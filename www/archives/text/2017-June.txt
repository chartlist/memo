From rusty at rustcorp.com.au  Thu Jun  1 01:28:20 2017
From: rusty at rustcorp.com.au (Rusty Russell)
Date: Thu, 01 Jun 2017 10:58:20 +0930
Subject: [bitcoin-dev] [RFC] Lightning invoice/payment format draft
Message-ID: <874lw0h4y3.fsf@rustcorp.com.au>

Hi all,

        There's a pull request for a lightning payment format which I'd
love wider review on.  It's bech32 encoded, with optional parts tagged:

        https://github.com/lightningnetwork/lightning-rfc/pull/183

There's an implementation with a less formal description here, too:

        https://github.com/rustyrussell/lightning-payencode

Example:
        Send 2500 microbitcoin using payment hash 00010203040506...0102 to me
        @03e7156ae33b0a208d0744199163177e909e80176e55d97a2f221ede0f934dd9ad
        within 1 minute from now (Tue 30 May 12:17:36 UTC 2017):

        lnbc2500u1qpvj6chqqqqsyqcyq5rqwzqfqqqsyqcyq5rqwzqfqqqsyqcyq5rqwzqfqypqdq5xysxxatsyp3k7enxv4jsxqz8slk6hqew9z5kzxyk33ast248j3ykmu3wncvgtgk0ewf5c6qnhen45vr43fmtzsh02j6ns096tcpfga0yfykc79e5uw3gh5ltr96q00zqppy6lfy

Thanks!
Rusty.

From karljohan-alm at garage.co.jp  Thu Jun  1 02:11:48 2017
From: karljohan-alm at garage.co.jp (Karl Johan Alm)
Date: Thu, 1 Jun 2017 11:11:48 +0900
Subject: [bitcoin-dev] Block Filter Digest profiling
Message-ID: <CALJw2w6zrdbn-xvDk9CpayqoDedbi5pFuwDyipeNO4hd9WjOog@mail.gmail.com>

Hello,

I have spent a fair bit of time trying to nail how exactly block
filter digests[1] should be done to optimize bandwidth, space,
resource usage.

The report can be found here: http://bc-2.jp/bfd-profile.pdf

This graph shows bandwidth use of 200 wallets simulated over 5000
blocks: http://bc-2.jp/bandwidth_bfd.png (black line is "sync once per
block" wallet, yellow is "sync once per 144 blocks" wallet, red is
average across all wallets).

An interesting insight made during the experiments: when allowing
digests to contain multiple blocks, the false positive rate of high
block count digests can be higher than normal, because the probability
of a false positive hit for a given entry in multiple digests,
assuming their sizes differ, is almost completely independent.

The results look rather promising to me, but I would like to hear
comments, in particular on the approach taken, if I made any faulty
assumptions, bad math mistakes, etc.

I am also curious what people consider to be acceptable costs in terms
of bandwidth use and memory (I couldn't find any stats on bandwidth
use of bloom filters). In the profiling, I restricted the field sizes
to 2^27 = 128 MB. I assumed this was appropriate as these fields are
very short lived, and in worst case, a client *could* do the scan and
decode simultaneously, without allocating up the space for the field
at all. For high block count digests (e.g. 1024 blocks), this is
sometimes overfilled. I wonder if 2^28 (256 MB) fields would be at all
acceptable or if an over-filled (high false positive rate) field is
better.

For that matter, I am not entirely sure 1024-block digests are
necessary, but they do come with an average 15 kb/block which is
pretty good.

I also wonder if the serialization approach taken is overkill or not.
It does save some space instead of simply storing "BBBAAAAA" but adds
some complexity that may not be warranted.

[1] https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2016-May/012636.html

From ZmnSCPxj at protonmail.com  Thu Jun  1 03:42:21 2017
From: ZmnSCPxj at protonmail.com (ZmnSCPxj)
Date: Wed, 31 May 2017 23:42:21 -0400
Subject: [bitcoin-dev] [Lightning-dev] [RFC] Lightning invoice/payment
	format draft
In-Reply-To: <874lw0h4y3.fsf@rustcorp.com.au>
References: <874lw0h4y3.fsf@rustcorp.com.au>
Message-ID: <LgBEZTIwZietTZKmz1eNigHGsoFPyrPFmGjxfpYuYqktbwXo6doj_Wfbsb9OGQ5VY1s-eTcBtJQ-qRUxTyRvZD3SPA2LkXbsVsZQ0xUiork=@protonmail.com>

Good morning Rusty,

The fact that amount is optional, and the separator character between human-readable and data is the character "1", may mean some trouble with parsing of the optional amount.

Currently, the version is 0, which translates to the character "q" appearing after "1". So 1q is obviously not an amount and is known to start the data part.

However, what happens when we decide to upgrade, and version is now 1, translating to character "p"?

If version 1 of invoice is avalialble, does a payment starting with lnbc1p .... indicate a 1 pico-bitcoin payment, or an arbitrary payment to a version-1 data part?

Or is amount not allowed to have character "1"? It seems a strange limitation if we impose this...

Or do I mistake my understanding of bech32?

Alternatively we can just fix the first 5 bits to be 0 (so "1q" is an unambiguous separator between human-readable and data parts) and provide the version by other means, such as changing lnbc to ln2bc or so on...

> simply reused here even though its 6-character checksum is optimized
> for human errors, which are unlikely given the length of lightning
> invoices.

At first read, this seems wrong. My understanding is that lightning invoices are longer than segwit addresses in bech32, so human error is more likely.

Of course, it seems that the intended meaning is really "lightning invoices are so long that it is unlikely humans will enter it by hand, so human errors are unlikely compared to QR reader errors etc." so perhaps better reworded as such.

Regards,
ZmnSCPxj
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170531/80a1f0d2/attachment.html>

From ZmnSCPxj at protonmail.com  Thu Jun  1 03:48:46 2017
From: ZmnSCPxj at protonmail.com (ZmnSCPxj)
Date: Wed, 31 May 2017 23:48:46 -0400
Subject: [bitcoin-dev] [Lightning-dev] [RFC] Lightning invoice/payment
	format draft
In-Reply-To: <LgBEZTIwZietTZKmz1eNigHGsoFPyrPFmGjxfpYuYqktbwXo6doj_Wfbsb9OGQ5VY1s-eTcBtJQ-qRUxTyRvZD3SPA2LkXbsVsZQ0xUiork=@protonmail.com>
References: <874lw0h4y3.fsf@rustcorp.com.au>
	<LgBEZTIwZietTZKmz1eNigHGsoFPyrPFmGjxfpYuYqktbwXo6doj_Wfbsb9OGQ5VY1s-eTcBtJQ-qRUxTyRvZD3SPA2LkXbsVsZQ0xUiork=@protonmail.com>
Message-ID: <Yvxsx9v_dQ2h0mJeS1lYDUQ2wL3k-Eq03IjY99YVwNFtItAQNdAMamEsgb21Q154g1tzbeq7OWAPVJ4XhallmiaD9cTH8CxLDfmsCsLov98=@protonmail.com>

Good morning,

>Or do I mistake my understanding of bech32?

Looking again at bech32 spec, yes, my understanding is wrong: the character "1" is not allowed in the data part, so the last "1" digit in the bech32 string is unambiguously the separator between the human-readable and data parts, please ignore me.

Regards,
ZmnSCPxj
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170531/2f45c053/attachment.html>

From andreas at schildbach.de  Thu Jun  1 05:54:37 2017
From: andreas at schildbach.de (Andreas Schildbach)
Date: Thu, 1 Jun 2017 07:54:37 +0200
Subject: [bitcoin-dev] [RFC] Lightning invoice/payment format draft
In-Reply-To: <874lw0h4y3.fsf@rustcorp.com.au>
References: <874lw0h4y3.fsf@rustcorp.com.au>
Message-ID: <ogoa6o$o4s$1@blaine.gmane.org>

In order for such messages to be dispatchable between apps, I suggest
prepending with an URI scheme, similar to the already existing
"bitcoin:" scheme.

Also I suggest defining a MIME type, e.g. for usage in NFC NDEF messages
or emails.

What is the relation of this BIP to BIP21 and BIP70-72? Is there a
reason for not extending BIP70?


On 06/01/2017 03:28 AM, Rusty Russell via bitcoin-dev wrote:
> Hi all,
> 
>         There's a pull request for a lightning payment format which I'd
> love wider review on.  It's bech32 encoded, with optional parts tagged:
> 
>         https://github.com/lightningnetwork/lightning-rfc/pull/183
> 
> There's an implementation with a less formal description here, too:
> 
>         https://github.com/rustyrussell/lightning-payencode
> 
> Example:
>         Send 2500 microbitcoin using payment hash 00010203040506...0102 to me
>         @03e7156ae33b0a208d0744199163177e909e80176e55d97a2f221ede0f934dd9ad
>         within 1 minute from now (Tue 30 May 12:17:36 UTC 2017):
> 
>         lnbc2500u1qpvj6chqqqqsyqcyq5rqwzqfqqqsyqcyq5rqwzqfqqqsyqcyq5rqwzqfqypqdq5xysxxatsyp3k7enxv4jsxqz8slk6hqew9z5kzxyk33ast248j3ykmu3wncvgtgk0ewf5c6qnhen45vr43fmtzsh02j6ns096tcpfga0yfykc79e5uw3gh5ltr96q00zqppy6lfy
> 
> Thanks!
> Rusty.
> 



From roconnor at blockstream.io  Thu Jun  1 15:10:56 2017
From: roconnor at blockstream.io (Russell O'Connor)
Date: Thu, 1 Jun 2017 11:10:56 -0400
Subject: [bitcoin-dev] A Method for Computing Merkle Roots of Annotated
 Binary Trees
In-Reply-To: <20170529161059.GA7698@fedora-23-dvm>
References: <CAMZUoK=f3hXHkqJBDfiLGSrgXi_ppgyH6+XWD9W54EYFWLm1+Q@mail.gmail.com>
	<20170528082624.GA14552@fedora-23-dvm>
	<CAMZUoK=8xaVp2Qoc7kvx8FdPbpY0rEpSba8kQVRQGjX4p0haxg@mail.gmail.com>
	<20170529161059.GA7698@fedora-23-dvm>
Message-ID: <CAMZUoKm6Oh4fp3nK3sTkfX+cu2Nuf6gKRs87Cu4w9Tm+G5Jb5Q@mail.gmail.com>

On Mon, May 29, 2017 at 12:10 PM, Peter Todd <pete at petertodd.org> wrote:

> On Mon, May 29, 2017 at 10:55:37AM -0400, Russell O'Connor wrote:
> > Some of this proposal can be salvaged, I think, by putting the hash of
> the
> > tags into Sha256Compress's first argument:
> >
> >     merkleRoot : Tree BitString -> Word256
> >     merkleRoot (Leaf (t))                := sha256Compress(sha256(t),
> > 0b0^512)
> >     merkleRoot (Unary (t, child))        := sha256Compress(sha256(t),
> > merkleRoot(child) ? 0b0^256)
> >     merkleRoot (Binary (t, left, right)) := sha256Compress(sha256(t),
> > merkleRoot(left) ? merkleRoot(right))
> >
> > The Merkle--Damg?rd property will still hold under the same conditions
> > about tags determining the type of node (Leaf, Unary, or Binary) while
> > avoiding the need for SHA256's padding.  If you have a small number of
> > tags, then you can pre-compute their hashes so that you only end up with
> > one call to SHA256 compress per node. If you have tags with a large
> amount
> > of data, you were going to be hashing them anyways.
>
> Notice how what you're proposing here is almost the same thing as using
> SHA256
> directly, modulo the fact that you skip the final block containing the
> message
> length.
>
> Similarly, you don't need to compute sha256(t) - you can just as easily
> compute
> the midstate sha256Compress(IV, t), and cache that midstate if you can
> reuse
> tags. Again, the only difference is the last block.
>

Yes, either way would be fine.


> > Unfortunately we lose the ability to cleverly avoid collisions between
> the
> > Sha256 and MerkleRoot functions by using safe tags.
>
> I think a better question to ask is why you want that property in the first
> place?
>
> My earlier python-proofmarshal(1) library had a scheme of per-use-case
> tags,
> but I eventually realised that depending on tags being unique is a
> footgun. For
> example, it's easy to see how two different systems could end up using the
> same
> tag due to designers forgetting to create new tags while copying and
> pasting
> old code. Similarly, if two such systems have to be integrated, you'll end
> up
> with tags getting reused for two different purposes.
>
> Now, if you design a system where that doesn't matter, then by extension
> it'll
> also be true that collisions between the sha256 and merkleroot functions
> don't
> matter either. And that system will be more robust to design mistakes, as
> tags
> only need to be unique "locally" to distinguish between different
> sub-types in
> a sum type (enum).
>

I was looking to add the property mostly because it was free to do with my
original design when the set of tags was small and could make some
applications more robust and/or easier to debug.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170601/80c03c9c/attachment.html>

From laolu32 at gmail.com  Thu Jun  1 19:01:14 2017
From: laolu32 at gmail.com (Olaoluwa Osuntokun)
Date: Thu, 01 Jun 2017 19:01:14 +0000
Subject: [bitcoin-dev] BIP Proposal: Compact Client Side Filtering for Light
	Clients
Message-ID: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>

Hi y'all,

Alex Akselrod and I would like to propose a new light client BIP for
consideration:
   * https://github.com/Roasbeef/bips/blob/master/gcs_light_client.mediawiki

This BIP proposal describes a concrete specification (along with a
reference implementations[1][2][3]) for the much discussed client-side
filtering reversal of BIP-37. The precise details are described in the
BIP, but as a summary: we've implemented a new light-client mode that uses
client-side filtering based off of Golomb-Rice coded sets. Full-nodes
maintain an additional index of the chain, and serve this compact filter
(the index) to light clients which request them. Light clients then fetch
these filters, query the locally and _maybe_ fetch the block if a relevant
item matches. The cool part is that blocks can be fetched from _any_
source, once the light client deems it necessary. Our primary motivation
for this work was enabling a light client mode for lnd[4] in order to
support a more light-weight back end paving the way for the usage of
Lightning on mobile phones and other devices. We've integrated neutrino
as a back end for lnd, and will be making the updated code public very
soon.

One specific area we'd like feedback on is the parameter selection. Unlike
BIP-37 which allows clients to dynamically tune their false positive rate,
our proposal uses a _fixed_ false-positive. Within the document, it's
currently specified as P = 1/2^20. We've done a bit of analysis and
optimization attempting to optimize the following sum:
filter_download_bandwidth + expected_block_false_positive_bandwidth. Alex
has made a JS calculator that allows y'all to explore the affect of
tweaking the false positive rate in addition to the following variables:
the number of items the wallet is scanning for, the size of the blocks,
number of blocks fetched, and the size of the filters themselves. The
calculator calculates the expected bandwidth utilization using the CDF of
the Geometric Distribution. The calculator can be found here:
https://aakselrod.github.io/gcs_calc.html. Alex also has an empirical
script he's been running on actual data, and the results seem to match up
rather nicely.

We we're excited to see that Karl Johan Alm (kallewoof) has done some
(rather extensive!) analysis of his own, focusing on a distinct encoding
type [5]. I haven't had the time yet to dig into his report yet, but I
think I've read enough to extract the key difference in our encodings: his
filters use a binomial encoding _directly_ on the filter contents, will we
instead create a Golomb-Coded set with the contents being _hashes_ (we use
siphash) of the filter items.

Using a fixed fp=20, I have some stats detailing the total index size, as
well as averages for both mainnet and testnet. For mainnet, using the
filter contents as currently described in the BIP (basic + extended), the
total size of the index comes out to 6.9GB. The break down is as follows:

    * total size:  6976047156
    * total avg:  14997.220622758816
    * total median:  3801
    * total max:  79155
    * regular size:  3117183743
    * regular avg:  6701.372750217131
    * regular median:  1734
    * regular max:  67533
    * extended size:  3858863413
    * extended avg:  8295.847872541684
    * extended median:  2041
    * extended max:  52508

In order to consider the average+median filter sizes in a world worth
larger blocks, I also ran the index for testnet:

    * total size:  2753238530
    * total avg:  5918.95736054141
    * total median:  60202
    * total max:  74983
    * regular size:  1165148878
    * regular avg:  2504.856172982827
    * regular median:  24812
    * regular max:  64554
    * extended size:  1588089652
    * extended avg:  3414.1011875585823
    * extended median:  35260
    * extended max:  41731

Finally, here are the testnet stats which take into account the increase
in the maximum filter size due to segwit's block-size increase. The max
filter sizes are a bit larger due to some of the habitual blocks I
created last year when testing segwit (transactions with 30k inputs, 30k
outputs, etc).

     * total size:  585087597
     * total avg:  520.8839608674402
     * total median:  20
     * total max:  164598
     * regular size:  299325029
     * regular avg:  266.4790836307566
     * regular median:  13
     * regular max:  164583
     * extended size:  285762568
     * extended avg:  254.4048772366836
     * extended median:  7
     * extended max:  127631

For those that are interested in the raw data, I've uploaded a CSV file
of raw data for each block (mainnet + testnet), which can be found here:
     * mainnet: (14MB):
https://www.dropbox.com/s/4yk2u8dj06njbuv/mainnet-gcs-stats.csv?dl=0
     * testnet: (25MB):
https://www.dropbox.com/s/w7dmmcbocnmjfbo/gcs-stats-testnet.csv?dl=0


We look forward to getting feedback from all of y'all!

-- Laolu


[1]: https://github.com/lightninglabs/neutrino
[2]: https://github.com/Roasbeef/btcd/tree/segwit-cbf
[3]: https://github.com/Roasbeef/btcutil/tree/gcs/gcs
[4]: https://github.com/lightningnetwork/lnd/

-- Laolu
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170601/dc7d95ae/attachment.html>

From elombrozo at gmail.com  Thu Jun  1 21:00:02 2017
From: elombrozo at gmail.com (Eric Lombrozo)
Date: Thu, 1 Jun 2017 14:00:02 -0700
Subject: [bitcoin-dev] BIP Proposal: Compact Client Side Filtering for
 Light Clients
In-Reply-To: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
References: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
Message-ID: <CABr1YTdQy9=XiCQOuSnLq_y1PDWg7mC=Wquv9YEFDW832J2NhQ@mail.gmail.com>

Thanks for sending this proposal! I look forward to having a great
discussion around this.

- Eric

On Thursday, June 1, 2017, Olaoluwa Osuntokun via bitcoin-dev <
bitcoin-dev at lists.linuxfoundation.org> wrote:

> Hi y'all,
>
> Alex Akselrod and I would like to propose a new light client BIP for
> consideration:
>    * https://github.com/Roasbeef/bips/blob/master/gcs_light_
> client.mediawiki
>
> This BIP proposal describes a concrete specification (along with a
> reference implementations[1][2][3]) for the much discussed client-side
> filtering reversal of BIP-37. The precise details are described in the
> BIP, but as a summary: we've implemented a new light-client mode that uses
> client-side filtering based off of Golomb-Rice coded sets. Full-nodes
> maintain an additional index of the chain, and serve this compact filter
> (the index) to light clients which request them. Light clients then fetch
> these filters, query the locally and _maybe_ fetch the block if a relevant
> item matches. The cool part is that blocks can be fetched from _any_
> source, once the light client deems it necessary. Our primary motivation
> for this work was enabling a light client mode for lnd[4] in order to
> support a more light-weight back end paving the way for the usage of
> Lightning on mobile phones and other devices. We've integrated neutrino
> as a back end for lnd, and will be making the updated code public very
> soon.
>
> One specific area we'd like feedback on is the parameter selection. Unlike
> BIP-37 which allows clients to dynamically tune their false positive rate,
> our proposal uses a _fixed_ false-positive. Within the document, it's
> currently specified as P = 1/2^20. We've done a bit of analysis and
> optimization attempting to optimize the following sum:
> filter_download_bandwidth + expected_block_false_positive_bandwidth. Alex
> has made a JS calculator that allows y'all to explore the affect of
> tweaking the false positive rate in addition to the following variables:
> the number of items the wallet is scanning for, the size of the blocks,
> number of blocks fetched, and the size of the filters themselves. The
> calculator calculates the expected bandwidth utilization using the CDF of
> the Geometric Distribution. The calculator can be found here:
> https://aakselrod.github.io/gcs_calc.html. Alex also has an empirical
> script he's been running on actual data, and the results seem to match up
> rather nicely.
>
> We we're excited to see that Karl Johan Alm (kallewoof) has done some
> (rather extensive!) analysis of his own, focusing on a distinct encoding
> type [5]. I haven't had the time yet to dig into his report yet, but I
> think I've read enough to extract the key difference in our encodings: his
> filters use a binomial encoding _directly_ on the filter contents, will we
> instead create a Golomb-Coded set with the contents being _hashes_ (we use
> siphash) of the filter items.
>
> Using a fixed fp=20, I have some stats detailing the total index size, as
> well as averages for both mainnet and testnet. For mainnet, using the
> filter contents as currently described in the BIP (basic + extended), the
> total size of the index comes out to 6.9GB. The break down is as follows:
>
>     * total size:  6976047156
>     * total avg:  14997.220622758816
>     * total median:  3801
>     * total max:  79155
>     * regular size:  3117183743
>     * regular avg:  6701.372750217131
>     * regular median:  1734
>     * regular max:  67533
>     * extended size:  3858863413
>     * extended avg:  8295.847872541684
>     * extended median:  2041
>     * extended max:  52508
>
> In order to consider the average+median filter sizes in a world worth
> larger blocks, I also ran the index for testnet:
>
>     * total size:  2753238530
>     * total avg:  5918.95736054141
>     * total median:  60202
>     * total max:  74983
>     * regular size:  1165148878
>     * regular avg:  2504.856172982827
>     * regular median:  24812
>     * regular max:  64554
>     * extended size:  1588089652
>     * extended avg:  3414.1011875585823
>     * extended median:  35260
>     * extended max:  41731
>
> Finally, here are the testnet stats which take into account the increase
> in the maximum filter size due to segwit's block-size increase. The max
> filter sizes are a bit larger due to some of the habitual blocks I
> created last year when testing segwit (transactions with 30k inputs, 30k
> outputs, etc).
>
>      * total size:  585087597
>      * total avg:  520.8839608674402
>      * total median:  20
>      * total max:  164598
>      * regular size:  299325029
>      * regular avg:  266.4790836307566
>      * regular median:  13
>      * regular max:  164583
>      * extended size:  285762568
>      * extended avg:  254.4048772366836
>      * extended median:  7
>      * extended max:  127631
>
> For those that are interested in the raw data, I've uploaded a CSV file
> of raw data for each block (mainnet + testnet), which can be found here:
>      * mainnet: (14MB): https://www.dropbox.com/s/
> 4yk2u8dj06njbuv/mainnet-gcs-stats.csv?dl=0
>      * testnet: (25MB): https://www.dropbox.com/s/
> w7dmmcbocnmjfbo/gcs-stats-testnet.csv?dl=0
>
>
> We look forward to getting feedback from all of y'all!
>
> -- Laolu
>
>
> [1]: https://github.com/lightninglabs/neutrino
> [2]: https://github.com/Roasbeef/btcd/tree/segwit-cbf
> [3]: https://github.com/Roasbeef/btcutil/tree/gcs/gcs
> [4]: https://github.com/lightningnetwork/lnd/
>
> -- Laolu
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170601/e4d43fdf/attachment-0001.html>

From lf-lists at mattcorallo.com  Thu Jun  1 21:33:43 2017
From: lf-lists at mattcorallo.com (Matt Corallo)
Date: Thu, 01 Jun 2017 21:33:43 +0000
Subject: [bitcoin-dev] BIP Proposal: Compact Client Side Filtering for
	Light	Clients
In-Reply-To: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
References: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
Message-ID: <B445007A-9FA3-4B1D-8CD0-F0371602DC5F@mattcorallo.com>

Quick comment before I finish reading it completely, looks like you have no way to match the input prevouts being spent, which is rather nice from a "watch for this output being spent" pov.

On June 1, 2017 3:01:14 PM EDT, Olaoluwa Osuntokun via bitcoin-dev <bitcoin-dev at lists.linuxfoundation.org> wrote:
>Hi y'all,
>
>Alex Akselrod and I would like to propose a new light client BIP for
>consideration:
>*
>https://github.com/Roasbeef/bips/blob/master/gcs_light_client.mediawiki
>
>This BIP proposal describes a concrete specification (along with a
>reference implementations[1][2][3]) for the much discussed client-side
>filtering reversal of BIP-37. The precise details are described in the
>BIP, but as a summary: we've implemented a new light-client mode that
>uses
>client-side filtering based off of Golomb-Rice coded sets. Full-nodes
>maintain an additional index of the chain, and serve this compact
>filter
>(the index) to light clients which request them. Light clients then
>fetch
>these filters, query the locally and _maybe_ fetch the block if a
>relevant
>item matches. The cool part is that blocks can be fetched from _any_
>source, once the light client deems it necessary. Our primary
>motivation
>for this work was enabling a light client mode for lnd[4] in order to
>support a more light-weight back end paving the way for the usage of
>Lightning on mobile phones and other devices. We've integrated neutrino
>as a back end for lnd, and will be making the updated code public very
>soon.
>
>One specific area we'd like feedback on is the parameter selection.
>Unlike
>BIP-37 which allows clients to dynamically tune their false positive
>rate,
>our proposal uses a _fixed_ false-positive. Within the document, it's
>currently specified as P = 1/2^20. We've done a bit of analysis and
>optimization attempting to optimize the following sum:
>filter_download_bandwidth + expected_block_false_positive_bandwidth.
>Alex
>has made a JS calculator that allows y'all to explore the affect of
>tweaking the false positive rate in addition to the following
>variables:
>the number of items the wallet is scanning for, the size of the blocks,
>number of blocks fetched, and the size of the filters themselves. The
>calculator calculates the expected bandwidth utilization using the CDF
>of
>the Geometric Distribution. The calculator can be found here:
>https://aakselrod.github.io/gcs_calc.html. Alex also has an empirical
>script he's been running on actual data, and the results seem to match
>up
>rather nicely.
>
>We we're excited to see that Karl Johan Alm (kallewoof) has done some
>(rather extensive!) analysis of his own, focusing on a distinct
>encoding
>type [5]. I haven't had the time yet to dig into his report yet, but I
>think I've read enough to extract the key difference in our encodings:
>his
>filters use a binomial encoding _directly_ on the filter contents, will
>we
>instead create a Golomb-Coded set with the contents being _hashes_ (we
>use
>siphash) of the filter items.
>
>Using a fixed fp=20, I have some stats detailing the total index size,
>as
>well as averages for both mainnet and testnet. For mainnet, using the
>filter contents as currently described in the BIP (basic + extended),
>the
>total size of the index comes out to 6.9GB. The break down is as
>follows:
>
>    * total size:  6976047156
>    * total avg:  14997.220622758816
>    * total median:  3801
>    * total max:  79155
>    * regular size:  3117183743
>    * regular avg:  6701.372750217131
>    * regular median:  1734
>    * regular max:  67533
>    * extended size:  3858863413
>    * extended avg:  8295.847872541684
>    * extended median:  2041
>    * extended max:  52508
>
>In order to consider the average+median filter sizes in a world worth
>larger blocks, I also ran the index for testnet:
>
>    * total size:  2753238530
>    * total avg:  5918.95736054141
>    * total median:  60202
>    * total max:  74983
>    * regular size:  1165148878
>    * regular avg:  2504.856172982827
>    * regular median:  24812
>    * regular max:  64554
>    * extended size:  1588089652
>    * extended avg:  3414.1011875585823
>    * extended median:  35260
>    * extended max:  41731
>
>Finally, here are the testnet stats which take into account the
>increase
>in the maximum filter size due to segwit's block-size increase. The max
>filter sizes are a bit larger due to some of the habitual blocks I
>created last year when testing segwit (transactions with 30k inputs,
>30k
>outputs, etc).
>
>     * total size:  585087597
>     * total avg:  520.8839608674402
>     * total median:  20
>     * total max:  164598
>     * regular size:  299325029
>     * regular avg:  266.4790836307566
>     * regular median:  13
>     * regular max:  164583
>     * extended size:  285762568
>     * extended avg:  254.4048772366836
>     * extended median:  7
>     * extended max:  127631
>
>For those that are interested in the raw data, I've uploaded a CSV file
>of raw data for each block (mainnet + testnet), which can be found
>here:
>     * mainnet: (14MB):
>https://www.dropbox.com/s/4yk2u8dj06njbuv/mainnet-gcs-stats.csv?dl=0
>     * testnet: (25MB):
>https://www.dropbox.com/s/w7dmmcbocnmjfbo/gcs-stats-testnet.csv?dl=0
>
>
>We look forward to getting feedback from all of y'all!
>
>-- Laolu
>
>
>[1]: https://github.com/lightninglabs/neutrino
>[2]: https://github.com/Roasbeef/btcd/tree/segwit-cbf
>[3]: https://github.com/Roasbeef/btcutil/tree/gcs/gcs
>[4]: https://github.com/lightningnetwork/lnd/
>
>-- Laolu

From laolu32 at gmail.com  Thu Jun  1 22:10:34 2017
From: laolu32 at gmail.com (Olaoluwa Osuntokun)
Date: Thu, 01 Jun 2017 22:10:34 +0000
Subject: [bitcoin-dev] BIP Proposal: Compact Client Side Filtering for
 Light Clients
In-Reply-To: <B445007A-9FA3-4B1D-8CD0-F0371602DC5F@mattcorallo.com>
References: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
	<B445007A-9FA3-4B1D-8CD0-F0371602DC5F@mattcorallo.com>
Message-ID: <CAO3Pvs-q89HDb9a9xtYMBm8RNtaQH1d+5B6S1YPk3C0JWM+vzA@mail.gmail.com>

Eric wrote:
> Thanks for sending this proposal! I look forward to having a great
> discussion around this.

Thanks Eric! We really appreciated the early feedback you gave on the
initial design.

One aspect which isn't in this BIP draft is direct support for unconfirmed
transactions. I consider such a feature an important UX feature for mobile
phones, and something which I've personally seen as an important
UX-experience when on-boarding new users to Bitcoin. This was brought up
in the original "bfd" mailing list chain [1]. Possible solutions are: a
new beefier INV message which contains enough information to be able to
identify relevant outputs created in a transaction, or a "streaming" p2p
extension that allows light clients to receive notifications of mempool
inclusion based on only (pkScript, amount) pairs.

Matt wrote:
> looks like you have no way to match the input prevouts being spent, which
> is rather nice from a "watch for this output being spent" pov.

Perhaps we didn't make this clear enough, but it _is_ indeed possible to
watch an output for spentness. Or maybe you mean matching on the
_script_ being spent?

>From the BIP draft:
> for each transaction, normal filters contain:
>  * The outpoints of each input within a transaction.
>  ...

Within the integration for lnd, we specifically use this feature to be
able to watch for when channels have been closed within the network graph,
or channels _directly_ under our control have been spent (either
unilateral channel closure, or a revocation beach).

-- Laolu

[1]:
https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-January/013397.html


On Thu, Jun 1, 2017 at 2:33 PM Matt Corallo <lf-lists at mattcorallo.com>
wrote:

> Quick comment before I finish reading it completely, looks like you have
> no way to match the input prevouts being spent, which is rather nice from a
> "watch for this output being spent" pov.
>
> On June 1, 2017 3:01:14 PM EDT, Olaoluwa Osuntokun via bitcoin-dev <
> bitcoin-dev at lists.linuxfoundation.org> wrote:
> >Hi y'all,
> >
> >Alex Akselrod and I would like to propose a new light client BIP for
> >consideration:
> >*
> >https://github.com/Roasbeef/bips/blob/master/gcs_light_client.mediawiki
> >
> >This BIP proposal describes a concrete specification (along with a
> >reference implementations[1][2][3]) for the much discussed client-side
> >filtering reversal of BIP-37. The precise details are described in the
> >BIP, but as a summary: we've implemented a new light-client mode that
> >uses
> >client-side filtering based off of Golomb-Rice coded sets. Full-nodes
> >maintain an additional index of the chain, and serve this compact
> >filter
> >(the index) to light clients which request them. Light clients then
> >fetch
> >these filters, query the locally and _maybe_ fetch the block if a
> >relevant
> >item matches. The cool part is that blocks can be fetched from _any_
> >source, once the light client deems it necessary. Our primary
> >motivation
> >for this work was enabling a light client mode for lnd[4] in order to
> >support a more light-weight back end paving the way for the usage of
> >Lightning on mobile phones and other devices. We've integrated neutrino
> >as a back end for lnd, and will be making the updated code public very
> >soon.
> >
> >One specific area we'd like feedback on is the parameter selection.
> >Unlike
> >BIP-37 which allows clients to dynamically tune their false positive
> >rate,
> >our proposal uses a _fixed_ false-positive. Within the document, it's
> >currently specified as P = 1/2^20. We've done a bit of analysis and
> >optimization attempting to optimize the following sum:
> >filter_download_bandwidth + expected_block_false_positive_bandwidth.
> >Alex
> >has made a JS calculator that allows y'all to explore the affect of
> >tweaking the false positive rate in addition to the following
> >variables:
> >the number of items the wallet is scanning for, the size of the blocks,
> >number of blocks fetched, and the size of the filters themselves. The
> >calculator calculates the expected bandwidth utilization using the CDF
> >of
> >the Geometric Distribution. The calculator can be found here:
> >https://aakselrod.github.io/gcs_calc.html. Alex also has an empirical
> >script he's been running on actual data, and the results seem to match
> >up
> >rather nicely.
> >
> >We we're excited to see that Karl Johan Alm (kallewoof) has done some
> >(rather extensive!) analysis of his own, focusing on a distinct
> >encoding
> >type [5]. I haven't had the time yet to dig into his report yet, but I
> >think I've read enough to extract the key difference in our encodings:
> >his
> >filters use a binomial encoding _directly_ on the filter contents, will
> >we
> >instead create a Golomb-Coded set with the contents being _hashes_ (we
> >use
> >siphash) of the filter items.
> >
> >Using a fixed fp=20, I have some stats detailing the total index size,
> >as
> >well as averages for both mainnet and testnet. For mainnet, using the
> >filter contents as currently described in the BIP (basic + extended),
> >the
> >total size of the index comes out to 6.9GB. The break down is as
> >follows:
> >
> >    * total size:  6976047156
> >    * total avg:  14997.220622758816
> >    * total median:  3801
> >    * total max:  79155
> >    * regular size:  3117183743
> >    * regular avg:  6701.372750217131
> >    * regular median:  1734
> >    * regular max:  67533
> >    * extended size:  3858863413 <(385)%20886-3413>
> >    * extended avg:  8295.847872541684
> >    * extended median:  2041
> >    * extended max:  52508
> >
> >In order to consider the average+median filter sizes in a world worth
> >larger blocks, I also ran the index for testnet:
> >
> >    * total size:  2753238530
> >    * total avg:  5918.95736054141
> >    * total median:  60202
> >    * total max:  74983
> >    * regular size:  1165148878
> >    * regular avg:  2504.856172982827
> >    * regular median:  24812
> >    * regular max:  64554
> >    * extended size:  1588089652
> >    * extended avg:  3414.1011875585823
> >    * extended median:  35260
> >    * extended max:  41731
> >
> >Finally, here are the testnet stats which take into account the
> >increase
> >in the maximum filter size due to segwit's block-size increase. The max
> >filter sizes are a bit larger due to some of the habitual blocks I
> >created last year when testing segwit (transactions with 30k inputs,
> >30k
> >outputs, etc).
> >
> >     * total size:  585087597
> >     * total avg:  520.8839608674402
> >     * total median:  20
> >     * total max:  164598
> >     * regular size:  299325029
> >     * regular avg:  266.4790836307566
> >     * regular median:  13
> >     * regular max:  164583
> >     * extended size:  285762568
> >     * extended avg:  254.4048772366836
> >     * extended median:  7
> >     * extended max:  127631
> >
> >For those that are interested in the raw data, I've uploaded a CSV file
> >of raw data for each block (mainnet + testnet), which can be found
> >here:
> >     * mainnet: (14MB):
> >https://www.dropbox.com/s/4yk2u8dj06njbuv/mainnet-gcs-stats.csv?dl=0
> >     * testnet: (25MB):
> >https://www.dropbox.com/s/w7dmmcbocnmjfbo/gcs-stats-testnet.csv?dl=0
> >
> >
> >We look forward to getting feedback from all of y'all!
> >
> >-- Laolu
> >
> >
> >[1]: https://github.com/lightninglabs/neutrino
> >[2]: https://github.com/Roasbeef/btcd/tree/segwit-cbf
> >[3]: https://github.com/Roasbeef/btcutil/tree/gcs/gcs
> >[4]: https://github.com/lightningnetwork/lnd/
> >
> >-- Laolu
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170601/25616960/attachment-0001.html>

From ctpacia at gmail.com  Fri Jun  2 02:15:16 2017
From: ctpacia at gmail.com (Chris)
Date: Thu, 1 Jun 2017 22:15:16 -0400
Subject: [bitcoin-dev] BIP Proposal: Compact Client Side Filtering for
 Light Clients
In-Reply-To: <CAO3Pvs-q89HDb9a9xtYMBm8RNtaQH1d+5B6S1YPk3C0JWM+vzA@mail.gmail.com>
References: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
	<B445007A-9FA3-4B1D-8CD0-F0371602DC5F@mattcorallo.com>
	<CAO3Pvs-q89HDb9a9xtYMBm8RNtaQH1d+5B6S1YPk3C0JWM+vzA@mail.gmail.com>
Message-ID: <73a6d59a-7e79-5d48-40cd-5c6f59abc122@gmail.com>

On 06/01/2017 06:10 PM, Olaoluwa Osuntokun via bitcoin-dev wrote:

> One aspect which isn't in this BIP draft is direct support for unconfirmed
> transactions. I consider such a feature an important UX feature for mobile
> phones, and something which I've personally seen as an important
> UX-experience when on-boarding new users to Bitcoin.

Totally agree. My first thought is maybe you could keep bip37 filtering
as optional for unconfirmed transactions. Since you're only interested
in incoming transactions in this case you can create one big filter with
all your wallet's addresses and reuse that filter. The bip37 privacy
issues mainly come up when trying to get the filter to match both
incoming and outgoing transactions, which is not needed in this case.

Otoh, if you download the block from the same peer that you gave a bip37
filter then they could probably test the txs in the block against both
filters. :/


From greg at xiph.org  Fri Jun  2 02:28:54 2017
From: greg at xiph.org (Gregory Maxwell)
Date: Fri, 2 Jun 2017 02:28:54 +0000
Subject: [bitcoin-dev] BIP Proposal: Compact Client Side Filtering for
 Light Clients
In-Reply-To: <73a6d59a-7e79-5d48-40cd-5c6f59abc122@gmail.com>
References: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
	<B445007A-9FA3-4B1D-8CD0-F0371602DC5F@mattcorallo.com>
	<CAO3Pvs-q89HDb9a9xtYMBm8RNtaQH1d+5B6S1YPk3C0JWM+vzA@mail.gmail.com>
	<73a6d59a-7e79-5d48-40cd-5c6f59abc122@gmail.com>
Message-ID: <CAAS2fgQv14qPV5d1xFjjxpoo4gj4pG1fBKLZs95vJFYa42zC9g@mail.gmail.com>

On Fri, Jun 2, 2017 at 2:15 AM, Chris via bitcoin-dev
<bitcoin-dev at lists.linuxfoundation.org> wrote:
> On 06/01/2017 06:10 PM, Olaoluwa Osuntokun via bitcoin-dev wrote:
>
>> One aspect which isn't in this BIP draft is direct support for unconfirmed
>> transactions. I consider such a feature an important UX feature for mobile
>> phones, and something which I've personally seen as an important
>> UX-experience when on-boarding new users to Bitcoin.
>
> Totally agree. My first thought is maybe you could keep bip37 filtering
> as optional for unconfirmed transactions. Since you're only interested

Really bad for privacy. Data for transactions at the tip is only
14kb/s-- potentially less if segwit is in use and you're not getting
witnesses. Is that really that burdensome?

FWIW, leaving a mobile browser just running while pointed at some
websites seems to use more traffic than that just loading advertising.
:)

From alex at akselrod.org  Fri Jun  2 03:35:29 2017
From: alex at akselrod.org (Alex Akselrod)
Date: Thu, 1 Jun 2017 23:35:29 -0400
Subject: [bitcoin-dev] BIP Proposal: Compact Client Side Filtering for
 Light Clients
In-Reply-To: <CAAS2fgQv14qPV5d1xFjjxpoo4gj4pG1fBKLZs95vJFYa42zC9g@mail.gmail.com>
References: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
	<B445007A-9FA3-4B1D-8CD0-F0371602DC5F@mattcorallo.com>
	<CAO3Pvs-q89HDb9a9xtYMBm8RNtaQH1d+5B6S1YPk3C0JWM+vzA@mail.gmail.com>
	<73a6d59a-7e79-5d48-40cd-5c6f59abc122@gmail.com>
	<CAAS2fgQv14qPV5d1xFjjxpoo4gj4pG1fBKLZs95vJFYa42zC9g@mail.gmail.com>
Message-ID: <CAE0pnxKD5+rE4aW86C-azrppnk5SaoEXBnwoJjh0mqQPzFSspQ@mail.gmail.com>

I agree with Greg and Laolu; BIP-37 filtering for transactions is no better
than for blocks and completely destroys privacy.

A constant stream of transactions is OK, but even cheaper for light clients
would be Laolu's proposal of streaming more tx data than existing inv
messages but less than existing tx messages.

We could make a bit field of things to include in every inv-with-metadata
message, such as:
- witness data
- scriptSig data pushes
- scriptPubKey
- hash of scriptPubKey (unnecessary if full scriptPubKey is sent)
- scriptPubKey data pushes
- etc.

This way a full node might be able to tell what application (or type of
application) a light client is running, but not the client's addresses or
outputs, except maybe when the client originates transactions.

On Thu, Jun 1, 2017 at 10:28 PM, Gregory Maxwell via bitcoin-dev <
bitcoin-dev at lists.linuxfoundation.org> wrote:

> On Fri, Jun 2, 2017 at 2:15 AM, Chris via bitcoin-dev
> <bitcoin-dev at lists.linuxfoundation.org> wrote:
> > On 06/01/2017 06:10 PM, Olaoluwa Osuntokun via bitcoin-dev wrote:
> >
> >> One aspect which isn't in this BIP draft is direct support for
> unconfirmed
> >> transactions. I consider such a feature an important UX feature for
> mobile
> >> phones, and something which I've personally seen as an important
> >> UX-experience when on-boarding new users to Bitcoin.
> >
> > Totally agree. My first thought is maybe you could keep bip37 filtering
> > as optional for unconfirmed transactions. Since you're only interested
>
> Really bad for privacy. Data for transactions at the tip is only
> 14kb/s-- potentially less if segwit is in use and you're not getting
> witnesses. Is that really that burdensome?
>
> FWIW, leaving a mobile browser just running while pointed at some
> websites seems to use more traffic than that just loading advertising.
> :)
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170601/cd98c32d/attachment.html>

From laolu32 at gmail.com  Fri Jun  2 04:49:16 2017
From: laolu32 at gmail.com (Olaoluwa Osuntokun)
Date: Fri, 02 Jun 2017 04:49:16 +0000
Subject: [bitcoin-dev] BIP Proposal: Compact Client Side Filtering for
	Light Clients
In-Reply-To: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
References: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
Message-ID: <CAO3Pvs-nNQR_53_wjS4rPU8W20kePnrSdBvCXMwpaOG7gpUNJQ@mail.gmail.com>

> In order to consider the average+median filter sizes in a world worth
larger
> blocks, I also ran the index for testnet:
>
>     * total size:  2753238530
>     * total avg:  5918.95736054141
>     * total median:  60202
>     * total max:  74983
>     * regular size:  1165148878
>     * regular avg:  2504.856172982827
>     * regular median:  24812
>     * regular max:  64554
>     * extended size:  1588089652
>     * extended avg:  3414.1011875585823
>     * extended median:  35260
>     * extended max:  41731
>

Oops, realized I made a mistake. These are the stats for Feb 2016 until
about a
month ago (since height 400k iirc).

-- Laolu


On Thu, Jun 1, 2017 at 12:01 PM Olaoluwa Osuntokun <laolu32 at gmail.com>
wrote:

> Hi y'all,
>
> Alex Akselrod and I would like to propose a new light client BIP for
> consideration:
>    *
> https://github.com/Roasbeef/bips/blob/master/gcs_light_client.mediawiki
>
> This BIP proposal describes a concrete specification (along with a
> reference implementations[1][2][3]) for the much discussed client-side
> filtering reversal of BIP-37. The precise details are described in the
> BIP, but as a summary: we've implemented a new light-client mode that uses
> client-side filtering based off of Golomb-Rice coded sets. Full-nodes
> maintain an additional index of the chain, and serve this compact filter
> (the index) to light clients which request them. Light clients then fetch
> these filters, query the locally and _maybe_ fetch the block if a relevant
> item matches. The cool part is that blocks can be fetched from _any_
> source, once the light client deems it necessary. Our primary motivation
> for this work was enabling a light client mode for lnd[4] in order to
> support a more light-weight back end paving the way for the usage of
> Lightning on mobile phones and other devices. We've integrated neutrino
> as a back end for lnd, and will be making the updated code public very
> soon.
>
> One specific area we'd like feedback on is the parameter selection. Unlike
> BIP-37 which allows clients to dynamically tune their false positive rate,
> our proposal uses a _fixed_ false-positive. Within the document, it's
> currently specified as P = 1/2^20. We've done a bit of analysis and
> optimization attempting to optimize the following sum:
> filter_download_bandwidth + expected_block_false_positive_bandwidth. Alex
> has made a JS calculator that allows y'all to explore the affect of
> tweaking the false positive rate in addition to the following variables:
> the number of items the wallet is scanning for, the size of the blocks,
> number of blocks fetched, and the size of the filters themselves. The
> calculator calculates the expected bandwidth utilization using the CDF of
> the Geometric Distribution. The calculator can be found here:
> https://aakselrod.github.io/gcs_calc.html. Alex also has an empirical
> script he's been running on actual data, and the results seem to match up
> rather nicely.
>
> We we're excited to see that Karl Johan Alm (kallewoof) has done some
> (rather extensive!) analysis of his own, focusing on a distinct encoding
> type [5]. I haven't had the time yet to dig into his report yet, but I
> think I've read enough to extract the key difference in our encodings: his
> filters use a binomial encoding _directly_ on the filter contents, will we
> instead create a Golomb-Coded set with the contents being _hashes_ (we use
> siphash) of the filter items.
>
> Using a fixed fp=20, I have some stats detailing the total index size, as
> well as averages for both mainnet and testnet. For mainnet, using the
> filter contents as currently described in the BIP (basic + extended), the
> total size of the index comes out to 6.9GB. The break down is as follows:
>
>     * total size:  6976047156
>     * total avg:  14997.220622758816
>     * total median:  3801
>     * total max:  79155
>     * regular size:  3117183743
>     * regular avg:  6701.372750217131
>     * regular median:  1734
>     * regular max:  67533
>     * extended size:  3858863413 <(385)%20886-3413>
>     * extended avg:  8295.847872541684
>     * extended median:  2041
>     * extended max:  52508
>
> In order to consider the average+median filter sizes in a world worth
> larger blocks, I also ran the index for testnet:
>
>     * total size:  2753238530
>     * total avg:  5918.95736054141
>     * total median:  60202
>     * total max:  74983
>     * regular size:  1165148878
>     * regular avg:  2504.856172982827
>     * regular median:  24812
>     * regular max:  64554
>     * extended size:  1588089652
>     * extended avg:  3414.1011875585823
>     * extended median:  35260
>     * extended max:  41731
>
> Finally, here are the testnet stats which take into account the increase
> in the maximum filter size due to segwit's block-size increase. The max
> filter sizes are a bit larger due to some of the habitual blocks I
> created last year when testing segwit (transactions with 30k inputs, 30k
> outputs, etc).
>
>      * total size:  585087597
>      * total avg:  520.8839608674402
>      * total median:  20
>      * total max:  164598
>      * regular size:  299325029
>      * regular avg:  266.4790836307566
>      * regular median:  13
>      * regular max:  164583
>      * extended size:  285762568
>      * extended avg:  254.4048772366836
>      * extended median:  7
>      * extended max:  127631
>
> For those that are interested in the raw data, I've uploaded a CSV file
> of raw data for each block (mainnet + testnet), which can be found here:
>      * mainnet: (14MB):
> https://www.dropbox.com/s/4yk2u8dj06njbuv/mainnet-gcs-stats.csv?dl=0
>      * testnet: (25MB):
> https://www.dropbox.com/s/w7dmmcbocnmjfbo/gcs-stats-testnet.csv?dl=0
>
>
> We look forward to getting feedback from all of y'all!
>
> -- Laolu
>
>
> [1]: https://github.com/lightninglabs/neutrino
> [2]: https://github.com/Roasbeef/btcd/tree/segwit-cbf
> [3]: https://github.com/Roasbeef/btcutil/tree/gcs/gcs
> [4]: https://github.com/lightningnetwork/lnd/
>
> -- Laolu
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170602/9382743e/attachment-0001.html>

From karljohan-alm at garage.co.jp  Fri Jun  2 06:00:30 2017
From: karljohan-alm at garage.co.jp (Karl Johan Alm)
Date: Fri, 2 Jun 2017 15:00:30 +0900
Subject: [bitcoin-dev] BIP Proposal: Compact Client Side Filtering for
 Light Clients
In-Reply-To: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
References: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
Message-ID: <CALJw2w5gUgbdX7XnxPsK2FZ6PZ5cSTgmCEqiPu7-S4gwXBM-_Q@mail.gmail.com>

Hello,

Really wish I'd known you were working on this a few weeks ago, but
such is life. Hopefully I can provide some useful feedback.

On Fri, Jun 2, 2017 at 4:01 AM, Olaoluwa Osuntokun via bitcoin-dev
<bitcoin-dev at lists.linuxfoundation.org> wrote:
> Full-nodes
> maintain an additional index of the chain, and serve this compact filter
> (the index) to light clients which request them. Light clients then fetch
> these filters, query the locally and _maybe_ fetch the block if a relevant
> item matches.

Is it necessary to maintain the index all the way to the beginning of
the chain? When would clients request "really old digests" and why?

> One specific area we'd like feedback on is the parameter selection. Unlike
> BIP-37 which allows clients to dynamically tune their false positive rate,
> our proposal uses a _fixed_ false-positive. Within the document, it's
> currently specified as P = 1/2^20. We've done a bit of analysis and
> optimization attempting to optimize the following sum:
> filter_download_bandwidth + expected_block_false_positive_bandwidth. Alex
> has made a JS calculator that allows y'all to explore the affect of
> tweaking the false positive rate in addition to the following variables:
> the number of items the wallet is scanning for, the size of the blocks,
> number of blocks fetched, and the size of the filters themselves. The
> calculator calculates the expected bandwidth utilization using the CDF of
> the Geometric Distribution. The calculator can be found here:
> https://aakselrod.github.io/gcs_calc.html. Alex also has an empirical
> script he's been running on actual data, and the results seem to match up
> rather nicely.

I haven't tried the tool yet, and maybe it will answer some of my questions.

On what data were the simulated wallets on actual data based? How did
false positive rates for wallets with lots of items (pubkeys etc) play
out? Is there a maximum number of items for a wallet before it becomes
too bandwidth costly to use digests?

> We we're excited to see that Karl Johan Alm (kallewoof) has done some
> (rather extensive!) analysis of his own, focusing on a distinct encoding
> type [5]. I haven't had the time yet to dig into his report yet, but I
> think I've read enough to extract the key difference in our encodings: his
> filters use a binomial encoding _directly_ on the filter contents, will we
> instead create a Golomb-Coded set with the contents being _hashes_ (we use
> siphash) of the filter items.

I will definitely try to reproduce my experiments with Golomb-Coded
sets and see what I come up with. It seems like you've got a little
less than half the size of my digests for 1-block digests but I
haven't tried making digests for all blocks (and lots of early blocks
are empty).

On the BIP proposal itself:

In Compact Filter Header Chain, you mention that clients should
download filters from nodes if filter_headers is not identical, and
ban offending nodes. What about temporary forks in the chain? What
about longer forks? In general, I am curious how you will deal with
reorgs and temporary non-consensus related chain splits.

I am also curious if you have considered digests containing multiple
blocks. Retaining a permanent binsearchable record of the entire chain
is obviously too space costly, but keeping the last X blocks as
binsearchable could speed up syncing for clients tremendously, I feel.

It may also be space efficient to ONLY store older digests in chunks
of e.g. 8 blocks. A client syncing up finding a match in an 8-block
chunk would have to grab those 8 blocks, but if it's not recent, that
may be acceptable. It may even be possible to make 4-, 2-, 1-block
digests on demand.

How fast are these to create? Would it make sense to provide digests
on demand in some cases, rather than keeping them around indefinitely?

From rebroad+linuxfoundation.org at gmail.com  Fri Jun  2 12:29:19 2017
From: rebroad+linuxfoundation.org at gmail.com (R E Broadley)
Date: Fri, 2 Jun 2017 14:29:19 +0200
Subject: [bitcoin-dev] Segwit2Mb - combined soft/hard fork - Request For
	Comments
In-Reply-To: <CAKzdR-qYjK0WHL51x4wJGpBuqjUu-Q8nBEPcLfj_qao=b-ZzaA@mail.gmail.com>
References: <CAKzdR-oN6tGvGSb04_awCf=Jsf3wgKJN5xUhCr8G2D2W9YgJww@mail.gmail.com>
	<CADJgMztpmcC_rv_oKYn_jRhLzx2FbtxgPUshcPDJpQVZYBcJzw@mail.gmail.com>
	<CAKzdR-qYjK0WHL51x4wJGpBuqjUu-Q8nBEPcLfj_qao=b-ZzaA@mail.gmail.com>
Message-ID: <CAFBxzAD4C_0DwzRw4M=e2bASPPT-wgD7jM=LVpnMzM3Ki+j0NQ@mail.gmail.com>

Miner signalling is not enough to avoid two forks - as has been proven in
the past (e.g. when miners signaled they were fully validating blocks when
there we in fact only validating headers). To really protect against two
forks happening, the code needs to detect this happening (i.e. monitor the
other fork) and if it's clear that the signalling was dishonest, then it
needs to abort, IMHO.

On Thu, Apr 6, 2017 at 10:42 PM, Sergio Demian Lerner via bitcoin-dev <
bitcoin-dev at lists.linuxfoundation.org> wrote:

> The 95% miner signaling is important to prevent two Bitcoin forks, such as
> what happened with Ethereum HF and Ethereum Classic.
>
> Bitcoin has a very slow difficulty re-targeting algorithm. A fork that has
> just 95% miner support will initially (for 2016 blocks) be 5% slower (an
> average block every 10 minutes and 30 seconds). The transaction capacity of
> the new Bitcoin protocol is reduced only 5%.
> However the chain with 5% if the hashing power not only has a 20x capacity
> reduction, but confirms transactions in 20x more time. So the mempool will
> grow 400 times. It must be noted that fees increased 10x from the moment
> blocks were half full, to the moment blocks became saturated. I'm sure no
> Bitcoin (pre-fork) user will be willing to pay 100x times the transaction
> fees to use such a slow and insecure network.
>
> So a 6-block confirmation will take 20 hours in the original chain and the
> original chain will be in this almost useless slow state for an average of
> 2016 blocks, or 280 days.
> If the original blockchain hard-forks to re-adjust the difficulty, then it
> will just represent an alt-coin having 5% of Bitcoin community, and it
> can't affect Bitcoin (the segwit2mb fork).
>
>
> On Mon, Apr 3, 2017 at 11:40 AM, Btc Drak <btcdrak at gmail.com> wrote:
>
>> On Fri, Mar 31, 2017 at 10:09 PM, Sergio Demian Lerner via bitcoin-dev <
>> bitcoin-dev at lists.linuxfoundation.org> wrote:
>>
>>> The hard-fork is conditional to 95% of the hashing power has approved
>>> the segwit2mb soft-fork and the segwit soft-fork has been activated (which
>>> should occur 2016 blocks after its lock-in time)
>>>
>>
>> Miners signalling they have upgraded by flipping a bit in the nVersion
>> field has little relevance in a hard fork. If 100% of the hash power
>> indicates they are running this proposal, but the nodes don't upgrade, what
>> will happen?
>>
>> For the record, I actually talk a lot about hard forks with various
>> developers and am very interested in the research that Johnson in
>> particular is pioneering. However, I have failed to understand your point
>> about 95% miner signalling in relation to a hard fork, so I am eagerly
>> awaiting your explanation.
>>
>
>
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170602/ee6c0677/attachment.html>

From ctpacia at gmail.com  Fri Jun  2 16:07:17 2017
From: ctpacia at gmail.com (Chris Pacia)
Date: Fri, 2 Jun 2017 12:07:17 -0400
Subject: [bitcoin-dev] BIP Proposal: Compact Client Side Filtering for
 Light Clients
In-Reply-To: <CAAS2fgQv14qPV5d1xFjjxpoo4gj4pG1fBKLZs95vJFYa42zC9g@mail.gmail.com>
References: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
	<B445007A-9FA3-4B1D-8CD0-F0371602DC5F@mattcorallo.com>
	<CAO3Pvs-q89HDb9a9xtYMBm8RNtaQH1d+5B6S1YPk3C0JWM+vzA@mail.gmail.com>
	<73a6d59a-7e79-5d48-40cd-5c6f59abc122@gmail.com>
	<CAAS2fgQv14qPV5d1xFjjxpoo4gj4pG1fBKLZs95vJFYa42zC9g@mail.gmail.com>
Message-ID: <CAB+qUq41kkbLKM1w5tJMEJ6yheygTXx2CnOQv8VTzD452e+pNQ@mail.gmail.com>

On Jun 1, 2017 10:28 PM, "Gregory Maxwell" <greg at xiph.org> wrote:


Really bad for privacy.


As I mentioned the issue is the potential collision with the block filter,
but bloom filters by themselves aren't inherently bad for privacy. They
just reduce the anonymity set. The reason bip37 doesn't work for privacy is
how the filters have to be used/abused to make it work. That's not what I
mentioned above.

Data for transactions at the tip is only

14kb/s-- potentially less if segwit is in use and you're not getting
witnesses. Is that really that burdensome?


Your not running that on mobile.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170602/bace51b4/attachment.html>

From alex at akselrod.org  Fri Jun  2 17:55:31 2017
From: alex at akselrod.org (Alex Akselrod)
Date: Fri, 2 Jun 2017 13:55:31 -0400
Subject: [bitcoin-dev] BIP Proposal: Compact Client Side Filtering for
 Light Clients
In-Reply-To: <CAE0pnxJxHYQ4+2pt3tt=1WZ0-K0vDxGB4KBXY+R=WfktMmATwA@mail.gmail.com>
References: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
	<CALJw2w5gUgbdX7XnxPsK2FZ6PZ5cSTgmCEqiPu7-S4gwXBM-_Q@mail.gmail.com>
	<CAE0pnx+RRAP269VeWAcxKbrcS9qX4LS8_6nY_js8X5NtQ22t_A@mail.gmail.com>
	<CAE0pnxLKYnwHnktTqW949s1AA9uK=6WnVYWmRoau8B1SszzYEg@mail.gmail.com>
	<CAE0pnxJxHYQ4+2pt3tt=1WZ0-K0vDxGB4KBXY+R=WfktMmATwA@mail.gmail.com>
Message-ID: <CAE0pnxK5r2XfVks=emkK=v66XRN5c-Sz-Lm_dKY+6nO=kPk6Vw@mail.gmail.com>

On Jun 2, 2017 8:09 AM, "Karl Johan Alm via bitcoin-dev" <
bitcoin-dev at lists.linuxfoundation.org> wrote:

Hello,

Really wish I'd known you were working on this a few weeks ago, but
such is life. Hopefully I can provide some useful feedback.


Your feedback is greatly appreciated!


On Fri, Jun 2, 2017 at 4:01 AM, Olaoluwa Osuntokun via bitcoin-dev
<bitcoin-dev at lists.linuxfoundation.org> wrote:
> Full-nodes
> maintain an additional index of the chain, and serve this compact filter
> (the index) to light clients which request them. Light clients then fetch
> these filters, query the locally and _maybe_ fetch the block if a relevant
> item matches.

Is it necessary to maintain the index all the way to the beginning of
the chain? When would clients request "really old digests" and why?


Without a soft fork, this is the only way for light clients to verify that
peers aren't lying to them. Clients can request headers (just hashes of the
filters and the previous headers, creating a chain) and look for conflicts
between peers. If a conflict is found at a certain block, the client can
download the block, generate a filter, calculate the header by hashing
together the previous header and the generated filter, and banning any
peers that don't match. A full node could prune old filters if you wanted
and recalculate them as necessary if you just keep the filter header chain
info as really old filters are unlikely to be requested by correctly
written software but you can't guarantee every client will follow best
practices either.


> The calculator can be found here:
> https://aakselrod.github.io/gcs_calc.html. Alex also has an empirical
> script he's been running on actual data, and the results seem to match up
> rather nicely.

I haven't tried the tool yet, and maybe it will answer some of my questions.

On what data were the simulated wallets on actual data based? How did
false positive rates for wallets with lots of items (pubkeys etc) play
out? Is there a maximum number of items for a wallet before it becomes
too bandwidth costly to use digests?


The simulations are based on completely random data within given
parameters. For example, it will generate a wallet of a specified size and
generate blocks of specified size with specified number of transactions of
specified format, all guaranteed to not match the wallet. It then tries to
match the wallet and tracks the filter size and the bandwidth used by block
downloads which are all due to false positives. The maximum wallet size can
be millions or more of addresses and outpoints before the filter isn't
worth it.

I published the simulation code at
https://gist.github.com/aakselrod/0ee665205f7c9538c2339876b0424b26 but the
calculation code gives you the same results (on average but very close with
a big enough sample size) much faster.

I will definitely try to reproduce my experiments with Golomb-Coded
sets and see what I come up with. It seems like you've got a little
less than half the size of my digests for 1-block digests but I
haven't tried making digests for all blocks (and lots of early blocks
are empty).


Filters for empty blocks only take a few bytes and sometimes zero when the
coinbase output is a burn that doesn't push any data (example will be in
the test vectors that I'll have ready shortly).

On the BIP proposal itself:

In Compact Filter Header Chain, you mention that clients should
download filters from nodes if filter_headers is not identical, and
ban offending nodes. What about temporary forks in the chain? What
about longer forks? In general, I am curious how you will deal with
reorgs and temporary non-consensus related chain splits.


The cfheaders messages give you the hash of the final block for which
there's a header in the message. This means you can ignore the message as
necessary rather than ban the peer, or track cfheaders for multiple forks
if desired.


I am also curious if you have considered digests containing multiple
blocks. Retaining a permanent binsearchable record of the entire chain
is obviously too space costly, but keeping the last X blocks as
binsearchable could speed up syncing for clients tremendously, I feel.


We hadn't (or I hadn't) until we read your recent post/paper and are
considering it now.


It may also be space efficient to ONLY store older digests in chunks
of e.g. 8 blocks. A client syncing up finding a match in an 8-block
chunk would have to grab those 8 blocks, but if it's not recent, that
may be acceptable. It may even be possible to make 4-, 2-, 1-block
digests on demand.


This is also something we (or at least I) hadn't considered before your
recent post. We have been working on this for a few months now so didn't
have time to work on trying out and possibly incorporating the idea before
release.

How fast are these to create? Would it make sense to provide digests
on demand in some cases, rather than keeping them around indefinitely?


They're pretty fast and can be pruned if desired, as mentioned above, as
long as the header chain is kept.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170602/9cfa5e6e/attachment-0001.html>

From erik at q32.com  Fri Jun  2 20:04:16 2017
From: erik at q32.com (Erik Aronesty)
Date: Fri, 2 Jun 2017 16:04:16 -0400
Subject: [bitcoin-dev] Segwit2Mb - combined soft/hard fork - Request For
	Comments
In-Reply-To: <CAAWeQ5ebqmmGcYHtoizKa6FXYyvyPSBM09kpzeGOEqJj4=ERZg@mail.gmail.com>
References: <CAKzdR-oN6tGvGSb04_awCf=Jsf3wgKJN5xUhCr8G2D2W9YgJww@mail.gmail.com>
	<1CF1FD5D-8D29-4783-823F-B3F588D5C5CE@mattcorallo.com>
	<CAKzdR-o0_CK1RPDKSV869Tk5JCo9KOmEoAyXYRAOphu00K8KkQ@mail.gmail.com>
	<CAAWeQ5ebqmmGcYHtoizKa6FXYyvyPSBM09kpzeGOEqJj4=ERZg@mail.gmail.com>
Message-ID: <CAJowKgLA94HirOrEJ7MMtxdLVYFNXV1aB5j=W+bGyckubV1xhw@mail.gmail.com>

>From me to you ...this proposal doesn't lock in anything.   We could just
merge it with some small pushback - allow segwit to activate in Aug, then
"upgrade" the hard fork to be "spoonet in 18 months" instead.

On Fri, Mar 31, 2017 at 11:03 PM, Samson Mow via bitcoin-dev <
bitcoin-dev at lists.linuxfoundation.org> wrote:

> A compromise for the sake of compromise doesn't merit technical
> discussions. There are no benefits to be gained from a 2MB hard-fork at
> this time and it would impose an unnecessary cost to the ecosystem for
> testing and implementation.
>
> On Fri, Mar 31, 2017 at 3:13 PM, Sergio Demian Lerner via bitcoin-dev <
> bitcoin-dev at lists.linuxfoundation.org> wrote:
>
>>
>>
>> On Fri, Mar 31, 2017 at 6:22 PM, Matt Corallo <lf-lists at mattcorallo.com>
>> wrote:
>>
>>> Hey Sergio,
>>>
>>> You appear to have ignored the last two years of Bitcoin hardfork
>>> research and understanding, recycling instead BIP 102 from 2015. There
>>> are many proposals which have pushed the state of hard fork research
>>> much further since then, and you may wish to read some of the posts on
>>> this mailing list listed at https://bitcoinhardforkresearch.github.io/
>>> and make further edits based on what you learn.
>>
>>
>> I've read every proposal that was published in the last two years and the
>> choice for NOT implementing any of the super cool research you cite is
>> intentional.
>>
>> We're in a deadlock and it seems we can't go forward adding more
>> functionality to segwit without the community approval (which include
>> miners). This is obvious to me.Then we have to go back.
>>
>> If this last resort solution is merged, we could go back to discuss
>> improvements with the
>>
>> Your goal of "avoid
>>> technical changes" appears to not have any basis outside of perceived
>>> compromise for compromise sake, only making such a hardfork riskier
>>> instead.
>>>
>>> You're are totally correct. It's a compromise for the compromise sake. I
>> couldn't have expressed it more clearly. However the only "riskier" element
>> is the hard forking date. We can move the date forward.
>>
>>
>>> At a minimum, in terms of pure technical changes, you should probably
>>> consider (probably among others):
>>>
>> a) Utilizing the "hard fork signaling bit" in the nVersion of the block.
>>>
>>
>> This I could consider, as it requires probably a single line of code.
>> Which BIP specifies this?
>>
>>
>>> b) Either limiting non-SegWit transactions in some way to fix the n**2
>>> sighash and FindAndDelete runtime and memory usage issues or fix them by
>>> utilizing the new sighash type which many wallets and projects have
>>> already implemented for SegWit in the spending of non-SegWit outputs.
>>>
>>
>> The Seghash problem has already been addressed by limiting the maximum
>> size of a transaction to 1 Mb.
>> The FindAndDelete problem has already been solved by the Core Developers,
>> so we don't have to worry about it anymore.
>>
>>
>>> c) Your really should have replay protection in any HF.
>>
>>
>> We could add a simple protection, although if we reach community
>> consensus and 95% of hashing power, does we really need to? Can the old
>> chain still be alive?
>> If more people ask for replay protection, I will merge Spoonet scheme or
>> develop the minimum possible replay protection (a simple signaling bit in
>> transaction version)
>>
>>
>>> d) You may wish to consider the possibility of tweaking the witness
>>> discount and possibly discounting other parts of the input - SegWit went
>>> a long ways towards making removal of elements from the UTXO set cheaper
>>> than adding them, but didn't quite get there, you should probably finish
>>> that job. This also provides additional tuneable parameters to allow you
>>> to increase the block size while not having a blowup in the worst-case
>>> block size.
>>>
>>
>> That is an interesting economic change and would be out of the scope of
>> segwit2mb.
>>
>>
>>> e) Additional commitments at the top of the merkle root - both for
>>> SegWit transactions and as additional space for merged mining and other
>>> commitments which we may wish to add in the future, this should likely
>>> be implemented an "additional header" ala Johnson Lau's Spoonnet
>>> proposal.
>>>
>>> That is an interesting technical improvement that is out of the scope of
>> segwit2mb.
>> We can keep discussing spoonet while we merge segwit2mb, as spoonnet
>> includes most of technical innovations.
>>
>>
>>> Additionally, I think your parameters here pose very significant risk to
>>> the Bitcoin ecosystem broadly.
>>>
>>> a) Activating a hard fork with less than 18/24 months (and even then...)
>>> from a fully-audited and supported release of full node software to
>>> activation date poses significant risks to many large software projects
>>> and users. I've repeatedly received feedback from various folks that a
>>> year or more is likely required in any hard fork to limit this risk, and
>>> limited pushback on that given the large increase which SegWit provides
>>> itself buying a ton of time.
>>>
>>> The feedback I received is slightly different from your feedback. Many
>> company CTOs have expressed that one year for a Bitcoin hard-fork was
>> period they could schedule a secure upgrade.
>>
>>
>>
>>> b) Having a significant discontinuity in block size increase only serves
>>> to confuse and mislead users and businesses, forcing them to rapidly
>>> adapt to a Bitcoin which changed overnight both by hardforking, and by
>>> fees changing suddenly. Instead, having the hard fork activate technical
>>> changes, and then slowly increasing the block size over the following
>>> several years keeps things nice and continuous and also keeps us from
>>> having to revisit ye old blocksize debate again six months after
>>> activation.
>>>
>>> This is something worth considering. There is the old Pieter BIP103
>> proposal has good parameters (17.7% per year).
>>
>> c) You should likely consider the effect of the many technological
>>> innovations coming down the pipe in the coming months. Technologies like
>>> Lightning, TumbleBit, and even your own RootStock could significantly
>>> reduce fee pressure as transactions move to much faster and more
>>> featureful systems.
>>>
>>> RSK sidechain team would have to take very tough decisions if Bitcoin
>> splits, as RSK platform cannot be pegged to two different cryptocurrencies.
>> We could launch two platforms, but RSK value proposition is "supporting the
>> advance of Bitcoin, the cryptocurrecy with highest network effect". You
>> understand that if Bitcoin splits Bitcoin BTC/BTU separately may cease to
>> be the cryptocurrencies with higher volume/market cap/network effect.
>>
>> Therefore all RSK people that I talked too would prefer to avoid a split
>> at all cost, reather that to be the winners of the scaling war.
>>
>>
>>
>>> On March 31, 2017 5:09:18 PM EDT, Sergio Demian Lerner via bitcoin-dev <
>>> bitcoin-dev at lists.linuxfoundation.org> wrote:
>>> >Hi everyone,
>>> >
>>> >Segwit2Mb is the project to merge into Bitcoin a minimal patch that
>>> >aims to
>>> >untangle the current conflict between different political positions
>>> >regarding segwit activation vs. an increase of the on-chain blockchain
>>> >space through a standard block size increase. It is not a new solution,
>>> >but
>>> >it should be seen more as a least common denominator.
>>> >
>>> >Segwit2Mb combines segwit as it is today in Bitcoin 0.14+ with a 2MB
>>> >block
>>> >size hard-fork activated ONLY if segwit activates (95% of miners
>>> >signaling), but at a fixed future date.
>>> >
>>> >The sole objective of this proposal is to re-unite the Bitcoin
>>> >community
>>> >and avoid a cryptocurrency split. Segwit2Mb does not aim to be best
>>> >possible technical solution to solve Bitcoin technical limitations.
>>> >However, this proposal does not imply a compromise to the future
>>> >scalability or decentralization of Bitcoin, as a small increase in
>>> >block
>>> >size has been proven by several core and non-core developers not to
>>> >affect
>>> >Bitcoin value propositions.
>>> >
>>> >In the worst case, a 2X block size increase has much lower economic
>>> >impact
>>> >than the last bitcoin halving (<10%), which succeeded without problem.
>>> >
>>> >On the other side, Segwit2Mb primary goal is to be minimalistic: in
>>> >this
>>> >patch some choices have been made to reduce the number of lines
>>> >modified in
>>> >the current Bitcoin Core state (master branch), instead of implementing
>>> >the
>>> >most elegant solution. This is because I want to reduce the time it
>>> >takes
>>> >for core programmers and reviewers to check the correctness of the
>>> >code,
>>> >and to report and correct bugs.
>>> >
>>> >The patch was built by forking the master branch of Bitcoin Core,
>>> >mixing a
>>> >few lines of code from Jeff Garzik's BIP102,  and defining a second
>>> >versionbits activation bit (bit 2) for the combined activation.
>>> >
>>> >The combined activation of segwit and 2Mb hard-fork nVersion bit is 2
>>> >(DEPLOYMENT_SEGWIT_AND_2MB_BLOCKS).
>>> >
>>> >This means that segwit can still be activated without the 2MB hard-fork
>>> >by
>>> >signaling bit 1 in nVersion  (DEPLOYMENT_SEGWIT).
>>> >
>>> >The tentative lock-in and hard-fork dates are the following:
>>> >
>>> >Bit 2 signaling StartTime = 1493424000; // April 29th, 2017
>>> >
>>> >Bit 2 signaling Timeout = 1503964800; // August 29th, 2017
>>> >
>>> >HardForkTime = 1513209600; // Thu, 14 Dec 2017 00:00:00 GMT
>>> >
>>> >
>>> >The hard-fork is conditional to 95% of the hashing power has approved
>>> >the
>>> >segwit2mb soft-fork and the segwit soft-fork has been activated (which
>>> >should occur 2016 blocks after its lock-in time)
>>> >
>>> >For more information on how soft-forks are signaled and activated, see
>>> >https://github.com/bitcoin/bips/blob/master/bip-0009.mediawiki
>>> >
>>> >This means that segwit would be activated before 2Mb: this is
>>> >inevitable,
>>> >as versionbits have been designed to have fixed activation periods and
>>> >thresholds for all bits. Making segwit and 2Mb fork activate together
>>> >at a
>>> >delayed date would have required a major re-write of this code, which
>>> >would
>>> >contradict the premise of creating a minimalistic patch. However, once
>>> >segwit is activated, the hard-fork is unavoidable.
>>> >
>>> >Although I have coded a first version of the segwit2mb patch (which
>>> >modifies 120 lines of code, and adds 220 lines of testing code), I
>>> >would
>>> >prefer to wait to publish the source code until more comments have been
>>> >received from the community.
>>> >
>>> >To prevent worsening block verification time because of the O(N^2)
>>> >hashing
>>> >problem, the simple restriction that transactions cannot be larger than
>>> >1Mb
>>> >has been kept. Therefore the worse-case of block verification time has
>>> >only
>>> >doubled.
>>> >
>>> >Regarding the hard-fork activation date, I want to give enough time to
>>> >all
>>> >active economic nodes to upgrade. As of Fri Mar 31 2017,
>>> >https://bitnodes.21.co/nodes/ reports that 6332 out of 6955 nodes (91%)
>>> >have upgraded to post 0.12 versions. Upgrade to post 0.12 versions can
>>> >be
>>> >used to identify economic active nodes, because in the 0.12 release
>>> >dynamic
>>> >fees were introduced, and currently no Bitcoin automatic payment system
>>> >can
>>> >operate without automatic discovery of the current fee rate. A pre-0.12
>>> >would require constant manual intervention.
>>> >Therefore I conclude that no more than 91% of the network nodes
>>> >reported by
>>> >bitnodes are active economic nodes.
>>> >
>>> >As Bitcoin Core 0.12 was released on February 2016, the time for this
>>> >91%
>>> >to upgrade has been around one year (under a moderate pressure of
>>> >operational problems with unconfirmed transactions).
>>> >Therefore we can expect a similar or lower time to upgrade for a
>>> >hard-fork,
>>> >after developers have discussed and approved the patch, and it has been
>>> >reviewed and merged and 95% of the hashing power has signaled for it
>>> >(the
>>> >pressure not to upgrade being a complete halt of the operations).
>>> >However I
>>> >suggest that we discuss the hard-fork date and delay it if there is a
>>> >real
>>> >need to.
>>> >
>>> >Currently time works against the Bitcoin community, and so is delaying
>>> >a
>>> >compromise solution. Most of the community agree that halting the
>>> >innovation for several years is a very bad option.
>>> >
>>> >After the comments collected by the community, a BIP will be written
>>> >describing the resulting proposal details.
>>> >
>>> >If segwit2mb locks-in, before hard-fork occurs all bitcoin nodes should
>>> >be
>>> >updated to a Segwit2Mb enabled node to prevent them to be forked-away
>>> >in a
>>> >chain with almost no hashing-power.
>>> >
>>> >The proof of concept patch was made for Bitcoin Core but should be
>>> >easily
>>> >ported to other Bitcoin protocol implementations that already support
>>> >versionbits. Lightweight (SPV) wallets should not be affected as they
>>> >generally do not check the block size.
>>> >
>>> >I personally want to see the Lightning Network in action this year, use
>>> >the
>>> >non-malleability features in segwit, see the community discussing other
>>> >exciting soft-forks in the scaling roadmap, Schnorr sigs, drivechains
>>> >and
>>> >MAST.
>>> >
>>> >I want to see miners, developers and industry side-by-side pushing
>>> >Bitcoin
>>> >forward, to increase the value of Bitcoin and prevent high transaction
>>> >fees
>>> >to put out of business use-cases that could have high positive social
>>> >impact.
>>> >
>>> >I believe in the strength of a unified Bitcoin community. If you're a
>>> >developer, please give your opinion, suggest changes, audit it, and
>>> >take a
>>> >stand with me to unlock the current Bitcoin deadlock.
>>> >
>>> >Contributions to the segwit2mb project are welcomed and awaited. The
>>> >only
>>> >limitation is to stick to the principle that the patch should be as
>>> >simple
>>> >to audit as possible. As an example, I wouldn't feel confident if the
>>> >patch
>>> >modified more than ~150 lines of code.
>>> >
>>> >Improvements unrelated to a 2 Mb increase or segwit, as beneficial as
>>> >it
>>> >may be to Bitcoin, should not be part of segwit2Mb.
>>> >
>>> >This proposal should not prevent other consensus proposals to be
>>> >simultaneously merged: segwit2mb is a last resort solution in case we
>>> >can
>>> >not reach consensus on anything better.
>>> >
>>> >Again, the proposal is only a starting point: community feedback is
>>> >expected and welcomed.
>>> >
>>> >Regards,
>>> >Sergio Demian Lerner
>>>
>>
>>
>> _______________________________________________
>> bitcoin-dev mailing list
>> bitcoin-dev at lists.linuxfoundation.org
>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>
>>
>
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170602/cb4bda03/attachment-0001.html>

From erik at q32.com  Fri Jun  2 20:04:25 2017
From: erik at q32.com (Erik Aronesty)
Date: Fri, 2 Jun 2017 16:04:25 -0400
Subject: [bitcoin-dev] Segwit2Mb - combined soft/hard fork - Request For
	Comments
In-Reply-To: <CABm2gDrAHo2P7t6SjituURqMUqs_=Lbp7X=g_j8nGoNKMKCRKQ@mail.gmail.com>
References: <CAKzdR-oN6tGvGSb04_awCf=Jsf3wgKJN5xUhCr8G2D2W9YgJww@mail.gmail.com>
	<1CF1FD5D-8D29-4783-823F-B3F588D5C5CE@mattcorallo.com>
	<CAD1TkXse5O6nEw9-EPsNp4c56YJ+OnM=F1uf8w+tyB=_+hFzFQ@mail.gmail.com>
	<CAKzdR-rFJNOZ856rA_q8C=zEUj_X561OSOwW+KZr4nRJ51w3HA@mail.gmail.com>
	<CABm2gDrAHo2P7t6SjituURqMUqs_=Lbp7X=g_j8nGoNKMKCRKQ@mail.gmail.com>
Message-ID: <CAJowKg+aYUCgBu0nD9U63jm2SunGeqdqOwiMgnTSfE9JmNJAQw@mail.gmail.com>

>From me to you ...this proposal doesn't lock in anything.   We could just
merge it with some small pushback - allow segwit to activate in Aug, then
"upgrade" the hard fork to be "spoonet in 18 months" instead.

On Sat, Apr 1, 2017 at 8:33 AM, Jorge Tim?n via bitcoin-dev <
bitcoin-dev at lists.linuxfoundation.org> wrote:

> Segwit replaces the 1 mb size limit with a weight limit of 4 mb. After
> segwit there's no need for MAX_BLOCK_BASE_SIZE anymore, let alone
> MAX_BLOCK2_BASE_SIZE.
> Thus, by "hf to 2 mb" it seems you just really mean hardforking from 4
> mb weight to 8 mb weight.
>
> I would also use the hardfork bit (sign bit in block.nNersion) as matt
> comments.
>
> > We're in a deadlock and it seems we can't go forward adding more
> functionality to segwit without the community approval (which include
> miners). This is obvious to me.Then we have to go back.
>
> If segwit is controversial the way it is (I still don't understand why
> despite having insistently asking to users and miners who claim to
> oppose it), adding more consensus rule changes won't make it any less
> controversial. If anything, it would be removing consensus rule
> changes, not adding them that could make it less controversial.
>
> By no means I want to dissuade you from working on this bip proposal,
> but I really don't see how it helps getting out of the deadlock at
> all.
>
>
> On Sat, Apr 1, 2017 at 1:44 PM, Sergio Demian Lerner via bitcoin-dev
> <bitcoin-dev at lists.linuxfoundation.org> wrote:
> > Some people have asked me for the current implementation of this patch to
> > review. I remind you that the current patch does not implement the
> hard-fork
> > signaling, as requested by Matt.
> >
> > The Segwit2Mb patch can be found here:
> > https://github.com/SergioDemianLerner/bitcoin/commits/master
> >
> > For now, the segwit2mb repo has a single test file using the old internal
> > blockchain building method (test/block_size_tests.cpp). This must be
> > replaced soon with a better external test using the bitcoin/qa/rpc-tests
> > tests, which I will begin to work on now after I collect all comments
> from
> > the community.
> >
> >
> > regards
> >
> >
> >
> > On Sat, Apr 1, 2017 at 3:55 AM, Jared Lee Richardson <jaredr26 at gmail.com
> >
> > wrote:
> >>
> >> > Remember that the "hashpower required to secure bitcoin" is determined
> >> > as a percentage of total Bitcoins transacted on-chain in each block
> >>
> >> Can you explain this statement a little better?  What do you mean by
> >> that?  What does the total bitcoins transacted have to do with
> >> hashpower required?
> >>
> >>
> >> On Fri, Mar 31, 2017 at 2:22 PM, Matt Corallo via bitcoin-dev
> >> <bitcoin-dev at lists.linuxfoundation.org> wrote:
> >> > Hey Sergio,
> >> >
> >> > You appear to have ignored the last two years of Bitcoin hardfork
> >> > research and understanding, recycling instead BIP 102 from 2015. There
> >> > are many proposals which have pushed the state of hard fork research
> >> > much further since then, and you may wish to read some of the posts on
> >> > this mailing list listed at https://bitcoinhardforkresearch.
> github.io/
> >> > and make further edits based on what you learn. Your goal of "avoid
> >> > technical changes" appears to not have any basis outside of perceived
> >> > compromise for compromise sake, only making such a hardfork riskier
> >> > instead.
> >> >
> >> > At a minimum, in terms of pure technical changes, you should probably
> >> > consider (probably among others):
> >> >
> >> > a) Utilizing the "hard fork signaling bit" in the nVersion of the
> block.
> >> > b) Either limiting non-SegWit transactions in some way to fix the n**2
> >> > sighash and FindAndDelete runtime and memory usage issues or fix them
> by
> >> > utilizing the new sighash type which many wallets and projects have
> >> > already implemented for SegWit in the spending of non-SegWit outputs.
> >> > c) Your really should have replay protection in any HF. The clever fix
> >> > from
> >> > Spoonnet for poor scaling of optionally allowing non-SegWit outputs to
> >> > be spent with SegWit's sighash provides this all in one go.
> >> > d) You may wish to consider the possibility of tweaking the witness
> >> > discount and possibly discounting other parts of the input - SegWit
> went
> >> > a long ways towards making removal of elements from the UTXO set
> cheaper
> >> > than adding them, but didn't quite get there, you should probably
> finish
> >> > that job. This also provides additional tuneable parameters to allow
> you
> >> > to increase the block size while not having a blowup in the worst-case
> >> > block size.
> >> > e) Additional commitments at the top of the merkle root - both for
> >> > SegWit transactions and as additional space for merged mining and
> other
> >> > commitments which we may wish to add in the future, this should likely
> >> > be implemented an "additional header" ala Johnson Lau's Spoonnet
> >> > proposal.
> >> >
> >> > Additionally, I think your parameters here pose very significant risk
> to
> >> > the Bitcoin ecosystem broadly.
> >> >
> >> > a) Activating a hard fork with less than 18/24 months (and even
> then...)
> >> > from a fully-audited and supported release of full node software to
> >> > activation date poses significant risks to many large software
> projects
> >> > and users. I've repeatedly received feedback from various folks that a
> >> > year or more is likely required in any hard fork to limit this risk,
> and
> >> > limited pushback on that given the large increase which SegWit
> provides
> >> > itself buying a ton of time.
> >> >
> >> > b) Having a significant discontinuity in block size increase only
> serves
> >> > to confuse and mislead users and businesses, forcing them to rapidly
> >> > adapt to a Bitcoin which changed overnight both by hardforking, and by
> >> > fees changing suddenly. Instead, having the hard fork activate
> technical
> >> > changes, and then slowly increasing the block size over the following
> >> > several years keeps things nice and continuous and also keeps us from
> >> > having to revisit ye old blocksize debate again six months after
> >> > activation.
> >> >
> >> > c) You should likely consider the effect of the many technological
> >> > innovations coming down the pipe in the coming months. Technologies
> like
> >> > Lightning, TumbleBit, and even your own RootStock could significantly
> >> > reduce fee pressure as transactions move to much faster and more
> >> > featureful systems.
> >> >
> >> > Commitments to aggressive hard fork parameters now may leave miners
> >> > without much revenue as far out as the next halving (which current
> >> > transaction growth trends are indicating we'd just only barely reach
> 2MB
> >> > of transaction volume, let alone if you consider the effects of users
> >> > moving to systems which provide more features for Bitcoin
> transactions).
> >> > This could lead to a precipitous drop in hashrate as miners are no
> >> > longer sufficiently compensated.
> >> >
> >> > Remember that the "hashpower required to secure bitcoin" is determined
> >> > as a percentage of total Bitcoins transacted on-chain in each block,
> so
> >> > as subsidy goes down, miners need to be paid with fees, not just price
> >> > increases. Even if we were OK with hashpower going down compared to
> the
> >> > value it is securing, betting the security of Bitcoin on its price
> >> > rising exponentially to match decreasing subsidy does not strike me
> as a
> >> > particularly inspiring tradeoff.
> >> >
> >> > There aren't many great technical solutions to some of these issues,
> as
> >> > far as I'm aware, but it's something that needs to be incredibly
> >> > carefully considered before betting the continued security of Bitcoin
> on
> >> > exponential on-chain growth, something which we have historically
> never
> >> > seen.
> >> >
> >> > Matt
> >> >
> >> >
> >> > On March 31, 2017 5:09:18 PM EDT, Sergio Demian Lerner via bitcoin-dev
> >> > <bitcoin-dev at lists.linuxfoundation.org> wrote:
> >> >>Hi everyone,
> >> >>
> >> >>Segwit2Mb is the project to merge into Bitcoin a minimal patch that
> >> >>aims to
> >> >>untangle the current conflict between different political positions
> >> >>regarding segwit activation vs. an increase of the on-chain blockchain
> >> >>space through a standard block size increase. It is not a new
> solution,
> >> >>but
> >> >>it should be seen more as a least common denominator.
> >> >>
> >> >>Segwit2Mb combines segwit as it is today in Bitcoin 0.14+ with a 2MB
> >> >>block
> >> >>size hard-fork activated ONLY if segwit activates (95% of miners
> >> >>signaling), but at a fixed future date.
> >> >>
> >> >>The sole objective of this proposal is to re-unite the Bitcoin
> >> >>community
> >> >>and avoid a cryptocurrency split. Segwit2Mb does not aim to be best
> >> >>possible technical solution to solve Bitcoin technical limitations.
> >> >>However, this proposal does not imply a compromise to the future
> >> >>scalability or decentralization of Bitcoin, as a small increase in
> >> >>block
> >> >>size has been proven by several core and non-core developers not to
> >> >>affect
> >> >>Bitcoin value propositions.
> >> >>
> >> >>In the worst case, a 2X block size increase has much lower economic
> >> >>impact
> >> >>than the last bitcoin halving (<10%), which succeeded without problem.
> >> >>
> >> >>On the other side, Segwit2Mb primary goal is to be minimalistic: in
> >> >>this
> >> >>patch some choices have been made to reduce the number of lines
> >> >>modified in
> >> >>the current Bitcoin Core state (master branch), instead of
> implementing
> >> >>the
> >> >>most elegant solution. This is because I want to reduce the time it
> >> >>takes
> >> >>for core programmers and reviewers to check the correctness of the
> >> >>code,
> >> >>and to report and correct bugs.
> >> >>
> >> >>The patch was built by forking the master branch of Bitcoin Core,
> >> >>mixing a
> >> >>few lines of code from Jeff Garzik's BIP102,  and defining a second
> >> >>versionbits activation bit (bit 2) for the combined activation.
> >> >>
> >> >>The combined activation of segwit and 2Mb hard-fork nVersion bit is 2
> >> >>(DEPLOYMENT_SEGWIT_AND_2MB_BLOCKS).
> >> >>
> >> >>This means that segwit can still be activated without the 2MB
> hard-fork
> >> >>by
> >> >>signaling bit 1 in nVersion  (DEPLOYMENT_SEGWIT).
> >> >>
> >> >>The tentative lock-in and hard-fork dates are the following:
> >> >>
> >> >>Bit 2 signaling StartTime = 1493424000; // April 29th, 2017
> >> >>
> >> >>Bit 2 signaling Timeout = 1503964800; // August 29th, 2017
> >> >>
> >> >>HardForkTime = 1513209600; // Thu, 14 Dec 2017 00:00:00 GMT
> >> >>
> >> >>
> >> >>The hard-fork is conditional to 95% of the hashing power has approved
> >> >>the
> >> >>segwit2mb soft-fork and the segwit soft-fork has been activated (which
> >> >>should occur 2016 blocks after its lock-in time)
> >> >>
> >> >>For more information on how soft-forks are signaled and activated, see
> >> >>https://github.com/bitcoin/bips/blob/master/bip-0009.mediawiki
> >> >>
> >> >>This means that segwit would be activated before 2Mb: this is
> >> >>inevitable,
> >> >>as versionbits have been designed to have fixed activation periods and
> >> >>thresholds for all bits. Making segwit and 2Mb fork activate together
> >> >>at a
> >> >>delayed date would have required a major re-write of this code, which
> >> >>would
> >> >>contradict the premise of creating a minimalistic patch. However, once
> >> >>segwit is activated, the hard-fork is unavoidable.
> >> >>
> >> >>Although I have coded a first version of the segwit2mb patch (which
> >> >>modifies 120 lines of code, and adds 220 lines of testing code), I
> >> >>would
> >> >>prefer to wait to publish the source code until more comments have
> been
> >> >>received from the community.
> >> >>
> >> >>To prevent worsening block verification time because of the O(N^2)
> >> >>hashing
> >> >>problem, the simple restriction that transactions cannot be larger
> than
> >> >>1Mb
> >> >>has been kept. Therefore the worse-case of block verification time has
> >> >>only
> >> >>doubled.
> >> >>
> >> >>Regarding the hard-fork activation date, I want to give enough time to
> >> >>all
> >> >>active economic nodes to upgrade. As of Fri Mar 31 2017,
> >> >>https://bitnodes.21.co/nodes/ reports that 6332 out of 6955 nodes
> (91%)
> >> >>have upgraded to post 0.12 versions. Upgrade to post 0.12 versions can
> >> >>be
> >> >>used to identify economic active nodes, because in the 0.12 release
> >> >>dynamic
> >> >>fees were introduced, and currently no Bitcoin automatic payment
> system
> >> >>can
> >> >>operate without automatic discovery of the current fee rate. A
> pre-0.12
> >> >>would require constant manual intervention.
> >> >>Therefore I conclude that no more than 91% of the network nodes
> >> >>reported by
> >> >>bitnodes are active economic nodes.
> >> >>
> >> >>As Bitcoin Core 0.12 was released on February 2016, the time for this
> >> >>91%
> >> >>to upgrade has been around one year (under a moderate pressure of
> >> >>operational problems with unconfirmed transactions).
> >> >>Therefore we can expect a similar or lower time to upgrade for a
> >> >>hard-fork,
> >> >>after developers have discussed and approved the patch, and it has
> been
> >> >>reviewed and merged and 95% of the hashing power has signaled for it
> >> >>(the
> >> >>pressure not to upgrade being a complete halt of the operations).
> >> >>However I
> >> >>suggest that we discuss the hard-fork date and delay it if there is a
> >> >>real
> >> >>need to.
> >> >>
> >> >>Currently time works against the Bitcoin community, and so is delaying
> >> >>a
> >> >>compromise solution. Most of the community agree that halting the
> >> >>innovation for several years is a very bad option.
> >> >>
> >> >>After the comments collected by the community, a BIP will be written
> >> >>describing the resulting proposal details.
> >> >>
> >> >>If segwit2mb locks-in, before hard-fork occurs all bitcoin nodes
> should
> >> >>be
> >> >>updated to a Segwit2Mb enabled node to prevent them to be forked-away
> >> >>in a
> >> >>chain with almost no hashing-power.
> >> >>
> >> >>The proof of concept patch was made for Bitcoin Core but should be
> >> >>easily
> >> >>ported to other Bitcoin protocol implementations that already support
> >> >>versionbits. Lightweight (SPV) wallets should not be affected as they
> >> >>generally do not check the block size.
> >> >>
> >> >>I personally want to see the Lightning Network in action this year,
> use
> >> >>the
> >> >>non-malleability features in segwit, see the community discussing
> other
> >> >>exciting soft-forks in the scaling roadmap, Schnorr sigs, drivechains
> >> >>and
> >> >>MAST.
> >> >>
> >> >>I want to see miners, developers and industry side-by-side pushing
> >> >>Bitcoin
> >> >>forward, to increase the value of Bitcoin and prevent high transaction
> >> >>fees
> >> >>to put out of business use-cases that could have high positive social
> >> >>impact.
> >> >>
> >> >>I believe in the strength of a unified Bitcoin community. If you're a
> >> >>developer, please give your opinion, suggest changes, audit it, and
> >> >>take a
> >> >>stand with me to unlock the current Bitcoin deadlock.
> >> >>
> >> >>Contributions to the segwit2mb project are welcomed and awaited. The
> >> >>only
> >> >>limitation is to stick to the principle that the patch should be as
> >> >>simple
> >> >>to audit as possible. As an example, I wouldn't feel confident if the
> >> >>patch
> >> >>modified more than ~150 lines of code.
> >> >>
> >> >>Improvements unrelated to a 2 Mb increase or segwit, as beneficial as
> >> >>it
> >> >>may be to Bitcoin, should not be part of segwit2Mb.
> >> >>
> >> >>This proposal should not prevent other consensus proposals to be
> >> >>simultaneously merged: segwit2mb is a last resort solution in case we
> >> >>can
> >> >>not reach consensus on anything better.
> >> >>
> >> >>Again, the proposal is only a starting point: community feedback is
> >> >>expected and welcomed.
> >> >>
> >> >>Regards,
> >> >>Sergio Demian Lerner
> >> > _______________________________________________
> >> > bitcoin-dev mailing list
> >> > bitcoin-dev at lists.linuxfoundation.org
> >> > https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
> >
> >
> >
> > _______________________________________________
> > bitcoin-dev mailing list
> > bitcoin-dev at lists.linuxfoundation.org
> > https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
> >
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170602/da24971d/attachment-0001.html>

From jaredr26 at gmail.com  Fri Jun  2 19:40:36 2017
From: jaredr26 at gmail.com (Jared Lee Richardson)
Date: Fri, 2 Jun 2017 12:40:36 -0700
Subject: [bitcoin-dev] Hypothetical 2 MB hardfork to follow BIP148
In-Reply-To: <CAAUaCyjbObcb1mJVmeEDmgzNddQCY3QhrHV3fgNbin-ZyqgfeA@mail.gmail.com>
References: <201705232023.40588.luke@dashjr.org>
	<CAJowKgJK9zBkVAM1NyOsjU04gvwV3zGnk+1ebfpt6rnbiKy6Og@mail.gmail.com>
	<CABm2gDpet31gEcBY6NTxEG+xA4rvg8_c79L+J=mJySGbf7Ydbg@mail.gmail.com>
	<CAOG=w-uei5-c-Mpp_R6RrN29NTrSV+gpNd79FC3cB6QPG65sEw@mail.gmail.com>
	<CAH+Axy5yYQywpy0s9pBZt_fNoLPpWfra-cU9HrUwH71GDOchsQ@mail.gmail.com>
	<004E1123-8346-48B6-9BCB-94BAE00EC34B@me.com>
	<CAAUaCyjbObcb1mJVmeEDmgzNddQCY3QhrHV3fgNbin-ZyqgfeA@mail.gmail.com>
Message-ID: <CAD1TkXtut2LZdp5Qo9ep2FfMGFFYqdxtobLJgoC7UutyNujKKg@mail.gmail.com>

> Maybe there's some hole in Jorge's logic and scrapping blockmaxsize has quadratic hashing risks, and maybe James' 10KB is too ambitious; but even if so, a simple 1MB tx size limit would clearly do the trick.  The broader point is that quadratic hashing is not a compelling reason to keep blockmaxsize post-HF: does someone have a better one?

I think this is exactly the right direction to head.  There are
arguments to be made for various maximum sizes... Maybe the limit
could be set to 1mb initially, and at a distant future block
height(years?) automatically drop to 500kb or 100kb?  That would give
anyone with existing systems or pre-signed transactions several years
to adjust to the change.  Notification could (?possibly?) be done with
a non-default parameter that must be changed to continue to use 100kb
- <1mb transactions, so no one running modern software could claim
they were not informed when that future date hits.

I don't see any real advantages to continuing to support transactions
larger than 100kb excepting the need to update legacy use cases /
already signed transactions.

On Tue, May 30, 2017 at 8:07 PM, Jacob Eliosoff via bitcoin-dev
<bitcoin-dev at lists.linuxfoundation.org> wrote:
> Maybe there's some hole in Jorge's logic and scrapping blockmaxsize has
> quadratic hashing risks, and maybe James' 10KB is too ambitious; but even if
> so, a simple 1MB tx size limit would clearly do the trick.  The broader
> point is that quadratic hashing is not a compelling reason to keep
> blockmaxsize post-HF: does someone have a better one?
>
>
>
> On May 30, 2017 9:46 PM, "Jean-Paul Kogelman via bitcoin-dev"
> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>
>> That would invalidate any pre-signed transactions that are currently out
>> there. You can't just change the rules out from under people.
>>
>>
>> On May 30, 2017, at 4:50 PM, James MacWhyte via bitcoin-dev
>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>
>>
>>>
>>>  The 1MB classic block size prevents quadratic hashing
>>> problems from being any worse than they are today.
>>>
>>
>> Add a transaction-size limit of, say, 10kb and the quadratic hashing
>> problem is a non-issue. Donezo.
>>
>> _______________________________________________
>> bitcoin-dev mailing list
>> bitcoin-dev at lists.linuxfoundation.org
>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>
>>
>> _______________________________________________
>> bitcoin-dev mailing list
>> bitcoin-dev at lists.linuxfoundation.org
>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>
>
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>

From jaredr26 at gmail.com  Fri Jun  2 20:13:58 2017
From: jaredr26 at gmail.com (Jared Lee Richardson)
Date: Fri, 2 Jun 2017 13:13:58 -0700
Subject: [bitcoin-dev] Compatibility-Oriented Omnibus Proposal
In-Reply-To: <-r9BgtNAp6_SNVwmPiOER08eMpERnuWioUbNVIQJhyIas29hC5VpWmWP5z4hcC8xtWcAPcFqyxNl9I0Ile6mpY8-ZuHr8jxERXKXKo8WYQE=@protonmail.com>
References: <aC4avUiJPnHXxIxPlh4w2XA-SLB6ueTUlVTW7TreFwGV12L7L9CAGoB2E9msVYhV0M6xPTERpatAIeZO3kK-ikCRkwYQcJeEMHS7WWZKDAM=@protonmail.com>
	<CALhpmH3sUxa=MYtCdNMGO3AMGgmT=Tc2kcJzzpoY84syjgtP_A@mail.gmail.com>
	<-r9BgtNAp6_SNVwmPiOER08eMpERnuWioUbNVIQJhyIas29hC5VpWmWP5z4hcC8xtWcAPcFqyxNl9I0Ile6mpY8-ZuHr8jxERXKXKo8WYQE=@protonmail.com>
Message-ID: <CAD1TkXtHmcZHGcOR3RiLhh8orB0L7Tn=yEwPLhrAZyS+qr-GZw@mail.gmail.com>

> The above decision may quickly become very controversial. I don't think
it's what most users had/have in mind when they discuss a "2MB+SegWit"
solution.
> With the current 1MB+SegWit, testing has shown us that normal usage
results in ~2 or 2.1MB blocks.
> I think most users will expect a linear increase when Base Size is
increased to 2000000 bytes and Total Weight is increased to 8000000 bytes.
With normal usage, the expected results would then be ~4 or 4.2MB blocks.

I think Calvin is correct here, the secondary limit is not what people
anticipated with the segwit + 2mb agreement.  It would not kill the
agreement for me, but it might for others.

What is the justification for the secondary limitation?  Is there hard data
to back this?  The quadratic hashing problem is frequently brought up, but
that is trivially handled with a hard 1mb transaction limit and on the
other thread there's talk/suggestions of an even lower limit.  Are there
any other reasons for this limitation, and is there data to justify those
concerns?  If not, this should be left out in favor of a transaction size
limit.  If so, hard data would go a long way to dealing with the conversy
this will create.


> Shaolin Fry?s ?Mandatory activation of segwit deployment?[3] is included
to:
> > cause the existing "segwit" deployment to activate without needing to
release a new deployment.
> Both of the aforementioned activation options (?fast-activation? and
?flag-day activation?) serve to prevent unnecessary delays in the network
upgrade process, addressing a common criticism of the Scaling Agreement and
providing an opportunity for cooperation and unity instead.

This is likely to cause more controversy and unfortunately has the tightest
timelines.  Unlike the SW2mb working group's timelines, a hard-coded
timeline couldn't be changed with mutual agreement from the signers.

Given the chance of bit1 accidental activation without clear signaling for
the required bit4 2mb hard fork, I don't think the fair or acceptable
tradeoff is for flag day to require bit1 signaling only.  *Flag day should
be modified to accept either bit1 signaling, OR to accept bit4 signaling IF
the 80% threshold hasn't been met.*  In this way the anti-segwit working
group members are not in danger of an activated bit1 segwit without also
getting their portion of the compromise, the bit4 signaled HF.  If flag day
accepts bit4 OR bit1, AND bit4 requires both bit1 and bit4 once 80% is
reached, flag day is nearly guaranteed to get its stated desire within 1750
blocks (bit4 accepted until block 800; bit4+bit1 signaled afterwards until
95%), but without the chance that the WG signers won't get what they agreed
to.

*That seems like a minor compromise for BIP148.  Thoughts on this change to
flag day / BIP148?*

In addition, the aggressiveness of the timelines and the complexity of the
merged COOP proposal may require the BIP148 flag day to be pushed back.  I
would think some day in September is achievable, but I'm not sure if August
1st will be.

Jared


On Tue, May 30, 2017 at 3:20 PM, CalvinRechner via bitcoin-dev <
bitcoin-dev at lists.linuxfoundation.org> wrote:

> In principle, there is complete flexibility when it comes to the specific
> consensus details of the hard fork. One common suggestion has been to phase
> in a gradual blocksize increase beyond the initial 2MB cap included in
> Luke-Jr's proposal (a la BIP103); this would certainly be a welcome
> inclusion in the Omnibus Proposal, provided that is what we want. The
> reasoning behind incorporating Luke-Jr's 2MB limit and discount-rebalancing
> was to satisfy the conditions of the Scaling Agreement while ensuring
> maximum safety, minimum code discrepancies, and minimum controversy among
> the community; these priorities seem imperative, considering the extreme
> timeline constraints we are working under and the goals of the proposal. To
> put it more simply, the intent of the proposal was to serve as a template
> for the minimum viable fork that can achieve true consensus. A gradual
> increase to a larger size cap, especially if it were reasonably
> conservative, would be wholly in accordance with the Omnibus Proposal if
> that is what it takes to achieve the cooperation between community,
> industry, and developers in this critical moment of Bitcoin's history.
>
>
> The purpose of the Omnibus Proposal is singlefold: to achieve the goals of
> the Consensus 2017 Scaling Agreement in the most maximally-compatible way.
> We can minimize disruption and loss potential all around by solving these
> problems in a compatibility-oriented manner. It is possible to fulfill both
> the letter and the spirit of the Scaling Agreement, to the complete
> satisfaction of all involved, while preventing chain-split risks in the
> meantime.
>
>
> There is no justification for incompatibility with existing deployment
> approaches, when there is the possibility to work together towards our
> mutual goals instead. The most rational option is to join forces and avoid
> any chain-split potential for as long as possible. Under the Omnibus
> Proposal, once SegWit is activated, the terms of the hard fork are locked
> in automatically, set to activate 6 months later. The proposal guarantees
> that a successful SegWit activation is followed by a hard fork. Beyond
> enforcing the hard fork rules beginning at block height HardForkHeight, the
> Omnibus Proposal simply represents compatibility with the existing
> SegWit-activation deployment approaches.
>
>
> By committing to this proposal, we can ensure unity, at least for now.
> There do not appear to be any arguments to the contrary. Why squander this
> opportunity for consensus and harmony? We can leverage the momentum of
> several disparate movements, and perhaps enjoy some much-needed social
> solidarity. In a way, everyone can get what they want, and through
> cooperation, we avoid the risk of a costly fracture.
>
>
> The Segwit2x Team has begun work on an implementation of the Consensus
> Scaling Agreement, their operational timeline including the publication of
> a BIP on June 16, 2017.[1] I call upon the developers and maintainers of
> this initiative to consider and honor the Omnibus Proposal, extended or
> modified as needed, as the guiding approach to your development effort.
> Almost every component of the code exists, in some form or fashion, in the
> various constituent proposals' reference implementations, most of which
> have already undergone a significant degree of peer review.
>
>
> We cannot afford to delay, nor to reimplement; the launch timeline is
> aggressively optimistic as it is. The quickest and safest approach to
> achieving the goals set forth at Consensus 2017 is to leverage the existing
> tools and proposals for the job. We can solve our problems properly,
> cooperatively.
>
>
> I humbly ask that Jeff Garzik, Barry Silbert, Mike Belshe, and all of the
> other wonderful, intelligent collaborators on this project step forward and
> support the cooperative, compatibility-oriented approach of the Omnibus
> Proposal.
>
>
> This is the best way to maximize value for everyone. We have a real
> opportunity to collaborate and work together on the same team. The Omnibus
> Proposal, designed in exact accordance with a powerful industry agreement
> and incorporating the feedback and suggestions provided from within both
> the developer community and the community-at-large, stands the best chance
> of uniting everyone under a common front.
>
>
> Please, for the love of Bitcoin, let us do our best to cooperate.
>
>
>
> [1] https://imgur.com/a/a2oPs
>
>
> Sent with ProtonMail <https://protonmail.com> Secure Email.
>
> -------- Original Message --------
> Subject: Re: [bitcoin-dev] Compatibility-Oriented Omnibus Proposal
> Local Time: May 29, 2017 6:49 PM
> UTC Time: May 29, 2017 11:49 PM
> From: opetruzel at gmail.com
> To: CalvinRechner <calvinrechner at protonmail.com>
> Bitcoin Dev <bitcoin-dev at lists.linuxfoundation.org>
>
> >>if the community wishes to adopt (by unanimous consensus) a 2 MB block
> size hardfork, this is probably the best way to do it right now... Legacy
> Bitcoin transactions are given the witness discount, and a block size limit
> of 2 MB is imposed.<<
>
>
> The above decision may quickly become very controversial. I don't think it's
> what most users had/have in mind when they discuss a "2MB+SegWit" solution.
>
> With the current 1MB+SegWit, testing has shown us that normal usage
> results in ~2 or 2.1MB blocks.
>
> I think most users will expect a linear increase when Base Size is
> increased to 2000000 bytes and Total Weight is increased to 8000000 bytes.
> With normal usage, the expected results would then be ~4 or 4.2MB blocks.
>
> Am I missing something here, or does Luke's suggested 2MB cap completely
> nullify that expected linear increase? If so, why? What's the logic behind
> this decision?
>
> I'd love to be armed with a good answer should my colleagues ask me the
> same obvious question, so thank you ahead of time!
>
> Respectfully,
> Oliver Petruzel
>
>
>
>
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170602/abfac0e2/attachment-0001.html>

From sergio.d.lerner at gmail.com  Fri Jun  2 21:57:12 2017
From: sergio.d.lerner at gmail.com (Sergio Demian Lerner)
Date: Fri, 2 Jun 2017 17:57:12 -0400
Subject: [bitcoin-dev] Compatibility-Oriented Omnibus Proposal
In-Reply-To: <CAD1TkXtHmcZHGcOR3RiLhh8orB0L7Tn=yEwPLhrAZyS+qr-GZw@mail.gmail.com>
References: <aC4avUiJPnHXxIxPlh4w2XA-SLB6ueTUlVTW7TreFwGV12L7L9CAGoB2E9msVYhV0M6xPTERpatAIeZO3kK-ikCRkwYQcJeEMHS7WWZKDAM=@protonmail.com>
	<CALhpmH3sUxa=MYtCdNMGO3AMGgmT=Tc2kcJzzpoY84syjgtP_A@mail.gmail.com>
	<-r9BgtNAp6_SNVwmPiOER08eMpERnuWioUbNVIQJhyIas29hC5VpWmWP5z4hcC8xtWcAPcFqyxNl9I0Ile6mpY8-ZuHr8jxERXKXKo8WYQE=@protonmail.com>
	<CAD1TkXtHmcZHGcOR3RiLhh8orB0L7Tn=yEwPLhrAZyS+qr-GZw@mail.gmail.com>
Message-ID: <CAKzdR-om+A1wrPSPTNT6AqtZjEw3hqjWKjgDoAQwggDYF3PH+A@mail.gmail.com>

I don't see LukeJr 2MB limit to be compatible with the NY agreement. For
the rest, seems fine for me.



On Fri, Jun 2, 2017 at 4:13 PM, Jared Lee Richardson via bitcoin-dev <
bitcoin-dev at lists.linuxfoundation.org> wrote:

> > The above decision may quickly become very controversial. I don't think
> it's what most users had/have in mind when they discuss a "2MB+SegWit"
> solution.
> > With the current 1MB+SegWit, testing has shown us that normal usage
> results in ~2 or 2.1MB blocks.
> > I think most users will expect a linear increase when Base Size is
> increased to 2000000 bytes and Total Weight is increased to 8000000 bytes.
> With normal usage, the expected results would then be ~4 or 4.2MB blocks.
>
> I think Calvin is correct here, the secondary limit is not what people
> anticipated with the segwit + 2mb agreement.  It would not kill the
> agreement for me, but it might for others.
>
> What is the justification for the secondary limitation?  Is there hard
> data to back this?  The quadratic hashing problem is frequently brought up,
> but that is trivially handled with a hard 1mb transaction limit and on the
> other thread there's talk/suggestions of an even lower limit.  Are there
> any other reasons for this limitation, and is there data to justify those
> concerns?  If not, this should be left out in favor of a transaction size
> limit.  If so, hard data would go a long way to dealing with the conversy
> this will create.
>
>
> > Shaolin Fry?s ?Mandatory activation of segwit deployment?[3] is included
> to:
> > > cause the existing "segwit" deployment to activate without needing to
> release a new deployment.
> > Both of the aforementioned activation options (?fast-activation? and
> ?flag-day activation?) serve to prevent unnecessary delays in the network
> upgrade process, addressing a common criticism of the Scaling Agreement and
> providing an opportunity for cooperation and unity instead.
>
> This is likely to cause more controversy and unfortunately has the
> tightest timelines.  Unlike the SW2mb working group's timelines, a
> hard-coded timeline couldn't be changed with mutual agreement from the
> signers.
>
> Given the chance of bit1 accidental activation without clear signaling for
> the required bit4 2mb hard fork, I don't think the fair or acceptable
> tradeoff is for flag day to require bit1 signaling only.  *Flag day
> should be modified to accept either bit1 signaling, OR to accept bit4
> signaling IF the 80% threshold hasn't been met.*  In this way the
> anti-segwit working group members are not in danger of an activated bit1
> segwit without also getting their portion of the compromise, the bit4
> signaled HF.  If flag day accepts bit4 OR bit1, AND bit4 requires both bit1
> and bit4 once 80% is reached, flag day is nearly guaranteed to get its
> stated desire within 1750 blocks (bit4 accepted until block 800; bit4+bit1
> signaled afterwards until 95%), but without the chance that the WG signers
> won't get what they agreed to.
>
> *That seems like a minor compromise for BIP148.  Thoughts on this change
> to flag day / BIP148?*
>
> In addition, the aggressiveness of the timelines and the complexity of the
> merged COOP proposal may require the BIP148 flag day to be pushed back.  I
> would think some day in September is achievable, but I'm not sure if August
> 1st will be.
>
> Jared
>
>
> On Tue, May 30, 2017 at 3:20 PM, CalvinRechner via bitcoin-dev <
> bitcoin-dev at lists.linuxfoundation.org> wrote:
>
>> In principle, there is complete flexibility when it comes to the specific
>> consensus details of the hard fork. One common suggestion has been to phase
>> in a gradual blocksize increase beyond the initial 2MB cap included in
>> Luke-Jr's proposal (a la BIP103); this would certainly be a welcome
>> inclusion in the Omnibus Proposal, provided that is what we want. The
>> reasoning behind incorporating Luke-Jr's 2MB limit and discount-rebalancing
>> was to satisfy the conditions of the Scaling Agreement while ensuring
>> maximum safety, minimum code discrepancies, and minimum controversy among
>> the community; these priorities seem imperative, considering the extreme
>> timeline constraints we are working under and the goals of the proposal. To
>> put it more simply, the intent of the proposal was to serve as a template
>> for the minimum viable fork that can achieve true consensus. A gradual
>> increase to a larger size cap, especially if it were reasonably
>> conservative, would be wholly in accordance with the Omnibus Proposal if
>> that is what it takes to achieve the cooperation between community,
>> industry, and developers in this critical moment of Bitcoin's history.
>>
>>
>> The purpose of the Omnibus Proposal is singlefold: to achieve the goals
>> of the Consensus 2017 Scaling Agreement in the most maximally-compatible
>> way. We can minimize disruption and loss potential all around by solving
>> these problems in a compatibility-oriented manner. It is possible to
>> fulfill both the letter and the spirit of the Scaling Agreement, to the
>> complete satisfaction of all involved, while preventing chain-split risks
>> in the meantime.
>>
>>
>> There is no justification for incompatibility with existing deployment
>> approaches, when there is the possibility to work together towards our
>> mutual goals instead. The most rational option is to join forces and avoid
>> any chain-split potential for as long as possible. Under the Omnibus
>> Proposal, once SegWit is activated, the terms of the hard fork are locked
>> in automatically, set to activate 6 months later. The proposal guarantees
>> that a successful SegWit activation is followed by a hard fork. Beyond
>> enforcing the hard fork rules beginning at block height HardForkHeight, the
>> Omnibus Proposal simply represents compatibility with the existing
>> SegWit-activation deployment approaches.
>>
>>
>> By committing to this proposal, we can ensure unity, at least for now.
>> There do not appear to be any arguments to the contrary. Why squander this
>> opportunity for consensus and harmony? We can leverage the momentum of
>> several disparate movements, and perhaps enjoy some much-needed social
>> solidarity. In a way, everyone can get what they want, and through
>> cooperation, we avoid the risk of a costly fracture.
>>
>>
>> The Segwit2x Team has begun work on an implementation of the Consensus
>> Scaling Agreement, their operational timeline including the publication of
>> a BIP on June 16, 2017.[1] I call upon the developers and maintainers of
>> this initiative to consider and honor the Omnibus Proposal, extended or
>> modified as needed, as the guiding approach to your development effort.
>> Almost every component of the code exists, in some form or fashion, in the
>> various constituent proposals' reference implementations, most of which
>> have already undergone a significant degree of peer review.
>>
>>
>> We cannot afford to delay, nor to reimplement; the launch timeline is
>> aggressively optimistic as it is. The quickest and safest approach to
>> achieving the goals set forth at Consensus 2017 is to leverage the existing
>> tools and proposals for the job. We can solve our problems properly,
>> cooperatively.
>>
>>
>> I humbly ask that Jeff Garzik, Barry Silbert, Mike Belshe, and all of the
>> other wonderful, intelligent collaborators on this project step forward and
>> support the cooperative, compatibility-oriented approach of the Omnibus
>> Proposal.
>>
>>
>> This is the best way to maximize value for everyone. We have a real
>> opportunity to collaborate and work together on the same team. The Omnibus
>> Proposal, designed in exact accordance with a powerful industry agreement
>> and incorporating the feedback and suggestions provided from within both
>> the developer community and the community-at-large, stands the best chance
>> of uniting everyone under a common front.
>>
>>
>> Please, for the love of Bitcoin, let us do our best to cooperate.
>>
>>
>>
>> [1] https://imgur.com/a/a2oPs
>>
>>
>> Sent with ProtonMail <https://protonmail.com> Secure Email.
>>
>> -------- Original Message --------
>> Subject: Re: [bitcoin-dev] Compatibility-Oriented Omnibus Proposal
>> Local Time: May 29, 2017 6:49 PM
>> UTC Time: May 29, 2017 11:49 PM
>> From: opetruzel at gmail.com
>> To: CalvinRechner <calvinrechner at protonmail.com>
>> Bitcoin Dev <bitcoin-dev at lists.linuxfoundation.org>
>>
>> >>if the community wishes to adopt (by unanimous consensus) a 2 MB block
>> size hardfork, this is probably the best way to do it right now... Legacy
>> Bitcoin transactions are given the witness discount, and a block size limit
>> of 2 MB is imposed.<<
>>
>>
>> The above decision may quickly become very controversial. I don't think it's
>> what most users had/have in mind when they discuss a "2MB+SegWit" solution.
>>
>> With the current 1MB+SegWit, testing has shown us that normal usage
>> results in ~2 or 2.1MB blocks.
>>
>> I think most users will expect a linear increase when Base Size is
>> increased to 2000000 bytes and Total Weight is increased to 8000000 bytes.
>> With normal usage, the expected results would then be ~4 or 4.2MB blocks.
>>
>> Am I missing something here, or does Luke's suggested 2MB cap completely
>> nullify that expected linear increase? If so, why? What's the logic behind
>> this decision?
>>
>> I'd love to be armed with a good answer should my colleagues ask me the
>> same obvious question, so thank you ahead of time!
>>
>> Respectfully,
>> Oliver Petruzel
>>
>>
>>
>>
>> _______________________________________________
>> bitcoin-dev mailing list
>> bitcoin-dev at lists.linuxfoundation.org
>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>
>>
>
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170602/6c0a891b/attachment.html>

From sergio.d.lerner at gmail.com  Fri Jun  2 21:51:45 2017
From: sergio.d.lerner at gmail.com (Sergio Demian Lerner)
Date: Fri, 2 Jun 2017 17:51:45 -0400
Subject: [bitcoin-dev] Segwit2Mb - combined soft/hard fork - Request For
	Comments
In-Reply-To: <CAJowKg+aYUCgBu0nD9U63jm2SunGeqdqOwiMgnTSfE9JmNJAQw@mail.gmail.com>
References: <CAKzdR-oN6tGvGSb04_awCf=Jsf3wgKJN5xUhCr8G2D2W9YgJww@mail.gmail.com>
	<1CF1FD5D-8D29-4783-823F-B3F588D5C5CE@mattcorallo.com>
	<CAD1TkXse5O6nEw9-EPsNp4c56YJ+OnM=F1uf8w+tyB=_+hFzFQ@mail.gmail.com>
	<CAKzdR-rFJNOZ856rA_q8C=zEUj_X561OSOwW+KZr4nRJ51w3HA@mail.gmail.com>
	<CABm2gDrAHo2P7t6SjituURqMUqs_=Lbp7X=g_j8nGoNKMKCRKQ@mail.gmail.com>
	<CAJowKg+aYUCgBu0nD9U63jm2SunGeqdqOwiMgnTSfE9JmNJAQw@mail.gmail.com>
Message-ID: <CAKzdR-qQvSz0WA3e9DoT-N+wwsFSjWu0G+iMcvJR1zmpXdHNZQ@mail.gmail.com>

By "upgrade"  the HF you mean activate 2X and then spoonet 18 months later
or do not activate the 2x HF at all?





On Fri, Jun 2, 2017 at 4:04 PM, Erik Aronesty via bitcoin-dev <
bitcoin-dev at lists.linuxfoundation.org> wrote:

> From me to you ...this proposal doesn't lock in anything.   We could just
> merge it with some small pushback - allow segwit to activate in Aug, then
> "upgrade" the hard fork to be "spoonet in 18 months" instead.
>
> On Sat, Apr 1, 2017 at 8:33 AM, Jorge Tim?n via bitcoin-dev <
> bitcoin-dev at lists.linuxfoundation.org> wrote:
>
>> Segwit replaces the 1 mb size limit with a weight limit of 4 mb. After
>> segwit there's no need for MAX_BLOCK_BASE_SIZE anymore, let alone
>> MAX_BLOCK2_BASE_SIZE.
>> Thus, by "hf to 2 mb" it seems you just really mean hardforking from 4
>> mb weight to 8 mb weight.
>>
>> I would also use the hardfork bit (sign bit in block.nNersion) as matt
>> comments.
>>
>> > We're in a deadlock and it seems we can't go forward adding more
>> functionality to segwit without the community approval (which include
>> miners). This is obvious to me.Then we have to go back.
>>
>> If segwit is controversial the way it is (I still don't understand why
>> despite having insistently asking to users and miners who claim to
>> oppose it), adding more consensus rule changes won't make it any less
>> controversial. If anything, it would be removing consensus rule
>> changes, not adding them that could make it less controversial.
>>
>> By no means I want to dissuade you from working on this bip proposal,
>> but I really don't see how it helps getting out of the deadlock at
>> all.
>>
>>
>> On Sat, Apr 1, 2017 at 1:44 PM, Sergio Demian Lerner via bitcoin-dev
>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>> > Some people have asked me for the current implementation of this patch
>> to
>> > review. I remind you that the current patch does not implement the
>> hard-fork
>> > signaling, as requested by Matt.
>> >
>> > The Segwit2Mb patch can be found here:
>> > https://github.com/SergioDemianLerner/bitcoin/commits/master
>> >
>> > For now, the segwit2mb repo has a single test file using the old
>> internal
>> > blockchain building method (test/block_size_tests.cpp). This must be
>> > replaced soon with a better external test using the bitcoin/qa/rpc-tests
>> > tests, which I will begin to work on now after I collect all comments
>> from
>> > the community.
>> >
>> >
>> > regards
>> >
>> >
>> >
>> > On Sat, Apr 1, 2017 at 3:55 AM, Jared Lee Richardson <
>> jaredr26 at gmail.com>
>> > wrote:
>> >>
>> >> > Remember that the "hashpower required to secure bitcoin" is
>> determined
>> >> > as a percentage of total Bitcoins transacted on-chain in each block
>> >>
>> >> Can you explain this statement a little better?  What do you mean by
>> >> that?  What does the total bitcoins transacted have to do with
>> >> hashpower required?
>> >>
>> >>
>> >> On Fri, Mar 31, 2017 at 2:22 PM, Matt Corallo via bitcoin-dev
>> >> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>> >> > Hey Sergio,
>> >> >
>> >> > You appear to have ignored the last two years of Bitcoin hardfork
>> >> > research and understanding, recycling instead BIP 102 from 2015.
>> There
>> >> > are many proposals which have pushed the state of hard fork research
>> >> > much further since then, and you may wish to read some of the posts
>> on
>> >> > this mailing list listed at https://bitcoinhardforkresearc
>> h.github.io/
>> >> > and make further edits based on what you learn. Your goal of "avoid
>> >> > technical changes" appears to not have any basis outside of perceived
>> >> > compromise for compromise sake, only making such a hardfork riskier
>> >> > instead.
>> >> >
>> >> > At a minimum, in terms of pure technical changes, you should probably
>> >> > consider (probably among others):
>> >> >
>> >> > a) Utilizing the "hard fork signaling bit" in the nVersion of the
>> block.
>> >> > b) Either limiting non-SegWit transactions in some way to fix the
>> n**2
>> >> > sighash and FindAndDelete runtime and memory usage issues or fix
>> them by
>> >> > utilizing the new sighash type which many wallets and projects have
>> >> > already implemented for SegWit in the spending of non-SegWit outputs.
>> >> > c) Your really should have replay protection in any HF. The clever
>> fix
>> >> > from
>> >> > Spoonnet for poor scaling of optionally allowing non-SegWit outputs
>> to
>> >> > be spent with SegWit's sighash provides this all in one go.
>> >> > d) You may wish to consider the possibility of tweaking the witness
>> >> > discount and possibly discounting other parts of the input - SegWit
>> went
>> >> > a long ways towards making removal of elements from the UTXO set
>> cheaper
>> >> > than adding them, but didn't quite get there, you should probably
>> finish
>> >> > that job. This also provides additional tuneable parameters to allow
>> you
>> >> > to increase the block size while not having a blowup in the
>> worst-case
>> >> > block size.
>> >> > e) Additional commitments at the top of the merkle root - both for
>> >> > SegWit transactions and as additional space for merged mining and
>> other
>> >> > commitments which we may wish to add in the future, this should
>> likely
>> >> > be implemented an "additional header" ala Johnson Lau's Spoonnet
>> >> > proposal.
>> >> >
>> >> > Additionally, I think your parameters here pose very significant
>> risk to
>> >> > the Bitcoin ecosystem broadly.
>> >> >
>> >> > a) Activating a hard fork with less than 18/24 months (and even
>> then...)
>> >> > from a fully-audited and supported release of full node software to
>> >> > activation date poses significant risks to many large software
>> projects
>> >> > and users. I've repeatedly received feedback from various folks that
>> a
>> >> > year or more is likely required in any hard fork to limit this risk,
>> and
>> >> > limited pushback on that given the large increase which SegWit
>> provides
>> >> > itself buying a ton of time.
>> >> >
>> >> > b) Having a significant discontinuity in block size increase only
>> serves
>> >> > to confuse and mislead users and businesses, forcing them to rapidly
>> >> > adapt to a Bitcoin which changed overnight both by hardforking, and
>> by
>> >> > fees changing suddenly. Instead, having the hard fork activate
>> technical
>> >> > changes, and then slowly increasing the block size over the following
>> >> > several years keeps things nice and continuous and also keeps us from
>> >> > having to revisit ye old blocksize debate again six months after
>> >> > activation.
>> >> >
>> >> > c) You should likely consider the effect of the many technological
>> >> > innovations coming down the pipe in the coming months. Technologies
>> like
>> >> > Lightning, TumbleBit, and even your own RootStock could significantly
>> >> > reduce fee pressure as transactions move to much faster and more
>> >> > featureful systems.
>> >> >
>> >> > Commitments to aggressive hard fork parameters now may leave miners
>> >> > without much revenue as far out as the next halving (which current
>> >> > transaction growth trends are indicating we'd just only barely reach
>> 2MB
>> >> > of transaction volume, let alone if you consider the effects of users
>> >> > moving to systems which provide more features for Bitcoin
>> transactions).
>> >> > This could lead to a precipitous drop in hashrate as miners are no
>> >> > longer sufficiently compensated.
>> >> >
>> >> > Remember that the "hashpower required to secure bitcoin" is
>> determined
>> >> > as a percentage of total Bitcoins transacted on-chain in each block,
>> so
>> >> > as subsidy goes down, miners need to be paid with fees, not just
>> price
>> >> > increases. Even if we were OK with hashpower going down compared to
>> the
>> >> > value it is securing, betting the security of Bitcoin on its price
>> >> > rising exponentially to match decreasing subsidy does not strike me
>> as a
>> >> > particularly inspiring tradeoff.
>> >> >
>> >> > There aren't many great technical solutions to some of these issues,
>> as
>> >> > far as I'm aware, but it's something that needs to be incredibly
>> >> > carefully considered before betting the continued security of
>> Bitcoin on
>> >> > exponential on-chain growth, something which we have historically
>> never
>> >> > seen.
>> >> >
>> >> > Matt
>> >> >
>> >> >
>> >> > On March 31, 2017 5:09:18 PM EDT, Sergio Demian Lerner via
>> bitcoin-dev
>> >> > <bitcoin-dev at lists.linuxfoundation.org> wrote:
>> >> >>Hi everyone,
>> >> >>
>> >> >>Segwit2Mb is the project to merge into Bitcoin a minimal patch that
>> >> >>aims to
>> >> >>untangle the current conflict between different political positions
>> >> >>regarding segwit activation vs. an increase of the on-chain
>> blockchain
>> >> >>space through a standard block size increase. It is not a new
>> solution,
>> >> >>but
>> >> >>it should be seen more as a least common denominator.
>> >> >>
>> >> >>Segwit2Mb combines segwit as it is today in Bitcoin 0.14+ with a 2MB
>> >> >>block
>> >> >>size hard-fork activated ONLY if segwit activates (95% of miners
>> >> >>signaling), but at a fixed future date.
>> >> >>
>> >> >>The sole objective of this proposal is to re-unite the Bitcoin
>> >> >>community
>> >> >>and avoid a cryptocurrency split. Segwit2Mb does not aim to be best
>> >> >>possible technical solution to solve Bitcoin technical limitations.
>> >> >>However, this proposal does not imply a compromise to the future
>> >> >>scalability or decentralization of Bitcoin, as a small increase in
>> >> >>block
>> >> >>size has been proven by several core and non-core developers not to
>> >> >>affect
>> >> >>Bitcoin value propositions.
>> >> >>
>> >> >>In the worst case, a 2X block size increase has much lower economic
>> >> >>impact
>> >> >>than the last bitcoin halving (<10%), which succeeded without
>> problem.
>> >> >>
>> >> >>On the other side, Segwit2Mb primary goal is to be minimalistic: in
>> >> >>this
>> >> >>patch some choices have been made to reduce the number of lines
>> >> >>modified in
>> >> >>the current Bitcoin Core state (master branch), instead of
>> implementing
>> >> >>the
>> >> >>most elegant solution. This is because I want to reduce the time it
>> >> >>takes
>> >> >>for core programmers and reviewers to check the correctness of the
>> >> >>code,
>> >> >>and to report and correct bugs.
>> >> >>
>> >> >>The patch was built by forking the master branch of Bitcoin Core,
>> >> >>mixing a
>> >> >>few lines of code from Jeff Garzik's BIP102,  and defining a second
>> >> >>versionbits activation bit (bit 2) for the combined activation.
>> >> >>
>> >> >>The combined activation of segwit and 2Mb hard-fork nVersion bit is 2
>> >> >>(DEPLOYMENT_SEGWIT_AND_2MB_BLOCKS).
>> >> >>
>> >> >>This means that segwit can still be activated without the 2MB
>> hard-fork
>> >> >>by
>> >> >>signaling bit 1 in nVersion  (DEPLOYMENT_SEGWIT).
>> >> >>
>> >> >>The tentative lock-in and hard-fork dates are the following:
>> >> >>
>> >> >>Bit 2 signaling StartTime = 1493424000; // April 29th, 2017
>> >> >>
>> >> >>Bit 2 signaling Timeout = 1503964800; // August 29th, 2017
>> >> >>
>> >> >>HardForkTime = 1513209600; // Thu, 14 Dec 2017 00:00:00 GMT
>> >> >>
>> >> >>
>> >> >>The hard-fork is conditional to 95% of the hashing power has approved
>> >> >>the
>> >> >>segwit2mb soft-fork and the segwit soft-fork has been activated
>> (which
>> >> >>should occur 2016 blocks after its lock-in time)
>> >> >>
>> >> >>For more information on how soft-forks are signaled and activated,
>> see
>> >> >>https://github.com/bitcoin/bips/blob/master/bip-0009.mediawiki
>> >> >>
>> >> >>This means that segwit would be activated before 2Mb: this is
>> >> >>inevitable,
>> >> >>as versionbits have been designed to have fixed activation periods
>> and
>> >> >>thresholds for all bits. Making segwit and 2Mb fork activate together
>> >> >>at a
>> >> >>delayed date would have required a major re-write of this code, which
>> >> >>would
>> >> >>contradict the premise of creating a minimalistic patch. However,
>> once
>> >> >>segwit is activated, the hard-fork is unavoidable.
>> >> >>
>> >> >>Although I have coded a first version of the segwit2mb patch (which
>> >> >>modifies 120 lines of code, and adds 220 lines of testing code), I
>> >> >>would
>> >> >>prefer to wait to publish the source code until more comments have
>> been
>> >> >>received from the community.
>> >> >>
>> >> >>To prevent worsening block verification time because of the O(N^2)
>> >> >>hashing
>> >> >>problem, the simple restriction that transactions cannot be larger
>> than
>> >> >>1Mb
>> >> >>has been kept. Therefore the worse-case of block verification time
>> has
>> >> >>only
>> >> >>doubled.
>> >> >>
>> >> >>Regarding the hard-fork activation date, I want to give enough time
>> to
>> >> >>all
>> >> >>active economic nodes to upgrade. As of Fri Mar 31 2017,
>> >> >>https://bitnodes.21.co/nodes/ reports that 6332 out of 6955 nodes
>> (91%)
>> >> >>have upgraded to post 0.12 versions. Upgrade to post 0.12 versions
>> can
>> >> >>be
>> >> >>used to identify economic active nodes, because in the 0.12 release
>> >> >>dynamic
>> >> >>fees were introduced, and currently no Bitcoin automatic payment
>> system
>> >> >>can
>> >> >>operate without automatic discovery of the current fee rate. A
>> pre-0.12
>> >> >>would require constant manual intervention.
>> >> >>Therefore I conclude that no more than 91% of the network nodes
>> >> >>reported by
>> >> >>bitnodes are active economic nodes.
>> >> >>
>> >> >>As Bitcoin Core 0.12 was released on February 2016, the time for this
>> >> >>91%
>> >> >>to upgrade has been around one year (under a moderate pressure of
>> >> >>operational problems with unconfirmed transactions).
>> >> >>Therefore we can expect a similar or lower time to upgrade for a
>> >> >>hard-fork,
>> >> >>after developers have discussed and approved the patch, and it has
>> been
>> >> >>reviewed and merged and 95% of the hashing power has signaled for it
>> >> >>(the
>> >> >>pressure not to upgrade being a complete halt of the operations).
>> >> >>However I
>> >> >>suggest that we discuss the hard-fork date and delay it if there is a
>> >> >>real
>> >> >>need to.
>> >> >>
>> >> >>Currently time works against the Bitcoin community, and so is
>> delaying
>> >> >>a
>> >> >>compromise solution. Most of the community agree that halting the
>> >> >>innovation for several years is a very bad option.
>> >> >>
>> >> >>After the comments collected by the community, a BIP will be written
>> >> >>describing the resulting proposal details.
>> >> >>
>> >> >>If segwit2mb locks-in, before hard-fork occurs all bitcoin nodes
>> should
>> >> >>be
>> >> >>updated to a Segwit2Mb enabled node to prevent them to be forked-away
>> >> >>in a
>> >> >>chain with almost no hashing-power.
>> >> >>
>> >> >>The proof of concept patch was made for Bitcoin Core but should be
>> >> >>easily
>> >> >>ported to other Bitcoin protocol implementations that already support
>> >> >>versionbits. Lightweight (SPV) wallets should not be affected as they
>> >> >>generally do not check the block size.
>> >> >>
>> >> >>I personally want to see the Lightning Network in action this year,
>> use
>> >> >>the
>> >> >>non-malleability features in segwit, see the community discussing
>> other
>> >> >>exciting soft-forks in the scaling roadmap, Schnorr sigs, drivechains
>> >> >>and
>> >> >>MAST.
>> >> >>
>> >> >>I want to see miners, developers and industry side-by-side pushing
>> >> >>Bitcoin
>> >> >>forward, to increase the value of Bitcoin and prevent high
>> transaction
>> >> >>fees
>> >> >>to put out of business use-cases that could have high positive social
>> >> >>impact.
>> >> >>
>> >> >>I believe in the strength of a unified Bitcoin community. If you're a
>> >> >>developer, please give your opinion, suggest changes, audit it, and
>> >> >>take a
>> >> >>stand with me to unlock the current Bitcoin deadlock.
>> >> >>
>> >> >>Contributions to the segwit2mb project are welcomed and awaited. The
>> >> >>only
>> >> >>limitation is to stick to the principle that the patch should be as
>> >> >>simple
>> >> >>to audit as possible. As an example, I wouldn't feel confident if the
>> >> >>patch
>> >> >>modified more than ~150 lines of code.
>> >> >>
>> >> >>Improvements unrelated to a 2 Mb increase or segwit, as beneficial as
>> >> >>it
>> >> >>may be to Bitcoin, should not be part of segwit2Mb.
>> >> >>
>> >> >>This proposal should not prevent other consensus proposals to be
>> >> >>simultaneously merged: segwit2mb is a last resort solution in case we
>> >> >>can
>> >> >>not reach consensus on anything better.
>> >> >>
>> >> >>Again, the proposal is only a starting point: community feedback is
>> >> >>expected and welcomed.
>> >> >>
>> >> >>Regards,
>> >> >>Sergio Demian Lerner
>> >> > _______________________________________________
>> >> > bitcoin-dev mailing list
>> >> > bitcoin-dev at lists.linuxfoundation.org
>> >> > https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>> >
>> >
>> >
>> > _______________________________________________
>> > bitcoin-dev mailing list
>> > bitcoin-dev at lists.linuxfoundation.org
>> > https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>> >
>> _______________________________________________
>> bitcoin-dev mailing list
>> bitcoin-dev at lists.linuxfoundation.org
>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>
>
>
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170602/40964871/attachment-0001.html>

From erik at q32.com  Sat Jun  3 00:53:55 2017
From: erik at q32.com (Erik Aronesty)
Date: Fri, 2 Jun 2017 20:53:55 -0400
Subject: [bitcoin-dev] Segwit2Mb - combined soft/hard fork - Request For
	Comments
In-Reply-To: <CAKzdR-qQvSz0WA3e9DoT-N+wwsFSjWu0G+iMcvJR1zmpXdHNZQ@mail.gmail.com>
References: <CAKzdR-oN6tGvGSb04_awCf=Jsf3wgKJN5xUhCr8G2D2W9YgJww@mail.gmail.com>
	<1CF1FD5D-8D29-4783-823F-B3F588D5C5CE@mattcorallo.com>
	<CAD1TkXse5O6nEw9-EPsNp4c56YJ+OnM=F1uf8w+tyB=_+hFzFQ@mail.gmail.com>
	<CAKzdR-rFJNOZ856rA_q8C=zEUj_X561OSOwW+KZr4nRJ51w3HA@mail.gmail.com>
	<CABm2gDrAHo2P7t6SjituURqMUqs_=Lbp7X=g_j8nGoNKMKCRKQ@mail.gmail.com>
	<CAJowKg+aYUCgBu0nD9U63jm2SunGeqdqOwiMgnTSfE9JmNJAQw@mail.gmail.com>
	<CAKzdR-qQvSz0WA3e9DoT-N+wwsFSjWu0G+iMcvJR1zmpXdHNZQ@mail.gmail.com>
Message-ID: <CAJowKgLmhWG6YjobTDS-F+ER2sr1tW38tjQZy=5LHt-YikEj6g@mail.gmail.com>

What I mean is that spoonet and other HF improvements, and a slower
timeline needs to be folded in ...before the HF activation date - to make
it far more likely that the community adopts the whole proposal and the
chain doesn't fragment.

If you try to push a 2mb with no safety checks and nothing else improved -
nothing will happen.

Take a quick look at the COOP proposal...it gets us to 4mb blocks in 4
years....gradually, no massive fee swings.


On Fri, Jun 2, 2017 at 5:51 PM, Sergio Demian Lerner <
sergio.d.lerner at gmail.com> wrote:

> By "upgrade"  the HF you mean activate 2X and then spoonet 18 months later
> or do not activate the 2x HF at all?
>
>
>
>
>
> On Fri, Jun 2, 2017 at 4:04 PM, Erik Aronesty via bitcoin-dev <
> bitcoin-dev at lists.linuxfoundation.org> wrote:
>
>> From me to you ...this proposal doesn't lock in anything.   We could just
>> merge it with some small pushback - allow segwit to activate in Aug, then
>> "upgrade" the hard fork to be "spoonet in 18 months" instead.
>>
>> On Sat, Apr 1, 2017 at 8:33 AM, Jorge Tim?n via bitcoin-dev <
>> bitcoin-dev at lists.linuxfoundation.org> wrote:
>>
>>> Segwit replaces the 1 mb size limit with a weight limit of 4 mb. After
>>> segwit there's no need for MAX_BLOCK_BASE_SIZE anymore, let alone
>>> MAX_BLOCK2_BASE_SIZE.
>>> Thus, by "hf to 2 mb" it seems you just really mean hardforking from 4
>>> mb weight to 8 mb weight.
>>>
>>> I would also use the hardfork bit (sign bit in block.nNersion) as matt
>>> comments.
>>>
>>> > We're in a deadlock and it seems we can't go forward adding more
>>> functionality to segwit without the community approval (which include
>>> miners). This is obvious to me.Then we have to go back.
>>>
>>> If segwit is controversial the way it is (I still don't understand why
>>> despite having insistently asking to users and miners who claim to
>>> oppose it), adding more consensus rule changes won't make it any less
>>> controversial. If anything, it would be removing consensus rule
>>> changes, not adding them that could make it less controversial.
>>>
>>> By no means I want to dissuade you from working on this bip proposal,
>>> but I really don't see how it helps getting out of the deadlock at
>>> all.
>>>
>>>
>>> On Sat, Apr 1, 2017 at 1:44 PM, Sergio Demian Lerner via bitcoin-dev
>>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>> > Some people have asked me for the current implementation of this patch
>>> to
>>> > review. I remind you that the current patch does not implement the
>>> hard-fork
>>> > signaling, as requested by Matt.
>>> >
>>> > The Segwit2Mb patch can be found here:
>>> > https://github.com/SergioDemianLerner/bitcoin/commits/master
>>> >
>>> > For now, the segwit2mb repo has a single test file using the old
>>> internal
>>> > blockchain building method (test/block_size_tests.cpp). This must be
>>> > replaced soon with a better external test using the
>>> bitcoin/qa/rpc-tests
>>> > tests, which I will begin to work on now after I collect all comments
>>> from
>>> > the community.
>>> >
>>> >
>>> > regards
>>> >
>>> >
>>> >
>>> > On Sat, Apr 1, 2017 at 3:55 AM, Jared Lee Richardson <
>>> jaredr26 at gmail.com>
>>> > wrote:
>>> >>
>>> >> > Remember that the "hashpower required to secure bitcoin" is
>>> determined
>>> >> > as a percentage of total Bitcoins transacted on-chain in each block
>>> >>
>>> >> Can you explain this statement a little better?  What do you mean by
>>> >> that?  What does the total bitcoins transacted have to do with
>>> >> hashpower required?
>>> >>
>>> >>
>>> >> On Fri, Mar 31, 2017 at 2:22 PM, Matt Corallo via bitcoin-dev
>>> >> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>> >> > Hey Sergio,
>>> >> >
>>> >> > You appear to have ignored the last two years of Bitcoin hardfork
>>> >> > research and understanding, recycling instead BIP 102 from 2015.
>>> There
>>> >> > are many proposals which have pushed the state of hard fork research
>>> >> > much further since then, and you may wish to read some of the posts
>>> on
>>> >> > this mailing list listed at https://bitcoinhardforkresearc
>>> h.github.io/
>>> >> > and make further edits based on what you learn. Your goal of "avoid
>>> >> > technical changes" appears to not have any basis outside of
>>> perceived
>>> >> > compromise for compromise sake, only making such a hardfork riskier
>>> >> > instead.
>>> >> >
>>> >> > At a minimum, in terms of pure technical changes, you should
>>> probably
>>> >> > consider (probably among others):
>>> >> >
>>> >> > a) Utilizing the "hard fork signaling bit" in the nVersion of the
>>> block.
>>> >> > b) Either limiting non-SegWit transactions in some way to fix the
>>> n**2
>>> >> > sighash and FindAndDelete runtime and memory usage issues or fix
>>> them by
>>> >> > utilizing the new sighash type which many wallets and projects have
>>> >> > already implemented for SegWit in the spending of non-SegWit
>>> outputs.
>>> >> > c) Your really should have replay protection in any HF. The clever
>>> fix
>>> >> > from
>>> >> > Spoonnet for poor scaling of optionally allowing non-SegWit outputs
>>> to
>>> >> > be spent with SegWit's sighash provides this all in one go.
>>> >> > d) You may wish to consider the possibility of tweaking the witness
>>> >> > discount and possibly discounting other parts of the input - SegWit
>>> went
>>> >> > a long ways towards making removal of elements from the UTXO set
>>> cheaper
>>> >> > than adding them, but didn't quite get there, you should probably
>>> finish
>>> >> > that job. This also provides additional tuneable parameters to
>>> allow you
>>> >> > to increase the block size while not having a blowup in the
>>> worst-case
>>> >> > block size.
>>> >> > e) Additional commitments at the top of the merkle root - both for
>>> >> > SegWit transactions and as additional space for merged mining and
>>> other
>>> >> > commitments which we may wish to add in the future, this should
>>> likely
>>> >> > be implemented an "additional header" ala Johnson Lau's Spoonnet
>>> >> > proposal.
>>> >> >
>>> >> > Additionally, I think your parameters here pose very significant
>>> risk to
>>> >> > the Bitcoin ecosystem broadly.
>>> >> >
>>> >> > a) Activating a hard fork with less than 18/24 months (and even
>>> then...)
>>> >> > from a fully-audited and supported release of full node software to
>>> >> > activation date poses significant risks to many large software
>>> projects
>>> >> > and users. I've repeatedly received feedback from various folks
>>> that a
>>> >> > year or more is likely required in any hard fork to limit this
>>> risk, and
>>> >> > limited pushback on that given the large increase which SegWit
>>> provides
>>> >> > itself buying a ton of time.
>>> >> >
>>> >> > b) Having a significant discontinuity in block size increase only
>>> serves
>>> >> > to confuse and mislead users and businesses, forcing them to rapidly
>>> >> > adapt to a Bitcoin which changed overnight both by hardforking, and
>>> by
>>> >> > fees changing suddenly. Instead, having the hard fork activate
>>> technical
>>> >> > changes, and then slowly increasing the block size over the
>>> following
>>> >> > several years keeps things nice and continuous and also keeps us
>>> from
>>> >> > having to revisit ye old blocksize debate again six months after
>>> >> > activation.
>>> >> >
>>> >> > c) You should likely consider the effect of the many technological
>>> >> > innovations coming down the pipe in the coming months. Technologies
>>> like
>>> >> > Lightning, TumbleBit, and even your own RootStock could
>>> significantly
>>> >> > reduce fee pressure as transactions move to much faster and more
>>> >> > featureful systems.
>>> >> >
>>> >> > Commitments to aggressive hard fork parameters now may leave miners
>>> >> > without much revenue as far out as the next halving (which current
>>> >> > transaction growth trends are indicating we'd just only barely
>>> reach 2MB
>>> >> > of transaction volume, let alone if you consider the effects of
>>> users
>>> >> > moving to systems which provide more features for Bitcoin
>>> transactions).
>>> >> > This could lead to a precipitous drop in hashrate as miners are no
>>> >> > longer sufficiently compensated.
>>> >> >
>>> >> > Remember that the "hashpower required to secure bitcoin" is
>>> determined
>>> >> > as a percentage of total Bitcoins transacted on-chain in each
>>> block, so
>>> >> > as subsidy goes down, miners need to be paid with fees, not just
>>> price
>>> >> > increases. Even if we were OK with hashpower going down compared to
>>> the
>>> >> > value it is securing, betting the security of Bitcoin on its price
>>> >> > rising exponentially to match decreasing subsidy does not strike me
>>> as a
>>> >> > particularly inspiring tradeoff.
>>> >> >
>>> >> > There aren't many great technical solutions to some of these
>>> issues, as
>>> >> > far as I'm aware, but it's something that needs to be incredibly
>>> >> > carefully considered before betting the continued security of
>>> Bitcoin on
>>> >> > exponential on-chain growth, something which we have historically
>>> never
>>> >> > seen.
>>> >> >
>>> >> > Matt
>>> >> >
>>> >> >
>>> >> > On March 31, 2017 5:09:18 PM EDT, Sergio Demian Lerner via
>>> bitcoin-dev
>>> >> > <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>> >> >>Hi everyone,
>>> >> >>
>>> >> >>Segwit2Mb is the project to merge into Bitcoin a minimal patch that
>>> >> >>aims to
>>> >> >>untangle the current conflict between different political positions
>>> >> >>regarding segwit activation vs. an increase of the on-chain
>>> blockchain
>>> >> >>space through a standard block size increase. It is not a new
>>> solution,
>>> >> >>but
>>> >> >>it should be seen more as a least common denominator.
>>> >> >>
>>> >> >>Segwit2Mb combines segwit as it is today in Bitcoin 0.14+ with a 2MB
>>> >> >>block
>>> >> >>size hard-fork activated ONLY if segwit activates (95% of miners
>>> >> >>signaling), but at a fixed future date.
>>> >> >>
>>> >> >>The sole objective of this proposal is to re-unite the Bitcoin
>>> >> >>community
>>> >> >>and avoid a cryptocurrency split. Segwit2Mb does not aim to be best
>>> >> >>possible technical solution to solve Bitcoin technical limitations.
>>> >> >>However, this proposal does not imply a compromise to the future
>>> >> >>scalability or decentralization of Bitcoin, as a small increase in
>>> >> >>block
>>> >> >>size has been proven by several core and non-core developers not to
>>> >> >>affect
>>> >> >>Bitcoin value propositions.
>>> >> >>
>>> >> >>In the worst case, a 2X block size increase has much lower economic
>>> >> >>impact
>>> >> >>than the last bitcoin halving (<10%), which succeeded without
>>> problem.
>>> >> >>
>>> >> >>On the other side, Segwit2Mb primary goal is to be minimalistic: in
>>> >> >>this
>>> >> >>patch some choices have been made to reduce the number of lines
>>> >> >>modified in
>>> >> >>the current Bitcoin Core state (master branch), instead of
>>> implementing
>>> >> >>the
>>> >> >>most elegant solution. This is because I want to reduce the time it
>>> >> >>takes
>>> >> >>for core programmers and reviewers to check the correctness of the
>>> >> >>code,
>>> >> >>and to report and correct bugs.
>>> >> >>
>>> >> >>The patch was built by forking the master branch of Bitcoin Core,
>>> >> >>mixing a
>>> >> >>few lines of code from Jeff Garzik's BIP102,  and defining a second
>>> >> >>versionbits activation bit (bit 2) for the combined activation.
>>> >> >>
>>> >> >>The combined activation of segwit and 2Mb hard-fork nVersion bit is
>>> 2
>>> >> >>(DEPLOYMENT_SEGWIT_AND_2MB_BLOCKS).
>>> >> >>
>>> >> >>This means that segwit can still be activated without the 2MB
>>> hard-fork
>>> >> >>by
>>> >> >>signaling bit 1 in nVersion  (DEPLOYMENT_SEGWIT).
>>> >> >>
>>> >> >>The tentative lock-in and hard-fork dates are the following:
>>> >> >>
>>> >> >>Bit 2 signaling StartTime = 1493424000; // April 29th, 2017
>>> >> >>
>>> >> >>Bit 2 signaling Timeout = 1503964800; // August 29th, 2017
>>> >> >>
>>> >> >>HardForkTime = 1513209600; // Thu, 14 Dec 2017 00:00:00 GMT
>>> >> >>
>>> >> >>
>>> >> >>The hard-fork is conditional to 95% of the hashing power has
>>> approved
>>> >> >>the
>>> >> >>segwit2mb soft-fork and the segwit soft-fork has been activated
>>> (which
>>> >> >>should occur 2016 blocks after its lock-in time)
>>> >> >>
>>> >> >>For more information on how soft-forks are signaled and activated,
>>> see
>>> >> >>https://github.com/bitcoin/bips/blob/master/bip-0009.mediawiki
>>> >> >>
>>> >> >>This means that segwit would be activated before 2Mb: this is
>>> >> >>inevitable,
>>> >> >>as versionbits have been designed to have fixed activation periods
>>> and
>>> >> >>thresholds for all bits. Making segwit and 2Mb fork activate
>>> together
>>> >> >>at a
>>> >> >>delayed date would have required a major re-write of this code,
>>> which
>>> >> >>would
>>> >> >>contradict the premise of creating a minimalistic patch. However,
>>> once
>>> >> >>segwit is activated, the hard-fork is unavoidable.
>>> >> >>
>>> >> >>Although I have coded a first version of the segwit2mb patch (which
>>> >> >>modifies 120 lines of code, and adds 220 lines of testing code), I
>>> >> >>would
>>> >> >>prefer to wait to publish the source code until more comments have
>>> been
>>> >> >>received from the community.
>>> >> >>
>>> >> >>To prevent worsening block verification time because of the O(N^2)
>>> >> >>hashing
>>> >> >>problem, the simple restriction that transactions cannot be larger
>>> than
>>> >> >>1Mb
>>> >> >>has been kept. Therefore the worse-case of block verification time
>>> has
>>> >> >>only
>>> >> >>doubled.
>>> >> >>
>>> >> >>Regarding the hard-fork activation date, I want to give enough time
>>> to
>>> >> >>all
>>> >> >>active economic nodes to upgrade. As of Fri Mar 31 2017,
>>> >> >>https://bitnodes.21.co/nodes/ reports that 6332 out of 6955 nodes
>>> (91%)
>>> >> >>have upgraded to post 0.12 versions. Upgrade to post 0.12 versions
>>> can
>>> >> >>be
>>> >> >>used to identify economic active nodes, because in the 0.12 release
>>> >> >>dynamic
>>> >> >>fees were introduced, and currently no Bitcoin automatic payment
>>> system
>>> >> >>can
>>> >> >>operate without automatic discovery of the current fee rate. A
>>> pre-0.12
>>> >> >>would require constant manual intervention.
>>> >> >>Therefore I conclude that no more than 91% of the network nodes
>>> >> >>reported by
>>> >> >>bitnodes are active economic nodes.
>>> >> >>
>>> >> >>As Bitcoin Core 0.12 was released on February 2016, the time for
>>> this
>>> >> >>91%
>>> >> >>to upgrade has been around one year (under a moderate pressure of
>>> >> >>operational problems with unconfirmed transactions).
>>> >> >>Therefore we can expect a similar or lower time to upgrade for a
>>> >> >>hard-fork,
>>> >> >>after developers have discussed and approved the patch, and it has
>>> been
>>> >> >>reviewed and merged and 95% of the hashing power has signaled for it
>>> >> >>(the
>>> >> >>pressure not to upgrade being a complete halt of the operations).
>>> >> >>However I
>>> >> >>suggest that we discuss the hard-fork date and delay it if there is
>>> a
>>> >> >>real
>>> >> >>need to.
>>> >> >>
>>> >> >>Currently time works against the Bitcoin community, and so is
>>> delaying
>>> >> >>a
>>> >> >>compromise solution. Most of the community agree that halting the
>>> >> >>innovation for several years is a very bad option.
>>> >> >>
>>> >> >>After the comments collected by the community, a BIP will be written
>>> >> >>describing the resulting proposal details.
>>> >> >>
>>> >> >>If segwit2mb locks-in, before hard-fork occurs all bitcoin nodes
>>> should
>>> >> >>be
>>> >> >>updated to a Segwit2Mb enabled node to prevent them to be
>>> forked-away
>>> >> >>in a
>>> >> >>chain with almost no hashing-power.
>>> >> >>
>>> >> >>The proof of concept patch was made for Bitcoin Core but should be
>>> >> >>easily
>>> >> >>ported to other Bitcoin protocol implementations that already
>>> support
>>> >> >>versionbits. Lightweight (SPV) wallets should not be affected as
>>> they
>>> >> >>generally do not check the block size.
>>> >> >>
>>> >> >>I personally want to see the Lightning Network in action this year,
>>> use
>>> >> >>the
>>> >> >>non-malleability features in segwit, see the community discussing
>>> other
>>> >> >>exciting soft-forks in the scaling roadmap, Schnorr sigs,
>>> drivechains
>>> >> >>and
>>> >> >>MAST.
>>> >> >>
>>> >> >>I want to see miners, developers and industry side-by-side pushing
>>> >> >>Bitcoin
>>> >> >>forward, to increase the value of Bitcoin and prevent high
>>> transaction
>>> >> >>fees
>>> >> >>to put out of business use-cases that could have high positive
>>> social
>>> >> >>impact.
>>> >> >>
>>> >> >>I believe in the strength of a unified Bitcoin community. If you're
>>> a
>>> >> >>developer, please give your opinion, suggest changes, audit it, and
>>> >> >>take a
>>> >> >>stand with me to unlock the current Bitcoin deadlock.
>>> >> >>
>>> >> >>Contributions to the segwit2mb project are welcomed and awaited. The
>>> >> >>only
>>> >> >>limitation is to stick to the principle that the patch should be as
>>> >> >>simple
>>> >> >>to audit as possible. As an example, I wouldn't feel confident if
>>> the
>>> >> >>patch
>>> >> >>modified more than ~150 lines of code.
>>> >> >>
>>> >> >>Improvements unrelated to a 2 Mb increase or segwit, as beneficial
>>> as
>>> >> >>it
>>> >> >>may be to Bitcoin, should not be part of segwit2Mb.
>>> >> >>
>>> >> >>This proposal should not prevent other consensus proposals to be
>>> >> >>simultaneously merged: segwit2mb is a last resort solution in case
>>> we
>>> >> >>can
>>> >> >>not reach consensus on anything better.
>>> >> >>
>>> >> >>Again, the proposal is only a starting point: community feedback is
>>> >> >>expected and welcomed.
>>> >> >>
>>> >> >>Regards,
>>> >> >>Sergio Demian Lerner
>>> >> > _______________________________________________
>>> >> > bitcoin-dev mailing list
>>> >> > bitcoin-dev at lists.linuxfoundation.org
>>> >> > https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>> >
>>> >
>>> >
>>> > _______________________________________________
>>> > bitcoin-dev mailing list
>>> > bitcoin-dev at lists.linuxfoundation.org
>>> > https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>> >
>>> _______________________________________________
>>> bitcoin-dev mailing list
>>> bitcoin-dev at lists.linuxfoundation.org
>>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>>
>>
>>
>> _______________________________________________
>> bitcoin-dev mailing list
>> bitcoin-dev at lists.linuxfoundation.org
>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170602/4ae7e0c6/attachment-0001.html>

From opetruzel at gmail.com  Sat Jun  3 02:03:47 2017
From: opetruzel at gmail.com (Oliver Petruzel)
Date: Fri, 2 Jun 2017 22:03:47 -0400
Subject: [bitcoin-dev] Segwit2Mb - combined soft/hard fork - Request For
	Comments
In-Reply-To: <CAJowKgLmhWG6YjobTDS-F+ER2sr1tW38tjQZy=5LHt-YikEj6g@mail.gmail.com>
References: <CAKzdR-oN6tGvGSb04_awCf=Jsf3wgKJN5xUhCr8G2D2W9YgJww@mail.gmail.com>
	<1CF1FD5D-8D29-4783-823F-B3F588D5C5CE@mattcorallo.com>
	<CAD1TkXse5O6nEw9-EPsNp4c56YJ+OnM=F1uf8w+tyB=_+hFzFQ@mail.gmail.com>
	<CAKzdR-rFJNOZ856rA_q8C=zEUj_X561OSOwW+KZr4nRJ51w3HA@mail.gmail.com>
	<CABm2gDrAHo2P7t6SjituURqMUqs_=Lbp7X=g_j8nGoNKMKCRKQ@mail.gmail.com>
	<CAJowKg+aYUCgBu0nD9U63jm2SunGeqdqOwiMgnTSfE9JmNJAQw@mail.gmail.com>
	<CAKzdR-qQvSz0WA3e9DoT-N+wwsFSjWu0G+iMcvJR1zmpXdHNZQ@mail.gmail.com>
	<CAJowKgLmhWG6YjobTDS-F+ER2sr1tW38tjQZy=5LHt-YikEj6g@mail.gmail.com>
Message-ID: <CALhpmH3n6i=HoLki5E0pPqrW8V-n2G6XLoza3ts96h3iJwLk5w@mail.gmail.com>

>>>Take a quick look at the COOP proposal...it gets us to 4mb blocks in 4
years....gradually, no massive fee swings.<<<

How is that captured in the COOP BIP? I can see Luke's 2MB cap referenced
in the BIP, but I don't see anything in the text that would indicate a
gradual increase of any sort.

As someone who has previously written a BIP draft to accomplish a gradual
increase with SegWit, I'd be very interested in seeing what approach
they've chosen.

Ollie
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170602/6b040040/attachment.html>

From opetruzel at gmail.com  Sat Jun  3 21:05:23 2017
From: opetruzel at gmail.com (Oliver Petruzel)
Date: Sat, 3 Jun 2017 17:05:23 -0400
Subject: [bitcoin-dev] Segwit2Mb - combined soft/hard fork - Request For
	Comments
In-Reply-To: <CAJowKgLmhWG6YjobTDS-F+ER2sr1tW38tjQZy=5LHt-YikEj6g@mail.gmail.com>
References: <CAKzdR-oN6tGvGSb04_awCf=Jsf3wgKJN5xUhCr8G2D2W9YgJww@mail.gmail.com>
	<1CF1FD5D-8D29-4783-823F-B3F588D5C5CE@mattcorallo.com>
	<CAD1TkXse5O6nEw9-EPsNp4c56YJ+OnM=F1uf8w+tyB=_+hFzFQ@mail.gmail.com>
	<CAKzdR-rFJNOZ856rA_q8C=zEUj_X561OSOwW+KZr4nRJ51w3HA@mail.gmail.com>
	<CABm2gDrAHo2P7t6SjituURqMUqs_=Lbp7X=g_j8nGoNKMKCRKQ@mail.gmail.com>
	<CAJowKg+aYUCgBu0nD9U63jm2SunGeqdqOwiMgnTSfE9JmNJAQw@mail.gmail.com>
	<CAKzdR-qQvSz0WA3e9DoT-N+wwsFSjWu0G+iMcvJR1zmpXdHNZQ@mail.gmail.com>
	<CAJowKgLmhWG6YjobTDS-F+ER2sr1tW38tjQZy=5LHt-YikEj6g@mail.gmail.com>
Message-ID: <CALhpmH1RHRWagteFTm+_HM4t2wBQEV60qO0AkL3_pPKPy2D+tw@mail.gmail.com>

>>2.1MB capacity in August via segwit, with 4MB weight, and 4.2MB capacity
in December with 8MB<<

I'm not sure how many people to not of the draft BIP I submitted to the
list in early April. It was essentially a combination of Gavin's BIP 109,
Adam's 2-4-8 idea, and something I added to SegWit that I call "Discount
Governing."

It basically takes the idea of gradual increases one step farther: a
gradual increase of both the Total weight and SegWit discount rate over a
period of X years (a schedule of Flag Day + X blocks increases).

Would this be something that some in the dev community might consider
if/when SegWit is combined with a block increase?

Original draft here:
https://lists.linuxfoundation.org/pipermail/bitcoin-dev/
2017-April/013984.html

Ollie
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170603/e570a003/attachment.html>

From karljohan-alm at garage.co.jp  Mon Jun  5 02:06:32 2017
From: karljohan-alm at garage.co.jp (Karl Johan Alm)
Date: Mon, 5 Jun 2017 11:06:32 +0900
Subject: [bitcoin-dev] BIP Proposal: Compact Client Side Filtering for
 Light Clients
In-Reply-To: <CAE0pnxK5r2XfVks=emkK=v66XRN5c-Sz-Lm_dKY+6nO=kPk6Vw@mail.gmail.com>
References: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
	<CALJw2w5gUgbdX7XnxPsK2FZ6PZ5cSTgmCEqiPu7-S4gwXBM-_Q@mail.gmail.com>
	<CAE0pnx+RRAP269VeWAcxKbrcS9qX4LS8_6nY_js8X5NtQ22t_A@mail.gmail.com>
	<CAE0pnxLKYnwHnktTqW949s1AA9uK=6WnVYWmRoau8B1SszzYEg@mail.gmail.com>
	<CAE0pnxJxHYQ4+2pt3tt=1WZ0-K0vDxGB4KBXY+R=WfktMmATwA@mail.gmail.com>
	<CAE0pnxK5r2XfVks=emkK=v66XRN5c-Sz-Lm_dKY+6nO=kPk6Vw@mail.gmail.com>
Message-ID: <CALJw2w6Vzq8PO3x607=ERK4XKU2vrHApqKP2rWm-sw2r1ZOJMw@mail.gmail.com>

On Sat, Jun 3, 2017 at 2:55 AM, Alex Akselrod via bitcoin-dev
<bitcoin-dev at lists.linuxfoundation.org> wrote:
> Without a soft fork, this is the only way for light clients to verify that
> peers aren't lying to them. Clients can request headers (just hashes of the
> filters and the previous headers, creating a chain) and look for conflicts
> between peers. If a conflict is found at a certain block, the client can
> download the block, generate a filter, calculate the header by hashing
> together the previous header and the generated filter, and banning any peers
> that don't match. A full node could prune old filters if you wanted and
> recalculate them as necessary if you just keep the filter header chain info
> as really old filters are unlikely to be requested by correctly written
> software but you can't guarantee every client will follow best practices
> either.

Ahh, so you actually make a separate digest chain with prev hashes and
everything. Once/if committed digests are soft forked in, it seems a
bit overkill but maybe it's worth it. (I was always assuming committed
digests in coinbase would come after people started using this, and
that people could just ask a couple of random peers for the digest
hash and ensure everyone gave the same answer as the hash of the
downloaded digest..).

> The simulations are based on completely random data within given parameters.

I noticed an increase in FP hits when using real data sampled from
real scriptPubKeys and such. Address reuse and other weird stuff. See
"lies.h" in github repo for experiments and chainsim.c initial part of
main where wallets get random stuff from the chain.

> I will definitely try to reproduce my experiments with Golomb-Coded
> sets and see what I come up with. It seems like you've got a little
> less than half the size of my digests for 1-block digests but I
> haven't tried making digests for all blocks (and lots of early blocks
> are empty).
>
>
> Filters for empty blocks only take a few bytes and sometimes zero when the
> coinbase output is a burn that doesn't push any data (example will be in the
> test vectors that I'll have ready shortly).

I created digests for all blocks up until block #469805 and actually
ended up with 5.8 GB, which is 1.1 GB lower than what you have, but
may be worse perf-wise on false positive rates and such.

> How fast are these to create? Would it make sense to provide digests
> on demand in some cases, rather than keeping them around indefinitely?
>
>
> They're pretty fast and can be pruned if desired, as mentioned above, as
> long as the header chain is kept.

For comparison, creating the digests above (469805 of them) took
roughly 30 mins on my end, but using the kstats format so probably
higher on an actual node (should get around to profiling that...).

From bitcoin at upalc.com  Mon Jun  5 20:30:23 2017
From: bitcoin at upalc.com (Upal Chakraborty)
Date: Tue, 6 Jun 2017 02:00:23 +0530
Subject: [bitcoin-dev] SegWit activation proposal with 2MB Hard Fork by next
 Block Halving on 2020
Message-ID: <CAED3CWg-Ss_4q6WzRh3ue+NP69Z8-xTztQw-=gO9Pc_j+pGiVg@mail.gmail.com>

*Proposal*: Verify whether 50% Tx mined from SegWit activation block to
block 630000 are SegWit Tx. If yes, increase legacy max block size to 2MB
and SegWit max block size to 8MB.

*Implementation*: This proposal either needs to be implemented in next
release of Bitcoin Core or require SegWit activation period restart while
it is implemented & released.

*Rationale*: This proposal minimizes the chance of a chain split, while
sticking to the original bitcoin scaling roadmap, i.e.
https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2015-December/011865.html


Thanks & Regards,
Upal Chakraborty
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170606/545af76b/attachment.html>

From contact at taoeffect.com  Tue Jun  6 22:39:28 2017
From: contact at taoeffect.com (Tao Effect)
Date: Tue, 6 Jun 2017 15:39:28 -0700
Subject: [bitcoin-dev] Replay attacks make BIP148 and BIP149 untennable
Message-ID: <31833011-7179-49D1-A07E-8FD9556C4534@taoeffect.com>

This is just me putting in my formal objection to BIP148 and BIP149 based on my experience with the ETH/ETC hard fork and involvement in that drama.

First, it's important to note that ETC/ETH HF is a very different situation from BIP148 and all other soft-forks. To those on this mailing list, the reasons should be self-evident (one results in two incompatible chains, the other doesn't).

However, replay attacks are common to both possibilities (i.e. when BIP148 has <51% hash power).

I believe the severity of replay attacks is going unvoiced and is not understood within the bitcoin community because of their lack of experience with them.

I further believe that replay attacks are the #1 issue with BIP148, BIP149, etc., superseding wipeout attacks in severity.

These are not baseless beliefs, they're born out of experience and I think anyone will reach the same conclusion upon study.

In a nutshell, replay attacks mean that all talk of there being potentially "two coins" as a result of BIP148 is basically nonsense.

Replay attacks effectively eliminate that possibility.

When users go to "sell their legacy coins", they've just sold their 148 coins, and vice versa.

Both of the coin-splitting techniques given so far by the proponents BIP148 are also untenable:

- Double-spending to self with nLockTime txns is insanely complicated, risky, not guaranteed to work, extremely time consuming, and would likely result in a massive increase in backlogged transactions and increased fees.

- Mixing with 148 coinbase txns destroys fungibility.

Without a coin, there is no real threat from BIP148. Without that threat, there is no point to BIP148, and the miners know this.

These and other concerns are outlined and explained in more detail in this conversation I had yesterday with John Light:

https://www.youtube.com/watch?v=33rL3-p8cPw <https://www.youtube.com/watch?v=33rL3-p8cPw>

Cheers,
Greg Slepak

--
Please do not email me anything that you are not comfortable also sharing with the NSA.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170606/7b754c78/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 801 bytes
Desc: Message signed with OpenPGP
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170606/7b754c78/attachment.sig>

From greg at xiph.org  Tue Jun  6 23:02:06 2017
From: greg at xiph.org (Gregory Maxwell)
Date: Tue, 6 Jun 2017 23:02:06 +0000
Subject: [bitcoin-dev] Replay attacks make BIP148 and BIP149 untennable
In-Reply-To: <31833011-7179-49D1-A07E-8FD9556C4534@taoeffect.com>
References: <31833011-7179-49D1-A07E-8FD9556C4534@taoeffect.com>
Message-ID: <CAAS2fgSU+UtbJSSAhf0-Sd0GH-RGnZmv+WHWtFV2zHFW2q6_yg@mail.gmail.com>

On Tue, Jun 6, 2017 at 10:39 PM, Tao Effect via bitcoin-dev
<bitcoin-dev at lists.linuxfoundation.org> wrote:
> I believe the severity of replay attacks is going unvoiced and is not
> understood within the bitcoin community because of their lack of experience
> with them.

Please don't insult our community-- the issues with replay were
pointed out by us to Ethereum in advance and were cited specifically
in prior hardfork discussions long before Ethereum started editing
their ledger for the economic benefit of its centralized
administrators.

The lack of extensive discussion on these issues you're seeing is
rather symptomatic of engineers that take stability seriously not
taking BIP148 seriously; not symptomatic of people not knowing about
them. The same concerns also applies to all these HF proposals (which
for some reason you don't mention), arguably even stronger.  The same
basic pattern exists: There are people that just don't care about the
technical issues who have made up their minds, and so you don't see
technical discussion.  Those people who do see the issues already
called out the proposals as being ill-advised.   Replay isn't even the
largest of the technical issues (network partitioning, for example, is
a much larger one).

BIP149 is arguably something of another matter in particular because
it has a time-frame that allows dealing with replay and other issues--
and particularly because it has a time-frame that can allow for the
avoidance of a meaningful fork at all.

From luke at dashjr.org  Tue Jun  6 23:08:11 2017
From: luke at dashjr.org (Luke Dashjr)
Date: Tue, 6 Jun 2017 23:08:11 +0000
Subject: [bitcoin-dev] Replay attacks make BIP148 and BIP149 untennable
In-Reply-To: <31833011-7179-49D1-A07E-8FD9556C4534@taoeffect.com>
References: <31833011-7179-49D1-A07E-8FD9556C4534@taoeffect.com>
Message-ID: <201706062308.12531.luke@dashjr.org>

On Tuesday 06 June 2017 10:39:28 PM Tao Effect via bitcoin-dev wrote:
> I believe the severity of replay attacks is going unvoiced and is not
> understood within the bitcoin community because of their lack of
> experience with them.

Replay is a solved problem. It can be improved on and made simpler, but at 
this point, replay only occurs when the sender is either negligent or 
intending it.

> Both of the coin-splitting techniques given so far by the proponents BIP148
> are also untenable:
> 
> - Double-spending to self with nLockTime txns is insanely complicated,
> risky, not guaranteed to work, extremely time consuming, and would likely
> result in a massive increase in backlogged transactions and increased
> fees.

This is nothing but unfounded FUD. It is very simple to implement and 
guaranteed to work eventually. It may be time consuming, but that is the only 
truth here. The only risk is that of a long reorg, the same as double spend 
attacks.

> - Mixing with 148 coinbase txns destroys fungibility.

What kind of "fungibility" does this FUD claim it destroys? Destroying cross-
chain fungibility is the very *intent* of replay protection. And it does not 
destroy same-chain fungibility any more than any other miner spending.

> Without a coin, there is no real threat from BIP148.

Lack of replay protection does not mean there is no coin. Replay protection is 
equally a concern for the main (BIP148) chain and any legacy chains malicious 
miners might choose to split off. And none of this changes the fact that such 
miners will be unable to sell their legacycoins at Bitcoin market prices, 
because whether other transactions are replayed or not, *their* coins won't be 
valid on the main chain.

Luke

From aj at erisian.com.au  Tue Jun  6 23:20:15 2017
From: aj at erisian.com.au (Anthony Towns)
Date: Wed, 7 Jun 2017 09:20:15 +1000
Subject: [bitcoin-dev] Replay attacks make BIP148 and BIP149 untennable
In-Reply-To: <31833011-7179-49D1-A07E-8FD9556C4534@taoeffect.com>
References: <31833011-7179-49D1-A07E-8FD9556C4534@taoeffect.com>
Message-ID: <20170606232015.GA11830@erisian.com.au>

On Tue, Jun 06, 2017 at 03:39:28PM -0700, Tao Effect via bitcoin-dev wrote:
> - Mixing with 148 coinbase txns destroys fungibility.

CoinJoin works as a method of both improving fungibility and mixing with
coinbase transactions.

You probably don't need to do anything clever to split a coin though:
if you send a transaction with a standard fee it will get confirmed
in a normal time on the higher hashrate chain, but won't confirm as
quickly on the lower hashrate chain (precisely because transactions are
valid on both chains, but blocks are found more slowly with the lower
hashrate). When it's confirmed on one chain, but not on the other, you
can then "double-spend" on the lower hashrate chain with a higher fee,
to end up with different coins on both chains.

(also, no double-n in untenable)

Cheers,
aj


From contact at taoeffect.com  Tue Jun  6 23:12:26 2017
From: contact at taoeffect.com (Tao Effect)
Date: Tue, 6 Jun 2017 16:12:26 -0700
Subject: [bitcoin-dev] Replay attacks make BIP148 and BIP149 untennable
In-Reply-To: <CAAS2fgSU+UtbJSSAhf0-Sd0GH-RGnZmv+WHWtFV2zHFW2q6_yg@mail.gmail.com>
References: <31833011-7179-49D1-A07E-8FD9556C4534@taoeffect.com>
	<CAAS2fgSU+UtbJSSAhf0-Sd0GH-RGnZmv+WHWtFV2zHFW2q6_yg@mail.gmail.com>
Message-ID: <7117CE7C-3C6F-4342-8A43-072605EB3D1E@taoeffect.com>

Hey Greg,

It wasn't my intention to insult anyone (a bit defensive?).

Maybe this is yet another example of a recurring criticism of Core: that core doesn't community these issues very well to journalists / reports / media / community outside of this list.

Because outside of this list it's been all about those 148 coins, and almost zero mention of replay attacks.

> BIP149 is arguably something of another matter in particular because
> it has a time-frame that allows dealing with replay and other issues--
> and particularly because it has a time-frame that can allow for the
> avoidance of a meaningful fork at all.

Are there other, more reasonable / feasible ways of addressing replay attacks in Bitcoin / BIP149 scenario?

Cheers,
Greg

--
Please do not email me anything that you are not comfortable also sharing with the NSA.

> On Jun 6, 2017, at 4:02 PM, Gregory Maxwell <greg at xiph.org <mailto:greg at xiph.org>> wrote:
> 
> On Tue, Jun 6, 2017 at 10:39 PM, Tao Effect via bitcoin-dev
> <bitcoin-dev at lists.linuxfoundation.org <mailto:bitcoin-dev at lists.linuxfoundation.org>> wrote:
>> I believe the severity of replay attacks is going unvoiced and is not
>> understood within the bitcoin community because of their lack of experience
>> with them.
> 
> Please don't insult our community-- the issues with replay were
> pointed out by us to Ethereum in advance and were cited specifically
> in prior hardfork discussions long before Ethereum started editing
> their ledger for the economic benefit of its centralized
> administrators.
> 
> The lack of extensive discussion on these issues you're seeing is
> rather symptomatic of engineers that take stability seriously not
> taking BIP148 seriously; not symptomatic of people not knowing about
> them. The same concerns also applies to all these HF proposals (which
> for some reason you don't mention), arguably even stronger.  The same
> basic pattern exists: There are people that just don't care about the
> technical issues who have made up their minds, and so you don't see
> technical discussion.  Those people who do see the issues already
> called out the proposals as being ill-advised.   Replay isn't even the
> largest of the technical issues (network partitioning, for example, is
> a much larger one).
> 
> BIP149 is arguably something of another matter in particular because
> it has a time-frame that allows dealing with replay and other issues--
> and particularly because it has a time-frame that can allow for the
> avoidance of a meaningful fork at all.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170606/6748ec9e/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 801 bytes
Desc: Message signed with OpenPGP
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170606/6748ec9e/attachment-0001.sig>

From contact at taoeffect.com  Tue Jun  6 23:19:39 2017
From: contact at taoeffect.com (Tao Effect)
Date: Tue, 6 Jun 2017 16:19:39 -0700
Subject: [bitcoin-dev] Replay attacks make BIP148 and BIP149 untennable
In-Reply-To: <201706062308.12531.luke@dashjr.org>
References: <31833011-7179-49D1-A07E-8FD9556C4534@taoeffect.com>
	<201706062308.12531.luke@dashjr.org>
Message-ID: <3F598630-86AA-4ACC-AD71-BB594767276C@taoeffect.com>

> Replay is a solved problem.

Point to this solved problem?

Your "solution" here is not a solution:

https://www.reddit.com/r/Bitcoin/comments/6f1urd/i_think_its_time_we_have_an_educated_discussion/diey21t/?context=3 <https://www.reddit.com/r/Bitcoin/comments/6f1urd/i_think_its_time_we_have_an_educated_discussion/diey21t/?context=3>

> This is nothing but unfounded FUD. It is very simple to implement and
> guaranteed to work eventually. It may be time consuming, but that is the only
> truth here. The only risk is that of a long reorg, the same as double spend
> attacks.

Let's assume you invented a simple way to double-spend txns to self (which you haven't, fyi), then that is an issue in of itself as the point of bitcoin is to *prevent* double-spending to self.

There would need to be much more time for the community to discuss the implications of wallets have a "double-spend to self" button in them.

> What kind of "fungibility" does this FUD claim it destroys? Destroying cross-
> chain fungibility is the very *intent* of replay protection. And it does not
> destroy same-chain fungibility any more than any other miner spending.

Yes it does destroy same-chain fungibility, as discussed on twitter [1], you're making miner coins special on both chains.

> Lack of replay protection does not mean there is no coin.

It effectively does. If people want to proceed blindly, ignoring replay, they're welcome to read about the consequences [2].

[1] https://twitter.com/taoeffect/status/872226556571131905 <https://twitter.com/taoeffect/status/872226556571131905>
[2] http://gist.github.com/taoeffect/c910ebb16d9f6d248e9f1f3c6e10b1b8 <http://gist.github.com/taoeffect/c910ebb16d9f6d248e9f1f3c6e10b1b8>

--
Please do not email me anything that you are not comfortable also sharing with the NSA.

> On Jun 6, 2017, at 4:08 PM, Luke Dashjr <luke at dashjr.org <mailto:luke at dashjr.org>> wrote:
> 
> On Tuesday 06 June 2017 10:39:28 PM Tao Effect via bitcoin-dev wrote:
>> I believe the severity of replay attacks is going unvoiced and is not
>> understood within the bitcoin community because of their lack of
>> experience with them.
> 
> Replay is a solved problem. It can be improved on and made simpler, but at
> this point, replay only occurs when the sender is either negligent or
> intending it.
> 
>> Both of the coin-splitting techniques given so far by the proponents BIP148
>> are also untenable:
>> 
>> - Double-spending to self with nLockTime txns is insanely complicated,
>> risky, not guaranteed to work, extremely time consuming, and would likely
>> result in a massive increase in backlogged transactions and increased
>> fees.
> 
> This is nothing but unfounded FUD. It is very simple to implement and
> guaranteed to work eventually. It may be time consuming, but that is the only
> truth here. The only risk is that of a long reorg, the same as double spend
> attacks.
> 
>> - Mixing with 148 coinbase txns destroys fungibility.
> 
> What kind of "fungibility" does this FUD claim it destroys? Destroying cross-
> chain fungibility is the very *intent* of replay protection. And it does not
> destroy same-chain fungibility any more than any other miner spending.
> 
>> Without a coin, there is no real threat from BIP148.
> 
> Lack of replay protection does not mean there is no coin. Replay protection is
> equally a concern for the main (BIP148) chain and any legacy chains malicious
> miners might choose to split off. And none of this changes the fact that such
> miners will be unable to sell their legacycoins at Bitcoin market prices,
> because whether other transactions are replayed or not, *their* coins won't be
> valid on the main chain.
> 
> Luke

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170606/1e3823f1/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 801 bytes
Desc: Message signed with OpenPGP
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170606/1e3823f1/attachment.sig>

From contact at taoeffect.com  Tue Jun  6 23:27:33 2017
From: contact at taoeffect.com (Tao Effect)
Date: Tue, 6 Jun 2017 16:27:33 -0700
Subject: [bitcoin-dev] Replay attacks make BIP148 and BIP149 untennable
In-Reply-To: <20170606232015.GA11830@erisian.com.au>
References: <31833011-7179-49D1-A07E-8FD9556C4534@taoeffect.com>
	<20170606232015.GA11830@erisian.com.au>
Message-ID: <38DDC3A2-2727-477E-A6FF-7638842AAB03@taoeffect.com>

> CoinJoin works as a method of both improving fungibility and mixing with
> coinbase transactions.

My understanding is that the two situations are quite different.

Unlike mixing to coin-split, CoinJoin doesn't create a high demand exclusively for coinbase transactions.

However, of the proposed methods, coin-mixing seems the better option, because it might be reasonably easy (I don't know) for exchanges to obtain 148 coinbase coins, and mix their coins with them, extending the coin-splitting capability beyond just miner coins and then using that to split incoming coins.

That seems like the most reasonable approach I've heard so far. Whether exchanges would be willing to do that is a separate question.

> When it's confirmed on one chain, but not on the other, you
> can then "double-spend" on the lower hashrate chain with a higher fee,
> to end up with different coins on both chains.

This method is time consuming and not guaranteed to work. CPFP can be used by an attacker to get your original txn into the 148 chain.

> (also, no double-n in untenable)

Why thank you aj, you're so good at spelling. :-)

Cheers,
Greg

--
Please do not email me anything that you are not comfortable also sharing with the NSA.

> On Jun 6, 2017, at 4:20 PM, Anthony Towns via bitcoin-dev <bitcoin-dev at lists.linuxfoundation.org <mailto:bitcoin-dev at lists.linuxfoundation.org>> wrote:
> 
> On Tue, Jun 06, 2017 at 03:39:28PM -0700, Tao Effect via bitcoin-dev wrote:
>> - Mixing with 148 coinbase txns destroys fungibility.
> 
> CoinJoin works as a method of both improving fungibility and mixing with
> coinbase transactions.
> 
> You probably don't need to do anything clever to split a coin though:
> if you send a transaction with a standard fee it will get confirmed
> in a normal time on the higher hashrate chain, but won't confirm as
> quickly on the lower hashrate chain (precisely because transactions are
> valid on both chains, but blocks are found more slowly with the lower
> hashrate). When it's confirmed on one chain, but not on the other, you
> can then "double-spend" on the lower hashrate chain with a higher fee,
> to end up with different coins on both chains.
> 
> (also, no double-n in untenable)
> 
> Cheers,
> aj
> 
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org <mailto:bitcoin-dev at lists.linuxfoundation.org>
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170606/ddaf726e/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 801 bytes
Desc: Message signed with OpenPGP
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170606/ddaf726e/attachment-0001.sig>

From contact at taoeffect.com  Tue Jun  6 23:31:17 2017
From: contact at taoeffect.com (Tao Effect)
Date: Tue, 6 Jun 2017 16:31:17 -0700
Subject: [bitcoin-dev] Replay attacks make BIP148 and BIP149 untennable
In-Reply-To: <38DDC3A2-2727-477E-A6FF-7638842AAB03@taoeffect.com>
References: <31833011-7179-49D1-A07E-8FD9556C4534@taoeffect.com>
	<20170606232015.GA11830@erisian.com.au>
	<38DDC3A2-2727-477E-A6FF-7638842AAB03@taoeffect.com>
Message-ID: <A6627D4B-F127-4213-A4B0-8040CF91F3CD@taoeffect.com>

> CPFP can be used by an attacker to get your original txn into the 148 chain.

*err, my bad that's unlikely to happen, if I remember correctly CPFP can only be done by the person you're sending the coins to. Coin-mixing seems the better option of the two, but shouldn't the BIP148 folks wait until it's clear that will be supported by exchanges?

--
Please do not email me anything that you are not comfortable also sharing with the NSA.

> On Jun 6, 2017, at 4:27 PM, Tao Effect <contact at taoeffect.com <mailto:contact at taoeffect.com>> wrote:
> 
>> CoinJoin works as a method of both improving fungibility and mixing with
>> coinbase transactions.
> 
> My understanding is that the two situations are quite different.
> 
> Unlike mixing to coin-split, CoinJoin doesn't create a high demand exclusively for coinbase transactions.
> 
> However, of the proposed methods, coin-mixing seems the better option, because it might be reasonably easy (I don't know) for exchanges to obtain 148 coinbase coins, and mix their coins with them, extending the coin-splitting capability beyond just miner coins and then using that to split incoming coins.
> 
> That seems like the most reasonable approach I've heard so far. Whether exchanges would be willing to do that is a separate question.
> 
>> When it's confirmed on one chain, but not on the other, you
>> can then "double-spend" on the lower hashrate chain with a higher fee,
>> to end up with different coins on both chains.
> 
> This method is time consuming and not guaranteed to work. CPFP can be used by an attacker to get your original txn into the 148 chain.
> 
>> (also, no double-n in untenable)
> 
> Why thank you aj, you're so good at spelling. :-)
> 
> Cheers,
> Greg
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170606/35a6f6dc/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 801 bytes
Desc: Message signed with OpenPGP
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170606/35a6f6dc/attachment.sig>

From kekcoin at protonmail.com  Tue Jun  6 23:59:19 2017
From: kekcoin at protonmail.com (Kekcoin)
Date: Tue, 06 Jun 2017 19:59:19 -0400
Subject: [bitcoin-dev] Replay attacks make BIP148 and BIP149 untennable
In-Reply-To: <38DDC3A2-2727-477E-A6FF-7638842AAB03@taoeffect.com>
References: <31833011-7179-49D1-A07E-8FD9556C4534@taoeffect.com>
	<20170606232015.GA11830@erisian.com.au>
	<38DDC3A2-2727-477E-A6FF-7638842AAB03@taoeffect.com>
Message-ID: <w5Ywd9qPblH4-m68BQC58FfV4fNFOCPUkUIOsNOz8-0uJQLjIaG5JevhRv1x_0cqtcZvRsKYQTy-EuBTjzJL-DuSX7dsHuoMfw-68cweBOk=@protonmail.com>

You keep referring to 148 coinbase coins, what is the rationale behind this? Why would you prefer using 148 coinbases over legacy coinbases for this purpose?

Sent with [ProtonMail](https://protonmail.com) Secure Email.

-------- Original Message --------
Subject: Re: [bitcoin-dev] Replay attacks make BIP148 and BIP149 untennable
Local Time: June 7, 2017 2:27 AM
UTC Time: June 6, 2017 11:27 PM
From: bitcoin-dev at lists.linuxfoundation.org
To: Anthony Towns <aj at erisian.com.au>
bitcoin-dev at lists.linuxfoundation.org

CoinJoin works as a method of both improving fungibility and mixing with
coinbase transactions.

My understanding is that the two situations are quite different.

Unlike mixing to coin-split, CoinJoin doesn't create a high demand exclusively for coinbase transactions.

However, of the proposed methods, coin-mixing seems the better option, because it might be reasonably easy (I don't know) for exchanges to obtain 148 coinbase coins, and mix their coins with them, extending the coin-splitting capability beyond just miner coins and then using that to split incoming coins.

That seems like the most reasonable approach I've heard so far. Whether exchanges would be willing to do that is a separate question.

When it's confirmed on one chain, but not on the other, you
can then "double-spend" on the lower hashrate chain with a higher fee,
to end up with different coins on both chains.

This method is time consuming and not guaranteed to work. CPFP can be used by an attacker to get your original txn into the 148 chain.

(also, no double-n in untenable)

Why thank you aj, you're so good at spelling. :-)

Cheers,
Greg

--
Please do not email me anything that you are not comfortable also sharing with the NSA.

On Jun 6, 2017, at 4:20 PM, Anthony Towns via bitcoin-dev <bitcoin-dev at lists.linuxfoundation.org> wrote:

On Tue, Jun 06, 2017 at 03:39:28PM -0700, Tao Effect via bitcoin-dev wrote:- Mixing with 148 coinbase txns destroys fungibility.

CoinJoin works as a method of both improving fungibility and mixing with
coinbase transactions.

You probably don't need to do anything clever to split a coin though:
if you send a transaction with a standard fee it will get confirmed
in a normal time on the higher hashrate chain, but won't confirm as
quickly on the lower hashrate chain (precisely because transactions are
valid on both chains, but blocks are found more slowly with the lower
hashrate). When it's confirmed on one chain, but not on the other, you
can then "double-spend" on the lower hashrate chain with a higher fee,
to end up with different coins on both chains.

(also, no double-n in untenable)

Cheers,
aj

_______________________________________________
bitcoin-dev mailing list
bitcoin-dev at lists.linuxfoundation.org
https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170606/6b251954/attachment-0001.html>

From contact at taoeffect.com  Wed Jun  7 00:04:29 2017
From: contact at taoeffect.com (Tao Effect)
Date: Tue, 6 Jun 2017 17:04:29 -0700
Subject: [bitcoin-dev] Replay attacks make BIP148 and BIP149 untennable
In-Reply-To: <w5Ywd9qPblH4-m68BQC58FfV4fNFOCPUkUIOsNOz8-0uJQLjIaG5JevhRv1x_0cqtcZvRsKYQTy-EuBTjzJL-DuSX7dsHuoMfw-68cweBOk=@protonmail.com>
References: <31833011-7179-49D1-A07E-8FD9556C4534@taoeffect.com>
	<20170606232015.GA11830@erisian.com.au>
	<38DDC3A2-2727-477E-A6FF-7638842AAB03@taoeffect.com>
	<w5Ywd9qPblH4-m68BQC58FfV4fNFOCPUkUIOsNOz8-0uJQLjIaG5JevhRv1x_0cqtcZvRsKYQTy-EuBTjzJL-DuSX7dsHuoMfw-68cweBOk=@protonmail.com>
Message-ID: <78F1D626-0D38-48FD-B2AF-378765182751@taoeffect.com>

> You keep referring to 148 coinbase coins, what is the rationale behind this? Why would you prefer using 148 coinbases over legacy coinbases for this purpose?

OK, maybe "post-UASF coinbase coins" is a better term? I just wanted to make it clear that this refers to coins that come from blocks generated after the UASF is activated.

--
Please do not email me anything that you are not comfortable also sharing with the NSA.

> On Jun 6, 2017, at 4:59 PM, Kekcoin <kekcoin at protonmail.com <mailto:kekcoin at protonmail.com>> wrote:
> 
> You keep referring to 148 coinbase coins, what is the rationale behind this? Why would you prefer using 148 coinbases over legacy coinbases for this purpose?
> 
> 
> Sent with ProtonMail <https://protonmail.com/> Secure Email.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170606/e69fcaa4/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 801 bytes
Desc: Message signed with OpenPGP
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170606/e69fcaa4/attachment-0001.sig>

From kekcoin at protonmail.com  Wed Jun  7 00:19:18 2017
From: kekcoin at protonmail.com (Kekcoin)
Date: Tue, 06 Jun 2017 20:19:18 -0400
Subject: [bitcoin-dev] Replay attacks make BIP148 and BIP149 untennable
In-Reply-To: <78F1D626-0D38-48FD-B2AF-378765182751@taoeffect.com>
References: <31833011-7179-49D1-A07E-8FD9556C4534@taoeffect.com>
	<20170606232015.GA11830@erisian.com.au>
	<38DDC3A2-2727-477E-A6FF-7638842AAB03@taoeffect.com>
	<w5Ywd9qPblH4-m68BQC58FfV4fNFOCPUkUIOsNOz8-0uJQLjIaG5JevhRv1x_0cqtcZvRsKYQTy-EuBTjzJL-DuSX7dsHuoMfw-68cweBOk=@protonmail.com>
	<78F1D626-0D38-48FD-B2AF-378765182751@taoeffect.com>
Message-ID: <oSkyoMQ0QQadP3ZDrIU_Xw0sEG8lv5q3B5Kjwnu_MIkvUGmg9TrDn1myLeRhPhyPpGbAgp1QWkerbp76jjptWhh4jz3JXjVycXuXZkxodG8=@protonmail.com>

Hmm, that's not the difference I was talking about. I was referring to the fact that using "post-chainsplit coinbases from the non-148 chain" to unilaterally (ie. can be done without action on the 148-chain) taint coins is more secure in extreme-adverserial cases such as secret-mining reorg attacks (as unfeasibly expensive they may be); the only large-scale (>100 block) reorganization the non-148 chain faces should be a resolution of the chainsplit and therefore render the replay threat moot.

Sent with [ProtonMail](https://protonmail.com) Secure Email.

-------- Original Message --------
Subject: Re: [bitcoin-dev] Replay attacks make BIP148 and BIP149 untennable
Local Time: June 7, 2017 3:04 AM
UTC Time: June 7, 2017 12:04 AM
From: contact at taoeffect.com
To: Kekcoin <kekcoin at protonmail.com>
Anthony Towns <aj at erisian.com.au>, bitcoin-dev at lists.linuxfoundation.org <bitcoin-dev at lists.linuxfoundation.org>

You keep referring to 148 coinbase coins, what is the rationale behind this? Why would you prefer using 148 coinbases over legacy coinbases for this purpose?

OK, maybe "post-UASF coinbase coins" is a better term? I just wanted to make it clear that this refers to coins that come from blocks generated after the UASF is activated.

--
Please do not email me anything that you are not comfortable also sharing with the NSA.

On Jun 6, 2017, at 4:59 PM, Kekcoin <kekcoin at protonmail.com> wrote:

You keep referring to 148 coinbase coins, what is the rationale behind this? Why would you prefer using 148 coinbases over legacy coinbases for this purpose?

Sent with [ProtonMail](https://protonmail.com/) Secure Email.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170606/2a247527/attachment.html>

From james.hilliard1 at gmail.com  Wed Jun  7 00:56:10 2017
From: james.hilliard1 at gmail.com (James Hilliard)
Date: Tue, 6 Jun 2017 19:56:10 -0500
Subject: [bitcoin-dev] User Activated Soft Fork Split Protection
Message-ID: <CADvTj4qpH-t5Gx6qyn3yToyUE_GFaBE989=AWNHLKMpMNW3R+w@mail.gmail.com>

Due to the proposed calendar(https://segwit2x.github.io/) for the
SegWit2x agreement being too slow to activate SegWit mandatory
signalling ahead of BIP148 using BIP91 I would like to propose another
option that miners can use to prevent a chain split ahead of the Aug
1st BIP148 activation date.

The splitprotection soft fork is essentially BIP91 but using BIP8
instead of BIP9 with a lower activation threshold and immediate
mandatory signalling lock-in. This allows for a majority of miners to
activate mandatory SegWit signalling and prevent a potential chain
split ahead of BIP148 activation.

This BIP allows for miners to respond to market forces quickly ahead
of BIP148 activation by signalling for splitprotection. Any miners
already running BIP148 should be encouraged to use splitprotection.

<pre>
  BIP: splitprotection
  Layer: Consensus (soft fork)
  Title: User Activated Soft Fork Split Protection
  Author: James Hilliard <james.hilliard1 at gmail.com>
  Comments-Summary: No comments yet.
  Comments-URI:
  Status: Draft
  Type: Standards Track
  Created: 2017-05-22
  License: BSD-3-Clause
           CC0-1.0
</pre>

==Abstract==

This document specifies a coordination mechanism for a simple majority
of miners to prevent a chain split ahead of BIP148 activation.

==Definitions==

"existing segwit deployment" refer to the BIP9 "segwit" deployment
using bit 1, between November 15th 2016 and November 15th 2017 to
activate BIP141, BIP143 and BIP147.

==Motivation==

The biggest risk of BIP148 is an extended chain split, this BIP
provides a way for a simple majority of miners to eliminate that risk.

This BIP provides a way for a simple majority of miners to coordinate
activation of the existing segwit deployment with less than 95%
hashpower before BIP148 activation. Due to time constraints unless
immediately deployed BIP91 will likely not be able to enforce
mandatory signalling of segwit before the Aug 1st activation of
BIP148. This BIP provides a method for rapid miner activation of
SegWit mandatory signalling ahead of the BIP148 activation date. Since
the primary goal of this BIP is to reduce the chance of an extended
chain split as much as possible we activate using a simple miner
majority of 65% over a 504 block interval rather than a higher
percentage. This BIP also allows miners to signal their intention to
run BIP148 in order to prevent a chain split.

==Specification==

While this BIP is active, all blocks must set the nVersion header top
3 bits to 001 together with bit field (1<<1) (according to the
existing segwit deployment). Blocks that do not signal as required
will be rejected.

==Deployment==

This BIP will be deployed by "version bits" with a 65%(this can be
adjusted if desired) activation threshold BIP9 with the name
"splitprotecion" and using bit 2.

This BIP starts immediately and is a BIP8 style soft fork since
mandatory signalling will start on midnight August 1st 2017 (epoch
time 1501545600) regardless of whether or not this BIP has reached its
own signalling threshold. This BIP will cease to be active when segwit
is locked-in.

=== Reference implementation ===

<pre>
// Check if Segregated Witness is Locked In
bool IsWitnessLockedIn(const CBlockIndex* pindexPrev, const
Consensus::Params& params)
{
    LOCK(cs_main);
    return (VersionBitsState(pindexPrev, params,
Consensus::DEPLOYMENT_SEGWIT, versionbitscache) ==
THRESHOLD_LOCKED_IN);
}

// SPLITPROTECTION mandatory segwit signalling.
if ( VersionBitsState(pindex->pprev, chainparams.GetConsensus(),
Consensus::DEPLOYMENT_SPLITPROTECTION, versionbitscache) ==
THRESHOLD_LOCKED_IN &&
     !IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
// Segwit is not locked in
     !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus()) ) //
and is not active.
{
    bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
VERSIONBITS_TOP_BITS;
    bool fSegbit = (pindex->nVersion &
VersionBitsMask(chainparams.GetConsensus(),
Consensus::DEPLOYMENT_SEGWIT)) != 0;
    if (!(fVersionBits && fSegbit)) {
        return state.DoS(0, error("ConnectBlock(): relayed block must
signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
    }
}

// BIP148 mandatory segwit signalling.
int64_t nMedianTimePast = pindex->GetMedianTimePast();
if ( (nMedianTimePast >= 1501545600) &&  // Tue 01 Aug 2017 00:00:00 UTC
     (nMedianTimePast <= 1510704000) &&  // Wed 15 Nov 2017 00:00:00 UTC
     (!IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
 // Segwit is not locked in
      !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus())) )
 // and is not active.
{
    bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
VERSIONBITS_TOP_BITS;
    bool fSegbit = (pindex->nVersion &
VersionBitsMask(chainparams.GetConsensus(),
Consensus::DEPLOYMENT_SEGWIT)) != 0;
    if (!(fVersionBits && fSegbit)) {
        return state.DoS(0, error("ConnectBlock(): relayed block must
signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
    }
}
</pre>

https://github.com/bitcoin/bitcoin/compare/0.14...jameshilliard:splitprotection-v0.14.1

==Backwards Compatibility==

This deployment is compatible with the existing "segwit" bit 1
deployment scheduled between midnight November 15th, 2016 and midnight
November 15th, 2017. This deployment is also compatible with the
existing BIP148 deployment. This BIP is compatible with BIP91 only if
BIP91 activates before it and before BIP148. Miners will need to
upgrade their nodes to support splitprotection otherwise they may
build on top of an invalid block. While this bip is active users
should either upgrade to splitprotection or wait for additional
confirmations when accepting payments.

==Rationale==

Historically we have used IsSuperMajority() to activate soft forks
such as BIP66 which has a mandatory signalling requirement for miners
once activated, this ensures that miners are aware of new rules being
enforced. This technique can be leveraged to lower the signalling
threshold of a soft fork while it is in the process of being deployed
in a backwards compatible way. We also use a BIP8 style timeout to
ensure that this BIP is compatible with BIP148 and that BIP148
compatible mandatory signalling activates regardless of miner
signalling levels.

By orphaning non-signalling blocks during the BIP9 bit 1 "segwit"
deployment, this BIP can cause the existing "segwit" deployment to
activate without needing to release a new deployment. As we approach
BIP148 activation it may be desirable for a majority of miners to have
a method that will ensure that there is no chain split.

==References==

*[https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-March/013714.html
Mailing list discussion]
*[https://github.com/bitcoin/bitcoin/blob/v0.6.0/src/main.cpp#L1281-L1283
P2SH flag day activation]
*[[bip-0009.mediawiki|BIP9 Version bits with timeout and delay]]
*[[bip-0016.mediawiki|BIP16 Pay to Script Hash]]
*[[bip-0091.mediawiki|BIP91 Reduced threshold Segwit MASF]]
*[[bip-0141.mediawiki|BIP141 Segregated Witness (Consensus layer)]]
*[[bip-0143.mediawiki|BIP143 Transaction Signature Verification for
Version 0 Witness Program]]
*[[bip-0147.mediawiki|BIP147 Dealing with dummy stack element malleability]]
*[[bip-0148.mediawiki|BIP148 Mandatory activation of segwit deployment]]
*[[bip-0149.mediawiki|BIP149 Segregated Witness (second deployment)]]
*[https://bitcoincore.org/en/2016/01/26/segwit-benefits/ Segwit benefits]

==Copyright==

This document is dual licensed as BSD 3-clause, and Creative Commons
CC0 1.0 Universal.

From karljohan-alm at garage.co.jp  Wed Jun  7 01:11:25 2017
From: karljohan-alm at garage.co.jp (Karl Johan Alm)
Date: Wed, 7 Jun 2017 10:11:25 +0900
Subject: [bitcoin-dev] User Activated Soft Fork Split Protection
In-Reply-To: <CADvTj4qpH-t5Gx6qyn3yToyUE_GFaBE989=AWNHLKMpMNW3R+w@mail.gmail.com>
References: <CADvTj4qpH-t5Gx6qyn3yToyUE_GFaBE989=AWNHLKMpMNW3R+w@mail.gmail.com>
Message-ID: <CALJw2w5-vzwF4S4szj1fXTeK3ONXOiKEGDEKYre2ArWxwPCfeQ@mail.gmail.com>

One thing about BIP148 activation that may be affected by this is the
fact that segwit signalling non-BIP148 miners + BIP148 miners may hold
majority hash power and prevent a chain split. With this SF, that will
no longer be the case, right? Or am I completely confused on the
subject?

On Wed, Jun 7, 2017 at 9:56 AM, James Hilliard via bitcoin-dev
<bitcoin-dev at lists.linuxfoundation.org> wrote:
> Due to the proposed calendar(https://segwit2x.github.io/) for the
> SegWit2x agreement being too slow to activate SegWit mandatory
> signalling ahead of BIP148 using BIP91 I would like to propose another
> option that miners can use to prevent a chain split ahead of the Aug
> 1st BIP148 activation date.
>
> The splitprotection soft fork is essentially BIP91 but using BIP8
> instead of BIP9 with a lower activation threshold and immediate
> mandatory signalling lock-in. This allows for a majority of miners to
> activate mandatory SegWit signalling and prevent a potential chain
> split ahead of BIP148 activation.
>
> This BIP allows for miners to respond to market forces quickly ahead
> of BIP148 activation by signalling for splitprotection. Any miners
> already running BIP148 should be encouraged to use splitprotection.
>
> <pre>
>   BIP: splitprotection
>   Layer: Consensus (soft fork)
>   Title: User Activated Soft Fork Split Protection
>   Author: James Hilliard <james.hilliard1 at gmail.com>
>   Comments-Summary: No comments yet.
>   Comments-URI:
>   Status: Draft
>   Type: Standards Track
>   Created: 2017-05-22
>   License: BSD-3-Clause
>            CC0-1.0
> </pre>
>
> ==Abstract==
>
> This document specifies a coordination mechanism for a simple majority
> of miners to prevent a chain split ahead of BIP148 activation.
>
> ==Definitions==
>
> "existing segwit deployment" refer to the BIP9 "segwit" deployment
> using bit 1, between November 15th 2016 and November 15th 2017 to
> activate BIP141, BIP143 and BIP147.
>
> ==Motivation==
>
> The biggest risk of BIP148 is an extended chain split, this BIP
> provides a way for a simple majority of miners to eliminate that risk.
>
> This BIP provides a way for a simple majority of miners to coordinate
> activation of the existing segwit deployment with less than 95%
> hashpower before BIP148 activation. Due to time constraints unless
> immediately deployed BIP91 will likely not be able to enforce
> mandatory signalling of segwit before the Aug 1st activation of
> BIP148. This BIP provides a method for rapid miner activation of
> SegWit mandatory signalling ahead of the BIP148 activation date. Since
> the primary goal of this BIP is to reduce the chance of an extended
> chain split as much as possible we activate using a simple miner
> majority of 65% over a 504 block interval rather than a higher
> percentage. This BIP also allows miners to signal their intention to
> run BIP148 in order to prevent a chain split.
>
> ==Specification==
>
> While this BIP is active, all blocks must set the nVersion header top
> 3 bits to 001 together with bit field (1<<1) (according to the
> existing segwit deployment). Blocks that do not signal as required
> will be rejected.
>
> ==Deployment==
>
> This BIP will be deployed by "version bits" with a 65%(this can be
> adjusted if desired) activation threshold BIP9 with the name
> "splitprotecion" and using bit 2.
>
> This BIP starts immediately and is a BIP8 style soft fork since
> mandatory signalling will start on midnight August 1st 2017 (epoch
> time 1501545600) regardless of whether or not this BIP has reached its
> own signalling threshold. This BIP will cease to be active when segwit
> is locked-in.
>
> === Reference implementation ===
>
> <pre>
> // Check if Segregated Witness is Locked In
> bool IsWitnessLockedIn(const CBlockIndex* pindexPrev, const
> Consensus::Params& params)
> {
>     LOCK(cs_main);
>     return (VersionBitsState(pindexPrev, params,
> Consensus::DEPLOYMENT_SEGWIT, versionbitscache) ==
> THRESHOLD_LOCKED_IN);
> }
>
> // SPLITPROTECTION mandatory segwit signalling.
> if ( VersionBitsState(pindex->pprev, chainparams.GetConsensus(),
> Consensus::DEPLOYMENT_SPLITPROTECTION, versionbitscache) ==
> THRESHOLD_LOCKED_IN &&
>      !IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
> // Segwit is not locked in
>      !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus()) ) //
> and is not active.
> {
>     bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
> VERSIONBITS_TOP_BITS;
>     bool fSegbit = (pindex->nVersion &
> VersionBitsMask(chainparams.GetConsensus(),
> Consensus::DEPLOYMENT_SEGWIT)) != 0;
>     if (!(fVersionBits && fSegbit)) {
>         return state.DoS(0, error("ConnectBlock(): relayed block must
> signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
>     }
> }
>
> // BIP148 mandatory segwit signalling.
> int64_t nMedianTimePast = pindex->GetMedianTimePast();
> if ( (nMedianTimePast >= 1501545600) &&  // Tue 01 Aug 2017 00:00:00 UTC
>      (nMedianTimePast <= 1510704000) &&  // Wed 15 Nov 2017 00:00:00 UTC
>      (!IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
>  // Segwit is not locked in
>       !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus())) )
>  // and is not active.
> {
>     bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
> VERSIONBITS_TOP_BITS;
>     bool fSegbit = (pindex->nVersion &
> VersionBitsMask(chainparams.GetConsensus(),
> Consensus::DEPLOYMENT_SEGWIT)) != 0;
>     if (!(fVersionBits && fSegbit)) {
>         return state.DoS(0, error("ConnectBlock(): relayed block must
> signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
>     }
> }
> </pre>
>
> https://github.com/bitcoin/bitcoin/compare/0.14...jameshilliard:splitprotection-v0.14.1
>
> ==Backwards Compatibility==
>
> This deployment is compatible with the existing "segwit" bit 1
> deployment scheduled between midnight November 15th, 2016 and midnight
> November 15th, 2017. This deployment is also compatible with the
> existing BIP148 deployment. This BIP is compatible with BIP91 only if
> BIP91 activates before it and before BIP148. Miners will need to
> upgrade their nodes to support splitprotection otherwise they may
> build on top of an invalid block. While this bip is active users
> should either upgrade to splitprotection or wait for additional
> confirmations when accepting payments.
>
> ==Rationale==
>
> Historically we have used IsSuperMajority() to activate soft forks
> such as BIP66 which has a mandatory signalling requirement for miners
> once activated, this ensures that miners are aware of new rules being
> enforced. This technique can be leveraged to lower the signalling
> threshold of a soft fork while it is in the process of being deployed
> in a backwards compatible way. We also use a BIP8 style timeout to
> ensure that this BIP is compatible with BIP148 and that BIP148
> compatible mandatory signalling activates regardless of miner
> signalling levels.
>
> By orphaning non-signalling blocks during the BIP9 bit 1 "segwit"
> deployment, this BIP can cause the existing "segwit" deployment to
> activate without needing to release a new deployment. As we approach
> BIP148 activation it may be desirable for a majority of miners to have
> a method that will ensure that there is no chain split.
>
> ==References==
>
> *[https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-March/013714.html
> Mailing list discussion]
> *[https://github.com/bitcoin/bitcoin/blob/v0.6.0/src/main.cpp#L1281-L1283
> P2SH flag day activation]
> *[[bip-0009.mediawiki|BIP9 Version bits with timeout and delay]]
> *[[bip-0016.mediawiki|BIP16 Pay to Script Hash]]
> *[[bip-0091.mediawiki|BIP91 Reduced threshold Segwit MASF]]
> *[[bip-0141.mediawiki|BIP141 Segregated Witness (Consensus layer)]]
> *[[bip-0143.mediawiki|BIP143 Transaction Signature Verification for
> Version 0 Witness Program]]
> *[[bip-0147.mediawiki|BIP147 Dealing with dummy stack element malleability]]
> *[[bip-0148.mediawiki|BIP148 Mandatory activation of segwit deployment]]
> *[[bip-0149.mediawiki|BIP149 Segregated Witness (second deployment)]]
> *[https://bitcoincore.org/en/2016/01/26/segwit-benefits/ Segwit benefits]
>
> ==Copyright==
>
> This document is dual licensed as BSD 3-clause, and Creative Commons
> CC0 1.0 Universal.
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev

From james.hilliard1 at gmail.com  Wed Jun  7 01:29:18 2017
From: james.hilliard1 at gmail.com (James Hilliard)
Date: Tue, 6 Jun 2017 20:29:18 -0500
Subject: [bitcoin-dev] User Activated Soft Fork Split Protection
In-Reply-To: <CALJw2w5-vzwF4S4szj1fXTeK3ONXOiKEGDEKYre2ArWxwPCfeQ@mail.gmail.com>
References: <CADvTj4qpH-t5Gx6qyn3yToyUE_GFaBE989=AWNHLKMpMNW3R+w@mail.gmail.com>
	<CALJw2w5-vzwF4S4szj1fXTeK3ONXOiKEGDEKYre2ArWxwPCfeQ@mail.gmail.com>
Message-ID: <CADvTj4qwxDSXJ+SLGmWwKY3EQ416kL3eQabUubExR+yHRRrJmg@mail.gmail.com>

You need a majority of miners enforcing BIP148 upon BIP148 activation
to prevent a split, not just a majority signalling segwit. This
provides a miner coordination mechanism for BIP148 mandatory
signalling enforcement.

On Tue, Jun 6, 2017 at 8:11 PM, Karl Johan Alm
<karljohan-alm at garage.co.jp> wrote:
> One thing about BIP148 activation that may be affected by this is the
> fact that segwit signalling non-BIP148 miners + BIP148 miners may hold
> majority hash power and prevent a chain split. With this SF, that will
> no longer be the case, right? Or am I completely confused on the
> subject?
>
> On Wed, Jun 7, 2017 at 9:56 AM, James Hilliard via bitcoin-dev
> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>> Due to the proposed calendar(https://segwit2x.github.io/) for the
>> SegWit2x agreement being too slow to activate SegWit mandatory
>> signalling ahead of BIP148 using BIP91 I would like to propose another
>> option that miners can use to prevent a chain split ahead of the Aug
>> 1st BIP148 activation date.
>>
>> The splitprotection soft fork is essentially BIP91 but using BIP8
>> instead of BIP9 with a lower activation threshold and immediate
>> mandatory signalling lock-in. This allows for a majority of miners to
>> activate mandatory SegWit signalling and prevent a potential chain
>> split ahead of BIP148 activation.
>>
>> This BIP allows for miners to respond to market forces quickly ahead
>> of BIP148 activation by signalling for splitprotection. Any miners
>> already running BIP148 should be encouraged to use splitprotection.
>>
>> <pre>
>>   BIP: splitprotection
>>   Layer: Consensus (soft fork)
>>   Title: User Activated Soft Fork Split Protection
>>   Author: James Hilliard <james.hilliard1 at gmail.com>
>>   Comments-Summary: No comments yet.
>>   Comments-URI:
>>   Status: Draft
>>   Type: Standards Track
>>   Created: 2017-05-22
>>   License: BSD-3-Clause
>>            CC0-1.0
>> </pre>
>>
>> ==Abstract==
>>
>> This document specifies a coordination mechanism for a simple majority
>> of miners to prevent a chain split ahead of BIP148 activation.
>>
>> ==Definitions==
>>
>> "existing segwit deployment" refer to the BIP9 "segwit" deployment
>> using bit 1, between November 15th 2016 and November 15th 2017 to
>> activate BIP141, BIP143 and BIP147.
>>
>> ==Motivation==
>>
>> The biggest risk of BIP148 is an extended chain split, this BIP
>> provides a way for a simple majority of miners to eliminate that risk.
>>
>> This BIP provides a way for a simple majority of miners to coordinate
>> activation of the existing segwit deployment with less than 95%
>> hashpower before BIP148 activation. Due to time constraints unless
>> immediately deployed BIP91 will likely not be able to enforce
>> mandatory signalling of segwit before the Aug 1st activation of
>> BIP148. This BIP provides a method for rapid miner activation of
>> SegWit mandatory signalling ahead of the BIP148 activation date. Since
>> the primary goal of this BIP is to reduce the chance of an extended
>> chain split as much as possible we activate using a simple miner
>> majority of 65% over a 504 block interval rather than a higher
>> percentage. This BIP also allows miners to signal their intention to
>> run BIP148 in order to prevent a chain split.
>>
>> ==Specification==
>>
>> While this BIP is active, all blocks must set the nVersion header top
>> 3 bits to 001 together with bit field (1<<1) (according to the
>> existing segwit deployment). Blocks that do not signal as required
>> will be rejected.
>>
>> ==Deployment==
>>
>> This BIP will be deployed by "version bits" with a 65%(this can be
>> adjusted if desired) activation threshold BIP9 with the name
>> "splitprotecion" and using bit 2.
>>
>> This BIP starts immediately and is a BIP8 style soft fork since
>> mandatory signalling will start on midnight August 1st 2017 (epoch
>> time 1501545600) regardless of whether or not this BIP has reached its
>> own signalling threshold. This BIP will cease to be active when segwit
>> is locked-in.
>>
>> === Reference implementation ===
>>
>> <pre>
>> // Check if Segregated Witness is Locked In
>> bool IsWitnessLockedIn(const CBlockIndex* pindexPrev, const
>> Consensus::Params& params)
>> {
>>     LOCK(cs_main);
>>     return (VersionBitsState(pindexPrev, params,
>> Consensus::DEPLOYMENT_SEGWIT, versionbitscache) ==
>> THRESHOLD_LOCKED_IN);
>> }
>>
>> // SPLITPROTECTION mandatory segwit signalling.
>> if ( VersionBitsState(pindex->pprev, chainparams.GetConsensus(),
>> Consensus::DEPLOYMENT_SPLITPROTECTION, versionbitscache) ==
>> THRESHOLD_LOCKED_IN &&
>>      !IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
>> // Segwit is not locked in
>>      !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus()) ) //
>> and is not active.
>> {
>>     bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
>> VERSIONBITS_TOP_BITS;
>>     bool fSegbit = (pindex->nVersion &
>> VersionBitsMask(chainparams.GetConsensus(),
>> Consensus::DEPLOYMENT_SEGWIT)) != 0;
>>     if (!(fVersionBits && fSegbit)) {
>>         return state.DoS(0, error("ConnectBlock(): relayed block must
>> signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
>>     }
>> }
>>
>> // BIP148 mandatory segwit signalling.
>> int64_t nMedianTimePast = pindex->GetMedianTimePast();
>> if ( (nMedianTimePast >= 1501545600) &&  // Tue 01 Aug 2017 00:00:00 UTC
>>      (nMedianTimePast <= 1510704000) &&  // Wed 15 Nov 2017 00:00:00 UTC
>>      (!IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
>>  // Segwit is not locked in
>>       !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus())) )
>>  // and is not active.
>> {
>>     bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
>> VERSIONBITS_TOP_BITS;
>>     bool fSegbit = (pindex->nVersion &
>> VersionBitsMask(chainparams.GetConsensus(),
>> Consensus::DEPLOYMENT_SEGWIT)) != 0;
>>     if (!(fVersionBits && fSegbit)) {
>>         return state.DoS(0, error("ConnectBlock(): relayed block must
>> signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
>>     }
>> }
>> </pre>
>>
>> https://github.com/bitcoin/bitcoin/compare/0.14...jameshilliard:splitprotection-v0.14.1
>>
>> ==Backwards Compatibility==
>>
>> This deployment is compatible with the existing "segwit" bit 1
>> deployment scheduled between midnight November 15th, 2016 and midnight
>> November 15th, 2017. This deployment is also compatible with the
>> existing BIP148 deployment. This BIP is compatible with BIP91 only if
>> BIP91 activates before it and before BIP148. Miners will need to
>> upgrade their nodes to support splitprotection otherwise they may
>> build on top of an invalid block. While this bip is active users
>> should either upgrade to splitprotection or wait for additional
>> confirmations when accepting payments.
>>
>> ==Rationale==
>>
>> Historically we have used IsSuperMajority() to activate soft forks
>> such as BIP66 which has a mandatory signalling requirement for miners
>> once activated, this ensures that miners are aware of new rules being
>> enforced. This technique can be leveraged to lower the signalling
>> threshold of a soft fork while it is in the process of being deployed
>> in a backwards compatible way. We also use a BIP8 style timeout to
>> ensure that this BIP is compatible with BIP148 and that BIP148
>> compatible mandatory signalling activates regardless of miner
>> signalling levels.
>>
>> By orphaning non-signalling blocks during the BIP9 bit 1 "segwit"
>> deployment, this BIP can cause the existing "segwit" deployment to
>> activate without needing to release a new deployment. As we approach
>> BIP148 activation it may be desirable for a majority of miners to have
>> a method that will ensure that there is no chain split.
>>
>> ==References==
>>
>> *[https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-March/013714.html
>> Mailing list discussion]
>> *[https://github.com/bitcoin/bitcoin/blob/v0.6.0/src/main.cpp#L1281-L1283
>> P2SH flag day activation]
>> *[[bip-0009.mediawiki|BIP9 Version bits with timeout and delay]]
>> *[[bip-0016.mediawiki|BIP16 Pay to Script Hash]]
>> *[[bip-0091.mediawiki|BIP91 Reduced threshold Segwit MASF]]
>> *[[bip-0141.mediawiki|BIP141 Segregated Witness (Consensus layer)]]
>> *[[bip-0143.mediawiki|BIP143 Transaction Signature Verification for
>> Version 0 Witness Program]]
>> *[[bip-0147.mediawiki|BIP147 Dealing with dummy stack element malleability]]
>> *[[bip-0148.mediawiki|BIP148 Mandatory activation of segwit deployment]]
>> *[[bip-0149.mediawiki|BIP149 Segregated Witness (second deployment)]]
>> *[https://bitcoincore.org/en/2016/01/26/segwit-benefits/ Segwit benefits]
>>
>> ==Copyright==
>>
>> This document is dual licensed as BSD 3-clause, and Creative Commons
>> CC0 1.0 Universal.
>> _______________________________________________
>> bitcoin-dev mailing list
>> bitcoin-dev at lists.linuxfoundation.org
>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev

From james.hilliard1 at gmail.com  Wed Jun  7 01:54:37 2017
From: james.hilliard1 at gmail.com (James Hilliard)
Date: Tue, 6 Jun 2017 20:54:37 -0500
Subject: [bitcoin-dev] User Activated Soft Fork Split Protection
In-Reply-To: <AE5BA251-9DA6-4E34-A748-11C8CF91977C@taoeffect.com>
References: <CADvTj4qpH-t5Gx6qyn3yToyUE_GFaBE989=AWNHLKMpMNW3R+w@mail.gmail.com>
	<AE5BA251-9DA6-4E34-A748-11C8CF91977C@taoeffect.com>
Message-ID: <CADvTj4q+oOS=DKfpiNQ6PAbksQfa1gKNfokr2Zc6PNGWqLyL4A@mail.gmail.com>

This is a BIP8 style soft fork so mandatory signalling will be active
after Aug 1st regardless.

On Tue, Jun 6, 2017 at 8:51 PM, Tao Effect <contact at taoeffect.com> wrote:
> What is the probability that a 65% threshold is too low and can allow a
> "surprise miner attack", whereby miners are kept offline before the
> deadline, and brought online immediately after, creating potential havoc?
>
> (Nit: "simple majority" usually refers to >50%, I think, might cause
> confusion.)
>
> -Greg Slepak
>
> --
> Please do not email me anything that you are not comfortable also sharing
> with the NSA.
>
> On Jun 6, 2017, at 5:56 PM, James Hilliard via bitcoin-dev
> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>
> Due to the proposed calendar(https://segwit2x.github.io/) for the
> SegWit2x agreement being too slow to activate SegWit mandatory
> signalling ahead of BIP148 using BIP91 I would like to propose another
> option that miners can use to prevent a chain split ahead of the Aug
> 1st BIP148 activation date.
>
> The splitprotection soft fork is essentially BIP91 but using BIP8
> instead of BIP9 with a lower activation threshold and immediate
> mandatory signalling lock-in. This allows for a majority of miners to
> activate mandatory SegWit signalling and prevent a potential chain
> split ahead of BIP148 activation.
>
> This BIP allows for miners to respond to market forces quickly ahead
> of BIP148 activation by signalling for splitprotection. Any miners
> already running BIP148 should be encouraged to use splitprotection.
>
> <pre>
>  BIP: splitprotection
>  Layer: Consensus (soft fork)
>  Title: User Activated Soft Fork Split Protection
>  Author: James Hilliard <james.hilliard1 at gmail.com>
>  Comments-Summary: No comments yet.
>  Comments-URI:
>  Status: Draft
>  Type: Standards Track
>  Created: 2017-05-22
>  License: BSD-3-Clause
>           CC0-1.0
> </pre>
>
> ==Abstract==
>
> This document specifies a coordination mechanism for a simple majority
> of miners to prevent a chain split ahead of BIP148 activation.
>
> ==Definitions==
>
> "existing segwit deployment" refer to the BIP9 "segwit" deployment
> using bit 1, between November 15th 2016 and November 15th 2017 to
> activate BIP141, BIP143 and BIP147.
>
> ==Motivation==
>
> The biggest risk of BIP148 is an extended chain split, this BIP
> provides a way for a simple majority of miners to eliminate that risk.
>
> This BIP provides a way for a simple majority of miners to coordinate
> activation of the existing segwit deployment with less than 95%
> hashpower before BIP148 activation. Due to time constraints unless
> immediately deployed BIP91 will likely not be able to enforce
> mandatory signalling of segwit before the Aug 1st activation of
> BIP148. This BIP provides a method for rapid miner activation of
> SegWit mandatory signalling ahead of the BIP148 activation date. Since
> the primary goal of this BIP is to reduce the chance of an extended
> chain split as much as possible we activate using a simple miner
> majority of 65% over a 504 block interval rather than a higher
> percentage. This BIP also allows miners to signal their intention to
> run BIP148 in order to prevent a chain split.
>
> ==Specification==
>
> While this BIP is active, all blocks must set the nVersion header top
> 3 bits to 001 together with bit field (1<<1) (according to the
> existing segwit deployment). Blocks that do not signal as required
> will be rejected.
>
> ==Deployment==
>
> This BIP will be deployed by "version bits" with a 65%(this can be
> adjusted if desired) activation threshold BIP9 with the name
> "splitprotecion" and using bit 2.
>
> This BIP starts immediately and is a BIP8 style soft fork since
> mandatory signalling will start on midnight August 1st 2017 (epoch
> time 1501545600) regardless of whether or not this BIP has reached its
> own signalling threshold. This BIP will cease to be active when segwit
> is locked-in.
>
> === Reference implementation ===
>
> <pre>
> // Check if Segregated Witness is Locked In
> bool IsWitnessLockedIn(const CBlockIndex* pindexPrev, const
> Consensus::Params& params)
> {
>    LOCK(cs_main);
>    return (VersionBitsState(pindexPrev, params,
> Consensus::DEPLOYMENT_SEGWIT, versionbitscache) ==
> THRESHOLD_LOCKED_IN);
> }
>
> // SPLITPROTECTION mandatory segwit signalling.
> if ( VersionBitsState(pindex->pprev, chainparams.GetConsensus(),
> Consensus::DEPLOYMENT_SPLITPROTECTION, versionbitscache) ==
> THRESHOLD_LOCKED_IN &&
>     !IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
> // Segwit is not locked in
>     !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus()) ) //
> and is not active.
> {
>    bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
> VERSIONBITS_TOP_BITS;
>    bool fSegbit = (pindex->nVersion &
> VersionBitsMask(chainparams.GetConsensus(),
> Consensus::DEPLOYMENT_SEGWIT)) != 0;
>    if (!(fVersionBits && fSegbit)) {
>        return state.DoS(0, error("ConnectBlock(): relayed block must
> signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
>    }
> }
>
> // BIP148 mandatory segwit signalling.
> int64_t nMedianTimePast = pindex->GetMedianTimePast();
> if ( (nMedianTimePast >= 1501545600) &&  // Tue 01 Aug 2017 00:00:00 UTC
>     (nMedianTimePast <= 1510704000) &&  // Wed 15 Nov 2017 00:00:00 UTC
>     (!IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
> // Segwit is not locked in
>      !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus())) )
> // and is not active.
> {
>    bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
> VERSIONBITS_TOP_BITS;
>    bool fSegbit = (pindex->nVersion &
> VersionBitsMask(chainparams.GetConsensus(),
> Consensus::DEPLOYMENT_SEGWIT)) != 0;
>    if (!(fVersionBits && fSegbit)) {
>        return state.DoS(0, error("ConnectBlock(): relayed block must
> signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
>    }
> }
> </pre>
>
> https://github.com/bitcoin/bitcoin/compare/0.14...jameshilliard:splitprotection-v0.14.1
>
> ==Backwards Compatibility==
>
> This deployment is compatible with the existing "segwit" bit 1
> deployment scheduled between midnight November 15th, 2016 and midnight
> November 15th, 2017. This deployment is also compatible with the
> existing BIP148 deployment. This BIP is compatible with BIP91 only if
> BIP91 activates before it and before BIP148. Miners will need to
> upgrade their nodes to support splitprotection otherwise they may
> build on top of an invalid block. While this bip is active users
> should either upgrade to splitprotection or wait for additional
> confirmations when accepting payments.
>
> ==Rationale==
>
> Historically we have used IsSuperMajority() to activate soft forks
> such as BIP66 which has a mandatory signalling requirement for miners
> once activated, this ensures that miners are aware of new rules being
> enforced. This technique can be leveraged to lower the signalling
> threshold of a soft fork while it is in the process of being deployed
> in a backwards compatible way. We also use a BIP8 style timeout to
> ensure that this BIP is compatible with BIP148 and that BIP148
> compatible mandatory signalling activates regardless of miner
> signalling levels.
>
> By orphaning non-signalling blocks during the BIP9 bit 1 "segwit"
> deployment, this BIP can cause the existing "segwit" deployment to
> activate without needing to release a new deployment. As we approach
> BIP148 activation it may be desirable for a majority of miners to have
> a method that will ensure that there is no chain split.
>
> ==References==
>
> *[https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-March/013714.html
> Mailing list discussion]
> *[https://github.com/bitcoin/bitcoin/blob/v0.6.0/src/main.cpp#L1281-L1283
> P2SH flag day activation]
> *[[bip-0009.mediawiki|BIP9 Version bits with timeout and delay]]
> *[[bip-0016.mediawiki|BIP16 Pay to Script Hash]]
> *[[bip-0091.mediawiki|BIP91 Reduced threshold Segwit MASF]]
> *[[bip-0141.mediawiki|BIP141 Segregated Witness (Consensus layer)]]
> *[[bip-0143.mediawiki|BIP143 Transaction Signature Verification for
> Version 0 Witness Program]]
> *[[bip-0147.mediawiki|BIP147 Dealing with dummy stack element malleability]]
> *[[bip-0148.mediawiki|BIP148 Mandatory activation of segwit deployment]]
> *[[bip-0149.mediawiki|BIP149 Segregated Witness (second deployment)]]
> *[https://bitcoincore.org/en/2016/01/26/segwit-benefits/ Segwit benefits]
>
> ==Copyright==
>
> This document is dual licensed as BSD 3-clause, and Creative Commons
> CC0 1.0 Universal.
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>
>

From contact at taoeffect.com  Wed Jun  7 01:51:39 2017
From: contact at taoeffect.com (Tao Effect)
Date: Tue, 6 Jun 2017 18:51:39 -0700
Subject: [bitcoin-dev] User Activated Soft Fork Split Protection
In-Reply-To: <CADvTj4qpH-t5Gx6qyn3yToyUE_GFaBE989=AWNHLKMpMNW3R+w@mail.gmail.com>
References: <CADvTj4qpH-t5Gx6qyn3yToyUE_GFaBE989=AWNHLKMpMNW3R+w@mail.gmail.com>
Message-ID: <AE5BA251-9DA6-4E34-A748-11C8CF91977C@taoeffect.com>

What is the probability that a 65% threshold is too low and can allow a "surprise miner attack", whereby miners are kept offline before the deadline, and brought online immediately after, creating potential havoc?

(Nit: "simple majority" usually refers to >50%, I think, might cause confusion.)

-Greg Slepak

--
Please do not email me anything that you are not comfortable also sharing with the NSA.

> On Jun 6, 2017, at 5:56 PM, James Hilliard via bitcoin-dev <bitcoin-dev at lists.linuxfoundation.org <mailto:bitcoin-dev at lists.linuxfoundation.org>> wrote:
> 
> Due to the proposed calendar(https://segwit2x.github.io/ <https://segwit2x.github.io/>) for the
> SegWit2x agreement being too slow to activate SegWit mandatory
> signalling ahead of BIP148 using BIP91 I would like to propose another
> option that miners can use to prevent a chain split ahead of the Aug
> 1st BIP148 activation date.
> 
> The splitprotection soft fork is essentially BIP91 but using BIP8
> instead of BIP9 with a lower activation threshold and immediate
> mandatory signalling lock-in. This allows for a majority of miners to
> activate mandatory SegWit signalling and prevent a potential chain
> split ahead of BIP148 activation.
> 
> This BIP allows for miners to respond to market forces quickly ahead
> of BIP148 activation by signalling for splitprotection. Any miners
> already running BIP148 should be encouraged to use splitprotection.
> 
> <pre>
>  BIP: splitprotection
>  Layer: Consensus (soft fork)
>  Title: User Activated Soft Fork Split Protection
>  Author: James Hilliard <james.hilliard1 at gmail.com <mailto:james.hilliard1 at gmail.com>>
>  Comments-Summary: No comments yet.
>  Comments-URI:
>  Status: Draft
>  Type: Standards Track
>  Created: 2017-05-22
>  License: BSD-3-Clause
>           CC0-1.0
> </pre>
> 
> ==Abstract==
> 
> This document specifies a coordination mechanism for a simple majority
> of miners to prevent a chain split ahead of BIP148 activation.
> 
> ==Definitions==
> 
> "existing segwit deployment" refer to the BIP9 "segwit" deployment
> using bit 1, between November 15th 2016 and November 15th 2017 to
> activate BIP141, BIP143 and BIP147.
> 
> ==Motivation==
> 
> The biggest risk of BIP148 is an extended chain split, this BIP
> provides a way for a simple majority of miners to eliminate that risk.
> 
> This BIP provides a way for a simple majority of miners to coordinate
> activation of the existing segwit deployment with less than 95%
> hashpower before BIP148 activation. Due to time constraints unless
> immediately deployed BIP91 will likely not be able to enforce
> mandatory signalling of segwit before the Aug 1st activation of
> BIP148. This BIP provides a method for rapid miner activation of
> SegWit mandatory signalling ahead of the BIP148 activation date. Since
> the primary goal of this BIP is to reduce the chance of an extended
> chain split as much as possible we activate using a simple miner
> majority of 65% over a 504 block interval rather than a higher
> percentage. This BIP also allows miners to signal their intention to
> run BIP148 in order to prevent a chain split.
> 
> ==Specification==
> 
> While this BIP is active, all blocks must set the nVersion header top
> 3 bits to 001 together with bit field (1<<1) (according to the
> existing segwit deployment). Blocks that do not signal as required
> will be rejected.
> 
> ==Deployment==
> 
> This BIP will be deployed by "version bits" with a 65%(this can be
> adjusted if desired) activation threshold BIP9 with the name
> "splitprotecion" and using bit 2.
> 
> This BIP starts immediately and is a BIP8 style soft fork since
> mandatory signalling will start on midnight August 1st 2017 (epoch
> time 1501545600) regardless of whether or not this BIP has reached its
> own signalling threshold. This BIP will cease to be active when segwit
> is locked-in.
> 
> === Reference implementation ===
> 
> <pre>
> // Check if Segregated Witness is Locked In
> bool IsWitnessLockedIn(const CBlockIndex* pindexPrev, const
> Consensus::Params& params)
> {
>    LOCK(cs_main);
>    return (VersionBitsState(pindexPrev, params,
> Consensus::DEPLOYMENT_SEGWIT, versionbitscache) ==
> THRESHOLD_LOCKED_IN);
> }
> 
> // SPLITPROTECTION mandatory segwit signalling.
> if ( VersionBitsState(pindex->pprev, chainparams.GetConsensus(),
> Consensus::DEPLOYMENT_SPLITPROTECTION, versionbitscache) ==
> THRESHOLD_LOCKED_IN &&
>     !IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
> // Segwit is not locked in
>     !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus()) ) //
> and is not active.
> {
>    bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
> VERSIONBITS_TOP_BITS;
>    bool fSegbit = (pindex->nVersion &
> VersionBitsMask(chainparams.GetConsensus(),
> Consensus::DEPLOYMENT_SEGWIT)) != 0;
>    if (!(fVersionBits && fSegbit)) {
>        return state.DoS(0, error("ConnectBlock(): relayed block must
> signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
>    }
> }
> 
> // BIP148 mandatory segwit signalling.
> int64_t nMedianTimePast = pindex->GetMedianTimePast();
> if ( (nMedianTimePast >= 1501545600) &&  // Tue 01 Aug 2017 00:00:00 UTC
>     (nMedianTimePast <= 1510704000) &&  // Wed 15 Nov 2017 00:00:00 UTC
>     (!IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
> // Segwit is not locked in
>      !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus())) )
> // and is not active.
> {
>    bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
> VERSIONBITS_TOP_BITS;
>    bool fSegbit = (pindex->nVersion &
> VersionBitsMask(chainparams.GetConsensus(),
> Consensus::DEPLOYMENT_SEGWIT)) != 0;
>    if (!(fVersionBits && fSegbit)) {
>        return state.DoS(0, error("ConnectBlock(): relayed block must
> signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
>    }
> }
> </pre>
> 
> https://github.com/bitcoin/bitcoin/compare/0.14...jameshilliard:splitprotection-v0.14.1 <https://github.com/bitcoin/bitcoin/compare/0.14...jameshilliard:splitprotection-v0.14.1>
> 
> ==Backwards Compatibility==
> 
> This deployment is compatible with the existing "segwit" bit 1
> deployment scheduled between midnight November 15th, 2016 and midnight
> November 15th, 2017. This deployment is also compatible with the
> existing BIP148 deployment. This BIP is compatible with BIP91 only if
> BIP91 activates before it and before BIP148. Miners will need to
> upgrade their nodes to support splitprotection otherwise they may
> build on top of an invalid block. While this bip is active users
> should either upgrade to splitprotection or wait for additional
> confirmations when accepting payments.
> 
> ==Rationale==
> 
> Historically we have used IsSuperMajority() to activate soft forks
> such as BIP66 which has a mandatory signalling requirement for miners
> once activated, this ensures that miners are aware of new rules being
> enforced. This technique can be leveraged to lower the signalling
> threshold of a soft fork while it is in the process of being deployed
> in a backwards compatible way. We also use a BIP8 style timeout to
> ensure that this BIP is compatible with BIP148 and that BIP148
> compatible mandatory signalling activates regardless of miner
> signalling levels.
> 
> By orphaning non-signalling blocks during the BIP9 bit 1 "segwit"
> deployment, this BIP can cause the existing "segwit" deployment to
> activate without needing to release a new deployment. As we approach
> BIP148 activation it may be desirable for a majority of miners to have
> a method that will ensure that there is no chain split.
> 
> ==References==
> 
> *[https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-March/013714.html <https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-March/013714.html>
> Mailing list discussion]
> *[https://github.com/bitcoin/bitcoin/blob/v0.6.0/src/main.cpp#L1281-L1283 <https://github.com/bitcoin/bitcoin/blob/v0.6.0/src/main.cpp#L1281-L1283>
> P2SH flag day activation]
> *[[bip-0009.mediawiki|BIP9 Version bits with timeout and delay]]
> *[[bip-0016.mediawiki|BIP16 Pay to Script Hash]]
> *[[bip-0091.mediawiki|BIP91 Reduced threshold Segwit MASF]]
> *[[bip-0141.mediawiki|BIP141 Segregated Witness (Consensus layer)]]
> *[[bip-0143.mediawiki|BIP143 Transaction Signature Verification for
> Version 0 Witness Program]]
> *[[bip-0147.mediawiki|BIP147 Dealing with dummy stack element malleability]]
> *[[bip-0148.mediawiki|BIP148 Mandatory activation of segwit deployment]]
> *[[bip-0149.mediawiki|BIP149 Segregated Witness (second deployment)]]
> *[https://bitcoincore.org/en/2016/01/26/segwit-benefits/ Segwit benefits <https://bitcoincore.org/en/2016/01/26/segwit-benefits/%20Segwit%20benefits>]
> 
> ==Copyright==
> 
> This document is dual licensed as BSD 3-clause, and Creative Commons
> CC0 1.0 Universal.
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org <mailto:bitcoin-dev at lists.linuxfoundation.org>
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev <https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170606/9d3cbc4a/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 801 bytes
Desc: Message signed with OpenPGP
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170606/9d3cbc4a/attachment-0001.sig>

From james.hilliard1 at gmail.com  Wed Jun  7 10:13:43 2017
From: james.hilliard1 at gmail.com (James Hilliard)
Date: Wed, 7 Jun 2017 05:13:43 -0500
Subject: [bitcoin-dev] User Activated Soft Fork Split Protection
In-Reply-To: <0CDEF5A2-0BAF-46E4-8906-39D4724AF3F2@taoeffect.com>
References: <CADvTj4qpH-t5Gx6qyn3yToyUE_GFaBE989=AWNHLKMpMNW3R+w@mail.gmail.com>
	<AE5BA251-9DA6-4E34-A748-11C8CF91977C@taoeffect.com>
	<CADvTj4q+oOS=DKfpiNQ6PAbksQfa1gKNfokr2Zc6PNGWqLyL4A@mail.gmail.com>
	<0CDEF5A2-0BAF-46E4-8906-39D4724AF3F2@taoeffect.com>
Message-ID: <CADvTj4oJr38V+b=96pt7GiaMMSPujsz9wQ-5wmgM=rvWUC8Dkw@mail.gmail.com>

I think even 55% would probably work out fine simply due to incentive
structures, once signalling is over 51% it's then clear to miners that
non-signalling blocks will be orphaned and the rest will rapidly
update to splitprotection/BIP148. The purpose of this BIP is to reduce
chain split risk for BIP148 since it's looking like BIP148 is going to
be run by a non-insignificant percentage of the economy at a minimum.

On Wed, Jun 7, 2017 at 12:20 AM, Tao Effect <contact at taoeffect.com> wrote:
> See thread on replay attacks for why activating regardless of threshold is a
> bad idea [1].
>
> BIP91 OTOH seems perfectly reasonable. 80% instead of 95% makes it more
> difficult for miners to hold together in opposition to Core. It gives Core
> more leverage in negotiations.
>
> If they don't activate with 80%, Core can release another BIP to reduce it
> to 75%.
>
> Each threshold reduction makes it both more likely to succeed, but also
> increases the likelihood of harm to the ecosystem.
>
> Cheers,
> Greg
>
> [1]
> https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-June/014497.html
>
> --
> Please do not email me anything that you are not comfortable also sharing
> with the NSA.
>
> On Jun 6, 2017, at 6:54 PM, James Hilliard <james.hilliard1 at gmail.com>
> wrote:
>
> This is a BIP8 style soft fork so mandatory signalling will be active
> after Aug 1st regardless.
>
> On Tue, Jun 6, 2017 at 8:51 PM, Tao Effect <contact at taoeffect.com> wrote:
>
> What is the probability that a 65% threshold is too low and can allow a
> "surprise miner attack", whereby miners are kept offline before the
> deadline, and brought online immediately after, creating potential havoc?
>
> (Nit: "simple majority" usually refers to >50%, I think, might cause
> confusion.)
>
> -Greg Slepak
>
> --
> Please do not email me anything that you are not comfortable also sharing
> with the NSA.
>
> On Jun 6, 2017, at 5:56 PM, James Hilliard via bitcoin-dev
> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>
> Due to the proposed calendar(https://segwit2x.github.io/) for the
> SegWit2x agreement being too slow to activate SegWit mandatory
> signalling ahead of BIP148 using BIP91 I would like to propose another
> option that miners can use to prevent a chain split ahead of the Aug
> 1st BIP148 activation date.
>
> The splitprotection soft fork is essentially BIP91 but using BIP8
> instead of BIP9 with a lower activation threshold and immediate
> mandatory signalling lock-in. This allows for a majority of miners to
> activate mandatory SegWit signalling and prevent a potential chain
> split ahead of BIP148 activation.
>
> This BIP allows for miners to respond to market forces quickly ahead
> of BIP148 activation by signalling for splitprotection. Any miners
> already running BIP148 should be encouraged to use splitprotection.
>
> <pre>
> BIP: splitprotection
> Layer: Consensus (soft fork)
> Title: User Activated Soft Fork Split Protection
> Author: James Hilliard <james.hilliard1 at gmail.com>
> Comments-Summary: No comments yet.
> Comments-URI:
> Status: Draft
> Type: Standards Track
> Created: 2017-05-22
> License: BSD-3-Clause
>          CC0-1.0
> </pre>
>
> ==Abstract==
>
> This document specifies a coordination mechanism for a simple majority
> of miners to prevent a chain split ahead of BIP148 activation.
>
> ==Definitions==
>
> "existing segwit deployment" refer to the BIP9 "segwit" deployment
> using bit 1, between November 15th 2016 and November 15th 2017 to
> activate BIP141, BIP143 and BIP147.
>
> ==Motivation==
>
> The biggest risk of BIP148 is an extended chain split, this BIP
> provides a way for a simple majority of miners to eliminate that risk.
>
> This BIP provides a way for a simple majority of miners to coordinate
> activation of the existing segwit deployment with less than 95%
> hashpower before BIP148 activation. Due to time constraints unless
> immediately deployed BIP91 will likely not be able to enforce
> mandatory signalling of segwit before the Aug 1st activation of
> BIP148. This BIP provides a method for rapid miner activation of
> SegWit mandatory signalling ahead of the BIP148 activation date. Since
> the primary goal of this BIP is to reduce the chance of an extended
> chain split as much as possible we activate using a simple miner
> majority of 65% over a 504 block interval rather than a higher
> percentage. This BIP also allows miners to signal their intention to
> run BIP148 in order to prevent a chain split.
>
> ==Specification==
>
> While this BIP is active, all blocks must set the nVersion header top
> 3 bits to 001 together with bit field (1<<1) (according to the
> existing segwit deployment). Blocks that do not signal as required
> will be rejected.
>
> ==Deployment==
>
> This BIP will be deployed by "version bits" with a 65%(this can be
> adjusted if desired) activation threshold BIP9 with the name
> "splitprotecion" and using bit 2.
>
> This BIP starts immediately and is a BIP8 style soft fork since
> mandatory signalling will start on midnight August 1st 2017 (epoch
> time 1501545600) regardless of whether or not this BIP has reached its
> own signalling threshold. This BIP will cease to be active when segwit
> is locked-in.
>
> === Reference implementation ===
>
> <pre>
> // Check if Segregated Witness is Locked In
> bool IsWitnessLockedIn(const CBlockIndex* pindexPrev, const
> Consensus::Params& params)
> {
>   LOCK(cs_main);
>   return (VersionBitsState(pindexPrev, params,
> Consensus::DEPLOYMENT_SEGWIT, versionbitscache) ==
> THRESHOLD_LOCKED_IN);
> }
>
> // SPLITPROTECTION mandatory segwit signalling.
> if ( VersionBitsState(pindex->pprev, chainparams.GetConsensus(),
> Consensus::DEPLOYMENT_SPLITPROTECTION, versionbitscache) ==
> THRESHOLD_LOCKED_IN &&
>    !IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
> // Segwit is not locked in
>    !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus()) ) //
> and is not active.
> {
>   bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
> VERSIONBITS_TOP_BITS;
>   bool fSegbit = (pindex->nVersion &
> VersionBitsMask(chainparams.GetConsensus(),
> Consensus::DEPLOYMENT_SEGWIT)) != 0;
>   if (!(fVersionBits && fSegbit)) {
>       return state.DoS(0, error("ConnectBlock(): relayed block must
> signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
>   }
> }
>
> // BIP148 mandatory segwit signalling.
> int64_t nMedianTimePast = pindex->GetMedianTimePast();
> if ( (nMedianTimePast >= 1501545600) &&  // Tue 01 Aug 2017 00:00:00 UTC
>    (nMedianTimePast <= 1510704000) &&  // Wed 15 Nov 2017 00:00:00 UTC
>    (!IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
> // Segwit is not locked in
>     !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus())) )
> // and is not active.
> {
>   bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
> VERSIONBITS_TOP_BITS;
>   bool fSegbit = (pindex->nVersion &
> VersionBitsMask(chainparams.GetConsensus(),
> Consensus::DEPLOYMENT_SEGWIT)) != 0;
>   if (!(fVersionBits && fSegbit)) {
>       return state.DoS(0, error("ConnectBlock(): relayed block must
> signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
>   }
> }
> </pre>
>
> https://github.com/bitcoin/bitcoin/compare/0.14...jameshilliard:splitprotection-v0.14.1
>
> ==Backwards Compatibility==
>
> This deployment is compatible with the existing "segwit" bit 1
> deployment scheduled between midnight November 15th, 2016 and midnight
> November 15th, 2017. This deployment is also compatible with the
> existing BIP148 deployment. This BIP is compatible with BIP91 only if
> BIP91 activates before it and before BIP148. Miners will need to
> upgrade their nodes to support splitprotection otherwise they may
> build on top of an invalid block. While this bip is active users
> should either upgrade to splitprotection or wait for additional
> confirmations when accepting payments.
>
> ==Rationale==
>
> Historically we have used IsSuperMajority() to activate soft forks
> such as BIP66 which has a mandatory signalling requirement for miners
> once activated, this ensures that miners are aware of new rules being
> enforced. This technique can be leveraged to lower the signalling
> threshold of a soft fork while it is in the process of being deployed
> in a backwards compatible way. We also use a BIP8 style timeout to
> ensure that this BIP is compatible with BIP148 and that BIP148
> compatible mandatory signalling activates regardless of miner
> signalling levels.
>
> By orphaning non-signalling blocks during the BIP9 bit 1 "segwit"
> deployment, this BIP can cause the existing "segwit" deployment to
> activate without needing to release a new deployment. As we approach
> BIP148 activation it may be desirable for a majority of miners to have
> a method that will ensure that there is no chain split.
>
> ==References==
>
> *[https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-March/013714.html
> Mailing list discussion]
> *[https://github.com/bitcoin/bitcoin/blob/v0.6.0/src/main.cpp#L1281-L1283
> P2SH flag day activation]
> *[[bip-0009.mediawiki|BIP9 Version bits with timeout and delay]]
> *[[bip-0016.mediawiki|BIP16 Pay to Script Hash]]
> *[[bip-0091.mediawiki|BIP91 Reduced threshold Segwit MASF]]
> *[[bip-0141.mediawiki|BIP141 Segregated Witness (Consensus layer)]]
> *[[bip-0143.mediawiki|BIP143 Transaction Signature Verification for
> Version 0 Witness Program]]
> *[[bip-0147.mediawiki|BIP147 Dealing with dummy stack element malleability]]
> *[[bip-0148.mediawiki|BIP148 Mandatory activation of segwit deployment]]
> *[[bip-0149.mediawiki|BIP149 Segregated Witness (second deployment)]]
> *[https://bitcoincore.org/en/2016/01/26/segwit-benefits/ Segwit benefits]
>
> ==Copyright==
>
> This document is dual licensed as BSD 3-clause, and Creative Commons
> CC0 1.0 Universal.
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>
>
>

From contact at taoeffect.com  Wed Jun  7 00:26:50 2017
From: contact at taoeffect.com (Tao Effect)
Date: Tue, 6 Jun 2017 17:26:50 -0700
Subject: [bitcoin-dev] Replay attacks make BIP148 and BIP149 untennable
In-Reply-To: <oSkyoMQ0QQadP3ZDrIU_Xw0sEG8lv5q3B5Kjwnu_MIkvUGmg9TrDn1myLeRhPhyPpGbAgp1QWkerbp76jjptWhh4jz3JXjVycXuXZkxodG8=@protonmail.com>
References: <31833011-7179-49D1-A07E-8FD9556C4534@taoeffect.com>
	<20170606232015.GA11830@erisian.com.au>
	<38DDC3A2-2727-477E-A6FF-7638842AAB03@taoeffect.com>
	<w5Ywd9qPblH4-m68BQC58FfV4fNFOCPUkUIOsNOz8-0uJQLjIaG5JevhRv1x_0cqtcZvRsKYQTy-EuBTjzJL-DuSX7dsHuoMfw-68cweBOk=@protonmail.com>
	<78F1D626-0D38-48FD-B2AF-378765182751@taoeffect.com>
	<oSkyoMQ0QQadP3ZDrIU_Xw0sEG8lv5q3B5Kjwnu_MIkvUGmg9TrDn1myLeRhPhyPpGbAgp1QWkerbp76jjptWhh4jz3JXjVycXuXZkxodG8=@protonmail.com>
Message-ID: <52DF2F59-49DF-4F90-B2A6-AF903EACE6A0@taoeffect.com>

I don't know what you mean by "render the replay threat moot."

If you don't have replay protection, replay is always a threat. A very serious one.

--
Please do not email me anything that you are not comfortable also sharing with the NSA.

> On Jun 6, 2017, at 5:19 PM, Kekcoin <kekcoin at protonmail.com <mailto:kekcoin at protonmail.com>> wrote:
> 
> Hmm, that's not the difference I was talking about. I was referring to the fact that using "post-chainsplit coinbases from the non-148 chain" to unilaterally (ie. can be done without action on the 148-chain) taint coins is more secure in extreme-adverserial cases such as secret-mining reorg attacks (as unfeasibly expensive they may be); the only large-scale (>100 block) reorganization the non-148 chain faces should be a resolution of the chainsplit and therefore render the replay threat moot.
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170606/b2d1e1e6/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 801 bytes
Desc: Message signed with OpenPGP
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170606/b2d1e1e6/attachment-0001.sig>

From kekcoin at protonmail.com  Wed Jun  7 00:29:08 2017
From: kekcoin at protonmail.com (Kekcoin)
Date: Tue, 06 Jun 2017 20:29:08 -0400
Subject: [bitcoin-dev] Replay attacks make BIP148 and BIP149 untennable
In-Reply-To: <52DF2F59-49DF-4F90-B2A6-AF903EACE6A0@taoeffect.com>
References: <31833011-7179-49D1-A07E-8FD9556C4534@taoeffect.com>
	<20170606232015.GA11830@erisian.com.au>
	<38DDC3A2-2727-477E-A6FF-7638842AAB03@taoeffect.com>
	<w5Ywd9qPblH4-m68BQC58FfV4fNFOCPUkUIOsNOz8-0uJQLjIaG5JevhRv1x_0cqtcZvRsKYQTy-EuBTjzJL-DuSX7dsHuoMfw-68cweBOk=@protonmail.com>
	<78F1D626-0D38-48FD-B2AF-378765182751@taoeffect.com>
	<oSkyoMQ0QQadP3ZDrIU_Xw0sEG8lv5q3B5Kjwnu_MIkvUGmg9TrDn1myLeRhPhyPpGbAgp1QWkerbp76jjptWhh4jz3JXjVycXuXZkxodG8=@protonmail.com>
	<52DF2F59-49DF-4F90-B2A6-AF903EACE6A0@taoeffect.com>
Message-ID: <lY1DxlDe2AacxKRcsB8DG2WvQK5wVnJdl46pE9Np9aGyTD560eDpJEvXZTNfKxSvulsGJOv3J4lrv14plchXfZh5JyYPLCNPATRMFUdu_h8=@protonmail.com>

Please read my email more carefully; the replay threat would be moot because there would be no alternative chain to replay the TX on, as the non-148 chain would have been reorganized into oblivion.

Sent with [ProtonMail](https://protonmail.com) Secure Email.

-------- Original Message --------
Subject: Re: [bitcoin-dev] Replay attacks make BIP148 and BIP149 untennable
Local Time: June 7, 2017 3:26 AM
UTC Time: June 7, 2017 12:26 AM
From: contact at taoeffect.com
To: Kekcoin <kekcoin at protonmail.com>
Anthony Towns <aj at erisian.com.au>, bitcoin-dev at lists.linuxfoundation.org <bitcoin-dev at lists.linuxfoundation.org>

I don't know what you mean by "render the replay threat moot."

If you don't have replay protection, replay is always a threat. A very serious one.

--
Please do not email me anything that you are not comfortable also sharing with the NSA.

On Jun 6, 2017, at 5:19 PM, Kekcoin <kekcoin at protonmail.com> wrote:

Hmm, that's not the difference I was talking about. I was referring to the fact that using "post-chainsplit coinbases from the non-148 chain" to unilaterally (ie. can be done without action on the 148-chain) taint coins is more secure in extreme-adverserial cases such as secret-mining reorg attacks (as unfeasibly expensive they may be); the only large-scale (>100 block) reorganization the non-148 chain faces should be a resolution of the chainsplit and therefore render the replay threat moot.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170606/c710f263/attachment-0001.html>

From contact at taoeffect.com  Wed Jun  7 00:38:02 2017
From: contact at taoeffect.com (Tao Effect)
Date: Tue, 6 Jun 2017 17:38:02 -0700
Subject: [bitcoin-dev] Replay attacks make BIP148 and BIP149 untennable
In-Reply-To: <lY1DxlDe2AacxKRcsB8DG2WvQK5wVnJdl46pE9Np9aGyTD560eDpJEvXZTNfKxSvulsGJOv3J4lrv14plchXfZh5JyYPLCNPATRMFUdu_h8=@protonmail.com>
References: <31833011-7179-49D1-A07E-8FD9556C4534@taoeffect.com>
	<20170606232015.GA11830@erisian.com.au>
	<38DDC3A2-2727-477E-A6FF-7638842AAB03@taoeffect.com>
	<w5Ywd9qPblH4-m68BQC58FfV4fNFOCPUkUIOsNOz8-0uJQLjIaG5JevhRv1x_0cqtcZvRsKYQTy-EuBTjzJL-DuSX7dsHuoMfw-68cweBOk=@protonmail.com>
	<78F1D626-0D38-48FD-B2AF-378765182751@taoeffect.com>
	<oSkyoMQ0QQadP3ZDrIU_Xw0sEG8lv5q3B5Kjwnu_MIkvUGmg9TrDn1myLeRhPhyPpGbAgp1QWkerbp76jjptWhh4jz3JXjVycXuXZkxodG8=@protonmail.com>
	<52DF2F59-49DF-4F90-B2A6-AF903EACE6A0@taoeffect.com>
	<lY1DxlDe2AacxKRcsB8DG2WvQK5wVnJdl46pE9Np9aGyTD560eDpJEvXZTNfKxSvulsGJOv3J4lrv14plchXfZh5JyYPLCNPATRMFUdu_h8=@protonmail.com>
Message-ID: <530153E9-1F86-4B21-A43D-72325EF1F811@taoeffect.com>

> Please read my email more carefully; the replay threat would be moot because there would be no alternative chain to replay the TX on,

In order to *get to that point*, you need >51%.

Not only that, but, if you started out with <51%, then you need >>51% in order to *catch up* and replace the large number of blocks added to the legacy chain in the mean time.

So, since >51% is _required_ for BIP148 to succeed (and likely >>51%)... you might as well do as SegWit did originally, or lower the threshold to 80% or something (as BIP91 does).

Without replay protection at the outset, BIP148, as far as I can tell, isn't a threat to miners.

--
Please do not email me anything that you are not comfortable also sharing with the NSA.

> On Jun 6, 2017, at 5:29 PM, Kekcoin <kekcoin at protonmail.com <mailto:kekcoin at protonmail.com>> wrote:
> 
> Please read my email more carefully; the replay threat would be moot because there would be no alternative chain to replay the TX on, as the non-148 chain would have been reorganized into oblivion.
> 
> 
> Sent with ProtonMail <https://protonmail.com/> Secure Email.
> 
>> -------- Original Message --------
>> Subject: Re: [bitcoin-dev] Replay attacks make BIP148 and BIP149 untennable
>> Local Time: June 7, 2017 3:26 AM
>> UTC Time: June 7, 2017 12:26 AM
>> From: contact at taoeffect.com <mailto:contact at taoeffect.com>
>> To: Kekcoin <kekcoin at protonmail.com <mailto:kekcoin at protonmail.com>>
>> Anthony Towns <aj at erisian.com.au <mailto:aj at erisian.com.au>>, bitcoin-dev at lists.linuxfoundation.org <mailto:bitcoin-dev at lists.linuxfoundation.org> <bitcoin-dev at lists.linuxfoundation.org <mailto:bitcoin-dev at lists.linuxfoundation.org>>
>> 
>> I don't know what you mean by "render the replay threat moot."
>> 
>> If you don't have replay protection, replay is always a threat. A very serious one.
>> 
>> --
>> Please do not email me anything that you are not comfortable also sharing with the NSA.
>> 
>>> On Jun 6, 2017, at 5:19 PM, Kekcoin <kekcoin at protonmail.com <mailto:kekcoin at protonmail.com>> wrote:
>>> 
>>> Hmm, that's not the difference I was talking about. I was referring to the fact that using "post-chainsplit coinbases from the non-148 chain" to unilaterally (ie. can be done without action on the 148-chain) taint coins is more secure in extreme-adverserial cases such as secret-mining reorg attacks (as unfeasibly expensive they may be); the only large-scale (>100 block) reorganization the non-148 chain faces should be a resolution of the chainsplit and therefore render the replay threat moot.
>>> 
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170606/99784c2b/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 801 bytes
Desc: Message signed with OpenPGP
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170606/99784c2b/attachment-0001.sig>

From kekcoin at protonmail.com  Wed Jun  7 00:46:23 2017
From: kekcoin at protonmail.com (Kekcoin)
Date: Tue, 06 Jun 2017 20:46:23 -0400
Subject: [bitcoin-dev] Replay attacks make BIP148 and BIP149 untennable
In-Reply-To: <530153E9-1F86-4B21-A43D-72325EF1F811@taoeffect.com>
References: <31833011-7179-49D1-A07E-8FD9556C4534@taoeffect.com>
	<20170606232015.GA11830@erisian.com.au>
	<38DDC3A2-2727-477E-A6FF-7638842AAB03@taoeffect.com>
	<w5Ywd9qPblH4-m68BQC58FfV4fNFOCPUkUIOsNOz8-0uJQLjIaG5JevhRv1x_0cqtcZvRsKYQTy-EuBTjzJL-DuSX7dsHuoMfw-68cweBOk=@protonmail.com>
	<78F1D626-0D38-48FD-B2AF-378765182751@taoeffect.com>
	<oSkyoMQ0QQadP3ZDrIU_Xw0sEG8lv5q3B5Kjwnu_MIkvUGmg9TrDn1myLeRhPhyPpGbAgp1QWkerbp76jjptWhh4jz3JXjVycXuXZkxodG8=@protonmail.com>
	<52DF2F59-49DF-4F90-B2A6-AF903EACE6A0@taoeffect.com>
	<lY1DxlDe2AacxKRcsB8DG2WvQK5wVnJdl46pE9Np9aGyTD560eDpJEvXZTNfKxSvulsGJOv3J4lrv14plchXfZh5JyYPLCNPATRMFUdu_h8=@protonmail.com>
	<530153E9-1F86-4B21-A43D-72325EF1F811@taoeffect.com>
Message-ID: <5pQR2BlehmKHRoZspUwV_R7BiRyANGsyJF4SKer5QoMzZIuO7pQtYGXuxevt2tIwGTqHTxZIbgHEG10HrSl19_MURgOZxoGcuJiK30l1agc=@protonmail.com>

I was merely describing that the only failure mode of using "post-split coinbases from the legacy chain" as seedcoins for cointainting purposes would be a resolution of the coinsplit, thereby rendering the cointainting redundant, therefore this would be an entirely safe approach to cointainting, as the only way coins could become untainted (and therefore subject to the threat of replay attacks) would coincide with a disappearance of the situation that gave rise to such replay attacks in the first place. This should sufficiently answer your concerns regarding lack of replay protection in case of medium-to-long-term chainsplits in general. If you fail to grok, please read again until you don't.

Sent with [ProtonMail](https://protonmail.com) Secure Email.

-------- Original Message --------
Subject: Re: [bitcoin-dev] Replay attacks make BIP148 and BIP149 untennable
Local Time: June 7, 2017 3:38 AM
UTC Time: June 7, 2017 12:38 AM
From: contact at taoeffect.com
To: Kekcoin <kekcoin at protonmail.com>
Anthony Towns <aj at erisian.com.au>, bitcoin-dev at lists.linuxfoundation.org <bitcoin-dev at lists.linuxfoundation.org>

Please read my email more carefully; the replay threat would be moot because there would be no alternative chain to replay the TX on,

In order to *get to that point*, you need >51%.

Not only that, but, if you started out with <51%, then you need >>51% in order to *catch up* and replace the large number of blocks added to the legacy chain in the mean time.

So, since >51% is _required_ for BIP148 to succeed (and likely >>51%)... you might as well do as SegWit did originally, or lower the threshold to 80% or something (as BIP91 does).

Without replay protection at the outset, BIP148, as far as I can tell, isn't a threat to miners.

--
Please do not email me anything that you are not comfortable also sharing with the NSA.

On Jun 6, 2017, at 5:29 PM, Kekcoin <kekcoin at protonmail.com> wrote:

Please read my email more carefully; the replay threat would be moot because there would be no alternative chain to replay the TX on, as the non-148 chain would have been reorganized into oblivion.

Sent with [ProtonMail](https://protonmail.com/) Secure Email.

-------- Original Message --------
Subject: Re: [bitcoin-dev] Replay attacks make BIP148 and BIP149 untennable
Local Time: June 7, 2017 3:26 AM
UTC Time: June 7, 2017 12:26 AM
From: contact at taoeffect.com
To: Kekcoin <kekcoin at protonmail.com>
Anthony Towns <aj at erisian.com.au>, bitcoin-dev at lists.linuxfoundation.org <bitcoin-dev at lists.linuxfoundation.org>

I don't know what you mean by "render the replay threat moot."

If you don't have replay protection, replay is always a threat. A very serious one.

--
Please do not email me anything that you are not comfortable also sharing with the NSA.

On Jun 6, 2017, at 5:19 PM, Kekcoin <kekcoin at protonmail.com> wrote:

Hmm, that's not the difference I was talking about. I was referring to the fact that using "post-chainsplit coinbases from the non-148 chain" to unilaterally (ie. can be done without action on the 148-chain) taint coins is more secure in extreme-adverserial cases such as secret-mining reorg attacks (as unfeasibly expensive they may be); the only large-scale (>100 block) reorganization the non-148 chain faces should be a resolution of the chainsplit and therefore render the replay threat moot.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170606/c5ac4a0c/attachment-0001.html>

From jacob.eliosoff at gmail.com  Wed Jun  7 04:17:37 2017
From: jacob.eliosoff at gmail.com (Jacob Eliosoff)
Date: Wed, 7 Jun 2017 00:17:37 -0400
Subject: [bitcoin-dev] User Activated Soft Fork Split Protection
In-Reply-To: <CADvTj4q+oOS=DKfpiNQ6PAbksQfa1gKNfokr2Zc6PNGWqLyL4A@mail.gmail.com>
References: <CADvTj4qpH-t5Gx6qyn3yToyUE_GFaBE989=AWNHLKMpMNW3R+w@mail.gmail.com>
	<AE5BA251-9DA6-4E34-A748-11C8CF91977C@taoeffect.com>
	<CADvTj4q+oOS=DKfpiNQ6PAbksQfa1gKNfokr2Zc6PNGWqLyL4A@mail.gmail.com>
Message-ID: <CAAUaCygpA896zWrcxysAose2e8ThYiBDKXu1LVwK22hmSXY11A@mail.gmail.com>

While this isn't an unreasonable proposal, it will orphan blocks from any
miner who isn't running it (or BIP148) by Aug 1, right?  That seems rather
rushed for a non-backwards-compatible SF, especially since in practice,
miners are unlikely to deploy it until it comes bundled with some version
of the Segwit2x HF code.

I realize this is a touchy topic but - how much hard evidence is there that
there *will* be significant disruption if miners simply ignore both this
and BIP148?  Correct me but afaict, BIP148 has ~0% hashrate support.

Unless the HF code is ready and agree on soon (say by Jul 1), my vote is to
keep the main chain backwards-compatible, especially if evidence of miner
support for BIP148 doesn't materialize soon.  It seems less disruptive for
recently-deployed BIP148 nodes to revert than to ask every miner in the
system to quickly upgrade or get orphaned.

Just my view, I respect that others will differ.


On Tue, Jun 6, 2017 at 9:54 PM, James Hilliard via bitcoin-dev <
bitcoin-dev at lists.linuxfoundation.org> wrote:

> This is a BIP8 style soft fork so mandatory signalling will be active
> after Aug 1st regardless.
>
> On Tue, Jun 6, 2017 at 8:51 PM, Tao Effect <contact at taoeffect.com> wrote:
> > What is the probability that a 65% threshold is too low and can allow a
> > "surprise miner attack", whereby miners are kept offline before the
> > deadline, and brought online immediately after, creating potential havoc?
> >
> > (Nit: "simple majority" usually refers to >50%, I think, might cause
> > confusion.)
> >
> > -Greg Slepak
> >
> > --
> > Please do not email me anything that you are not comfortable also sharing
> > with the NSA.
> >
> > On Jun 6, 2017, at 5:56 PM, James Hilliard via bitcoin-dev
> > <bitcoin-dev at lists.linuxfoundation.org> wrote:
> >
> > Due to the proposed calendar(https://segwit2x.github.io/) for the
> > SegWit2x agreement being too slow to activate SegWit mandatory
> > signalling ahead of BIP148 using BIP91 I would like to propose another
> > option that miners can use to prevent a chain split ahead of the Aug
> > 1st BIP148 activation date.
> >
> > The splitprotection soft fork is essentially BIP91 but using BIP8
> > instead of BIP9 with a lower activation threshold and immediate
> > mandatory signalling lock-in. This allows for a majority of miners to
> > activate mandatory SegWit signalling and prevent a potential chain
> > split ahead of BIP148 activation.
> >
> > This BIP allows for miners to respond to market forces quickly ahead
> > of BIP148 activation by signalling for splitprotection. Any miners
> > already running BIP148 should be encouraged to use splitprotection.
> >
> > <pre>
> >  BIP: splitprotection
> >  Layer: Consensus (soft fork)
> >  Title: User Activated Soft Fork Split Protection
> >  Author: James Hilliard <james.hilliard1 at gmail.com>
> >  Comments-Summary: No comments yet.
> >  Comments-URI:
> >  Status: Draft
> >  Type: Standards Track
> >  Created: 2017-05-22
> >  License: BSD-3-Clause
> >           CC0-1.0
> > </pre>
> >
> > ==Abstract==
> >
> > This document specifies a coordination mechanism for a simple majority
> > of miners to prevent a chain split ahead of BIP148 activation.
> >
> > ==Definitions==
> >
> > "existing segwit deployment" refer to the BIP9 "segwit" deployment
> > using bit 1, between November 15th 2016 and November 15th 2017 to
> > activate BIP141, BIP143 and BIP147.
> >
> > ==Motivation==
> >
> > The biggest risk of BIP148 is an extended chain split, this BIP
> > provides a way for a simple majority of miners to eliminate that risk.
> >
> > This BIP provides a way for a simple majority of miners to coordinate
> > activation of the existing segwit deployment with less than 95%
> > hashpower before BIP148 activation. Due to time constraints unless
> > immediately deployed BIP91 will likely not be able to enforce
> > mandatory signalling of segwit before the Aug 1st activation of
> > BIP148. This BIP provides a method for rapid miner activation of
> > SegWit mandatory signalling ahead of the BIP148 activation date. Since
> > the primary goal of this BIP is to reduce the chance of an extended
> > chain split as much as possible we activate using a simple miner
> > majority of 65% over a 504 block interval rather than a higher
> > percentage. This BIP also allows miners to signal their intention to
> > run BIP148 in order to prevent a chain split.
> >
> > ==Specification==
> >
> > While this BIP is active, all blocks must set the nVersion header top
> > 3 bits to 001 together with bit field (1<<1) (according to the
> > existing segwit deployment). Blocks that do not signal as required
> > will be rejected.
> >
> > ==Deployment==
> >
> > This BIP will be deployed by "version bits" with a 65%(this can be
> > adjusted if desired) activation threshold BIP9 with the name
> > "splitprotecion" and using bit 2.
> >
> > This BIP starts immediately and is a BIP8 style soft fork since
> > mandatory signalling will start on midnight August 1st 2017 (epoch
> > time 1501545600) regardless of whether or not this BIP has reached its
> > own signalling threshold. This BIP will cease to be active when segwit
> > is locked-in.
> >
> > === Reference implementation ===
> >
> > <pre>
> > // Check if Segregated Witness is Locked In
> > bool IsWitnessLockedIn(const CBlockIndex* pindexPrev, const
> > Consensus::Params& params)
> > {
> >    LOCK(cs_main);
> >    return (VersionBitsState(pindexPrev, params,
> > Consensus::DEPLOYMENT_SEGWIT, versionbitscache) ==
> > THRESHOLD_LOCKED_IN);
> > }
> >
> > // SPLITPROTECTION mandatory segwit signalling.
> > if ( VersionBitsState(pindex->pprev, chainparams.GetConsensus(),
> > Consensus::DEPLOYMENT_SPLITPROTECTION, versionbitscache) ==
> > THRESHOLD_LOCKED_IN &&
> >     !IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
> > // Segwit is not locked in
> >     !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus()) ) //
> > and is not active.
> > {
> >    bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
> > VERSIONBITS_TOP_BITS;
> >    bool fSegbit = (pindex->nVersion &
> > VersionBitsMask(chainparams.GetConsensus(),
> > Consensus::DEPLOYMENT_SEGWIT)) != 0;
> >    if (!(fVersionBits && fSegbit)) {
> >        return state.DoS(0, error("ConnectBlock(): relayed block must
> > signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
> >    }
> > }
> >
> > // BIP148 mandatory segwit signalling.
> > int64_t nMedianTimePast = pindex->GetMedianTimePast();
> > if ( (nMedianTimePast >= 1501545600) &&  // Tue 01 Aug 2017 00:00:00 UTC
> >     (nMedianTimePast <= 1510704000) &&  // Wed 15 Nov 2017 00:00:00 UTC
> >     (!IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
> > // Segwit is not locked in
> >      !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus())) )
> > // and is not active.
> > {
> >    bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
> > VERSIONBITS_TOP_BITS;
> >    bool fSegbit = (pindex->nVersion &
> > VersionBitsMask(chainparams.GetConsensus(),
> > Consensus::DEPLOYMENT_SEGWIT)) != 0;
> >    if (!(fVersionBits && fSegbit)) {
> >        return state.DoS(0, error("ConnectBlock(): relayed block must
> > signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
> >    }
> > }
> > </pre>
> >
> > https://github.com/bitcoin/bitcoin/compare/0.14...
> jameshilliard:splitprotection-v0.14.1
> >
> > ==Backwards Compatibility==
> >
> > This deployment is compatible with the existing "segwit" bit 1
> > deployment scheduled between midnight November 15th, 2016 and midnight
> > November 15th, 2017. This deployment is also compatible with the
> > existing BIP148 deployment. This BIP is compatible with BIP91 only if
> > BIP91 activates before it and before BIP148. Miners will need to
> > upgrade their nodes to support splitprotection otherwise they may
> > build on top of an invalid block. While this bip is active users
> > should either upgrade to splitprotection or wait for additional
> > confirmations when accepting payments.
> >
> > ==Rationale==
> >
> > Historically we have used IsSuperMajority() to activate soft forks
> > such as BIP66 which has a mandatory signalling requirement for miners
> > once activated, this ensures that miners are aware of new rules being
> > enforced. This technique can be leveraged to lower the signalling
> > threshold of a soft fork while it is in the process of being deployed
> > in a backwards compatible way. We also use a BIP8 style timeout to
> > ensure that this BIP is compatible with BIP148 and that BIP148
> > compatible mandatory signalling activates regardless of miner
> > signalling levels.
> >
> > By orphaning non-signalling blocks during the BIP9 bit 1 "segwit"
> > deployment, this BIP can cause the existing "segwit" deployment to
> > activate without needing to release a new deployment. As we approach
> > BIP148 activation it may be desirable for a majority of miners to have
> > a method that will ensure that there is no chain split.
> >
> > ==References==
> >
> > *[https://lists.linuxfoundation.org/pipermail/
> bitcoin-dev/2017-March/013714.html
> > Mailing list discussion]
> > *[https://github.com/bitcoin/bitcoin/blob/v0.6.0/src/main.
> cpp#L1281-L1283
> > P2SH flag day activation]
> > *[[bip-0009.mediawiki|BIP9 Version bits with timeout and delay]]
> > *[[bip-0016.mediawiki|BIP16 Pay to Script Hash]]
> > *[[bip-0091.mediawiki|BIP91 Reduced threshold Segwit MASF]]
> > *[[bip-0141.mediawiki|BIP141 Segregated Witness (Consensus layer)]]
> > *[[bip-0143.mediawiki|BIP143 Transaction Signature Verification for
> > Version 0 Witness Program]]
> > *[[bip-0147.mediawiki|BIP147 Dealing with dummy stack element
> malleability]]
> > *[[bip-0148.mediawiki|BIP148 Mandatory activation of segwit deployment]]
> > *[[bip-0149.mediawiki|BIP149 Segregated Witness (second deployment)]]
> > *[https://bitcoincore.org/en/2016/01/26/segwit-benefits/ Segwit
> benefits]
> >
> > ==Copyright==
> >
> > This document is dual licensed as BSD 3-clause, and Creative Commons
> > CC0 1.0 Universal.
> > _______________________________________________
> > bitcoin-dev mailing list
> > bitcoin-dev at lists.linuxfoundation.org
> > https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
> >
> >
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170607/27553471/attachment-0001.html>

From contact at taoeffect.com  Wed Jun  7 05:20:52 2017
From: contact at taoeffect.com (Tao Effect)
Date: Tue, 6 Jun 2017 22:20:52 -0700
Subject: [bitcoin-dev] User Activated Soft Fork Split Protection
In-Reply-To: <CADvTj4q+oOS=DKfpiNQ6PAbksQfa1gKNfokr2Zc6PNGWqLyL4A@mail.gmail.com>
References: <CADvTj4qpH-t5Gx6qyn3yToyUE_GFaBE989=AWNHLKMpMNW3R+w@mail.gmail.com>
	<AE5BA251-9DA6-4E34-A748-11C8CF91977C@taoeffect.com>
	<CADvTj4q+oOS=DKfpiNQ6PAbksQfa1gKNfokr2Zc6PNGWqLyL4A@mail.gmail.com>
Message-ID: <0CDEF5A2-0BAF-46E4-8906-39D4724AF3F2@taoeffect.com>

See thread on replay attacks for why activating regardless of threshold is a bad idea [1].

BIP91 OTOH seems perfectly reasonable. 80% instead of 95% makes it more difficult for miners to hold together in opposition to Core. It gives Core more leverage in negotiations.

If they don't activate with 80%, Core can release another BIP to reduce it to 75%.

Each threshold reduction makes it both more likely to succeed, but also increases the likelihood of harm to the ecosystem.

Cheers,
Greg

[1] https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-June/014497.html <https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-June/014497.html>

--
Please do not email me anything that you are not comfortable also sharing with the NSA.

> On Jun 6, 2017, at 6:54 PM, James Hilliard <james.hilliard1 at gmail.com <mailto:james.hilliard1 at gmail.com>> wrote:
> 
> This is a BIP8 style soft fork so mandatory signalling will be active
> after Aug 1st regardless.
> 
> On Tue, Jun 6, 2017 at 8:51 PM, Tao Effect <contact at taoeffect.com <mailto:contact at taoeffect.com>> wrote:
>> What is the probability that a 65% threshold is too low and can allow a
>> "surprise miner attack", whereby miners are kept offline before the
>> deadline, and brought online immediately after, creating potential havoc?
>> 
>> (Nit: "simple majority" usually refers to >50%, I think, might cause
>> confusion.)
>> 
>> -Greg Slepak
>> 
>> --
>> Please do not email me anything that you are not comfortable also sharing
>> with the NSA.
>> 
>> On Jun 6, 2017, at 5:56 PM, James Hilliard via bitcoin-dev
>> <bitcoin-dev at lists.linuxfoundation.org <mailto:bitcoin-dev at lists.linuxfoundation.org>> wrote:
>> 
>> Due to the proposed calendar(https://segwit2x.github.io/ <https://segwit2x.github.io/>) for the
>> SegWit2x agreement being too slow to activate SegWit mandatory
>> signalling ahead of BIP148 using BIP91 I would like to propose another
>> option that miners can use to prevent a chain split ahead of the Aug
>> 1st BIP148 activation date.
>> 
>> The splitprotection soft fork is essentially BIP91 but using BIP8
>> instead of BIP9 with a lower activation threshold and immediate
>> mandatory signalling lock-in. This allows for a majority of miners to
>> activate mandatory SegWit signalling and prevent a potential chain
>> split ahead of BIP148 activation.
>> 
>> This BIP allows for miners to respond to market forces quickly ahead
>> of BIP148 activation by signalling for splitprotection. Any miners
>> already running BIP148 should be encouraged to use splitprotection.
>> 
>> <pre>
>> BIP: splitprotection
>> Layer: Consensus (soft fork)
>> Title: User Activated Soft Fork Split Protection
>> Author: James Hilliard <james.hilliard1 at gmail.com <mailto:james.hilliard1 at gmail.com>>
>> Comments-Summary: No comments yet.
>> Comments-URI:
>> Status: Draft
>> Type: Standards Track
>> Created: 2017-05-22
>> License: BSD-3-Clause
>>          CC0-1.0
>> </pre>
>> 
>> ==Abstract==
>> 
>> This document specifies a coordination mechanism for a simple majority
>> of miners to prevent a chain split ahead of BIP148 activation.
>> 
>> ==Definitions==
>> 
>> "existing segwit deployment" refer to the BIP9 "segwit" deployment
>> using bit 1, between November 15th 2016 and November 15th 2017 to
>> activate BIP141, BIP143 and BIP147.
>> 
>> ==Motivation==
>> 
>> The biggest risk of BIP148 is an extended chain split, this BIP
>> provides a way for a simple majority of miners to eliminate that risk.
>> 
>> This BIP provides a way for a simple majority of miners to coordinate
>> activation of the existing segwit deployment with less than 95%
>> hashpower before BIP148 activation. Due to time constraints unless
>> immediately deployed BIP91 will likely not be able to enforce
>> mandatory signalling of segwit before the Aug 1st activation of
>> BIP148. This BIP provides a method for rapid miner activation of
>> SegWit mandatory signalling ahead of the BIP148 activation date. Since
>> the primary goal of this BIP is to reduce the chance of an extended
>> chain split as much as possible we activate using a simple miner
>> majority of 65% over a 504 block interval rather than a higher
>> percentage. This BIP also allows miners to signal their intention to
>> run BIP148 in order to prevent a chain split.
>> 
>> ==Specification==
>> 
>> While this BIP is active, all blocks must set the nVersion header top
>> 3 bits to 001 together with bit field (1<<1) (according to the
>> existing segwit deployment). Blocks that do not signal as required
>> will be rejected.
>> 
>> ==Deployment==
>> 
>> This BIP will be deployed by "version bits" with a 65%(this can be
>> adjusted if desired) activation threshold BIP9 with the name
>> "splitprotecion" and using bit 2.
>> 
>> This BIP starts immediately and is a BIP8 style soft fork since
>> mandatory signalling will start on midnight August 1st 2017 (epoch
>> time 1501545600) regardless of whether or not this BIP has reached its
>> own signalling threshold. This BIP will cease to be active when segwit
>> is locked-in.
>> 
>> === Reference implementation ===
>> 
>> <pre>
>> // Check if Segregated Witness is Locked In
>> bool IsWitnessLockedIn(const CBlockIndex* pindexPrev, const
>> Consensus::Params& params)
>> {
>>   LOCK(cs_main);
>>   return (VersionBitsState(pindexPrev, params,
>> Consensus::DEPLOYMENT_SEGWIT, versionbitscache) ==
>> THRESHOLD_LOCKED_IN);
>> }
>> 
>> // SPLITPROTECTION mandatory segwit signalling.
>> if ( VersionBitsState(pindex->pprev, chainparams.GetConsensus(),
>> Consensus::DEPLOYMENT_SPLITPROTECTION, versionbitscache) ==
>> THRESHOLD_LOCKED_IN &&
>>    !IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
>> // Segwit is not locked in
>>    !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus()) ) //
>> and is not active.
>> {
>>   bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
>> VERSIONBITS_TOP_BITS;
>>   bool fSegbit = (pindex->nVersion &
>> VersionBitsMask(chainparams.GetConsensus(),
>> Consensus::DEPLOYMENT_SEGWIT)) != 0;
>>   if (!(fVersionBits && fSegbit)) {
>>       return state.DoS(0, error("ConnectBlock(): relayed block must
>> signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
>>   }
>> }
>> 
>> // BIP148 mandatory segwit signalling.
>> int64_t nMedianTimePast = pindex->GetMedianTimePast();
>> if ( (nMedianTimePast >= 1501545600) &&  // Tue 01 Aug 2017 00:00:00 UTC
>>    (nMedianTimePast <= 1510704000) &&  // Wed 15 Nov 2017 00:00:00 UTC
>>    (!IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
>> // Segwit is not locked in
>>     !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus())) )
>> // and is not active.
>> {
>>   bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
>> VERSIONBITS_TOP_BITS;
>>   bool fSegbit = (pindex->nVersion &
>> VersionBitsMask(chainparams.GetConsensus(),
>> Consensus::DEPLOYMENT_SEGWIT)) != 0;
>>   if (!(fVersionBits && fSegbit)) {
>>       return state.DoS(0, error("ConnectBlock(): relayed block must
>> signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
>>   }
>> }
>> </pre>
>> 
>> https://github.com/bitcoin/bitcoin/compare/0.14...jameshilliard:splitprotection-v0.14.1 <https://github.com/bitcoin/bitcoin/compare/0.14...jameshilliard:splitprotection-v0.14.1>
>> 
>> ==Backwards Compatibility==
>> 
>> This deployment is compatible with the existing "segwit" bit 1
>> deployment scheduled between midnight November 15th, 2016 and midnight
>> November 15th, 2017. This deployment is also compatible with the
>> existing BIP148 deployment. This BIP is compatible with BIP91 only if
>> BIP91 activates before it and before BIP148. Miners will need to
>> upgrade their nodes to support splitprotection otherwise they may
>> build on top of an invalid block. While this bip is active users
>> should either upgrade to splitprotection or wait for additional
>> confirmations when accepting payments.
>> 
>> ==Rationale==
>> 
>> Historically we have used IsSuperMajority() to activate soft forks
>> such as BIP66 which has a mandatory signalling requirement for miners
>> once activated, this ensures that miners are aware of new rules being
>> enforced. This technique can be leveraged to lower the signalling
>> threshold of a soft fork while it is in the process of being deployed
>> in a backwards compatible way. We also use a BIP8 style timeout to
>> ensure that this BIP is compatible with BIP148 and that BIP148
>> compatible mandatory signalling activates regardless of miner
>> signalling levels.
>> 
>> By orphaning non-signalling blocks during the BIP9 bit 1 "segwit"
>> deployment, this BIP can cause the existing "segwit" deployment to
>> activate without needing to release a new deployment. As we approach
>> BIP148 activation it may be desirable for a majority of miners to have
>> a method that will ensure that there is no chain split.
>> 
>> ==References==
>> 
>> *[https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-March/013714.html
>> Mailing list discussion]
>> *[https://github.com/bitcoin/bitcoin/blob/v0.6.0/src/main.cpp#L1281-L1283
>> P2SH flag day activation]
>> *[[bip-0009.mediawiki|BIP9 Version bits with timeout and delay]]
>> *[[bip-0016.mediawiki|BIP16 Pay to Script Hash]]
>> *[[bip-0091.mediawiki|BIP91 Reduced threshold Segwit MASF]]
>> *[[bip-0141.mediawiki|BIP141 Segregated Witness (Consensus layer)]]
>> *[[bip-0143.mediawiki|BIP143 Transaction Signature Verification for
>> Version 0 Witness Program]]
>> *[[bip-0147.mediawiki|BIP147 Dealing with dummy stack element malleability]]
>> *[[bip-0148.mediawiki|BIP148 Mandatory activation of segwit deployment]]
>> *[[bip-0149.mediawiki|BIP149 Segregated Witness (second deployment)]]
>> *[https://bitcoincore.org/en/2016/01/26/segwit-benefits/ Segwit benefits]
>> 
>> ==Copyright==
>> 
>> This document is dual licensed as BSD 3-clause, and Creative Commons
>> CC0 1.0 Universal.
>> _______________________________________________
>> bitcoin-dev mailing list
>> bitcoin-dev at lists.linuxfoundation.org
>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>> 
>> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170606/1871ce5a/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 801 bytes
Desc: Message signed with OpenPGP
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170606/1871ce5a/attachment-0001.sig>

From contact at taoeffect.com  Tue Jun  6 20:43:25 2017
From: contact at taoeffect.com (Tao Effect)
Date: Tue, 6 Jun 2017 13:43:25 -0700
Subject: [bitcoin-dev] Replay attacks make BIP148 and BIP149 untennable
Message-ID: <BDD17E4F-254F-426B-827A-E43CC07EFC27@taoeffect.com>

This is just me putting in my formal objection to BIP148 and BIP149 based on my experience with the ETH/ETC hard fork and involvement in that drama.

First, it's important to note that ETC/ETH HF is a very different situation from BIP148 and all other soft-forks. To those on this mailing list, the reasons should be self-evident (one results in two incompatible chains, the other doesn't).

However, replay attacks are common to both possibilities (i.e. when BIP148 has <51% hash power).

I believe the severity of replay attacks is going unvoiced and is not understood within the bitcoin community because of their lack of experience with them.

I further believe that replay attacks are the #1 issue with BIP148, BIP149, etc., superseding wipeout attacks in severity.

These are not baseless beliefs, they're born out of experience and I think anyone will reach the same conclusion upon study.

In a nutshell, replay attacks mean that all talk of there being potentially "two coins" as a result of BIP148 is basically nonsense.

Replay attacks effectively eliminate that possibility.

When users go to "sell their legacy coins", they've just sold their 148 coins, and vice versa.

Both of the coin-splitting techniques given so far by the proponents BIP148 are also untenable:

- Double-spending to self with nLockTime txns is insanely complicated, risky, not guaranteed to work, extremely time consuming, and would likely result in a massive increase in backlogged transactions and increased fees.

- Mixing with 148 coinbase txns destroys fungibility.

Without a coin, there is no real threat from BIP148. Without that threat, there is no point to BIP148, and the miners know this.

These and other concerns are outlined and explained in more detail in this conversation I had yesterday with John Light:

https://www.youtube.com/watch?v=33rL3-p8cPw <https://www.youtube.com/watch?v=33rL3-p8cPw>

Cheers,
Greg Slepak

--
Please do not email me anything that you are not comfortable also sharing with the NSA.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170606/862fdff6/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 801 bytes
Desc: Message signed with OpenPGP
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170606/862fdff6/attachment.sig>

From nick at ethereum.org  Wed Jun  7 13:25:35 2017
From: nick at ethereum.org (Nick Johnson)
Date: Wed, 07 Jun 2017 13:25:35 +0000
Subject: [bitcoin-dev] Replay attacks make BIP148 and BIP149 untennable
In-Reply-To: <CAAS2fgSU+UtbJSSAhf0-Sd0GH-RGnZmv+WHWtFV2zHFW2q6_yg@mail.gmail.com>
References: <31833011-7179-49D1-A07E-8FD9556C4534@taoeffect.com>
	<CAAS2fgSU+UtbJSSAhf0-Sd0GH-RGnZmv+WHWtFV2zHFW2q6_yg@mail.gmail.com>
Message-ID: <CAFz7pMuQTdUBmOOB7aPrgkDNZvQTn_jfantfLQQVWoerD=D2Kg@mail.gmail.com>

On Wed, Jun 7, 2017 at 12:02 AM Gregory Maxwell via bitcoin-dev <
bitcoin-dev at lists.linuxfoundation.org> wrote:

> On Tue, Jun 6, 2017 at 10:39 PM, Tao Effect via bitcoin-dev
> <bitcoin-dev at lists.linuxfoundation.org> wrote:
> > I believe the severity of replay attacks is going unvoiced and is not
> > understood within the bitcoin community because of their lack of
> experience
> > with them.
>
> Please don't insult our community-- the issues with replay were
> pointed out by us to Ethereum in advance and were cited specifically
> in prior hardfork discussions long before Ethereum started editing
> their ledger for the economic benefit of its centralized
> administrators.


Please don't spread misinformation. Whatever you think of the DAO hard
fork, it's a simple fact that the Ethereum ledger was not edited.

-Nick Johnson
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170607/2c04c534/attachment.html>

From erik at q32.com  Wed Jun  7 14:10:48 2017
From: erik at q32.com (Erik Aronesty)
Date: Wed, 7 Jun 2017 10:10:48 -0400
Subject: [bitcoin-dev] User Activated Soft Fork Split Protection
In-Reply-To: <CADvTj4oJr38V+b=96pt7GiaMMSPujsz9wQ-5wmgM=rvWUC8Dkw@mail.gmail.com>
References: <CADvTj4qpH-t5Gx6qyn3yToyUE_GFaBE989=AWNHLKMpMNW3R+w@mail.gmail.com>
	<AE5BA251-9DA6-4E34-A748-11C8CF91977C@taoeffect.com>
	<CADvTj4q+oOS=DKfpiNQ6PAbksQfa1gKNfokr2Zc6PNGWqLyL4A@mail.gmail.com>
	<0CDEF5A2-0BAF-46E4-8906-39D4724AF3F2@taoeffect.com>
	<CADvTj4oJr38V+b=96pt7GiaMMSPujsz9wQ-5wmgM=rvWUC8Dkw@mail.gmail.com>
Message-ID: <CAJowKgJi-68G5Xy1_8n_BOX5e8myj08_SPiFu+cdWsRD4DNy4w@mail.gmail.com>

This is, by far, the safest way for miners to quickly defend against a
chain split, much better than a -bip148 option.   This allows miners to
defend themselves, with very little risk, since the defense is only
activated if the majority of miners do so. I would move for a very rapid
deployment.   Only miners would need to upgrade.   Regular users would not
have to concern themselves with this release.

On Wed, Jun 7, 2017 at 6:13 AM, James Hilliard via bitcoin-dev <
bitcoin-dev at lists.linuxfoundation.org> wrote:

> I think even 55% would probably work out fine simply due to incentive
> structures, once signalling is over 51% it's then clear to miners that
> non-signalling blocks will be orphaned and the rest will rapidly
> update to splitprotection/BIP148. The purpose of this BIP is to reduce
> chain split risk for BIP148 since it's looking like BIP148 is going to
> be run by a non-insignificant percentage of the economy at a minimum.
>
> On Wed, Jun 7, 2017 at 12:20 AM, Tao Effect <contact at taoeffect.com> wrote:
> > See thread on replay attacks for why activating regardless of threshold
> is a
> > bad idea [1].
> >
> > BIP91 OTOH seems perfectly reasonable. 80% instead of 95% makes it more
> > difficult for miners to hold together in opposition to Core. It gives
> Core
> > more leverage in negotiations.
> >
> > If they don't activate with 80%, Core can release another BIP to reduce
> it
> > to 75%.
> >
> > Each threshold reduction makes it both more likely to succeed, but also
> > increases the likelihood of harm to the ecosystem.
> >
> > Cheers,
> > Greg
> >
> > [1]
> > https://lists.linuxfoundation.org/pipermail/bitcoin-dev/
> 2017-June/014497.html
> >
> > --
> > Please do not email me anything that you are not comfortable also sharing
> > with the NSA.
> >
> > On Jun 6, 2017, at 6:54 PM, James Hilliard <james.hilliard1 at gmail.com>
> > wrote:
> >
> > This is a BIP8 style soft fork so mandatory signalling will be active
> > after Aug 1st regardless.
> >
> > On Tue, Jun 6, 2017 at 8:51 PM, Tao Effect <contact at taoeffect.com>
> wrote:
> >
> > What is the probability that a 65% threshold is too low and can allow a
> > "surprise miner attack", whereby miners are kept offline before the
> > deadline, and brought online immediately after, creating potential havoc?
> >
> > (Nit: "simple majority" usually refers to >50%, I think, might cause
> > confusion.)
> >
> > -Greg Slepak
> >
> > --
> > Please do not email me anything that you are not comfortable also sharing
> > with the NSA.
> >
> > On Jun 6, 2017, at 5:56 PM, James Hilliard via bitcoin-dev
> > <bitcoin-dev at lists.linuxfoundation.org> wrote:
> >
> > Due to the proposed calendar(https://segwit2x.github.io/) for the
> > SegWit2x agreement being too slow to activate SegWit mandatory
> > signalling ahead of BIP148 using BIP91 I would like to propose another
> > option that miners can use to prevent a chain split ahead of the Aug
> > 1st BIP148 activation date.
> >
> > The splitprotection soft fork is essentially BIP91 but using BIP8
> > instead of BIP9 with a lower activation threshold and immediate
> > mandatory signalling lock-in. This allows for a majority of miners to
> > activate mandatory SegWit signalling and prevent a potential chain
> > split ahead of BIP148 activation.
> >
> > This BIP allows for miners to respond to market forces quickly ahead
> > of BIP148 activation by signalling for splitprotection. Any miners
> > already running BIP148 should be encouraged to use splitprotection.
> >
> > <pre>
> > BIP: splitprotection
> > Layer: Consensus (soft fork)
> > Title: User Activated Soft Fork Split Protection
> > Author: James Hilliard <james.hilliard1 at gmail.com>
> > Comments-Summary: No comments yet.
> > Comments-URI:
> > Status: Draft
> > Type: Standards Track
> > Created: 2017-05-22
> > License: BSD-3-Clause
> >          CC0-1.0
> > </pre>
> >
> > ==Abstract==
> >
> > This document specifies a coordination mechanism for a simple majority
> > of miners to prevent a chain split ahead of BIP148 activation.
> >
> > ==Definitions==
> >
> > "existing segwit deployment" refer to the BIP9 "segwit" deployment
> > using bit 1, between November 15th 2016 and November 15th 2017 to
> > activate BIP141, BIP143 and BIP147.
> >
> > ==Motivation==
> >
> > The biggest risk of BIP148 is an extended chain split, this BIP
> > provides a way for a simple majority of miners to eliminate that risk.
> >
> > This BIP provides a way for a simple majority of miners to coordinate
> > activation of the existing segwit deployment with less than 95%
> > hashpower before BIP148 activation. Due to time constraints unless
> > immediately deployed BIP91 will likely not be able to enforce
> > mandatory signalling of segwit before the Aug 1st activation of
> > BIP148. This BIP provides a method for rapid miner activation of
> > SegWit mandatory signalling ahead of the BIP148 activation date. Since
> > the primary goal of this BIP is to reduce the chance of an extended
> > chain split as much as possible we activate using a simple miner
> > majority of 65% over a 504 block interval rather than a higher
> > percentage. This BIP also allows miners to signal their intention to
> > run BIP148 in order to prevent a chain split.
> >
> > ==Specification==
> >
> > While this BIP is active, all blocks must set the nVersion header top
> > 3 bits to 001 together with bit field (1<<1) (according to the
> > existing segwit deployment). Blocks that do not signal as required
> > will be rejected.
> >
> > ==Deployment==
> >
> > This BIP will be deployed by "version bits" with a 65%(this can be
> > adjusted if desired) activation threshold BIP9 with the name
> > "splitprotecion" and using bit 2.
> >
> > This BIP starts immediately and is a BIP8 style soft fork since
> > mandatory signalling will start on midnight August 1st 2017 (epoch
> > time 1501545600) regardless of whether or not this BIP has reached its
> > own signalling threshold. This BIP will cease to be active when segwit
> > is locked-in.
> >
> > === Reference implementation ===
> >
> > <pre>
> > // Check if Segregated Witness is Locked In
> > bool IsWitnessLockedIn(const CBlockIndex* pindexPrev, const
> > Consensus::Params& params)
> > {
> >   LOCK(cs_main);
> >   return (VersionBitsState(pindexPrev, params,
> > Consensus::DEPLOYMENT_SEGWIT, versionbitscache) ==
> > THRESHOLD_LOCKED_IN);
> > }
> >
> > // SPLITPROTECTION mandatory segwit signalling.
> > if ( VersionBitsState(pindex->pprev, chainparams.GetConsensus(),
> > Consensus::DEPLOYMENT_SPLITPROTECTION, versionbitscache) ==
> > THRESHOLD_LOCKED_IN &&
> >    !IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
> > // Segwit is not locked in
> >    !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus()) ) //
> > and is not active.
> > {
> >   bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
> > VERSIONBITS_TOP_BITS;
> >   bool fSegbit = (pindex->nVersion &
> > VersionBitsMask(chainparams.GetConsensus(),
> > Consensus::DEPLOYMENT_SEGWIT)) != 0;
> >   if (!(fVersionBits && fSegbit)) {
> >       return state.DoS(0, error("ConnectBlock(): relayed block must
> > signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
> >   }
> > }
> >
> > // BIP148 mandatory segwit signalling.
> > int64_t nMedianTimePast = pindex->GetMedianTimePast();
> > if ( (nMedianTimePast >= 1501545600) &&  // Tue 01 Aug 2017 00:00:00 UTC
> >    (nMedianTimePast <= 1510704000) &&  // Wed 15 Nov 2017 00:00:00 UTC
> >    (!IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
> > // Segwit is not locked in
> >     !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus())) )
> > // and is not active.
> > {
> >   bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
> > VERSIONBITS_TOP_BITS;
> >   bool fSegbit = (pindex->nVersion &
> > VersionBitsMask(chainparams.GetConsensus(),
> > Consensus::DEPLOYMENT_SEGWIT)) != 0;
> >   if (!(fVersionBits && fSegbit)) {
> >       return state.DoS(0, error("ConnectBlock(): relayed block must
> > signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
> >   }
> > }
> > </pre>
> >
> > https://github.com/bitcoin/bitcoin/compare/0.14...
> jameshilliard:splitprotection-v0.14.1
> >
> > ==Backwards Compatibility==
> >
> > This deployment is compatible with the existing "segwit" bit 1
> > deployment scheduled between midnight November 15th, 2016 and midnight
> > November 15th, 2017. This deployment is also compatible with the
> > existing BIP148 deployment. This BIP is compatible with BIP91 only if
> > BIP91 activates before it and before BIP148. Miners will need to
> > upgrade their nodes to support splitprotection otherwise they may
> > build on top of an invalid block. While this bip is active users
> > should either upgrade to splitprotection or wait for additional
> > confirmations when accepting payments.
> >
> > ==Rationale==
> >
> > Historically we have used IsSuperMajority() to activate soft forks
> > such as BIP66 which has a mandatory signalling requirement for miners
> > once activated, this ensures that miners are aware of new rules being
> > enforced. This technique can be leveraged to lower the signalling
> > threshold of a soft fork while it is in the process of being deployed
> > in a backwards compatible way. We also use a BIP8 style timeout to
> > ensure that this BIP is compatible with BIP148 and that BIP148
> > compatible mandatory signalling activates regardless of miner
> > signalling levels.
> >
> > By orphaning non-signalling blocks during the BIP9 bit 1 "segwit"
> > deployment, this BIP can cause the existing "segwit" deployment to
> > activate without needing to release a new deployment. As we approach
> > BIP148 activation it may be desirable for a majority of miners to have
> > a method that will ensure that there is no chain split.
> >
> > ==References==
> >
> > *[https://lists.linuxfoundation.org/pipermail/
> bitcoin-dev/2017-March/013714.html
> > Mailing list discussion]
> > *[https://github.com/bitcoin/bitcoin/blob/v0.6.0/src/main.
> cpp#L1281-L1283
> > P2SH flag day activation]
> > *[[bip-0009.mediawiki|BIP9 Version bits with timeout and delay]]
> > *[[bip-0016.mediawiki|BIP16 Pay to Script Hash]]
> > *[[bip-0091.mediawiki|BIP91 Reduced threshold Segwit MASF]]
> > *[[bip-0141.mediawiki|BIP141 Segregated Witness (Consensus layer)]]
> > *[[bip-0143.mediawiki|BIP143 Transaction Signature Verification for
> > Version 0 Witness Program]]
> > *[[bip-0147.mediawiki|BIP147 Dealing with dummy stack element
> malleability]]
> > *[[bip-0148.mediawiki|BIP148 Mandatory activation of segwit deployment]]
> > *[[bip-0149.mediawiki|BIP149 Segregated Witness (second deployment)]]
> > *[https://bitcoincore.org/en/2016/01/26/segwit-benefits/ Segwit
> benefits]
> >
> > ==Copyright==
> >
> > This document is dual licensed as BSD 3-clause, and Creative Commons
> > CC0 1.0 Universal.
> > _______________________________________________
> > bitcoin-dev mailing list
> > bitcoin-dev at lists.linuxfoundation.org
> > https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
> >
> >
> >
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170607/881a9a7d/attachment-0001.html>

From contact at taoeffect.com  Wed Jun  7 16:27:03 2017
From: contact at taoeffect.com (Tao Effect)
Date: Wed, 7 Jun 2017 09:27:03 -0700
Subject: [bitcoin-dev] Replay attacks make BIP148 and BIP149 untennable
In-Reply-To: <CAFz7pMuQTdUBmOOB7aPrgkDNZvQTn_jfantfLQQVWoerD=D2Kg@mail.gmail.com>
References: <31833011-7179-49D1-A07E-8FD9556C4534@taoeffect.com>
	<CAAS2fgSU+UtbJSSAhf0-Sd0GH-RGnZmv+WHWtFV2zHFW2q6_yg@mail.gmail.com>
	<CAFz7pMuQTdUBmOOB7aPrgkDNZvQTn_jfantfLQQVWoerD=D2Kg@mail.gmail.com>
Message-ID: <F9930B98-BBCC-4B4D-B938-AE2CFB7721AD@taoeffect.com>

Nick,

> Please don't spread misinformation. Whatever you think of the DAO hard fork, it's a simple fact that the Ethereum ledger was not edited.

This sort of email is unhelpful to this conversation, and it certainly doesn't help with the perception that Ethereum is nothing but a bunch of hypocritical Bankers 2.0.

Everyone knows you didn't edit Ethereum Classic, but the the hard fork, which was re-branded as Ethereum, was edited.

- Greg

--
Please do not email me anything that you are not comfortable also sharing with the NSA.

> On Jun 7, 2017, at 6:25 AM, Nick Johnson <nick at ethereum.org <mailto:nick at ethereum.org>> wrote:
> 
> On Wed, Jun 7, 2017 at 12:02 AM Gregory Maxwell via bitcoin-dev <bitcoin-dev at lists.linuxfoundation.org <mailto:bitcoin-dev at lists.linuxfoundation.org>> wrote:
> On Tue, Jun 6, 2017 at 10:39 PM, Tao Effect via bitcoin-dev
> <bitcoin-dev at lists.linuxfoundation.org <mailto:bitcoin-dev at lists.linuxfoundation.org>> wrote:
> > I believe the severity of replay attacks is going unvoiced and is not
> > understood within the bitcoin community because of their lack of experience
> > with them.
> 
> Please don't insult our community-- the issues with replay were
> pointed out by us to Ethereum in advance and were cited specifically
> in prior hardfork discussions long before Ethereum started editing
> their ledger for the economic benefit of its centralized
> administrators.
> 
> Please don't spread misinformation. Whatever you think of the DAO hard fork, it's a simple fact that the Ethereum ledger was not edited.
> 
> -Nick Johnson

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170607/d0012334/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 801 bytes
Desc: Message signed with OpenPGP
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170607/d0012334/attachment.sig>

From jacob.eliosoff at gmail.com  Wed Jun  7 16:44:32 2017
From: jacob.eliosoff at gmail.com (Jacob Eliosoff)
Date: Wed, 7 Jun 2017 12:44:32 -0400
Subject: [bitcoin-dev] User Activated Soft Fork Split Protection
In-Reply-To: <CAJowKgJi-68G5Xy1_8n_BOX5e8myj08_SPiFu+cdWsRD4DNy4w@mail.gmail.com>
References: <CADvTj4qpH-t5Gx6qyn3yToyUE_GFaBE989=AWNHLKMpMNW3R+w@mail.gmail.com>
	<AE5BA251-9DA6-4E34-A748-11C8CF91977C@taoeffect.com>
	<CADvTj4q+oOS=DKfpiNQ6PAbksQfa1gKNfokr2Zc6PNGWqLyL4A@mail.gmail.com>
	<0CDEF5A2-0BAF-46E4-8906-39D4724AF3F2@taoeffect.com>
	<CADvTj4oJr38V+b=96pt7GiaMMSPujsz9wQ-5wmgM=rvWUC8Dkw@mail.gmail.com>
	<CAJowKgJi-68G5Xy1_8n_BOX5e8myj08_SPiFu+cdWsRD4DNy4w@mail.gmail.com>
Message-ID: <CAAUaCyiKs9cDa6vC=8VpyT8vY5L8U0=H=+N48dJzLn1GMj3dmA@mail.gmail.com>

This is not the safest defense against a split.  If 70% of miners run
"splitprotection", and 0.1% run BIP148, there's no "safety"/"defense"
reason for splitprotection to activate segwit.  It should only do so if
*BIP148* support (NB: not just segwit support!) >50%.

The truly defensive logic is "If the majority supports orphaning non-segwit
blocks starting Aug 1, I'll join them."

If the real goal of this BIP is to induce miners to run segwit, then fair
enough.  But passing it off as the safest defense is bad faith.


On Wed, Jun 7, 2017 at 10:10 AM, Erik Aronesty via bitcoin-dev <
bitcoin-dev at lists.linuxfoundation.org> wrote:

> This is, by far, the safest way for miners to quickly defend against a
> chain split, much better than a -bip148 option.   This allows miners to
> defend themselves, with very little risk, since the defense is only
> activated if the majority of miners do so. I would move for a very rapid
> deployment.   Only miners would need to upgrade.   Regular users would not
> have to concern themselves with this release.
>
> On Wed, Jun 7, 2017 at 6:13 AM, James Hilliard via bitcoin-dev <
> bitcoin-dev at lists.linuxfoundation.org> wrote:
>
>> I think even 55% would probably work out fine simply due to incentive
>> structures, once signalling is over 51% it's then clear to miners that
>> non-signalling blocks will be orphaned and the rest will rapidly
>> update to splitprotection/BIP148. The purpose of this BIP is to reduce
>> chain split risk for BIP148 since it's looking like BIP148 is going to
>> be run by a non-insignificant percentage of the economy at a minimum.
>>
>> On Wed, Jun 7, 2017 at 12:20 AM, Tao Effect <contact at taoeffect.com>
>> wrote:
>> > See thread on replay attacks for why activating regardless of threshold
>> is a
>> > bad idea [1].
>> >
>> > BIP91 OTOH seems perfectly reasonable. 80% instead of 95% makes it more
>> > difficult for miners to hold together in opposition to Core. It gives
>> Core
>> > more leverage in negotiations.
>> >
>> > If they don't activate with 80%, Core can release another BIP to reduce
>> it
>> > to 75%.
>> >
>> > Each threshold reduction makes it both more likely to succeed, but also
>> > increases the likelihood of harm to the ecosystem.
>> >
>> > Cheers,
>> > Greg
>> >
>> > [1]
>> > https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017
>> -June/014497.html
>> >
>> > --
>> > Please do not email me anything that you are not comfortable also
>> sharing
>> > with the NSA.
>> >
>> > On Jun 6, 2017, at 6:54 PM, James Hilliard <james.hilliard1 at gmail.com>
>> > wrote:
>> >
>> > This is a BIP8 style soft fork so mandatory signalling will be active
>> > after Aug 1st regardless.
>> >
>> > On Tue, Jun 6, 2017 at 8:51 PM, Tao Effect <contact at taoeffect.com>
>> wrote:
>> >
>> > What is the probability that a 65% threshold is too low and can allow a
>> > "surprise miner attack", whereby miners are kept offline before the
>> > deadline, and brought online immediately after, creating potential
>> havoc?
>> >
>> > (Nit: "simple majority" usually refers to >50%, I think, might cause
>> > confusion.)
>> >
>> > -Greg Slepak
>> >
>> > --
>> > Please do not email me anything that you are not comfortable also
>> sharing
>> > with the NSA.
>> >
>> > On Jun 6, 2017, at 5:56 PM, James Hilliard via bitcoin-dev
>> > <bitcoin-dev at lists.linuxfoundation.org> wrote:
>> >
>> > Due to the proposed calendar(https://segwit2x.github.io/) for the
>> > SegWit2x agreement being too slow to activate SegWit mandatory
>> > signalling ahead of BIP148 using BIP91 I would like to propose another
>> > option that miners can use to prevent a chain split ahead of the Aug
>> > 1st BIP148 activation date.
>> >
>> > The splitprotection soft fork is essentially BIP91 but using BIP8
>> > instead of BIP9 with a lower activation threshold and immediate
>> > mandatory signalling lock-in. This allows for a majority of miners to
>> > activate mandatory SegWit signalling and prevent a potential chain
>> > split ahead of BIP148 activation.
>> >
>> > This BIP allows for miners to respond to market forces quickly ahead
>> > of BIP148 activation by signalling for splitprotection. Any miners
>> > already running BIP148 should be encouraged to use splitprotection.
>> >
>> > <pre>
>> > BIP: splitprotection
>> > Layer: Consensus (soft fork)
>> > Title: User Activated Soft Fork Split Protection
>> > Author: James Hilliard <james.hilliard1 at gmail.com>
>> > Comments-Summary: No comments yet.
>> > Comments-URI:
>> > Status: Draft
>> > Type: Standards Track
>> > Created: 2017-05-22
>> > License: BSD-3-Clause
>> >          CC0-1.0
>> > </pre>
>> >
>> > ==Abstract==
>> >
>> > This document specifies a coordination mechanism for a simple majority
>> > of miners to prevent a chain split ahead of BIP148 activation.
>> >
>> > ==Definitions==
>> >
>> > "existing segwit deployment" refer to the BIP9 "segwit" deployment
>> > using bit 1, between November 15th 2016 and November 15th 2017 to
>> > activate BIP141, BIP143 and BIP147.
>> >
>> > ==Motivation==
>> >
>> > The biggest risk of BIP148 is an extended chain split, this BIP
>> > provides a way for a simple majority of miners to eliminate that risk.
>> >
>> > This BIP provides a way for a simple majority of miners to coordinate
>> > activation of the existing segwit deployment with less than 95%
>> > hashpower before BIP148 activation. Due to time constraints unless
>> > immediately deployed BIP91 will likely not be able to enforce
>> > mandatory signalling of segwit before the Aug 1st activation of
>> > BIP148. This BIP provides a method for rapid miner activation of
>> > SegWit mandatory signalling ahead of the BIP148 activation date. Since
>> > the primary goal of this BIP is to reduce the chance of an extended
>> > chain split as much as possible we activate using a simple miner
>> > majority of 65% over a 504 block interval rather than a higher
>> > percentage. This BIP also allows miners to signal their intention to
>> > run BIP148 in order to prevent a chain split.
>> >
>> > ==Specification==
>> >
>> > While this BIP is active, all blocks must set the nVersion header top
>> > 3 bits to 001 together with bit field (1<<1) (according to the
>> > existing segwit deployment). Blocks that do not signal as required
>> > will be rejected.
>> >
>> > ==Deployment==
>> >
>> > This BIP will be deployed by "version bits" with a 65%(this can be
>> > adjusted if desired) activation threshold BIP9 with the name
>> > "splitprotecion" and using bit 2.
>> >
>> > This BIP starts immediately and is a BIP8 style soft fork since
>> > mandatory signalling will start on midnight August 1st 2017 (epoch
>> > time 1501545600) regardless of whether or not this BIP has reached its
>> > own signalling threshold. This BIP will cease to be active when segwit
>> > is locked-in.
>> >
>> > === Reference implementation ===
>> >
>> > <pre>
>> > // Check if Segregated Witness is Locked In
>> > bool IsWitnessLockedIn(const CBlockIndex* pindexPrev, const
>> > Consensus::Params& params)
>> > {
>> >   LOCK(cs_main);
>> >   return (VersionBitsState(pindexPrev, params,
>> > Consensus::DEPLOYMENT_SEGWIT, versionbitscache) ==
>> > THRESHOLD_LOCKED_IN);
>> > }
>> >
>> > // SPLITPROTECTION mandatory segwit signalling.
>> > if ( VersionBitsState(pindex->pprev, chainparams.GetConsensus(),
>> > Consensus::DEPLOYMENT_SPLITPROTECTION, versionbitscache) ==
>> > THRESHOLD_LOCKED_IN &&
>> >    !IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
>> > // Segwit is not locked in
>> >    !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus()) ) //
>> > and is not active.
>> > {
>> >   bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
>> > VERSIONBITS_TOP_BITS;
>> >   bool fSegbit = (pindex->nVersion &
>> > VersionBitsMask(chainparams.GetConsensus(),
>> > Consensus::DEPLOYMENT_SEGWIT)) != 0;
>> >   if (!(fVersionBits && fSegbit)) {
>> >       return state.DoS(0, error("ConnectBlock(): relayed block must
>> > signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
>> >   }
>> > }
>> >
>> > // BIP148 mandatory segwit signalling.
>> > int64_t nMedianTimePast = pindex->GetMedianTimePast();
>> > if ( (nMedianTimePast >= 1501545600) &&  // Tue 01 Aug 2017 00:00:00 UTC
>> >    (nMedianTimePast <= 1510704000) &&  // Wed 15 Nov 2017 00:00:00 UTC
>> >    (!IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
>> > // Segwit is not locked in
>> >     !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus())) )
>> > // and is not active.
>> > {
>> >   bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
>> > VERSIONBITS_TOP_BITS;
>> >   bool fSegbit = (pindex->nVersion &
>> > VersionBitsMask(chainparams.GetConsensus(),
>> > Consensus::DEPLOYMENT_SEGWIT)) != 0;
>> >   if (!(fVersionBits && fSegbit)) {
>> >       return state.DoS(0, error("ConnectBlock(): relayed block must
>> > signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
>> >   }
>> > }
>> > </pre>
>> >
>> > https://github.com/bitcoin/bitcoin/compare/0.14...jameshilli
>> ard:splitprotection-v0.14.1
>> >
>> > ==Backwards Compatibility==
>> >
>> > This deployment is compatible with the existing "segwit" bit 1
>> > deployment scheduled between midnight November 15th, 2016 and midnight
>> > November 15th, 2017. This deployment is also compatible with the
>> > existing BIP148 deployment. This BIP is compatible with BIP91 only if
>> > BIP91 activates before it and before BIP148. Miners will need to
>> > upgrade their nodes to support splitprotection otherwise they may
>> > build on top of an invalid block. While this bip is active users
>> > should either upgrade to splitprotection or wait for additional
>> > confirmations when accepting payments.
>> >
>> > ==Rationale==
>> >
>> > Historically we have used IsSuperMajority() to activate soft forks
>> > such as BIP66 which has a mandatory signalling requirement for miners
>> > once activated, this ensures that miners are aware of new rules being
>> > enforced. This technique can be leveraged to lower the signalling
>> > threshold of a soft fork while it is in the process of being deployed
>> > in a backwards compatible way. We also use a BIP8 style timeout to
>> > ensure that this BIP is compatible with BIP148 and that BIP148
>> > compatible mandatory signalling activates regardless of miner
>> > signalling levels.
>> >
>> > By orphaning non-signalling blocks during the BIP9 bit 1 "segwit"
>> > deployment, this BIP can cause the existing "segwit" deployment to
>> > activate without needing to release a new deployment. As we approach
>> > BIP148 activation it may be desirable for a majority of miners to have
>> > a method that will ensure that there is no chain split.
>> >
>> > ==References==
>> >
>> > *[https://lists.linuxfoundation.org/pipermail/bitcoin-dev/
>> 2017-March/013714.html
>> > Mailing list discussion]
>> > *[https://github.com/bitcoin/bitcoin/blob/v0.6.0/src/main.cp
>> p#L1281-L1283
>> > P2SH flag day activation]
>> > *[[bip-0009.mediawiki|BIP9 Version bits with timeout and delay]]
>> > *[[bip-0016.mediawiki|BIP16 Pay to Script Hash]]
>> > *[[bip-0091.mediawiki|BIP91 Reduced threshold Segwit MASF]]
>> > *[[bip-0141.mediawiki|BIP141 Segregated Witness (Consensus layer)]]
>> > *[[bip-0143.mediawiki|BIP143 Transaction Signature Verification for
>> > Version 0 Witness Program]]
>> > *[[bip-0147.mediawiki|BIP147 Dealing with dummy stack element
>> malleability]]
>> > *[[bip-0148.mediawiki|BIP148 Mandatory activation of segwit deployment]]
>> > *[[bip-0149.mediawiki|BIP149 Segregated Witness (second deployment)]]
>> > *[https://bitcoincore.org/en/2016/01/26/segwit-benefits/ Segwit
>> benefits]
>> >
>> > ==Copyright==
>> >
>> > This document is dual licensed as BSD 3-clause, and Creative Commons
>> > CC0 1.0 Universal.
>> > _______________________________________________
>> > bitcoin-dev mailing list
>> > bitcoin-dev at lists.linuxfoundation.org
>> > https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>> >
>> >
>> >
>> _______________________________________________
>> bitcoin-dev mailing list
>> bitcoin-dev at lists.linuxfoundation.org
>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>
>
>
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170607/308e84ea/attachment-0001.html>

From erik at q32.com  Wed Jun  7 18:05:52 2017
From: erik at q32.com (Erik Aronesty)
Date: Wed, 7 Jun 2017 14:05:52 -0400
Subject: [bitcoin-dev] User Activated Soft Fork Split Protection
In-Reply-To: <CAAUaCyiKs9cDa6vC=8VpyT8vY5L8U0=H=+N48dJzLn1GMj3dmA@mail.gmail.com>
References: <CADvTj4qpH-t5Gx6qyn3yToyUE_GFaBE989=AWNHLKMpMNW3R+w@mail.gmail.com>
	<AE5BA251-9DA6-4E34-A748-11C8CF91977C@taoeffect.com>
	<CADvTj4q+oOS=DKfpiNQ6PAbksQfa1gKNfokr2Zc6PNGWqLyL4A@mail.gmail.com>
	<0CDEF5A2-0BAF-46E4-8906-39D4724AF3F2@taoeffect.com>
	<CADvTj4oJr38V+b=96pt7GiaMMSPujsz9wQ-5wmgM=rvWUC8Dkw@mail.gmail.com>
	<CAJowKgJi-68G5Xy1_8n_BOX5e8myj08_SPiFu+cdWsRD4DNy4w@mail.gmail.com>
	<CAAUaCyiKs9cDa6vC=8VpyT8vY5L8U0=H=+N48dJzLn1GMj3dmA@mail.gmail.com>
Message-ID: <CAJowKgK52vo8c2v2AoSMoTzdL_YsHPNGZqJOy1HWPRdBPTb1uw@mail.gmail.com>

> But passing it off as the safest defense is bad faith.

Without this option, a miner has to guess whether a split will be
economically impacting.   With this option, his miner will automatically
switch to the chain least likely to get wiped out... as soon as a simple
majority of miners supports it.


On Wed, Jun 7, 2017 at 12:44 PM, Jacob Eliosoff <jacob.eliosoff at gmail.com>
wrote:

> This is not the safest defense against a split.  If 70% of miners run
> "splitprotection", and 0.1% run BIP148, there's no "safety"/"defense"
> reason for splitprotection to activate segwit.  It should only do so if
> *BIP148* support (NB: not just segwit support!) >50%.
>
> The truly defensive logic is "If the majority supports orphaning
> non-segwit blocks starting Aug 1, I'll join them."
>
> If the real goal of this BIP is to induce miners to run segwit, then fair
> enough.  But passing it off as the safest defense is bad faith.
>
>
> On Wed, Jun 7, 2017 at 10:10 AM, Erik Aronesty via bitcoin-dev <
> bitcoin-dev at lists.linuxfoundation.org> wrote:
>
>> This is, by far, the safest way for miners to quickly defend against a
>> chain split, much better than a -bip148 option.   This allows miners to
>> defend themselves, with very little risk, since the defense is only
>> activated if the majority of miners do so. I would move for a very rapid
>> deployment.   Only miners would need to upgrade.   Regular users would not
>> have to concern themselves with this release.
>>
>> On Wed, Jun 7, 2017 at 6:13 AM, James Hilliard via bitcoin-dev <
>> bitcoin-dev at lists.linuxfoundation.org> wrote:
>>
>>> I think even 55% would probably work out fine simply due to incentive
>>> structures, once signalling is over 51% it's then clear to miners that
>>> non-signalling blocks will be orphaned and the rest will rapidly
>>> update to splitprotection/BIP148. The purpose of this BIP is to reduce
>>> chain split risk for BIP148 since it's looking like BIP148 is going to
>>> be run by a non-insignificant percentage of the economy at a minimum.
>>>
>>> On Wed, Jun 7, 2017 at 12:20 AM, Tao Effect <contact at taoeffect.com>
>>> wrote:
>>> > See thread on replay attacks for why activating regardless of
>>> threshold is a
>>> > bad idea [1].
>>> >
>>> > BIP91 OTOH seems perfectly reasonable. 80% instead of 95% makes it more
>>> > difficult for miners to hold together in opposition to Core. It gives
>>> Core
>>> > more leverage in negotiations.
>>> >
>>> > If they don't activate with 80%, Core can release another BIP to
>>> reduce it
>>> > to 75%.
>>> >
>>> > Each threshold reduction makes it both more likely to succeed, but also
>>> > increases the likelihood of harm to the ecosystem.
>>> >
>>> > Cheers,
>>> > Greg
>>> >
>>> > [1]
>>> > https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017
>>> -June/014497.html
>>> >
>>> > --
>>> > Please do not email me anything that you are not comfortable also
>>> sharing
>>> > with the NSA.
>>> >
>>> > On Jun 6, 2017, at 6:54 PM, James Hilliard <james.hilliard1 at gmail.com>
>>> > wrote:
>>> >
>>> > This is a BIP8 style soft fork so mandatory signalling will be active
>>> > after Aug 1st regardless.
>>> >
>>> > On Tue, Jun 6, 2017 at 8:51 PM, Tao Effect <contact at taoeffect.com>
>>> wrote:
>>> >
>>> > What is the probability that a 65% threshold is too low and can allow a
>>> > "surprise miner attack", whereby miners are kept offline before the
>>> > deadline, and brought online immediately after, creating potential
>>> havoc?
>>> >
>>> > (Nit: "simple majority" usually refers to >50%, I think, might cause
>>> > confusion.)
>>> >
>>> > -Greg Slepak
>>> >
>>> > --
>>> > Please do not email me anything that you are not comfortable also
>>> sharing
>>> > with the NSA.
>>> >
>>> > On Jun 6, 2017, at 5:56 PM, James Hilliard via bitcoin-dev
>>> > <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>> >
>>> > Due to the proposed calendar(https://segwit2x.github.io/) for the
>>> > SegWit2x agreement being too slow to activate SegWit mandatory
>>> > signalling ahead of BIP148 using BIP91 I would like to propose another
>>> > option that miners can use to prevent a chain split ahead of the Aug
>>> > 1st BIP148 activation date.
>>> >
>>> > The splitprotection soft fork is essentially BIP91 but using BIP8
>>> > instead of BIP9 with a lower activation threshold and immediate
>>> > mandatory signalling lock-in. This allows for a majority of miners to
>>> > activate mandatory SegWit signalling and prevent a potential chain
>>> > split ahead of BIP148 activation.
>>> >
>>> > This BIP allows for miners to respond to market forces quickly ahead
>>> > of BIP148 activation by signalling for splitprotection. Any miners
>>> > already running BIP148 should be encouraged to use splitprotection.
>>> >
>>> > <pre>
>>> > BIP: splitprotection
>>> > Layer: Consensus (soft fork)
>>> > Title: User Activated Soft Fork Split Protection
>>> > Author: James Hilliard <james.hilliard1 at gmail.com>
>>> > Comments-Summary: No comments yet.
>>> > Comments-URI:
>>> > Status: Draft
>>> > Type: Standards Track
>>> > Created: 2017-05-22
>>> > License: BSD-3-Clause
>>> >          CC0-1.0
>>> > </pre>
>>> >
>>> > ==Abstract==
>>> >
>>> > This document specifies a coordination mechanism for a simple majority
>>> > of miners to prevent a chain split ahead of BIP148 activation.
>>> >
>>> > ==Definitions==
>>> >
>>> > "existing segwit deployment" refer to the BIP9 "segwit" deployment
>>> > using bit 1, between November 15th 2016 and November 15th 2017 to
>>> > activate BIP141, BIP143 and BIP147.
>>> >
>>> > ==Motivation==
>>> >
>>> > The biggest risk of BIP148 is an extended chain split, this BIP
>>> > provides a way for a simple majority of miners to eliminate that risk.
>>> >
>>> > This BIP provides a way for a simple majority of miners to coordinate
>>> > activation of the existing segwit deployment with less than 95%
>>> > hashpower before BIP148 activation. Due to time constraints unless
>>> > immediately deployed BIP91 will likely not be able to enforce
>>> > mandatory signalling of segwit before the Aug 1st activation of
>>> > BIP148. This BIP provides a method for rapid miner activation of
>>> > SegWit mandatory signalling ahead of the BIP148 activation date. Since
>>> > the primary goal of this BIP is to reduce the chance of an extended
>>> > chain split as much as possible we activate using a simple miner
>>> > majority of 65% over a 504 block interval rather than a higher
>>> > percentage. This BIP also allows miners to signal their intention to
>>> > run BIP148 in order to prevent a chain split.
>>> >
>>> > ==Specification==
>>> >
>>> > While this BIP is active, all blocks must set the nVersion header top
>>> > 3 bits to 001 together with bit field (1<<1) (according to the
>>> > existing segwit deployment). Blocks that do not signal as required
>>> > will be rejected.
>>> >
>>> > ==Deployment==
>>> >
>>> > This BIP will be deployed by "version bits" with a 65%(this can be
>>> > adjusted if desired) activation threshold BIP9 with the name
>>> > "splitprotecion" and using bit 2.
>>> >
>>> > This BIP starts immediately and is a BIP8 style soft fork since
>>> > mandatory signalling will start on midnight August 1st 2017 (epoch
>>> > time 1501545600) regardless of whether or not this BIP has reached its
>>> > own signalling threshold. This BIP will cease to be active when segwit
>>> > is locked-in.
>>> >
>>> > === Reference implementation ===
>>> >
>>> > <pre>
>>> > // Check if Segregated Witness is Locked In
>>> > bool IsWitnessLockedIn(const CBlockIndex* pindexPrev, const
>>> > Consensus::Params& params)
>>> > {
>>> >   LOCK(cs_main);
>>> >   return (VersionBitsState(pindexPrev, params,
>>> > Consensus::DEPLOYMENT_SEGWIT, versionbitscache) ==
>>> > THRESHOLD_LOCKED_IN);
>>> > }
>>> >
>>> > // SPLITPROTECTION mandatory segwit signalling.
>>> > if ( VersionBitsState(pindex->pprev, chainparams.GetConsensus(),
>>> > Consensus::DEPLOYMENT_SPLITPROTECTION, versionbitscache) ==
>>> > THRESHOLD_LOCKED_IN &&
>>> >    !IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
>>> > // Segwit is not locked in
>>> >    !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus()) ) //
>>> > and is not active.
>>> > {
>>> >   bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
>>> > VERSIONBITS_TOP_BITS;
>>> >   bool fSegbit = (pindex->nVersion &
>>> > VersionBitsMask(chainparams.GetConsensus(),
>>> > Consensus::DEPLOYMENT_SEGWIT)) != 0;
>>> >   if (!(fVersionBits && fSegbit)) {
>>> >       return state.DoS(0, error("ConnectBlock(): relayed block must
>>> > signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
>>> >   }
>>> > }
>>> >
>>> > // BIP148 mandatory segwit signalling.
>>> > int64_t nMedianTimePast = pindex->GetMedianTimePast();
>>> > if ( (nMedianTimePast >= 1501545600) &&  // Tue 01 Aug 2017 00:00:00
>>> UTC
>>> >    (nMedianTimePast <= 1510704000) &&  // Wed 15 Nov 2017 00:00:00 UTC
>>> >    (!IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
>>> > // Segwit is not locked in
>>> >     !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus())) )
>>> > // and is not active.
>>> > {
>>> >   bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
>>> > VERSIONBITS_TOP_BITS;
>>> >   bool fSegbit = (pindex->nVersion &
>>> > VersionBitsMask(chainparams.GetConsensus(),
>>> > Consensus::DEPLOYMENT_SEGWIT)) != 0;
>>> >   if (!(fVersionBits && fSegbit)) {
>>> >       return state.DoS(0, error("ConnectBlock(): relayed block must
>>> > signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
>>> >   }
>>> > }
>>> > </pre>
>>> >
>>> > https://github.com/bitcoin/bitcoin/compare/0.14...jameshilli
>>> ard:splitprotection-v0.14.1
>>> >
>>> > ==Backwards Compatibility==
>>> >
>>> > This deployment is compatible with the existing "segwit" bit 1
>>> > deployment scheduled between midnight November 15th, 2016 and midnight
>>> > November 15th, 2017. This deployment is also compatible with the
>>> > existing BIP148 deployment. This BIP is compatible with BIP91 only if
>>> > BIP91 activates before it and before BIP148. Miners will need to
>>> > upgrade their nodes to support splitprotection otherwise they may
>>> > build on top of an invalid block. While this bip is active users
>>> > should either upgrade to splitprotection or wait for additional
>>> > confirmations when accepting payments.
>>> >
>>> > ==Rationale==
>>> >
>>> > Historically we have used IsSuperMajority() to activate soft forks
>>> > such as BIP66 which has a mandatory signalling requirement for miners
>>> > once activated, this ensures that miners are aware of new rules being
>>> > enforced. This technique can be leveraged to lower the signalling
>>> > threshold of a soft fork while it is in the process of being deployed
>>> > in a backwards compatible way. We also use a BIP8 style timeout to
>>> > ensure that this BIP is compatible with BIP148 and that BIP148
>>> > compatible mandatory signalling activates regardless of miner
>>> > signalling levels.
>>> >
>>> > By orphaning non-signalling blocks during the BIP9 bit 1 "segwit"
>>> > deployment, this BIP can cause the existing "segwit" deployment to
>>> > activate without needing to release a new deployment. As we approach
>>> > BIP148 activation it may be desirable for a majority of miners to have
>>> > a method that will ensure that there is no chain split.
>>> >
>>> > ==References==
>>> >
>>> > *[https://lists.linuxfoundation.org/pipermail/bitcoin-dev/20
>>> 17-March/013714.html
>>> > Mailing list discussion]
>>> > *[https://github.com/bitcoin/bitcoin/blob/v0.6.0/src/main.cp
>>> p#L1281-L1283
>>> > P2SH flag day activation]
>>> > *[[bip-0009.mediawiki|BIP9 Version bits with timeout and delay]]
>>> > *[[bip-0016.mediawiki|BIP16 Pay to Script Hash]]
>>> > *[[bip-0091.mediawiki|BIP91 Reduced threshold Segwit MASF]]
>>> > *[[bip-0141.mediawiki|BIP141 Segregated Witness (Consensus layer)]]
>>> > *[[bip-0143.mediawiki|BIP143 Transaction Signature Verification for
>>> > Version 0 Witness Program]]
>>> > *[[bip-0147.mediawiki|BIP147 Dealing with dummy stack element
>>> malleability]]
>>> > *[[bip-0148.mediawiki|BIP148 Mandatory activation of segwit
>>> deployment]]
>>> > *[[bip-0149.mediawiki|BIP149 Segregated Witness (second deployment)]]
>>> > *[https://bitcoincore.org/en/2016/01/26/segwit-benefits/ Segwit
>>> benefits]
>>> >
>>> > ==Copyright==
>>> >
>>> > This document is dual licensed as BSD 3-clause, and Creative Commons
>>> > CC0 1.0 Universal.
>>> > _______________________________________________
>>> > bitcoin-dev mailing list
>>> > bitcoin-dev at lists.linuxfoundation.org
>>> > https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>> >
>>> >
>>> >
>>> _______________________________________________
>>> bitcoin-dev mailing list
>>> bitcoin-dev at lists.linuxfoundation.org
>>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>>
>>
>>
>> _______________________________________________
>> bitcoin-dev mailing list
>> bitcoin-dev at lists.linuxfoundation.org
>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170607/69b8b33e/attachment-0001.html>

From nick at ethereum.org  Wed Jun  7 17:35:17 2017
From: nick at ethereum.org (Nick Johnson)
Date: Wed, 07 Jun 2017 17:35:17 +0000
Subject: [bitcoin-dev] Replay attacks make BIP148 and BIP149 untennable
In-Reply-To: <F9930B98-BBCC-4B4D-B938-AE2CFB7721AD@taoeffect.com>
References: <31833011-7179-49D1-A07E-8FD9556C4534@taoeffect.com>
	<CAAS2fgSU+UtbJSSAhf0-Sd0GH-RGnZmv+WHWtFV2zHFW2q6_yg@mail.gmail.com>
	<CAFz7pMuQTdUBmOOB7aPrgkDNZvQTn_jfantfLQQVWoerD=D2Kg@mail.gmail.com>
	<F9930B98-BBCC-4B4D-B938-AE2CFB7721AD@taoeffect.com>
Message-ID: <CAFz7pMvk5acuXRXPiMwo63A=RgdnhFXrMWmED3JLXXP5BPMf6g@mail.gmail.com>

On Wed, Jun 7, 2017 at 5:27 PM Tao Effect <contact at taoeffect.com> wrote:

> Nick,
>
> Please don't spread misinformation. Whatever you think of the DAO hard
> fork, it's a simple fact that the Ethereum ledger was not edited.
>
>
> This sort of email is unhelpful to this conversation, and it certainly
> doesn't help with the perception that Ethereum is nothing but a bunch of
> hypocritical Bankers 2.0.
>


>
> Everyone knows you didn't edit Ethereum Classic, but the the hard fork,
> which was re-branded as Ethereum, was edited.
>

That's not what I was suggesting. My point is that the ledger was never
edited. An 'irregular state change' was added at a specific block height,
but the ledger remains inviolate.

I'm sure I don't have to explain the difference between the ledger and the
state to you, or why it's significant that the ledger wasn't (and can't be,
practically) modified.

-Nick


> - Greg
>
> --
> Please do not email me anything that you are not comfortable also sharing with
> the NSA.
>
> On Jun 7, 2017, at 6:25 AM, Nick Johnson <nick at ethereum.org> wrote:
>
> On Wed, Jun 7, 2017 at 12:02 AM Gregory Maxwell via bitcoin-dev <
> bitcoin-dev at lists.linuxfoundation.org> wrote:
>
>> On Tue, Jun 6, 2017 at 10:39 PM, Tao Effect via bitcoin-dev
>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>> > I believe the severity of replay attacks is going unvoiced and is not
>> > understood within the bitcoin community because of their lack of
>> experience
>> > with them.
>>
>> Please don't insult our community-- the issues with replay were
>> pointed out by us to Ethereum in advance and were cited specifically
>> in prior hardfork discussions long before Ethereum started editing
>> their ledger for the economic benefit of its centralized
>> administrators.
>
>
> Please don't spread misinformation. Whatever you think of the DAO hard
> fork, it's a simple fact that the Ethereum ledger was not edited.
>
> -Nick Johnson
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170607/480f3051/attachment.html>

From jacob.eliosoff at gmail.com  Wed Jun  7 19:39:48 2017
From: jacob.eliosoff at gmail.com (Jacob Eliosoff)
Date: Wed, 7 Jun 2017 15:39:48 -0400
Subject: [bitcoin-dev] User Activated Soft Fork Split Protection
In-Reply-To: <CAJowKgK52vo8c2v2AoSMoTzdL_YsHPNGZqJOy1HWPRdBPTb1uw@mail.gmail.com>
References: <CADvTj4qpH-t5Gx6qyn3yToyUE_GFaBE989=AWNHLKMpMNW3R+w@mail.gmail.com>
	<AE5BA251-9DA6-4E34-A748-11C8CF91977C@taoeffect.com>
	<CADvTj4q+oOS=DKfpiNQ6PAbksQfa1gKNfokr2Zc6PNGWqLyL4A@mail.gmail.com>
	<0CDEF5A2-0BAF-46E4-8906-39D4724AF3F2@taoeffect.com>
	<CADvTj4oJr38V+b=96pt7GiaMMSPujsz9wQ-5wmgM=rvWUC8Dkw@mail.gmail.com>
	<CAJowKgJi-68G5Xy1_8n_BOX5e8myj08_SPiFu+cdWsRD4DNy4w@mail.gmail.com>
	<CAAUaCyiKs9cDa6vC=8VpyT8vY5L8U0=H=+N48dJzLn1GMj3dmA@mail.gmail.com>
	<CAJowKgK52vo8c2v2AoSMoTzdL_YsHPNGZqJOy1HWPRdBPTb1uw@mail.gmail.com>
Message-ID: <CAAUaCyibZcVQNfA_k+0e2AmjUqNZgkXRmG8GweaK9dRQiiprEg@mail.gmail.com>

You're missing my point.  "As soon as a simple majority supports it" - what
is "it"?  BIP148?  Or "deferring to the miner consensus on BIP148"?  It's
the difference between supporting one side of a vote, vs supporting
deferral to the outcome of the vote.

Or if you mean, the safe thing for miners is to orphan non-segwit blocks
Aug 1 *regardless* of the miner consensus (since the economic consensus
might differ), then there's zero need for this BIP: they should just run
BIP148.

As I said: this BIP should be corrected to only orphan if >50% signal for
BIP148.  Or, define two bits, one meaning "I support BIP148," the other "I
will go w/ the miner majority on BIP148."  Fudging them this way is
deceptive.


On Jun 7, 2017 2:05 PM, "Erik Aronesty" <erik at q32.com> wrote:

> But passing it off as the safest defense is bad faith.

Without this option, a miner has to guess whether a split will be
economically impacting.   With this option, his miner will automatically
switch to the chain least likely to get wiped out... as soon as a simple
majority of miners supports it.


On Wed, Jun 7, 2017 at 12:44 PM, Jacob Eliosoff <jacob.eliosoff at gmail.com>
wrote:

> This is not the safest defense against a split.  If 70% of miners run
> "splitprotection", and 0.1% run BIP148, there's no "safety"/"defense"
> reason for splitprotection to activate segwit.  It should only do so if
> *BIP148* support (NB: not just segwit support!) >50%.
>
> The truly defensive logic is "If the majority supports orphaning
> non-segwit blocks starting Aug 1, I'll join them."
>
> If the real goal of this BIP is to induce miners to run segwit, then fair
> enough.  But passing it off as the safest defense is bad faith.
>
>
> On Wed, Jun 7, 2017 at 10:10 AM, Erik Aronesty via bitcoin-dev <
> bitcoin-dev at lists.linuxfoundation.org> wrote:
>
>> This is, by far, the safest way for miners to quickly defend against a
>> chain split, much better than a -bip148 option.   This allows miners to
>> defend themselves, with very little risk, since the defense is only
>> activated if the majority of miners do so. I would move for a very rapid
>> deployment.   Only miners would need to upgrade.   Regular users would not
>> have to concern themselves with this release.
>>
>> On Wed, Jun 7, 2017 at 6:13 AM, James Hilliard via bitcoin-dev <
>> bitcoin-dev at lists.linuxfoundation.org> wrote:
>>
>>> I think even 55% would probably work out fine simply due to incentive
>>> structures, once signalling is over 51% it's then clear to miners that
>>> non-signalling blocks will be orphaned and the rest will rapidly
>>> update to splitprotection/BIP148. The purpose of this BIP is to reduce
>>> chain split risk for BIP148 since it's looking like BIP148 is going to
>>> be run by a non-insignificant percentage of the economy at a minimum.
>>>
>>> On Wed, Jun 7, 2017 at 12:20 AM, Tao Effect <contact at taoeffect.com>
>>> wrote:
>>> > See thread on replay attacks for why activating regardless of
>>> threshold is a
>>> > bad idea [1].
>>> >
>>> > BIP91 OTOH seems perfectly reasonable. 80% instead of 95% makes it more
>>> > difficult for miners to hold together in opposition to Core. It gives
>>> Core
>>> > more leverage in negotiations.
>>> >
>>> > If they don't activate with 80%, Core can release another BIP to
>>> reduce it
>>> > to 75%.
>>> >
>>> > Each threshold reduction makes it both more likely to succeed, but also
>>> > increases the likelihood of harm to the ecosystem.
>>> >
>>> > Cheers,
>>> > Greg
>>> >
>>> > [1]
>>> > https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017
>>> -June/014497.html
>>> >
>>> > --
>>> > Please do not email me anything that you are not comfortable also
>>> sharing
>>> > with the NSA.
>>> >
>>> > On Jun 6, 2017, at 6:54 PM, James Hilliard <james.hilliard1 at gmail.com>
>>> > wrote:
>>> >
>>> > This is a BIP8 style soft fork so mandatory signalling will be active
>>> > after Aug 1st regardless.
>>> >
>>> > On Tue, Jun 6, 2017 at 8:51 PM, Tao Effect <contact at taoeffect.com>
>>> wrote:
>>> >
>>> > What is the probability that a 65% threshold is too low and can allow a
>>> > "surprise miner attack", whereby miners are kept offline before the
>>> > deadline, and brought online immediately after, creating potential
>>> havoc?
>>> >
>>> > (Nit: "simple majority" usually refers to >50%, I think, might cause
>>> > confusion.)
>>> >
>>> > -Greg Slepak
>>> >
>>> > --
>>> > Please do not email me anything that you are not comfortable also
>>> sharing
>>> > with the NSA.
>>> >
>>> > On Jun 6, 2017, at 5:56 PM, James Hilliard via bitcoin-dev
>>> > <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>> >
>>> > Due to the proposed calendar(https://segwit2x.github.io/) for the
>>> > SegWit2x agreement being too slow to activate SegWit mandatory
>>> > signalling ahead of BIP148 using BIP91 I would like to propose another
>>> > option that miners can use to prevent a chain split ahead of the Aug
>>> > 1st BIP148 activation date.
>>> >
>>> > The splitprotection soft fork is essentially BIP91 but using BIP8
>>> > instead of BIP9 with a lower activation threshold and immediate
>>> > mandatory signalling lock-in. This allows for a majority of miners to
>>> > activate mandatory SegWit signalling and prevent a potential chain
>>> > split ahead of BIP148 activation.
>>> >
>>> > This BIP allows for miners to respond to market forces quickly ahead
>>> > of BIP148 activation by signalling for splitprotection. Any miners
>>> > already running BIP148 should be encouraged to use splitprotection.
>>> >
>>> > <pre>
>>> > BIP: splitprotection
>>> > Layer: Consensus (soft fork)
>>> > Title: User Activated Soft Fork Split Protection
>>> > Author: James Hilliard <james.hilliard1 at gmail.com>
>>> > Comments-Summary: No comments yet.
>>> > Comments-URI:
>>> > Status: Draft
>>> > Type: Standards Track
>>> > Created: 2017-05-22
>>> > License: BSD-3-Clause
>>> >          CC0-1.0
>>> > </pre>
>>> >
>>> > ==Abstract==
>>> >
>>> > This document specifies a coordination mechanism for a simple majority
>>> > of miners to prevent a chain split ahead of BIP148 activation.
>>> >
>>> > ==Definitions==
>>> >
>>> > "existing segwit deployment" refer to the BIP9 "segwit" deployment
>>> > using bit 1, between November 15th 2016 and November 15th 2017 to
>>> > activate BIP141, BIP143 and BIP147.
>>> >
>>> > ==Motivation==
>>> >
>>> > The biggest risk of BIP148 is an extended chain split, this BIP
>>> > provides a way for a simple majority of miners to eliminate that risk.
>>> >
>>> > This BIP provides a way for a simple majority of miners to coordinate
>>> > activation of the existing segwit deployment with less than 95%
>>> > hashpower before BIP148 activation. Due to time constraints unless
>>> > immediately deployed BIP91 will likely not be able to enforce
>>> > mandatory signalling of segwit before the Aug 1st activation of
>>> > BIP148. This BIP provides a method for rapid miner activation of
>>> > SegWit mandatory signalling ahead of the BIP148 activation date. Since
>>> > the primary goal of this BIP is to reduce the chance of an extended
>>> > chain split as much as possible we activate using a simple miner
>>> > majority of 65% over a 504 block interval rather than a higher
>>> > percentage. This BIP also allows miners to signal their intention to
>>> > run BIP148 in order to prevent a chain split.
>>> >
>>> > ==Specification==
>>> >
>>> > While this BIP is active, all blocks must set the nVersion header top
>>> > 3 bits to 001 together with bit field (1<<1) (according to the
>>> > existing segwit deployment). Blocks that do not signal as required
>>> > will be rejected.
>>> >
>>> > ==Deployment==
>>> >
>>> > This BIP will be deployed by "version bits" with a 65%(this can be
>>> > adjusted if desired) activation threshold BIP9 with the name
>>> > "splitprotecion" and using bit 2.
>>> >
>>> > This BIP starts immediately and is a BIP8 style soft fork since
>>> > mandatory signalling will start on midnight August 1st 2017 (epoch
>>> > time 1501545600) regardless of whether or not this BIP has reached its
>>> > own signalling threshold. This BIP will cease to be active when segwit
>>> > is locked-in.
>>> >
>>> > === Reference implementation ===
>>> >
>>> > <pre>
>>> > // Check if Segregated Witness is Locked In
>>> > bool IsWitnessLockedIn(const CBlockIndex* pindexPrev, const
>>> > Consensus::Params& params)
>>> > {
>>> >   LOCK(cs_main);
>>> >   return (VersionBitsState(pindexPrev, params,
>>> > Consensus::DEPLOYMENT_SEGWIT, versionbitscache) ==
>>> > THRESHOLD_LOCKED_IN);
>>> > }
>>> >
>>> > // SPLITPROTECTION mandatory segwit signalling.
>>> > if ( VersionBitsState(pindex->pprev, chainparams.GetConsensus(),
>>> > Consensus::DEPLOYMENT_SPLITPROTECTION, versionbitscache) ==
>>> > THRESHOLD_LOCKED_IN &&
>>> >    !IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
>>> > // Segwit is not locked in
>>> >    !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus()) ) //
>>> > and is not active.
>>> > {
>>> >   bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
>>> > VERSIONBITS_TOP_BITS;
>>> >   bool fSegbit = (pindex->nVersion &
>>> > VersionBitsMask(chainparams.GetConsensus(),
>>> > Consensus::DEPLOYMENT_SEGWIT)) != 0;
>>> >   if (!(fVersionBits && fSegbit)) {
>>> >       return state.DoS(0, error("ConnectBlock(): relayed block must
>>> > signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
>>> >   }
>>> > }
>>> >
>>> > // BIP148 mandatory segwit signalling.
>>> > int64_t nMedianTimePast = pindex->GetMedianTimePast();
>>> > if ( (nMedianTimePast >= 1501545600) &&  // Tue 01 Aug 2017 00:00:00
>>> UTC
>>> >    (nMedianTimePast <= 1510704000) &&  // Wed 15 Nov 2017 00:00:00 UTC
>>> >    (!IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
>>> > // Segwit is not locked in
>>> >     !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus())) )
>>> > // and is not active.
>>> > {
>>> >   bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
>>> > VERSIONBITS_TOP_BITS;
>>> >   bool fSegbit = (pindex->nVersion &
>>> > VersionBitsMask(chainparams.GetConsensus(),
>>> > Consensus::DEPLOYMENT_SEGWIT)) != 0;
>>> >   if (!(fVersionBits && fSegbit)) {
>>> >       return state.DoS(0, error("ConnectBlock(): relayed block must
>>> > signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
>>> >   }
>>> > }
>>> > </pre>
>>> >
>>> > https://github.com/bitcoin/bitcoin/compare/0.14...jameshilli
>>> ard:splitprotection-v0.14.1
>>> >
>>> > ==Backwards Compatibility==
>>> >
>>> > This deployment is compatible with the existing "segwit" bit 1
>>> > deployment scheduled between midnight November 15th, 2016 and midnight
>>> > November 15th, 2017. This deployment is also compatible with the
>>> > existing BIP148 deployment. This BIP is compatible with BIP91 only if
>>> > BIP91 activates before it and before BIP148. Miners will need to
>>> > upgrade their nodes to support splitprotection otherwise they may
>>> > build on top of an invalid block. While this bip is active users
>>> > should either upgrade to splitprotection or wait for additional
>>> > confirmations when accepting payments.
>>> >
>>> > ==Rationale==
>>> >
>>> > Historically we have used IsSuperMajority() to activate soft forks
>>> > such as BIP66 which has a mandatory signalling requirement for miners
>>> > once activated, this ensures that miners are aware of new rules being
>>> > enforced. This technique can be leveraged to lower the signalling
>>> > threshold of a soft fork while it is in the process of being deployed
>>> > in a backwards compatible way. We also use a BIP8 style timeout to
>>> > ensure that this BIP is compatible with BIP148 and that BIP148
>>> > compatible mandatory signalling activates regardless of miner
>>> > signalling levels.
>>> >
>>> > By orphaning non-signalling blocks during the BIP9 bit 1 "segwit"
>>> > deployment, this BIP can cause the existing "segwit" deployment to
>>> > activate without needing to release a new deployment. As we approach
>>> > BIP148 activation it may be desirable for a majority of miners to have
>>> > a method that will ensure that there is no chain split.
>>> >
>>> > ==References==
>>> >
>>> > *[https://lists.linuxfoundation.org/pipermail/bitcoin-dev/20
>>> 17-March/013714.html
>>> > Mailing list discussion]
>>> > *[https://github.com/bitcoin/bitcoin/blob/v0.6.0/src/main.cp
>>> p#L1281-L1283
>>> > P2SH flag day activation]
>>> > *[[bip-0009.mediawiki|BIP9 Version bits with timeout and delay]]
>>> > *[[bip-0016.mediawiki|BIP16 Pay to Script Hash]]
>>> > *[[bip-0091.mediawiki|BIP91 Reduced threshold Segwit MASF]]
>>> > *[[bip-0141.mediawiki|BIP141 Segregated Witness (Consensus layer)]]
>>> > *[[bip-0143.mediawiki|BIP143 Transaction Signature Verification for
>>> > Version 0 Witness Program]]
>>> > *[[bip-0147.mediawiki|BIP147 Dealing with dummy stack element
>>> malleability]]
>>> > *[[bip-0148.mediawiki|BIP148 Mandatory activation of segwit
>>> deployment]]
>>> > *[[bip-0149.mediawiki|BIP149 Segregated Witness (second deployment)]]
>>> > *[https://bitcoincore.org/en/2016/01/26/segwit-benefits/ Segwit
>>> benefits]
>>> >
>>> > ==Copyright==
>>> >
>>> > This document is dual licensed as BSD 3-clause, and Creative Commons
>>> > CC0 1.0 Universal.
>>> > _______________________________________________
>>> > bitcoin-dev mailing list
>>> > bitcoin-dev at lists.linuxfoundation.org
>>> > https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>> >
>>> >
>>> >
>>> _______________________________________________
>>> bitcoin-dev mailing list
>>> bitcoin-dev at lists.linuxfoundation.org
>>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>>
>>
>>
>> _______________________________________________
>> bitcoin-dev mailing list
>> bitcoin-dev at lists.linuxfoundation.org
>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170607/e1a7345e/attachment-0001.html>

From erik at q32.com  Wed Jun  7 19:59:23 2017
From: erik at q32.com (Erik Aronesty)
Date: Wed, 7 Jun 2017 15:59:23 -0400
Subject: [bitcoin-dev] User Activated Soft Fork Split Protection
In-Reply-To: <CAAUaCyibZcVQNfA_k+0e2AmjUqNZgkXRmG8GweaK9dRQiiprEg@mail.gmail.com>
References: <CADvTj4qpH-t5Gx6qyn3yToyUE_GFaBE989=AWNHLKMpMNW3R+w@mail.gmail.com>
	<AE5BA251-9DA6-4E34-A748-11C8CF91977C@taoeffect.com>
	<CADvTj4q+oOS=DKfpiNQ6PAbksQfa1gKNfokr2Zc6PNGWqLyL4A@mail.gmail.com>
	<0CDEF5A2-0BAF-46E4-8906-39D4724AF3F2@taoeffect.com>
	<CADvTj4oJr38V+b=96pt7GiaMMSPujsz9wQ-5wmgM=rvWUC8Dkw@mail.gmail.com>
	<CAJowKgJi-68G5Xy1_8n_BOX5e8myj08_SPiFu+cdWsRD4DNy4w@mail.gmail.com>
	<CAAUaCyiKs9cDa6vC=8VpyT8vY5L8U0=H=+N48dJzLn1GMj3dmA@mail.gmail.com>
	<CAJowKgK52vo8c2v2AoSMoTzdL_YsHPNGZqJOy1HWPRdBPTb1uw@mail.gmail.com>
	<CAAUaCyibZcVQNfA_k+0e2AmjUqNZgkXRmG8GweaK9dRQiiprEg@mail.gmail.com>
Message-ID: <CAJowKgJGQFnAxQ+xKX_EBt7QxP6dx3B0Lg6O0pSdvQ9TAGgopg@mail.gmail.com>

I get it, a threshold could be put in place, but something like 33% would
more accurately reflect the risks miners run.

I'm not aware of a good signal to indicates someone is planning to run
BIP148 and orphan a miner's blocks.



On Wed, Jun 7, 2017 at 3:39 PM, Jacob Eliosoff <jacob.eliosoff at gmail.com>
wrote:

> You're missing my point.  "As soon as a simple majority supports it" -
> what is "it"?  BIP148?  Or "deferring to the miner consensus on BIP148"?
> It's the difference between supporting one side of a vote, vs supporting
> deferral to the outcome of the vote.
>
> Or if you mean, the safe thing for miners is to orphan non-segwit blocks
> Aug 1 *regardless* of the miner consensus (since the economic consensus
> might differ), then there's zero need for this BIP: they should just run
> BIP148.
>
> As I said: this BIP should be corrected to only orphan if >50% signal for
> BIP148.  Or, define two bits, one meaning "I support BIP148," the other "I
> will go w/ the miner majority on BIP148."  Fudging them this way is
> deceptive.
>
>
> On Jun 7, 2017 2:05 PM, "Erik Aronesty" <erik at q32.com> wrote:
>
> > But passing it off as the safest defense is bad faith.
>
> Without this option, a miner has to guess whether a split will be
> economically impacting.   With this option, his miner will automatically
> switch to the chain least likely to get wiped out... as soon as a simple
> majority of miners supports it.
>
>
> On Wed, Jun 7, 2017 at 12:44 PM, Jacob Eliosoff <jacob.eliosoff at gmail.com>
> wrote:
>
>> This is not the safest defense against a split.  If 70% of miners run
>> "splitprotection", and 0.1% run BIP148, there's no "safety"/"defense"
>> reason for splitprotection to activate segwit.  It should only do so if
>> *BIP148* support (NB: not just segwit support!) >50%.
>>
>> The truly defensive logic is "If the majority supports orphaning
>> non-segwit blocks starting Aug 1, I'll join them."
>>
>> If the real goal of this BIP is to induce miners to run segwit, then fair
>> enough.  But passing it off as the safest defense is bad faith.
>>
>>
>> On Wed, Jun 7, 2017 at 10:10 AM, Erik Aronesty via bitcoin-dev <
>> bitcoin-dev at lists.linuxfoundation.org> wrote:
>>
>>> This is, by far, the safest way for miners to quickly defend against a
>>> chain split, much better than a -bip148 option.   This allows miners to
>>> defend themselves, with very little risk, since the defense is only
>>> activated if the majority of miners do so. I would move for a very rapid
>>> deployment.   Only miners would need to upgrade.   Regular users would not
>>> have to concern themselves with this release.
>>>
>>> On Wed, Jun 7, 2017 at 6:13 AM, James Hilliard via bitcoin-dev <
>>> bitcoin-dev at lists.linuxfoundation.org> wrote:
>>>
>>>> I think even 55% would probably work out fine simply due to incentive
>>>> structures, once signalling is over 51% it's then clear to miners that
>>>> non-signalling blocks will be orphaned and the rest will rapidly
>>>> update to splitprotection/BIP148. The purpose of this BIP is to reduce
>>>> chain split risk for BIP148 since it's looking like BIP148 is going to
>>>> be run by a non-insignificant percentage of the economy at a minimum.
>>>>
>>>> On Wed, Jun 7, 2017 at 12:20 AM, Tao Effect <contact at taoeffect.com>
>>>> wrote:
>>>> > See thread on replay attacks for why activating regardless of
>>>> threshold is a
>>>> > bad idea [1].
>>>> >
>>>> > BIP91 OTOH seems perfectly reasonable. 80% instead of 95% makes it
>>>> more
>>>> > difficult for miners to hold together in opposition to Core. It gives
>>>> Core
>>>> > more leverage in negotiations.
>>>> >
>>>> > If they don't activate with 80%, Core can release another BIP to
>>>> reduce it
>>>> > to 75%.
>>>> >
>>>> > Each threshold reduction makes it both more likely to succeed, but
>>>> also
>>>> > increases the likelihood of harm to the ecosystem.
>>>> >
>>>> > Cheers,
>>>> > Greg
>>>> >
>>>> > [1]
>>>> > https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017
>>>> -June/014497.html
>>>> >
>>>> > --
>>>> > Please do not email me anything that you are not comfortable also
>>>> sharing
>>>> > with the NSA.
>>>> >
>>>> > On Jun 6, 2017, at 6:54 PM, James Hilliard <james.hilliard1 at gmail.com
>>>> >
>>>> > wrote:
>>>> >
>>>> > This is a BIP8 style soft fork so mandatory signalling will be active
>>>> > after Aug 1st regardless.
>>>> >
>>>> > On Tue, Jun 6, 2017 at 8:51 PM, Tao Effect <contact at taoeffect.com>
>>>> wrote:
>>>> >
>>>> > What is the probability that a 65% threshold is too low and can allow
>>>> a
>>>> > "surprise miner attack", whereby miners are kept offline before the
>>>> > deadline, and brought online immediately after, creating potential
>>>> havoc?
>>>> >
>>>> > (Nit: "simple majority" usually refers to >50%, I think, might cause
>>>> > confusion.)
>>>> >
>>>> > -Greg Slepak
>>>> >
>>>> > --
>>>> > Please do not email me anything that you are not comfortable also
>>>> sharing
>>>> > with the NSA.
>>>> >
>>>> > On Jun 6, 2017, at 5:56 PM, James Hilliard via bitcoin-dev
>>>> > <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>>> >
>>>> > Due to the proposed calendar(https://segwit2x.github.io/) for the
>>>> > SegWit2x agreement being too slow to activate SegWit mandatory
>>>> > signalling ahead of BIP148 using BIP91 I would like to propose another
>>>> > option that miners can use to prevent a chain split ahead of the Aug
>>>> > 1st BIP148 activation date.
>>>> >
>>>> > The splitprotection soft fork is essentially BIP91 but using BIP8
>>>> > instead of BIP9 with a lower activation threshold and immediate
>>>> > mandatory signalling lock-in. This allows for a majority of miners to
>>>> > activate mandatory SegWit signalling and prevent a potential chain
>>>> > split ahead of BIP148 activation.
>>>> >
>>>> > This BIP allows for miners to respond to market forces quickly ahead
>>>> > of BIP148 activation by signalling for splitprotection. Any miners
>>>> > already running BIP148 should be encouraged to use splitprotection.
>>>> >
>>>> > <pre>
>>>> > BIP: splitprotection
>>>> > Layer: Consensus (soft fork)
>>>> > Title: User Activated Soft Fork Split Protection
>>>> > Author: James Hilliard <james.hilliard1 at gmail.com>
>>>> > Comments-Summary: No comments yet.
>>>> > Comments-URI:
>>>> > Status: Draft
>>>> > Type: Standards Track
>>>> > Created: 2017-05-22
>>>> > License: BSD-3-Clause
>>>> >          CC0-1.0
>>>> > </pre>
>>>> >
>>>> > ==Abstract==
>>>> >
>>>> > This document specifies a coordination mechanism for a simple majority
>>>> > of miners to prevent a chain split ahead of BIP148 activation.
>>>> >
>>>> > ==Definitions==
>>>> >
>>>> > "existing segwit deployment" refer to the BIP9 "segwit" deployment
>>>> > using bit 1, between November 15th 2016 and November 15th 2017 to
>>>> > activate BIP141, BIP143 and BIP147.
>>>> >
>>>> > ==Motivation==
>>>> >
>>>> > The biggest risk of BIP148 is an extended chain split, this BIP
>>>> > provides a way for a simple majority of miners to eliminate that risk.
>>>> >
>>>> > This BIP provides a way for a simple majority of miners to coordinate
>>>> > activation of the existing segwit deployment with less than 95%
>>>> > hashpower before BIP148 activation. Due to time constraints unless
>>>> > immediately deployed BIP91 will likely not be able to enforce
>>>> > mandatory signalling of segwit before the Aug 1st activation of
>>>> > BIP148. This BIP provides a method for rapid miner activation of
>>>> > SegWit mandatory signalling ahead of the BIP148 activation date. Since
>>>> > the primary goal of this BIP is to reduce the chance of an extended
>>>> > chain split as much as possible we activate using a simple miner
>>>> > majority of 65% over a 504 block interval rather than a higher
>>>> > percentage. This BIP also allows miners to signal their intention to
>>>> > run BIP148 in order to prevent a chain split.
>>>> >
>>>> > ==Specification==
>>>> >
>>>> > While this BIP is active, all blocks must set the nVersion header top
>>>> > 3 bits to 001 together with bit field (1<<1) (according to the
>>>> > existing segwit deployment). Blocks that do not signal as required
>>>> > will be rejected.
>>>> >
>>>> > ==Deployment==
>>>> >
>>>> > This BIP will be deployed by "version bits" with a 65%(this can be
>>>> > adjusted if desired) activation threshold BIP9 with the name
>>>> > "splitprotecion" and using bit 2.
>>>> >
>>>> > This BIP starts immediately and is a BIP8 style soft fork since
>>>> > mandatory signalling will start on midnight August 1st 2017 (epoch
>>>> > time 1501545600) regardless of whether or not this BIP has reached its
>>>> > own signalling threshold. This BIP will cease to be active when segwit
>>>> > is locked-in.
>>>> >
>>>> > === Reference implementation ===
>>>> >
>>>> > <pre>
>>>> > // Check if Segregated Witness is Locked In
>>>> > bool IsWitnessLockedIn(const CBlockIndex* pindexPrev, const
>>>> > Consensus::Params& params)
>>>> > {
>>>> >   LOCK(cs_main);
>>>> >   return (VersionBitsState(pindexPrev, params,
>>>> > Consensus::DEPLOYMENT_SEGWIT, versionbitscache) ==
>>>> > THRESHOLD_LOCKED_IN);
>>>> > }
>>>> >
>>>> > // SPLITPROTECTION mandatory segwit signalling.
>>>> > if ( VersionBitsState(pindex->pprev, chainparams.GetConsensus(),
>>>> > Consensus::DEPLOYMENT_SPLITPROTECTION, versionbitscache) ==
>>>> > THRESHOLD_LOCKED_IN &&
>>>> >    !IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
>>>> > // Segwit is not locked in
>>>> >    !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus()) ) //
>>>> > and is not active.
>>>> > {
>>>> >   bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
>>>> > VERSIONBITS_TOP_BITS;
>>>> >   bool fSegbit = (pindex->nVersion &
>>>> > VersionBitsMask(chainparams.GetConsensus(),
>>>> > Consensus::DEPLOYMENT_SEGWIT)) != 0;
>>>> >   if (!(fVersionBits && fSegbit)) {
>>>> >       return state.DoS(0, error("ConnectBlock(): relayed block must
>>>> > signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
>>>> >   }
>>>> > }
>>>> >
>>>> > // BIP148 mandatory segwit signalling.
>>>> > int64_t nMedianTimePast = pindex->GetMedianTimePast();
>>>> > if ( (nMedianTimePast >= 1501545600) &&  // Tue 01 Aug 2017 00:00:00
>>>> UTC
>>>> >    (nMedianTimePast <= 1510704000) &&  // Wed 15 Nov 2017 00:00:00 UTC
>>>> >    (!IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
>>>> > // Segwit is not locked in
>>>> >     !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus())) )
>>>> > // and is not active.
>>>> > {
>>>> >   bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
>>>> > VERSIONBITS_TOP_BITS;
>>>> >   bool fSegbit = (pindex->nVersion &
>>>> > VersionBitsMask(chainparams.GetConsensus(),
>>>> > Consensus::DEPLOYMENT_SEGWIT)) != 0;
>>>> >   if (!(fVersionBits && fSegbit)) {
>>>> >       return state.DoS(0, error("ConnectBlock(): relayed block must
>>>> > signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
>>>> >   }
>>>> > }
>>>> > </pre>
>>>> >
>>>> > https://github.com/bitcoin/bitcoin/compare/0.14...jameshilli
>>>> ard:splitprotection-v0.14.1
>>>> >
>>>> > ==Backwards Compatibility==
>>>> >
>>>> > This deployment is compatible with the existing "segwit" bit 1
>>>> > deployment scheduled between midnight November 15th, 2016 and midnight
>>>> > November 15th, 2017. This deployment is also compatible with the
>>>> > existing BIP148 deployment. This BIP is compatible with BIP91 only if
>>>> > BIP91 activates before it and before BIP148. Miners will need to
>>>> > upgrade their nodes to support splitprotection otherwise they may
>>>> > build on top of an invalid block. While this bip is active users
>>>> > should either upgrade to splitprotection or wait for additional
>>>> > confirmations when accepting payments.
>>>> >
>>>> > ==Rationale==
>>>> >
>>>> > Historically we have used IsSuperMajority() to activate soft forks
>>>> > such as BIP66 which has a mandatory signalling requirement for miners
>>>> > once activated, this ensures that miners are aware of new rules being
>>>> > enforced. This technique can be leveraged to lower the signalling
>>>> > threshold of a soft fork while it is in the process of being deployed
>>>> > in a backwards compatible way. We also use a BIP8 style timeout to
>>>> > ensure that this BIP is compatible with BIP148 and that BIP148
>>>> > compatible mandatory signalling activates regardless of miner
>>>> > signalling levels.
>>>> >
>>>> > By orphaning non-signalling blocks during the BIP9 bit 1 "segwit"
>>>> > deployment, this BIP can cause the existing "segwit" deployment to
>>>> > activate without needing to release a new deployment. As we approach
>>>> > BIP148 activation it may be desirable for a majority of miners to have
>>>> > a method that will ensure that there is no chain split.
>>>> >
>>>> > ==References==
>>>> >
>>>> > *[https://lists.linuxfoundation.org/pipermail/bitcoin-dev/20
>>>> 17-March/013714.html
>>>> > Mailing list discussion]
>>>> > *[https://github.com/bitcoin/bitcoin/blob/v0.6.0/src/main.cp
>>>> p#L1281-L1283
>>>> > P2SH flag day activation]
>>>> > *[[bip-0009.mediawiki|BIP9 Version bits with timeout and delay]]
>>>> > *[[bip-0016.mediawiki|BIP16 Pay to Script Hash]]
>>>> > *[[bip-0091.mediawiki|BIP91 Reduced threshold Segwit MASF]]
>>>> > *[[bip-0141.mediawiki|BIP141 Segregated Witness (Consensus layer)]]
>>>> > *[[bip-0143.mediawiki|BIP143 Transaction Signature Verification for
>>>> > Version 0 Witness Program]]
>>>> > *[[bip-0147.mediawiki|BIP147 Dealing with dummy stack element
>>>> malleability]]
>>>> > *[[bip-0148.mediawiki|BIP148 Mandatory activation of segwit
>>>> deployment]]
>>>> > *[[bip-0149.mediawiki|BIP149 Segregated Witness (second deployment)]]
>>>> > *[https://bitcoincore.org/en/2016/01/26/segwit-benefits/ Segwit
>>>> benefits]
>>>> >
>>>> > ==Copyright==
>>>> >
>>>> > This document is dual licensed as BSD 3-clause, and Creative Commons
>>>> > CC0 1.0 Universal.
>>>> > _______________________________________________
>>>> > bitcoin-dev mailing list
>>>> > bitcoin-dev at lists.linuxfoundation.org
>>>> > https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>>> >
>>>> >
>>>> >
>>>> _______________________________________________
>>>> bitcoin-dev mailing list
>>>> bitcoin-dev at lists.linuxfoundation.org
>>>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>>>
>>>
>>>
>>> _______________________________________________
>>> bitcoin-dev mailing list
>>> bitcoin-dev at lists.linuxfoundation.org
>>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>>
>>>
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170607/6c509d1f/attachment-0001.html>

From james.hilliard1 at gmail.com  Wed Jun  7 21:21:29 2017
From: james.hilliard1 at gmail.com (James Hilliard)
Date: Wed, 7 Jun 2017 16:21:29 -0500
Subject: [bitcoin-dev] User Activated Soft Fork Split Protection
In-Reply-To: <CAD1TkXvaNq8wBsDdbYG4Qwn9YY=tXw8kPQQ2=B4nLKPdq3fsWg@mail.gmail.com>
References: <CADvTj4qpH-t5Gx6qyn3yToyUE_GFaBE989=AWNHLKMpMNW3R+w@mail.gmail.com>
	<AE5BA251-9DA6-4E34-A748-11C8CF91977C@taoeffect.com>
	<CADvTj4q+oOS=DKfpiNQ6PAbksQfa1gKNfokr2Zc6PNGWqLyL4A@mail.gmail.com>
	<0CDEF5A2-0BAF-46E4-8906-39D4724AF3F2@taoeffect.com>
	<CADvTj4oJr38V+b=96pt7GiaMMSPujsz9wQ-5wmgM=rvWUC8Dkw@mail.gmail.com>
	<CAJowKgJi-68G5Xy1_8n_BOX5e8myj08_SPiFu+cdWsRD4DNy4w@mail.gmail.com>
	<CAD1TkXvaNq8wBsDdbYG4Qwn9YY=tXw8kPQQ2=B4nLKPdq3fsWg@mail.gmail.com>
Message-ID: <CADvTj4pEGoMUN_fn1bywzhV-WkRP7sQ6fofXKsYJsYjq329b9g@mail.gmail.com>

Keep in mind that this is only temporary until segwit has locked in,
after that happens it becomes optional for miners again.

On Wed, Jun 7, 2017 at 4:09 PM, Jared Lee Richardson <jaredr26 at gmail.com> wrote:
>> This is, by far, the safest way for miners to quickly defend against a chain split, much better than a -bip148 option.   This allows miners to defend themselves, with very little risk, since the defense is only activated if the majority of miners do so. I would move for a very rapid deployment.   Only miners would need to upgrade.   Regular users would not have to concern themselves with this release.
>
> FYI, even if very successful, this deployment and change may have a
> severe negative impact on a small group of miners.  Any miners/pools
> who are not actively following the forums, news, or these discussions
> may be difficult to reach and communicate with in time, particularly
> with language barriers.  Of those, any who are also either not
> signaling segwit currently or are running an older software version
> will have their blocks continuously and constantly orphaned, but may
> not have any alarms or notifications set up for such an unexpected
> failure.  That may or may not be a worthy consideration, but it is
> definitely brusque and a harsh price to pay.  Considering the
> opposition mentioned against transaction limits for the rare cases
> where a very large transaction has already been signed, it seems that
> this would be worthy of consideration.  For the few miners in that
> situation, it does turn segwit from an optional softfork into a
> punishing hardfork.
>
> I don't think that's a sufficient reason alone to kill the idea, but
> it should be a concern.
>
> Jared
>
> On Wed, Jun 7, 2017 at 7:10 AM, Erik Aronesty via bitcoin-dev
> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>> This is, by far, the safest way for miners to quickly defend against a chain
>> split, much better than a -bip148 option.   This allows miners to defend
>> themselves, with very little risk, since the defense is only activated if
>> the majority of miners do so. I would move for a very rapid deployment.
>> Only miners would need to upgrade.   Regular users would not have to concern
>> themselves with this release.
>>
>> On Wed, Jun 7, 2017 at 6:13 AM, James Hilliard via bitcoin-dev
>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>>
>>> I think even 55% would probably work out fine simply due to incentive
>>> structures, once signalling is over 51% it's then clear to miners that
>>> non-signalling blocks will be orphaned and the rest will rapidly
>>> update to splitprotection/BIP148. The purpose of this BIP is to reduce
>>> chain split risk for BIP148 since it's looking like BIP148 is going to
>>> be run by a non-insignificant percentage of the economy at a minimum.
>>>
>>> On Wed, Jun 7, 2017 at 12:20 AM, Tao Effect <contact at taoeffect.com> wrote:
>>> > See thread on replay attacks for why activating regardless of threshold
>>> > is a
>>> > bad idea [1].
>>> >
>>> > BIP91 OTOH seems perfectly reasonable. 80% instead of 95% makes it more
>>> > difficult for miners to hold together in opposition to Core. It gives
>>> > Core
>>> > more leverage in negotiations.
>>> >
>>> > If they don't activate with 80%, Core can release another BIP to reduce
>>> > it
>>> > to 75%.
>>> >
>>> > Each threshold reduction makes it both more likely to succeed, but also
>>> > increases the likelihood of harm to the ecosystem.
>>> >
>>> > Cheers,
>>> > Greg
>>> >
>>> > [1]
>>> >
>>> > https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-June/014497.html
>>> >
>>> > --
>>> > Please do not email me anything that you are not comfortable also
>>> > sharing
>>> > with the NSA.
>>> >
>>> > On Jun 6, 2017, at 6:54 PM, James Hilliard <james.hilliard1 at gmail.com>
>>> > wrote:
>>> >
>>> > This is a BIP8 style soft fork so mandatory signalling will be active
>>> > after Aug 1st regardless.
>>> >
>>> > On Tue, Jun 6, 2017 at 8:51 PM, Tao Effect <contact at taoeffect.com>
>>> > wrote:
>>> >
>>> > What is the probability that a 65% threshold is too low and can allow a
>>> > "surprise miner attack", whereby miners are kept offline before the
>>> > deadline, and brought online immediately after, creating potential
>>> > havoc?
>>> >
>>> > (Nit: "simple majority" usually refers to >50%, I think, might cause
>>> > confusion.)
>>> >
>>> > -Greg Slepak
>>> >
>>> > --
>>> > Please do not email me anything that you are not comfortable also
>>> > sharing
>>> > with the NSA.
>>> >
>>> > On Jun 6, 2017, at 5:56 PM, James Hilliard via bitcoin-dev
>>> > <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>> >
>>> > Due to the proposed calendar(https://segwit2x.github.io/) for the
>>> > SegWit2x agreement being too slow to activate SegWit mandatory
>>> > signalling ahead of BIP148 using BIP91 I would like to propose another
>>> > option that miners can use to prevent a chain split ahead of the Aug
>>> > 1st BIP148 activation date.
>>> >
>>> > The splitprotection soft fork is essentially BIP91 but using BIP8
>>> > instead of BIP9 with a lower activation threshold and immediate
>>> > mandatory signalling lock-in. This allows for a majority of miners to
>>> > activate mandatory SegWit signalling and prevent a potential chain
>>> > split ahead of BIP148 activation.
>>> >
>>> > This BIP allows for miners to respond to market forces quickly ahead
>>> > of BIP148 activation by signalling for splitprotection. Any miners
>>> > already running BIP148 should be encouraged to use splitprotection.
>>> >
>>> > <pre>
>>> > BIP: splitprotection
>>> > Layer: Consensus (soft fork)
>>> > Title: User Activated Soft Fork Split Protection
>>> > Author: James Hilliard <james.hilliard1 at gmail.com>
>>> > Comments-Summary: No comments yet.
>>> > Comments-URI:
>>> > Status: Draft
>>> > Type: Standards Track
>>> > Created: 2017-05-22
>>> > License: BSD-3-Clause
>>> >          CC0-1.0
>>> > </pre>
>>> >
>>> > ==Abstract==
>>> >
>>> > This document specifies a coordination mechanism for a simple majority
>>> > of miners to prevent a chain split ahead of BIP148 activation.
>>> >
>>> > ==Definitions==
>>> >
>>> > "existing segwit deployment" refer to the BIP9 "segwit" deployment
>>> > using bit 1, between November 15th 2016 and November 15th 2017 to
>>> > activate BIP141, BIP143 and BIP147.
>>> >
>>> > ==Motivation==
>>> >
>>> > The biggest risk of BIP148 is an extended chain split, this BIP
>>> > provides a way for a simple majority of miners to eliminate that risk.
>>> >
>>> > This BIP provides a way for a simple majority of miners to coordinate
>>> > activation of the existing segwit deployment with less than 95%
>>> > hashpower before BIP148 activation. Due to time constraints unless
>>> > immediately deployed BIP91 will likely not be able to enforce
>>> > mandatory signalling of segwit before the Aug 1st activation of
>>> > BIP148. This BIP provides a method for rapid miner activation of
>>> > SegWit mandatory signalling ahead of the BIP148 activation date. Since
>>> > the primary goal of this BIP is to reduce the chance of an extended
>>> > chain split as much as possible we activate using a simple miner
>>> > majority of 65% over a 504 block interval rather than a higher
>>> > percentage. This BIP also allows miners to signal their intention to
>>> > run BIP148 in order to prevent a chain split.
>>> >
>>> > ==Specification==
>>> >
>>> > While this BIP is active, all blocks must set the nVersion header top
>>> > 3 bits to 001 together with bit field (1<<1) (according to the
>>> > existing segwit deployment). Blocks that do not signal as required
>>> > will be rejected.
>>> >
>>> > ==Deployment==
>>> >
>>> > This BIP will be deployed by "version bits" with a 65%(this can be
>>> > adjusted if desired) activation threshold BIP9 with the name
>>> > "splitprotecion" and using bit 2.
>>> >
>>> > This BIP starts immediately and is a BIP8 style soft fork since
>>> > mandatory signalling will start on midnight August 1st 2017 (epoch
>>> > time 1501545600) regardless of whether or not this BIP has reached its
>>> > own signalling threshold. This BIP will cease to be active when segwit
>>> > is locked-in.
>>> >
>>> > === Reference implementation ===
>>> >
>>> > <pre>
>>> > // Check if Segregated Witness is Locked In
>>> > bool IsWitnessLockedIn(const CBlockIndex* pindexPrev, const
>>> > Consensus::Params& params)
>>> > {
>>> >   LOCK(cs_main);
>>> >   return (VersionBitsState(pindexPrev, params,
>>> > Consensus::DEPLOYMENT_SEGWIT, versionbitscache) ==
>>> > THRESHOLD_LOCKED_IN);
>>> > }
>>> >
>>> > // SPLITPROTECTION mandatory segwit signalling.
>>> > if ( VersionBitsState(pindex->pprev, chainparams.GetConsensus(),
>>> > Consensus::DEPLOYMENT_SPLITPROTECTION, versionbitscache) ==
>>> > THRESHOLD_LOCKED_IN &&
>>> >    !IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
>>> > // Segwit is not locked in
>>> >    !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus()) ) //
>>> > and is not active.
>>> > {
>>> >   bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
>>> > VERSIONBITS_TOP_BITS;
>>> >   bool fSegbit = (pindex->nVersion &
>>> > VersionBitsMask(chainparams.GetConsensus(),
>>> > Consensus::DEPLOYMENT_SEGWIT)) != 0;
>>> >   if (!(fVersionBits && fSegbit)) {
>>> >       return state.DoS(0, error("ConnectBlock(): relayed block must
>>> > signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
>>> >   }
>>> > }
>>> >
>>> > // BIP148 mandatory segwit signalling.
>>> > int64_t nMedianTimePast = pindex->GetMedianTimePast();
>>> > if ( (nMedianTimePast >= 1501545600) &&  // Tue 01 Aug 2017 00:00:00 UTC
>>> >    (nMedianTimePast <= 1510704000) &&  // Wed 15 Nov 2017 00:00:00 UTC
>>> >    (!IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
>>> > // Segwit is not locked in
>>> >     !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus())) )
>>> > // and is not active.
>>> > {
>>> >   bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
>>> > VERSIONBITS_TOP_BITS;
>>> >   bool fSegbit = (pindex->nVersion &
>>> > VersionBitsMask(chainparams.GetConsensus(),
>>> > Consensus::DEPLOYMENT_SEGWIT)) != 0;
>>> >   if (!(fVersionBits && fSegbit)) {
>>> >       return state.DoS(0, error("ConnectBlock(): relayed block must
>>> > signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
>>> >   }
>>> > }
>>> > </pre>
>>> >
>>> >
>>> > https://github.com/bitcoin/bitcoin/compare/0.14...jameshilliard:splitprotection-v0.14.1
>>> >
>>> > ==Backwards Compatibility==
>>> >
>>> > This deployment is compatible with the existing "segwit" bit 1
>>> > deployment scheduled between midnight November 15th, 2016 and midnight
>>> > November 15th, 2017. This deployment is also compatible with the
>>> > existing BIP148 deployment. This BIP is compatible with BIP91 only if
>>> > BIP91 activates before it and before BIP148. Miners will need to
>>> > upgrade their nodes to support splitprotection otherwise they may
>>> > build on top of an invalid block. While this bip is active users
>>> > should either upgrade to splitprotection or wait for additional
>>> > confirmations when accepting payments.
>>> >
>>> > ==Rationale==
>>> >
>>> > Historically we have used IsSuperMajority() to activate soft forks
>>> > such as BIP66 which has a mandatory signalling requirement for miners
>>> > once activated, this ensures that miners are aware of new rules being
>>> > enforced. This technique can be leveraged to lower the signalling
>>> > threshold of a soft fork while it is in the process of being deployed
>>> > in a backwards compatible way. We also use a BIP8 style timeout to
>>> > ensure that this BIP is compatible with BIP148 and that BIP148
>>> > compatible mandatory signalling activates regardless of miner
>>> > signalling levels.
>>> >
>>> > By orphaning non-signalling blocks during the BIP9 bit 1 "segwit"
>>> > deployment, this BIP can cause the existing "segwit" deployment to
>>> > activate without needing to release a new deployment. As we approach
>>> > BIP148 activation it may be desirable for a majority of miners to have
>>> > a method that will ensure that there is no chain split.
>>> >
>>> > ==References==
>>> >
>>> >
>>> > *[https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-March/013714.html
>>> > Mailing list discussion]
>>> >
>>> > *[https://github.com/bitcoin/bitcoin/blob/v0.6.0/src/main.cpp#L1281-L1283
>>> > P2SH flag day activation]
>>> > *[[bip-0009.mediawiki|BIP9 Version bits with timeout and delay]]
>>> > *[[bip-0016.mediawiki|BIP16 Pay to Script Hash]]
>>> > *[[bip-0091.mediawiki|BIP91 Reduced threshold Segwit MASF]]
>>> > *[[bip-0141.mediawiki|BIP141 Segregated Witness (Consensus layer)]]
>>> > *[[bip-0143.mediawiki|BIP143 Transaction Signature Verification for
>>> > Version 0 Witness Program]]
>>> > *[[bip-0147.mediawiki|BIP147 Dealing with dummy stack element
>>> > malleability]]
>>> > *[[bip-0148.mediawiki|BIP148 Mandatory activation of segwit deployment]]
>>> > *[[bip-0149.mediawiki|BIP149 Segregated Witness (second deployment)]]
>>> > *[https://bitcoincore.org/en/2016/01/26/segwit-benefits/ Segwit
>>> > benefits]
>>> >
>>> > ==Copyright==
>>> >
>>> > This document is dual licensed as BSD 3-clause, and Creative Commons
>>> > CC0 1.0 Universal.
>>> > _______________________________________________
>>> > bitcoin-dev mailing list
>>> > bitcoin-dev at lists.linuxfoundation.org
>>> > https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>> >
>>> >
>>> >
>>> _______________________________________________
>>> bitcoin-dev mailing list
>>> bitcoin-dev at lists.linuxfoundation.org
>>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>
>>
>>
>> _______________________________________________
>> bitcoin-dev mailing list
>> bitcoin-dev at lists.linuxfoundation.org
>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>

From greg at xiph.org  Wed Jun  7 21:41:36 2017
From: greg at xiph.org (Gregory Maxwell)
Date: Wed, 7 Jun 2017 21:41:36 +0000
Subject: [bitcoin-dev] BIP Proposal: Compact Client Side Filtering for
 Light Clients
In-Reply-To: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
References: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
Message-ID: <CAAS2fgRVTfsfXAyHBoBaCqAXpK+=QCFy-Lx3zH=d3tPteu7GcA@mail.gmail.com>

On Thu, Jun 1, 2017 at 7:01 PM, Olaoluwa Osuntokun via bitcoin-dev
<bitcoin-dev at lists.linuxfoundation.org> wrote:
> Hi y'all,
>
> Alex Akselrod and I would like to propose a new light client BIP for
> consideration:
>    * https://github.com/Roasbeef/bips/blob/master/gcs_light_client.mediawiki

I see the inner loop of construction and lookup are free of
non-constant divmod. This will result in implementations being
needlessly slow (especially on arm, but even on modern x86_64 a
division is a 90 cycle-ish affair.)

I believe this can be fixed by using this approach
http://lemire.me/blog/2016/06/27/a-fast-alternative-to-the-modulo-reduction/
   which has the same non-uniformity as mod but needs only a multiply
and shift.

Otherwise fast implementations will have to implement the code to
compute bit twiddling hack exact division code, which is kind of
complicated. (e.g. via the technique in "{N}-bit Unsigned Division via
{N}-bit Multiply-Add" by Arch D. Robison).

Shouldn't all cases in your spec where you have N=transactions be
n=indexed-outputs? Otherwise, I think your golomb parameter and false
positive rate are wrong.

From james.hilliard1 at gmail.com  Wed Jun  7 21:42:52 2017
From: james.hilliard1 at gmail.com (James Hilliard)
Date: Wed, 7 Jun 2017 16:42:52 -0500
Subject: [bitcoin-dev] User Activated Soft Fork Split Protection
In-Reply-To: <CAD1TkXviJouao7YoHjiDN3mTUWFEbMY9mtCqkQ8zp8JthyhT7Q@mail.gmail.com>
References: <CADvTj4qpH-t5Gx6qyn3yToyUE_GFaBE989=AWNHLKMpMNW3R+w@mail.gmail.com>
	<CAD1TkXviJouao7YoHjiDN3mTUWFEbMY9mtCqkQ8zp8JthyhT7Q@mail.gmail.com>
Message-ID: <CADvTj4rz4exYMvBEmYi=bTZDgDm0drLjpRZmZUo17inzCzCRVg@mail.gmail.com>

I don't really see how this would increase the likelihood of an
extended chain split assuming BIP148 is going to have
non-insignificant economic backing. This BIP is designed to provide a
risk mitigation measure that miners can safely deploy. Since this BIP
only activates with a clear miner majority it should not increase the
risk of an extended chain split. At this point it is not completely
clear how much economic support there is for BIP148 but support
certainly seems to be growing and we have nearly 2 months until BIP148
activation. I intentionally used a shorter activation period here so
that decisions by miners can be made close to the BIP148 activation
date.

On Wed, Jun 7, 2017 at 4:29 PM, Jared Lee Richardson <jaredr26 at gmail.com> wrote:
> I think this BIP represents a gamble, and the gamble may not be a good
> one.  The gamble here is that if the segwit2x changes are rolled out
> on time, and if the signatories accept the bit4 + bit1 signaling
> proposals within BIP91, the launch will go smoother, as intended.  But
> conversely, if either the segwit2x signatories balk about the Bit1
> signaling OR if the timelines for segwit2mb are missed even by a bit,
> it may cause the BIP148 chainsplit to be worse than it would be
> without.  Given the frequent concerns raised in multiple places about
> the aggressiveness of the segwit2x timelines, including the
> non-hardfork timelines, this does not seem like a great gamble to be
> making.
>
> The reason I say it may make the chainsplit be worse than it would
> otherwise be is that it may provide a false sense of safety for BIP148
> that currently does not currently exist(and should not, as it is a
> chainsplit).  That sense of safety would only be legitimate if the
> segwit2x signatories were on board, and the segwit2x code effectively
> enforced BIP148 simultaneously, neither of which are guaranteed.  If
> users and more miners had a false sense that BIP148 was *not* going to
> chainsplit from default / segwit2x, they might not follow the news if
> suddenly the segwit2x plan were delayed for a few days.  While any
> additional support would definitely be cheered on by BIP148
> supporters, the practical reality might be that this proposal would
> take BIP148 from the "unlikely to have any viable chain after flag day
> without segwit2x" category into the "small but viable minority chain"
> category, and even worse, it might strengthen the chainsplit just days
> before segwit is activated on BOTH chains, putting the BIP148
> supporters on the wrong pro-segwit, but still-viable chain.
>
> If Core had taken a strong stance to include BIP148 into the client,
> and if BIP148 support were much much broader, I would feel differently
> as the gamble would be more likely to discourage a chainsplit (By
> forcing the acceleration of segwit2x) rather than encourage it (by
> strengthening an extreme minority chainsplit that may wind up on the
> wrong side of two segwit-activated chains).  As it stands now, this
> seems like a very dangerous attempt to compromise with a small but
> vocal group that are the ones creating the threat to begin with.
>
> Jared
>
> On Tue, Jun 6, 2017 at 5:56 PM, James Hilliard via bitcoin-dev
> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>> Due to the proposed calendar(https://segwit2x.github.io/) for the
>> SegWit2x agreement being too slow to activate SegWit mandatory
>> signalling ahead of BIP148 using BIP91 I would like to propose another
>> option that miners can use to prevent a chain split ahead of the Aug
>> 1st BIP148 activation date.
>>
>> The splitprotection soft fork is essentially BIP91 but using BIP8
>> instead of BIP9 with a lower activation threshold and immediate
>> mandatory signalling lock-in. This allows for a majority of miners to
>> activate mandatory SegWit signalling and prevent a potential chain
>> split ahead of BIP148 activation.
>>
>> This BIP allows for miners to respond to market forces quickly ahead
>> of BIP148 activation by signalling for splitprotection. Any miners
>> already running BIP148 should be encouraged to use splitprotection.
>>
>> <pre>
>>   BIP: splitprotection
>>   Layer: Consensus (soft fork)
>>   Title: User Activated Soft Fork Split Protection
>>   Author: James Hilliard <james.hilliard1 at gmail.com>
>>   Comments-Summary: No comments yet.
>>   Comments-URI:
>>   Status: Draft
>>   Type: Standards Track
>>   Created: 2017-05-22
>>   License: BSD-3-Clause
>>            CC0-1.0
>> </pre>
>>
>> ==Abstract==
>>
>> This document specifies a coordination mechanism for a simple majority
>> of miners to prevent a chain split ahead of BIP148 activation.
>>
>> ==Definitions==
>>
>> "existing segwit deployment" refer to the BIP9 "segwit" deployment
>> using bit 1, between November 15th 2016 and November 15th 2017 to
>> activate BIP141, BIP143 and BIP147.
>>
>> ==Motivation==
>>
>> The biggest risk of BIP148 is an extended chain split, this BIP
>> provides a way for a simple majority of miners to eliminate that risk.
>>
>> This BIP provides a way for a simple majority of miners to coordinate
>> activation of the existing segwit deployment with less than 95%
>> hashpower before BIP148 activation. Due to time constraints unless
>> immediately deployed BIP91 will likely not be able to enforce
>> mandatory signalling of segwit before the Aug 1st activation of
>> BIP148. This BIP provides a method for rapid miner activation of
>> SegWit mandatory signalling ahead of the BIP148 activation date. Since
>> the primary goal of this BIP is to reduce the chance of an extended
>> chain split as much as possible we activate using a simple miner
>> majority of 65% over a 504 block interval rather than a higher
>> percentage. This BIP also allows miners to signal their intention to
>> run BIP148 in order to prevent a chain split.
>>
>> ==Specification==
>>
>> While this BIP is active, all blocks must set the nVersion header top
>> 3 bits to 001 together with bit field (1<<1) (according to the
>> existing segwit deployment). Blocks that do not signal as required
>> will be rejected.
>>
>> ==Deployment==
>>
>> This BIP will be deployed by "version bits" with a 65%(this can be
>> adjusted if desired) activation threshold BIP9 with the name
>> "splitprotecion" and using bit 2.
>>
>> This BIP starts immediately and is a BIP8 style soft fork since
>> mandatory signalling will start on midnight August 1st 2017 (epoch
>> time 1501545600) regardless of whether or not this BIP has reached its
>> own signalling threshold. This BIP will cease to be active when segwit
>> is locked-in.
>>
>> === Reference implementation ===
>>
>> <pre>
>> // Check if Segregated Witness is Locked In
>> bool IsWitnessLockedIn(const CBlockIndex* pindexPrev, const
>> Consensus::Params& params)
>> {
>>     LOCK(cs_main);
>>     return (VersionBitsState(pindexPrev, params,
>> Consensus::DEPLOYMENT_SEGWIT, versionbitscache) ==
>> THRESHOLD_LOCKED_IN);
>> }
>>
>> // SPLITPROTECTION mandatory segwit signalling.
>> if ( VersionBitsState(pindex->pprev, chainparams.GetConsensus(),
>> Consensus::DEPLOYMENT_SPLITPROTECTION, versionbitscache) ==
>> THRESHOLD_LOCKED_IN &&
>>      !IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
>> // Segwit is not locked in
>>      !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus()) ) //
>> and is not active.
>> {
>>     bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
>> VERSIONBITS_TOP_BITS;
>>     bool fSegbit = (pindex->nVersion &
>> VersionBitsMask(chainparams.GetConsensus(),
>> Consensus::DEPLOYMENT_SEGWIT)) != 0;
>>     if (!(fVersionBits && fSegbit)) {
>>         return state.DoS(0, error("ConnectBlock(): relayed block must
>> signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
>>     }
>> }
>>
>> // BIP148 mandatory segwit signalling.
>> int64_t nMedianTimePast = pindex->GetMedianTimePast();
>> if ( (nMedianTimePast >= 1501545600) &&  // Tue 01 Aug 2017 00:00:00 UTC
>>      (nMedianTimePast <= 1510704000) &&  // Wed 15 Nov 2017 00:00:00 UTC
>>      (!IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
>>  // Segwit is not locked in
>>       !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus())) )
>>  // and is not active.
>> {
>>     bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
>> VERSIONBITS_TOP_BITS;
>>     bool fSegbit = (pindex->nVersion &
>> VersionBitsMask(chainparams.GetConsensus(),
>> Consensus::DEPLOYMENT_SEGWIT)) != 0;
>>     if (!(fVersionBits && fSegbit)) {
>>         return state.DoS(0, error("ConnectBlock(): relayed block must
>> signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
>>     }
>> }
>> </pre>
>>
>> https://github.com/bitcoin/bitcoin/compare/0.14...jameshilliard:splitprotection-v0.14.1
>>
>> ==Backwards Compatibility==
>>
>> This deployment is compatible with the existing "segwit" bit 1
>> deployment scheduled between midnight November 15th, 2016 and midnight
>> November 15th, 2017. This deployment is also compatible with the
>> existing BIP148 deployment. This BIP is compatible with BIP91 only if
>> BIP91 activates before it and before BIP148. Miners will need to
>> upgrade their nodes to support splitprotection otherwise they may
>> build on top of an invalid block. While this bip is active users
>> should either upgrade to splitprotection or wait for additional
>> confirmations when accepting payments.
>>
>> ==Rationale==
>>
>> Historically we have used IsSuperMajority() to activate soft forks
>> such as BIP66 which has a mandatory signalling requirement for miners
>> once activated, this ensures that miners are aware of new rules being
>> enforced. This technique can be leveraged to lower the signalling
>> threshold of a soft fork while it is in the process of being deployed
>> in a backwards compatible way. We also use a BIP8 style timeout to
>> ensure that this BIP is compatible with BIP148 and that BIP148
>> compatible mandatory signalling activates regardless of miner
>> signalling levels.
>>
>> By orphaning non-signalling blocks during the BIP9 bit 1 "segwit"
>> deployment, this BIP can cause the existing "segwit" deployment to
>> activate without needing to release a new deployment. As we approach
>> BIP148 activation it may be desirable for a majority of miners to have
>> a method that will ensure that there is no chain split.
>>
>> ==References==
>>
>> *[https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-March/013714.html
>> Mailing list discussion]
>> *[https://github.com/bitcoin/bitcoin/blob/v0.6.0/src/main.cpp#L1281-L1283
>> P2SH flag day activation]
>> *[[bip-0009.mediawiki|BIP9 Version bits with timeout and delay]]
>> *[[bip-0016.mediawiki|BIP16 Pay to Script Hash]]
>> *[[bip-0091.mediawiki|BIP91 Reduced threshold Segwit MASF]]
>> *[[bip-0141.mediawiki|BIP141 Segregated Witness (Consensus layer)]]
>> *[[bip-0143.mediawiki|BIP143 Transaction Signature Verification for
>> Version 0 Witness Program]]
>> *[[bip-0147.mediawiki|BIP147 Dealing with dummy stack element malleability]]
>> *[[bip-0148.mediawiki|BIP148 Mandatory activation of segwit deployment]]
>> *[[bip-0149.mediawiki|BIP149 Segregated Witness (second deployment)]]
>> *[https://bitcoincore.org/en/2016/01/26/segwit-benefits/ Segwit benefits]
>>
>> ==Copyright==
>>
>> This document is dual licensed as BSD 3-clause, and Creative Commons
>> CC0 1.0 Universal.
>> _______________________________________________
>> bitcoin-dev mailing list
>> bitcoin-dev at lists.linuxfoundation.org
>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev

From james.hilliard1 at gmail.com  Wed Jun  7 21:44:52 2017
From: james.hilliard1 at gmail.com (James Hilliard)
Date: Wed, 7 Jun 2017 16:44:52 -0500
Subject: [bitcoin-dev] User Activated Soft Fork Split Protection
In-Reply-To: <CAD1TkXsrV3hmyEcpNXFdfWfTp3yLA4iKNCkp7FzjaATkXrmVnw@mail.gmail.com>
References: <CADvTj4qpH-t5Gx6qyn3yToyUE_GFaBE989=AWNHLKMpMNW3R+w@mail.gmail.com>
	<AE5BA251-9DA6-4E34-A748-11C8CF91977C@taoeffect.com>
	<CADvTj4q+oOS=DKfpiNQ6PAbksQfa1gKNfokr2Zc6PNGWqLyL4A@mail.gmail.com>
	<0CDEF5A2-0BAF-46E4-8906-39D4724AF3F2@taoeffect.com>
	<CADvTj4oJr38V+b=96pt7GiaMMSPujsz9wQ-5wmgM=rvWUC8Dkw@mail.gmail.com>
	<CAJowKgJi-68G5Xy1_8n_BOX5e8myj08_SPiFu+cdWsRD4DNy4w@mail.gmail.com>
	<CAD1TkXvaNq8wBsDdbYG4Qwn9YY=tXw8kPQQ2=B4nLKPdq3fsWg@mail.gmail.com>
	<CADvTj4pEGoMUN_fn1bywzhV-WkRP7sQ6fofXKsYJsYjq329b9g@mail.gmail.com>
	<CAD1TkXsrV3hmyEcpNXFdfWfTp3yLA4iKNCkp7FzjaATkXrmVnw@mail.gmail.com>
Message-ID: <CADvTj4oh8ZpN5DcYqse9ruVqpQiCcV1Z_-VrdFTAw7Zr_OV+9Q@mail.gmail.com>

Yes, this is the same as BIP148, there is no mandatory signalling
after segwit is locked in.

On Wed, Jun 7, 2017 at 4:43 PM, Jared Lee Richardson <jaredr26 at gmail.com> wrote:
>> Keep in mind that this is only temporary until segwit has locked in,
> after that happens it becomes optional for miners again.
>
> I missed that, that does effectively address that concern.  It appears
> that BIP148 implements the same rule as would be required to prevent a
> later chainsplit as well, no?
>
> This comment did bring to mind another concern about BIP148/91 though,
> which I'll raise in the pull request discussion.  Feel free to respond
> to it there.
>
> Jared
>
> On Wed, Jun 7, 2017 at 2:21 PM, James Hilliard
> <james.hilliard1 at gmail.com> wrote:
>> Keep in mind that this is only temporary until segwit has locked in,
>> after that happens it becomes optional for miners again.
>>
>> On Wed, Jun 7, 2017 at 4:09 PM, Jared Lee Richardson <jaredr26 at gmail.com> wrote:
>>>> This is, by far, the safest way for miners to quickly defend against a chain split, much better than a -bip148 option.   This allows miners to defend themselves, with very little risk, since the defense is only activated if the majority of miners do so. I would move for a very rapid deployment.   Only miners would need to upgrade.   Regular users would not have to concern themselves with this release.
>>>
>>> FYI, even if very successful, this deployment and change may have a
>>> severe negative impact on a small group of miners.  Any miners/pools
>>> who are not actively following the forums, news, or these discussions
>>> may be difficult to reach and communicate with in time, particularly
>>> with language barriers.  Of those, any who are also either not
>>> signaling segwit currently or are running an older software version
>>> will have their blocks continuously and constantly orphaned, but may
>>> not have any alarms or notifications set up for such an unexpected
>>> failure.  That may or may not be a worthy consideration, but it is
>>> definitely brusque and a harsh price to pay.  Considering the
>>> opposition mentioned against transaction limits for the rare cases
>>> where a very large transaction has already been signed, it seems that
>>> this would be worthy of consideration.  For the few miners in that
>>> situation, it does turn segwit from an optional softfork into a
>>> punishing hardfork.
>>>
>>> I don't think that's a sufficient reason alone to kill the idea, but
>>> it should be a concern.
>>>
>>> Jared
>>>
>>> On Wed, Jun 7, 2017 at 7:10 AM, Erik Aronesty via bitcoin-dev
>>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>>> This is, by far, the safest way for miners to quickly defend against a chain
>>>> split, much better than a -bip148 option.   This allows miners to defend
>>>> themselves, with very little risk, since the defense is only activated if
>>>> the majority of miners do so. I would move for a very rapid deployment.
>>>> Only miners would need to upgrade.   Regular users would not have to concern
>>>> themselves with this release.
>>>>
>>>> On Wed, Jun 7, 2017 at 6:13 AM, James Hilliard via bitcoin-dev
>>>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>>>>
>>>>> I think even 55% would probably work out fine simply due to incentive
>>>>> structures, once signalling is over 51% it's then clear to miners that
>>>>> non-signalling blocks will be orphaned and the rest will rapidly
>>>>> update to splitprotection/BIP148. The purpose of this BIP is to reduce
>>>>> chain split risk for BIP148 since it's looking like BIP148 is going to
>>>>> be run by a non-insignificant percentage of the economy at a minimum.
>>>>>
>>>>> On Wed, Jun 7, 2017 at 12:20 AM, Tao Effect <contact at taoeffect.com> wrote:
>>>>> > See thread on replay attacks for why activating regardless of threshold
>>>>> > is a
>>>>> > bad idea [1].
>>>>> >
>>>>> > BIP91 OTOH seems perfectly reasonable. 80% instead of 95% makes it more
>>>>> > difficult for miners to hold together in opposition to Core. It gives
>>>>> > Core
>>>>> > more leverage in negotiations.
>>>>> >
>>>>> > If they don't activate with 80%, Core can release another BIP to reduce
>>>>> > it
>>>>> > to 75%.
>>>>> >
>>>>> > Each threshold reduction makes it both more likely to succeed, but also
>>>>> > increases the likelihood of harm to the ecosystem.
>>>>> >
>>>>> > Cheers,
>>>>> > Greg
>>>>> >
>>>>> > [1]
>>>>> >
>>>>> > https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-June/014497.html
>>>>> >
>>>>> > --
>>>>> > Please do not email me anything that you are not comfortable also
>>>>> > sharing
>>>>> > with the NSA.
>>>>> >
>>>>> > On Jun 6, 2017, at 6:54 PM, James Hilliard <james.hilliard1 at gmail.com>
>>>>> > wrote:
>>>>> >
>>>>> > This is a BIP8 style soft fork so mandatory signalling will be active
>>>>> > after Aug 1st regardless.
>>>>> >
>>>>> > On Tue, Jun 6, 2017 at 8:51 PM, Tao Effect <contact at taoeffect.com>
>>>>> > wrote:
>>>>> >
>>>>> > What is the probability that a 65% threshold is too low and can allow a
>>>>> > "surprise miner attack", whereby miners are kept offline before the
>>>>> > deadline, and brought online immediately after, creating potential
>>>>> > havoc?
>>>>> >
>>>>> > (Nit: "simple majority" usually refers to >50%, I think, might cause
>>>>> > confusion.)
>>>>> >
>>>>> > -Greg Slepak
>>>>> >
>>>>> > --
>>>>> > Please do not email me anything that you are not comfortable also
>>>>> > sharing
>>>>> > with the NSA.
>>>>> >
>>>>> > On Jun 6, 2017, at 5:56 PM, James Hilliard via bitcoin-dev
>>>>> > <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>>>> >
>>>>> > Due to the proposed calendar(https://segwit2x.github.io/) for the
>>>>> > SegWit2x agreement being too slow to activate SegWit mandatory
>>>>> > signalling ahead of BIP148 using BIP91 I would like to propose another
>>>>> > option that miners can use to prevent a chain split ahead of the Aug
>>>>> > 1st BIP148 activation date.
>>>>> >
>>>>> > The splitprotection soft fork is essentially BIP91 but using BIP8
>>>>> > instead of BIP9 with a lower activation threshold and immediate
>>>>> > mandatory signalling lock-in. This allows for a majority of miners to
>>>>> > activate mandatory SegWit signalling and prevent a potential chain
>>>>> > split ahead of BIP148 activation.
>>>>> >
>>>>> > This BIP allows for miners to respond to market forces quickly ahead
>>>>> > of BIP148 activation by signalling for splitprotection. Any miners
>>>>> > already running BIP148 should be encouraged to use splitprotection.
>>>>> >
>>>>> > <pre>
>>>>> > BIP: splitprotection
>>>>> > Layer: Consensus (soft fork)
>>>>> > Title: User Activated Soft Fork Split Protection
>>>>> > Author: James Hilliard <james.hilliard1 at gmail.com>
>>>>> > Comments-Summary: No comments yet.
>>>>> > Comments-URI:
>>>>> > Status: Draft
>>>>> > Type: Standards Track
>>>>> > Created: 2017-05-22
>>>>> > License: BSD-3-Clause
>>>>> >          CC0-1.0
>>>>> > </pre>
>>>>> >
>>>>> > ==Abstract==
>>>>> >
>>>>> > This document specifies a coordination mechanism for a simple majority
>>>>> > of miners to prevent a chain split ahead of BIP148 activation.
>>>>> >
>>>>> > ==Definitions==
>>>>> >
>>>>> > "existing segwit deployment" refer to the BIP9 "segwit" deployment
>>>>> > using bit 1, between November 15th 2016 and November 15th 2017 to
>>>>> > activate BIP141, BIP143 and BIP147.
>>>>> >
>>>>> > ==Motivation==
>>>>> >
>>>>> > The biggest risk of BIP148 is an extended chain split, this BIP
>>>>> > provides a way for a simple majority of miners to eliminate that risk.
>>>>> >
>>>>> > This BIP provides a way for a simple majority of miners to coordinate
>>>>> > activation of the existing segwit deployment with less than 95%
>>>>> > hashpower before BIP148 activation. Due to time constraints unless
>>>>> > immediately deployed BIP91 will likely not be able to enforce
>>>>> > mandatory signalling of segwit before the Aug 1st activation of
>>>>> > BIP148. This BIP provides a method for rapid miner activation of
>>>>> > SegWit mandatory signalling ahead of the BIP148 activation date. Since
>>>>> > the primary goal of this BIP is to reduce the chance of an extended
>>>>> > chain split as much as possible we activate using a simple miner
>>>>> > majority of 65% over a 504 block interval rather than a higher
>>>>> > percentage. This BIP also allows miners to signal their intention to
>>>>> > run BIP148 in order to prevent a chain split.
>>>>> >
>>>>> > ==Specification==
>>>>> >
>>>>> > While this BIP is active, all blocks must set the nVersion header top
>>>>> > 3 bits to 001 together with bit field (1<<1) (according to the
>>>>> > existing segwit deployment). Blocks that do not signal as required
>>>>> > will be rejected.
>>>>> >
>>>>> > ==Deployment==
>>>>> >
>>>>> > This BIP will be deployed by "version bits" with a 65%(this can be
>>>>> > adjusted if desired) activation threshold BIP9 with the name
>>>>> > "splitprotecion" and using bit 2.
>>>>> >
>>>>> > This BIP starts immediately and is a BIP8 style soft fork since
>>>>> > mandatory signalling will start on midnight August 1st 2017 (epoch
>>>>> > time 1501545600) regardless of whether or not this BIP has reached its
>>>>> > own signalling threshold. This BIP will cease to be active when segwit
>>>>> > is locked-in.
>>>>> >
>>>>> > === Reference implementation ===
>>>>> >
>>>>> > <pre>
>>>>> > // Check if Segregated Witness is Locked In
>>>>> > bool IsWitnessLockedIn(const CBlockIndex* pindexPrev, const
>>>>> > Consensus::Params& params)
>>>>> > {
>>>>> >   LOCK(cs_main);
>>>>> >   return (VersionBitsState(pindexPrev, params,
>>>>> > Consensus::DEPLOYMENT_SEGWIT, versionbitscache) ==
>>>>> > THRESHOLD_LOCKED_IN);
>>>>> > }
>>>>> >
>>>>> > // SPLITPROTECTION mandatory segwit signalling.
>>>>> > if ( VersionBitsState(pindex->pprev, chainparams.GetConsensus(),
>>>>> > Consensus::DEPLOYMENT_SPLITPROTECTION, versionbitscache) ==
>>>>> > THRESHOLD_LOCKED_IN &&
>>>>> >    !IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
>>>>> > // Segwit is not locked in
>>>>> >    !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus()) ) //
>>>>> > and is not active.
>>>>> > {
>>>>> >   bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
>>>>> > VERSIONBITS_TOP_BITS;
>>>>> >   bool fSegbit = (pindex->nVersion &
>>>>> > VersionBitsMask(chainparams.GetConsensus(),
>>>>> > Consensus::DEPLOYMENT_SEGWIT)) != 0;
>>>>> >   if (!(fVersionBits && fSegbit)) {
>>>>> >       return state.DoS(0, error("ConnectBlock(): relayed block must
>>>>> > signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
>>>>> >   }
>>>>> > }
>>>>> >
>>>>> > // BIP148 mandatory segwit signalling.
>>>>> > int64_t nMedianTimePast = pindex->GetMedianTimePast();
>>>>> > if ( (nMedianTimePast >= 1501545600) &&  // Tue 01 Aug 2017 00:00:00 UTC
>>>>> >    (nMedianTimePast <= 1510704000) &&  // Wed 15 Nov 2017 00:00:00 UTC
>>>>> >    (!IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
>>>>> > // Segwit is not locked in
>>>>> >     !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus())) )
>>>>> > // and is not active.
>>>>> > {
>>>>> >   bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
>>>>> > VERSIONBITS_TOP_BITS;
>>>>> >   bool fSegbit = (pindex->nVersion &
>>>>> > VersionBitsMask(chainparams.GetConsensus(),
>>>>> > Consensus::DEPLOYMENT_SEGWIT)) != 0;
>>>>> >   if (!(fVersionBits && fSegbit)) {
>>>>> >       return state.DoS(0, error("ConnectBlock(): relayed block must
>>>>> > signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
>>>>> >   }
>>>>> > }
>>>>> > </pre>
>>>>> >
>>>>> >
>>>>> > https://github.com/bitcoin/bitcoin/compare/0.14...jameshilliard:splitprotection-v0.14.1
>>>>> >
>>>>> > ==Backwards Compatibility==
>>>>> >
>>>>> > This deployment is compatible with the existing "segwit" bit 1
>>>>> > deployment scheduled between midnight November 15th, 2016 and midnight
>>>>> > November 15th, 2017. This deployment is also compatible with the
>>>>> > existing BIP148 deployment. This BIP is compatible with BIP91 only if
>>>>> > BIP91 activates before it and before BIP148. Miners will need to
>>>>> > upgrade their nodes to support splitprotection otherwise they may
>>>>> > build on top of an invalid block. While this bip is active users
>>>>> > should either upgrade to splitprotection or wait for additional
>>>>> > confirmations when accepting payments.
>>>>> >
>>>>> > ==Rationale==
>>>>> >
>>>>> > Historically we have used IsSuperMajority() to activate soft forks
>>>>> > such as BIP66 which has a mandatory signalling requirement for miners
>>>>> > once activated, this ensures that miners are aware of new rules being
>>>>> > enforced. This technique can be leveraged to lower the signalling
>>>>> > threshold of a soft fork while it is in the process of being deployed
>>>>> > in a backwards compatible way. We also use a BIP8 style timeout to
>>>>> > ensure that this BIP is compatible with BIP148 and that BIP148
>>>>> > compatible mandatory signalling activates regardless of miner
>>>>> > signalling levels.
>>>>> >
>>>>> > By orphaning non-signalling blocks during the BIP9 bit 1 "segwit"
>>>>> > deployment, this BIP can cause the existing "segwit" deployment to
>>>>> > activate without needing to release a new deployment. As we approach
>>>>> > BIP148 activation it may be desirable for a majority of miners to have
>>>>> > a method that will ensure that there is no chain split.
>>>>> >
>>>>> > ==References==
>>>>> >
>>>>> >
>>>>> > *[https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-March/013714.html
>>>>> > Mailing list discussion]
>>>>> >
>>>>> > *[https://github.com/bitcoin/bitcoin/blob/v0.6.0/src/main.cpp#L1281-L1283
>>>>> > P2SH flag day activation]
>>>>> > *[[bip-0009.mediawiki|BIP9 Version bits with timeout and delay]]
>>>>> > *[[bip-0016.mediawiki|BIP16 Pay to Script Hash]]
>>>>> > *[[bip-0091.mediawiki|BIP91 Reduced threshold Segwit MASF]]
>>>>> > *[[bip-0141.mediawiki|BIP141 Segregated Witness (Consensus layer)]]
>>>>> > *[[bip-0143.mediawiki|BIP143 Transaction Signature Verification for
>>>>> > Version 0 Witness Program]]
>>>>> > *[[bip-0147.mediawiki|BIP147 Dealing with dummy stack element
>>>>> > malleability]]
>>>>> > *[[bip-0148.mediawiki|BIP148 Mandatory activation of segwit deployment]]
>>>>> > *[[bip-0149.mediawiki|BIP149 Segregated Witness (second deployment)]]
>>>>> > *[https://bitcoincore.org/en/2016/01/26/segwit-benefits/ Segwit
>>>>> > benefits]
>>>>> >
>>>>> > ==Copyright==
>>>>> >
>>>>> > This document is dual licensed as BSD 3-clause, and Creative Commons
>>>>> > CC0 1.0 Universal.
>>>>> > _______________________________________________
>>>>> > bitcoin-dev mailing list
>>>>> > bitcoin-dev at lists.linuxfoundation.org
>>>>> > https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>>>> >
>>>>> >
>>>>> >
>>>>> _______________________________________________
>>>>> bitcoin-dev mailing list
>>>>> bitcoin-dev at lists.linuxfoundation.org
>>>>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>>>
>>>>
>>>>
>>>> _______________________________________________
>>>> bitcoin-dev mailing list
>>>> bitcoin-dev at lists.linuxfoundation.org
>>>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>>>

From jaredr26 at gmail.com  Wed Jun  7 21:09:04 2017
From: jaredr26 at gmail.com (Jared Lee Richardson)
Date: Wed, 7 Jun 2017 14:09:04 -0700
Subject: [bitcoin-dev] User Activated Soft Fork Split Protection
In-Reply-To: <CAJowKgJi-68G5Xy1_8n_BOX5e8myj08_SPiFu+cdWsRD4DNy4w@mail.gmail.com>
References: <CADvTj4qpH-t5Gx6qyn3yToyUE_GFaBE989=AWNHLKMpMNW3R+w@mail.gmail.com>
	<AE5BA251-9DA6-4E34-A748-11C8CF91977C@taoeffect.com>
	<CADvTj4q+oOS=DKfpiNQ6PAbksQfa1gKNfokr2Zc6PNGWqLyL4A@mail.gmail.com>
	<0CDEF5A2-0BAF-46E4-8906-39D4724AF3F2@taoeffect.com>
	<CADvTj4oJr38V+b=96pt7GiaMMSPujsz9wQ-5wmgM=rvWUC8Dkw@mail.gmail.com>
	<CAJowKgJi-68G5Xy1_8n_BOX5e8myj08_SPiFu+cdWsRD4DNy4w@mail.gmail.com>
Message-ID: <CAD1TkXvaNq8wBsDdbYG4Qwn9YY=tXw8kPQQ2=B4nLKPdq3fsWg@mail.gmail.com>

> This is, by far, the safest way for miners to quickly defend against a chain split, much better than a -bip148 option.   This allows miners to defend themselves, with very little risk, since the defense is only activated if the majority of miners do so. I would move for a very rapid deployment.   Only miners would need to upgrade.   Regular users would not have to concern themselves with this release.

FYI, even if very successful, this deployment and change may have a
severe negative impact on a small group of miners.  Any miners/pools
who are not actively following the forums, news, or these discussions
may be difficult to reach and communicate with in time, particularly
with language barriers.  Of those, any who are also either not
signaling segwit currently or are running an older software version
will have their blocks continuously and constantly orphaned, but may
not have any alarms or notifications set up for such an unexpected
failure.  That may or may not be a worthy consideration, but it is
definitely brusque and a harsh price to pay.  Considering the
opposition mentioned against transaction limits for the rare cases
where a very large transaction has already been signed, it seems that
this would be worthy of consideration.  For the few miners in that
situation, it does turn segwit from an optional softfork into a
punishing hardfork.

I don't think that's a sufficient reason alone to kill the idea, but
it should be a concern.

Jared

On Wed, Jun 7, 2017 at 7:10 AM, Erik Aronesty via bitcoin-dev
<bitcoin-dev at lists.linuxfoundation.org> wrote:
> This is, by far, the safest way for miners to quickly defend against a chain
> split, much better than a -bip148 option.   This allows miners to defend
> themselves, with very little risk, since the defense is only activated if
> the majority of miners do so. I would move for a very rapid deployment.
> Only miners would need to upgrade.   Regular users would not have to concern
> themselves with this release.
>
> On Wed, Jun 7, 2017 at 6:13 AM, James Hilliard via bitcoin-dev
> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>
>> I think even 55% would probably work out fine simply due to incentive
>> structures, once signalling is over 51% it's then clear to miners that
>> non-signalling blocks will be orphaned and the rest will rapidly
>> update to splitprotection/BIP148. The purpose of this BIP is to reduce
>> chain split risk for BIP148 since it's looking like BIP148 is going to
>> be run by a non-insignificant percentage of the economy at a minimum.
>>
>> On Wed, Jun 7, 2017 at 12:20 AM, Tao Effect <contact at taoeffect.com> wrote:
>> > See thread on replay attacks for why activating regardless of threshold
>> > is a
>> > bad idea [1].
>> >
>> > BIP91 OTOH seems perfectly reasonable. 80% instead of 95% makes it more
>> > difficult for miners to hold together in opposition to Core. It gives
>> > Core
>> > more leverage in negotiations.
>> >
>> > If they don't activate with 80%, Core can release another BIP to reduce
>> > it
>> > to 75%.
>> >
>> > Each threshold reduction makes it both more likely to succeed, but also
>> > increases the likelihood of harm to the ecosystem.
>> >
>> > Cheers,
>> > Greg
>> >
>> > [1]
>> >
>> > https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-June/014497.html
>> >
>> > --
>> > Please do not email me anything that you are not comfortable also
>> > sharing
>> > with the NSA.
>> >
>> > On Jun 6, 2017, at 6:54 PM, James Hilliard <james.hilliard1 at gmail.com>
>> > wrote:
>> >
>> > This is a BIP8 style soft fork so mandatory signalling will be active
>> > after Aug 1st regardless.
>> >
>> > On Tue, Jun 6, 2017 at 8:51 PM, Tao Effect <contact at taoeffect.com>
>> > wrote:
>> >
>> > What is the probability that a 65% threshold is too low and can allow a
>> > "surprise miner attack", whereby miners are kept offline before the
>> > deadline, and brought online immediately after, creating potential
>> > havoc?
>> >
>> > (Nit: "simple majority" usually refers to >50%, I think, might cause
>> > confusion.)
>> >
>> > -Greg Slepak
>> >
>> > --
>> > Please do not email me anything that you are not comfortable also
>> > sharing
>> > with the NSA.
>> >
>> > On Jun 6, 2017, at 5:56 PM, James Hilliard via bitcoin-dev
>> > <bitcoin-dev at lists.linuxfoundation.org> wrote:
>> >
>> > Due to the proposed calendar(https://segwit2x.github.io/) for the
>> > SegWit2x agreement being too slow to activate SegWit mandatory
>> > signalling ahead of BIP148 using BIP91 I would like to propose another
>> > option that miners can use to prevent a chain split ahead of the Aug
>> > 1st BIP148 activation date.
>> >
>> > The splitprotection soft fork is essentially BIP91 but using BIP8
>> > instead of BIP9 with a lower activation threshold and immediate
>> > mandatory signalling lock-in. This allows for a majority of miners to
>> > activate mandatory SegWit signalling and prevent a potential chain
>> > split ahead of BIP148 activation.
>> >
>> > This BIP allows for miners to respond to market forces quickly ahead
>> > of BIP148 activation by signalling for splitprotection. Any miners
>> > already running BIP148 should be encouraged to use splitprotection.
>> >
>> > <pre>
>> > BIP: splitprotection
>> > Layer: Consensus (soft fork)
>> > Title: User Activated Soft Fork Split Protection
>> > Author: James Hilliard <james.hilliard1 at gmail.com>
>> > Comments-Summary: No comments yet.
>> > Comments-URI:
>> > Status: Draft
>> > Type: Standards Track
>> > Created: 2017-05-22
>> > License: BSD-3-Clause
>> >          CC0-1.0
>> > </pre>
>> >
>> > ==Abstract==
>> >
>> > This document specifies a coordination mechanism for a simple majority
>> > of miners to prevent a chain split ahead of BIP148 activation.
>> >
>> > ==Definitions==
>> >
>> > "existing segwit deployment" refer to the BIP9 "segwit" deployment
>> > using bit 1, between November 15th 2016 and November 15th 2017 to
>> > activate BIP141, BIP143 and BIP147.
>> >
>> > ==Motivation==
>> >
>> > The biggest risk of BIP148 is an extended chain split, this BIP
>> > provides a way for a simple majority of miners to eliminate that risk.
>> >
>> > This BIP provides a way for a simple majority of miners to coordinate
>> > activation of the existing segwit deployment with less than 95%
>> > hashpower before BIP148 activation. Due to time constraints unless
>> > immediately deployed BIP91 will likely not be able to enforce
>> > mandatory signalling of segwit before the Aug 1st activation of
>> > BIP148. This BIP provides a method for rapid miner activation of
>> > SegWit mandatory signalling ahead of the BIP148 activation date. Since
>> > the primary goal of this BIP is to reduce the chance of an extended
>> > chain split as much as possible we activate using a simple miner
>> > majority of 65% over a 504 block interval rather than a higher
>> > percentage. This BIP also allows miners to signal their intention to
>> > run BIP148 in order to prevent a chain split.
>> >
>> > ==Specification==
>> >
>> > While this BIP is active, all blocks must set the nVersion header top
>> > 3 bits to 001 together with bit field (1<<1) (according to the
>> > existing segwit deployment). Blocks that do not signal as required
>> > will be rejected.
>> >
>> > ==Deployment==
>> >
>> > This BIP will be deployed by "version bits" with a 65%(this can be
>> > adjusted if desired) activation threshold BIP9 with the name
>> > "splitprotecion" and using bit 2.
>> >
>> > This BIP starts immediately and is a BIP8 style soft fork since
>> > mandatory signalling will start on midnight August 1st 2017 (epoch
>> > time 1501545600) regardless of whether or not this BIP has reached its
>> > own signalling threshold. This BIP will cease to be active when segwit
>> > is locked-in.
>> >
>> > === Reference implementation ===
>> >
>> > <pre>
>> > // Check if Segregated Witness is Locked In
>> > bool IsWitnessLockedIn(const CBlockIndex* pindexPrev, const
>> > Consensus::Params& params)
>> > {
>> >   LOCK(cs_main);
>> >   return (VersionBitsState(pindexPrev, params,
>> > Consensus::DEPLOYMENT_SEGWIT, versionbitscache) ==
>> > THRESHOLD_LOCKED_IN);
>> > }
>> >
>> > // SPLITPROTECTION mandatory segwit signalling.
>> > if ( VersionBitsState(pindex->pprev, chainparams.GetConsensus(),
>> > Consensus::DEPLOYMENT_SPLITPROTECTION, versionbitscache) ==
>> > THRESHOLD_LOCKED_IN &&
>> >    !IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
>> > // Segwit is not locked in
>> >    !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus()) ) //
>> > and is not active.
>> > {
>> >   bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
>> > VERSIONBITS_TOP_BITS;
>> >   bool fSegbit = (pindex->nVersion &
>> > VersionBitsMask(chainparams.GetConsensus(),
>> > Consensus::DEPLOYMENT_SEGWIT)) != 0;
>> >   if (!(fVersionBits && fSegbit)) {
>> >       return state.DoS(0, error("ConnectBlock(): relayed block must
>> > signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
>> >   }
>> > }
>> >
>> > // BIP148 mandatory segwit signalling.
>> > int64_t nMedianTimePast = pindex->GetMedianTimePast();
>> > if ( (nMedianTimePast >= 1501545600) &&  // Tue 01 Aug 2017 00:00:00 UTC
>> >    (nMedianTimePast <= 1510704000) &&  // Wed 15 Nov 2017 00:00:00 UTC
>> >    (!IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
>> > // Segwit is not locked in
>> >     !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus())) )
>> > // and is not active.
>> > {
>> >   bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
>> > VERSIONBITS_TOP_BITS;
>> >   bool fSegbit = (pindex->nVersion &
>> > VersionBitsMask(chainparams.GetConsensus(),
>> > Consensus::DEPLOYMENT_SEGWIT)) != 0;
>> >   if (!(fVersionBits && fSegbit)) {
>> >       return state.DoS(0, error("ConnectBlock(): relayed block must
>> > signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
>> >   }
>> > }
>> > </pre>
>> >
>> >
>> > https://github.com/bitcoin/bitcoin/compare/0.14...jameshilliard:splitprotection-v0.14.1
>> >
>> > ==Backwards Compatibility==
>> >
>> > This deployment is compatible with the existing "segwit" bit 1
>> > deployment scheduled between midnight November 15th, 2016 and midnight
>> > November 15th, 2017. This deployment is also compatible with the
>> > existing BIP148 deployment. This BIP is compatible with BIP91 only if
>> > BIP91 activates before it and before BIP148. Miners will need to
>> > upgrade their nodes to support splitprotection otherwise they may
>> > build on top of an invalid block. While this bip is active users
>> > should either upgrade to splitprotection or wait for additional
>> > confirmations when accepting payments.
>> >
>> > ==Rationale==
>> >
>> > Historically we have used IsSuperMajority() to activate soft forks
>> > such as BIP66 which has a mandatory signalling requirement for miners
>> > once activated, this ensures that miners are aware of new rules being
>> > enforced. This technique can be leveraged to lower the signalling
>> > threshold of a soft fork while it is in the process of being deployed
>> > in a backwards compatible way. We also use a BIP8 style timeout to
>> > ensure that this BIP is compatible with BIP148 and that BIP148
>> > compatible mandatory signalling activates regardless of miner
>> > signalling levels.
>> >
>> > By orphaning non-signalling blocks during the BIP9 bit 1 "segwit"
>> > deployment, this BIP can cause the existing "segwit" deployment to
>> > activate without needing to release a new deployment. As we approach
>> > BIP148 activation it may be desirable for a majority of miners to have
>> > a method that will ensure that there is no chain split.
>> >
>> > ==References==
>> >
>> >
>> > *[https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-March/013714.html
>> > Mailing list discussion]
>> >
>> > *[https://github.com/bitcoin/bitcoin/blob/v0.6.0/src/main.cpp#L1281-L1283
>> > P2SH flag day activation]
>> > *[[bip-0009.mediawiki|BIP9 Version bits with timeout and delay]]
>> > *[[bip-0016.mediawiki|BIP16 Pay to Script Hash]]
>> > *[[bip-0091.mediawiki|BIP91 Reduced threshold Segwit MASF]]
>> > *[[bip-0141.mediawiki|BIP141 Segregated Witness (Consensus layer)]]
>> > *[[bip-0143.mediawiki|BIP143 Transaction Signature Verification for
>> > Version 0 Witness Program]]
>> > *[[bip-0147.mediawiki|BIP147 Dealing with dummy stack element
>> > malleability]]
>> > *[[bip-0148.mediawiki|BIP148 Mandatory activation of segwit deployment]]
>> > *[[bip-0149.mediawiki|BIP149 Segregated Witness (second deployment)]]
>> > *[https://bitcoincore.org/en/2016/01/26/segwit-benefits/ Segwit
>> > benefits]
>> >
>> > ==Copyright==
>> >
>> > This document is dual licensed as BSD 3-clause, and Creative Commons
>> > CC0 1.0 Universal.
>> > _______________________________________________
>> > bitcoin-dev mailing list
>> > bitcoin-dev at lists.linuxfoundation.org
>> > https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>> >
>> >
>> >
>> _______________________________________________
>> bitcoin-dev mailing list
>> bitcoin-dev at lists.linuxfoundation.org
>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>
>
>
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>

From jaredr26 at gmail.com  Wed Jun  7 21:29:55 2017
From: jaredr26 at gmail.com (Jared Lee Richardson)
Date: Wed, 7 Jun 2017 14:29:55 -0700
Subject: [bitcoin-dev] User Activated Soft Fork Split Protection
In-Reply-To: <CADvTj4qpH-t5Gx6qyn3yToyUE_GFaBE989=AWNHLKMpMNW3R+w@mail.gmail.com>
References: <CADvTj4qpH-t5Gx6qyn3yToyUE_GFaBE989=AWNHLKMpMNW3R+w@mail.gmail.com>
Message-ID: <CAD1TkXviJouao7YoHjiDN3mTUWFEbMY9mtCqkQ8zp8JthyhT7Q@mail.gmail.com>

I think this BIP represents a gamble, and the gamble may not be a good
one.  The gamble here is that if the segwit2x changes are rolled out
on time, and if the signatories accept the bit4 + bit1 signaling
proposals within BIP91, the launch will go smoother, as intended.  But
conversely, if either the segwit2x signatories balk about the Bit1
signaling OR if the timelines for segwit2mb are missed even by a bit,
it may cause the BIP148 chainsplit to be worse than it would be
without.  Given the frequent concerns raised in multiple places about
the aggressiveness of the segwit2x timelines, including the
non-hardfork timelines, this does not seem like a great gamble to be
making.

The reason I say it may make the chainsplit be worse than it would
otherwise be is that it may provide a false sense of safety for BIP148
that currently does not currently exist(and should not, as it is a
chainsplit).  That sense of safety would only be legitimate if the
segwit2x signatories were on board, and the segwit2x code effectively
enforced BIP148 simultaneously, neither of which are guaranteed.  If
users and more miners had a false sense that BIP148 was *not* going to
chainsplit from default / segwit2x, they might not follow the news if
suddenly the segwit2x plan were delayed for a few days.  While any
additional support would definitely be cheered on by BIP148
supporters, the practical reality might be that this proposal would
take BIP148 from the "unlikely to have any viable chain after flag day
without segwit2x" category into the "small but viable minority chain"
category, and even worse, it might strengthen the chainsplit just days
before segwit is activated on BOTH chains, putting the BIP148
supporters on the wrong pro-segwit, but still-viable chain.

If Core had taken a strong stance to include BIP148 into the client,
and if BIP148 support were much much broader, I would feel differently
as the gamble would be more likely to discourage a chainsplit (By
forcing the acceleration of segwit2x) rather than encourage it (by
strengthening an extreme minority chainsplit that may wind up on the
wrong side of two segwit-activated chains).  As it stands now, this
seems like a very dangerous attempt to compromise with a small but
vocal group that are the ones creating the threat to begin with.

Jared

On Tue, Jun 6, 2017 at 5:56 PM, James Hilliard via bitcoin-dev
<bitcoin-dev at lists.linuxfoundation.org> wrote:
> Due to the proposed calendar(https://segwit2x.github.io/) for the
> SegWit2x agreement being too slow to activate SegWit mandatory
> signalling ahead of BIP148 using BIP91 I would like to propose another
> option that miners can use to prevent a chain split ahead of the Aug
> 1st BIP148 activation date.
>
> The splitprotection soft fork is essentially BIP91 but using BIP8
> instead of BIP9 with a lower activation threshold and immediate
> mandatory signalling lock-in. This allows for a majority of miners to
> activate mandatory SegWit signalling and prevent a potential chain
> split ahead of BIP148 activation.
>
> This BIP allows for miners to respond to market forces quickly ahead
> of BIP148 activation by signalling for splitprotection. Any miners
> already running BIP148 should be encouraged to use splitprotection.
>
> <pre>
>   BIP: splitprotection
>   Layer: Consensus (soft fork)
>   Title: User Activated Soft Fork Split Protection
>   Author: James Hilliard <james.hilliard1 at gmail.com>
>   Comments-Summary: No comments yet.
>   Comments-URI:
>   Status: Draft
>   Type: Standards Track
>   Created: 2017-05-22
>   License: BSD-3-Clause
>            CC0-1.0
> </pre>
>
> ==Abstract==
>
> This document specifies a coordination mechanism for a simple majority
> of miners to prevent a chain split ahead of BIP148 activation.
>
> ==Definitions==
>
> "existing segwit deployment" refer to the BIP9 "segwit" deployment
> using bit 1, between November 15th 2016 and November 15th 2017 to
> activate BIP141, BIP143 and BIP147.
>
> ==Motivation==
>
> The biggest risk of BIP148 is an extended chain split, this BIP
> provides a way for a simple majority of miners to eliminate that risk.
>
> This BIP provides a way for a simple majority of miners to coordinate
> activation of the existing segwit deployment with less than 95%
> hashpower before BIP148 activation. Due to time constraints unless
> immediately deployed BIP91 will likely not be able to enforce
> mandatory signalling of segwit before the Aug 1st activation of
> BIP148. This BIP provides a method for rapid miner activation of
> SegWit mandatory signalling ahead of the BIP148 activation date. Since
> the primary goal of this BIP is to reduce the chance of an extended
> chain split as much as possible we activate using a simple miner
> majority of 65% over a 504 block interval rather than a higher
> percentage. This BIP also allows miners to signal their intention to
> run BIP148 in order to prevent a chain split.
>
> ==Specification==
>
> While this BIP is active, all blocks must set the nVersion header top
> 3 bits to 001 together with bit field (1<<1) (according to the
> existing segwit deployment). Blocks that do not signal as required
> will be rejected.
>
> ==Deployment==
>
> This BIP will be deployed by "version bits" with a 65%(this can be
> adjusted if desired) activation threshold BIP9 with the name
> "splitprotecion" and using bit 2.
>
> This BIP starts immediately and is a BIP8 style soft fork since
> mandatory signalling will start on midnight August 1st 2017 (epoch
> time 1501545600) regardless of whether or not this BIP has reached its
> own signalling threshold. This BIP will cease to be active when segwit
> is locked-in.
>
> === Reference implementation ===
>
> <pre>
> // Check if Segregated Witness is Locked In
> bool IsWitnessLockedIn(const CBlockIndex* pindexPrev, const
> Consensus::Params& params)
> {
>     LOCK(cs_main);
>     return (VersionBitsState(pindexPrev, params,
> Consensus::DEPLOYMENT_SEGWIT, versionbitscache) ==
> THRESHOLD_LOCKED_IN);
> }
>
> // SPLITPROTECTION mandatory segwit signalling.
> if ( VersionBitsState(pindex->pprev, chainparams.GetConsensus(),
> Consensus::DEPLOYMENT_SPLITPROTECTION, versionbitscache) ==
> THRESHOLD_LOCKED_IN &&
>      !IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
> // Segwit is not locked in
>      !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus()) ) //
> and is not active.
> {
>     bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
> VERSIONBITS_TOP_BITS;
>     bool fSegbit = (pindex->nVersion &
> VersionBitsMask(chainparams.GetConsensus(),
> Consensus::DEPLOYMENT_SEGWIT)) != 0;
>     if (!(fVersionBits && fSegbit)) {
>         return state.DoS(0, error("ConnectBlock(): relayed block must
> signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
>     }
> }
>
> // BIP148 mandatory segwit signalling.
> int64_t nMedianTimePast = pindex->GetMedianTimePast();
> if ( (nMedianTimePast >= 1501545600) &&  // Tue 01 Aug 2017 00:00:00 UTC
>      (nMedianTimePast <= 1510704000) &&  // Wed 15 Nov 2017 00:00:00 UTC
>      (!IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
>  // Segwit is not locked in
>       !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus())) )
>  // and is not active.
> {
>     bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
> VERSIONBITS_TOP_BITS;
>     bool fSegbit = (pindex->nVersion &
> VersionBitsMask(chainparams.GetConsensus(),
> Consensus::DEPLOYMENT_SEGWIT)) != 0;
>     if (!(fVersionBits && fSegbit)) {
>         return state.DoS(0, error("ConnectBlock(): relayed block must
> signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
>     }
> }
> </pre>
>
> https://github.com/bitcoin/bitcoin/compare/0.14...jameshilliard:splitprotection-v0.14.1
>
> ==Backwards Compatibility==
>
> This deployment is compatible with the existing "segwit" bit 1
> deployment scheduled between midnight November 15th, 2016 and midnight
> November 15th, 2017. This deployment is also compatible with the
> existing BIP148 deployment. This BIP is compatible with BIP91 only if
> BIP91 activates before it and before BIP148. Miners will need to
> upgrade their nodes to support splitprotection otherwise they may
> build on top of an invalid block. While this bip is active users
> should either upgrade to splitprotection or wait for additional
> confirmations when accepting payments.
>
> ==Rationale==
>
> Historically we have used IsSuperMajority() to activate soft forks
> such as BIP66 which has a mandatory signalling requirement for miners
> once activated, this ensures that miners are aware of new rules being
> enforced. This technique can be leveraged to lower the signalling
> threshold of a soft fork while it is in the process of being deployed
> in a backwards compatible way. We also use a BIP8 style timeout to
> ensure that this BIP is compatible with BIP148 and that BIP148
> compatible mandatory signalling activates regardless of miner
> signalling levels.
>
> By orphaning non-signalling blocks during the BIP9 bit 1 "segwit"
> deployment, this BIP can cause the existing "segwit" deployment to
> activate without needing to release a new deployment. As we approach
> BIP148 activation it may be desirable for a majority of miners to have
> a method that will ensure that there is no chain split.
>
> ==References==
>
> *[https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-March/013714.html
> Mailing list discussion]
> *[https://github.com/bitcoin/bitcoin/blob/v0.6.0/src/main.cpp#L1281-L1283
> P2SH flag day activation]
> *[[bip-0009.mediawiki|BIP9 Version bits with timeout and delay]]
> *[[bip-0016.mediawiki|BIP16 Pay to Script Hash]]
> *[[bip-0091.mediawiki|BIP91 Reduced threshold Segwit MASF]]
> *[[bip-0141.mediawiki|BIP141 Segregated Witness (Consensus layer)]]
> *[[bip-0143.mediawiki|BIP143 Transaction Signature Verification for
> Version 0 Witness Program]]
> *[[bip-0147.mediawiki|BIP147 Dealing with dummy stack element malleability]]
> *[[bip-0148.mediawiki|BIP148 Mandatory activation of segwit deployment]]
> *[[bip-0149.mediawiki|BIP149 Segregated Witness (second deployment)]]
> *[https://bitcoincore.org/en/2016/01/26/segwit-benefits/ Segwit benefits]
>
> ==Copyright==
>
> This document is dual licensed as BSD 3-clause, and Creative Commons
> CC0 1.0 Universal.
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev

From jaredr26 at gmail.com  Wed Jun  7 21:43:14 2017
From: jaredr26 at gmail.com (Jared Lee Richardson)
Date: Wed, 7 Jun 2017 14:43:14 -0700
Subject: [bitcoin-dev] User Activated Soft Fork Split Protection
In-Reply-To: <CADvTj4pEGoMUN_fn1bywzhV-WkRP7sQ6fofXKsYJsYjq329b9g@mail.gmail.com>
References: <CADvTj4qpH-t5Gx6qyn3yToyUE_GFaBE989=AWNHLKMpMNW3R+w@mail.gmail.com>
	<AE5BA251-9DA6-4E34-A748-11C8CF91977C@taoeffect.com>
	<CADvTj4q+oOS=DKfpiNQ6PAbksQfa1gKNfokr2Zc6PNGWqLyL4A@mail.gmail.com>
	<0CDEF5A2-0BAF-46E4-8906-39D4724AF3F2@taoeffect.com>
	<CADvTj4oJr38V+b=96pt7GiaMMSPujsz9wQ-5wmgM=rvWUC8Dkw@mail.gmail.com>
	<CAJowKgJi-68G5Xy1_8n_BOX5e8myj08_SPiFu+cdWsRD4DNy4w@mail.gmail.com>
	<CAD1TkXvaNq8wBsDdbYG4Qwn9YY=tXw8kPQQ2=B4nLKPdq3fsWg@mail.gmail.com>
	<CADvTj4pEGoMUN_fn1bywzhV-WkRP7sQ6fofXKsYJsYjq329b9g@mail.gmail.com>
Message-ID: <CAD1TkXsrV3hmyEcpNXFdfWfTp3yLA4iKNCkp7FzjaATkXrmVnw@mail.gmail.com>

> Keep in mind that this is only temporary until segwit has locked in,
after that happens it becomes optional for miners again.

I missed that, that does effectively address that concern.  It appears
that BIP148 implements the same rule as would be required to prevent a
later chainsplit as well, no?

This comment did bring to mind another concern about BIP148/91 though,
which I'll raise in the pull request discussion.  Feel free to respond
to it there.

Jared

On Wed, Jun 7, 2017 at 2:21 PM, James Hilliard
<james.hilliard1 at gmail.com> wrote:
> Keep in mind that this is only temporary until segwit has locked in,
> after that happens it becomes optional for miners again.
>
> On Wed, Jun 7, 2017 at 4:09 PM, Jared Lee Richardson <jaredr26 at gmail.com> wrote:
>>> This is, by far, the safest way for miners to quickly defend against a chain split, much better than a -bip148 option.   This allows miners to defend themselves, with very little risk, since the defense is only activated if the majority of miners do so. I would move for a very rapid deployment.   Only miners would need to upgrade.   Regular users would not have to concern themselves with this release.
>>
>> FYI, even if very successful, this deployment and change may have a
>> severe negative impact on a small group of miners.  Any miners/pools
>> who are not actively following the forums, news, or these discussions
>> may be difficult to reach and communicate with in time, particularly
>> with language barriers.  Of those, any who are also either not
>> signaling segwit currently or are running an older software version
>> will have their blocks continuously and constantly orphaned, but may
>> not have any alarms or notifications set up for such an unexpected
>> failure.  That may or may not be a worthy consideration, but it is
>> definitely brusque and a harsh price to pay.  Considering the
>> opposition mentioned against transaction limits for the rare cases
>> where a very large transaction has already been signed, it seems that
>> this would be worthy of consideration.  For the few miners in that
>> situation, it does turn segwit from an optional softfork into a
>> punishing hardfork.
>>
>> I don't think that's a sufficient reason alone to kill the idea, but
>> it should be a concern.
>>
>> Jared
>>
>> On Wed, Jun 7, 2017 at 7:10 AM, Erik Aronesty via bitcoin-dev
>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>> This is, by far, the safest way for miners to quickly defend against a chain
>>> split, much better than a -bip148 option.   This allows miners to defend
>>> themselves, with very little risk, since the defense is only activated if
>>> the majority of miners do so. I would move for a very rapid deployment.
>>> Only miners would need to upgrade.   Regular users would not have to concern
>>> themselves with this release.
>>>
>>> On Wed, Jun 7, 2017 at 6:13 AM, James Hilliard via bitcoin-dev
>>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>>>
>>>> I think even 55% would probably work out fine simply due to incentive
>>>> structures, once signalling is over 51% it's then clear to miners that
>>>> non-signalling blocks will be orphaned and the rest will rapidly
>>>> update to splitprotection/BIP148. The purpose of this BIP is to reduce
>>>> chain split risk for BIP148 since it's looking like BIP148 is going to
>>>> be run by a non-insignificant percentage of the economy at a minimum.
>>>>
>>>> On Wed, Jun 7, 2017 at 12:20 AM, Tao Effect <contact at taoeffect.com> wrote:
>>>> > See thread on replay attacks for why activating regardless of threshold
>>>> > is a
>>>> > bad idea [1].
>>>> >
>>>> > BIP91 OTOH seems perfectly reasonable. 80% instead of 95% makes it more
>>>> > difficult for miners to hold together in opposition to Core. It gives
>>>> > Core
>>>> > more leverage in negotiations.
>>>> >
>>>> > If they don't activate with 80%, Core can release another BIP to reduce
>>>> > it
>>>> > to 75%.
>>>> >
>>>> > Each threshold reduction makes it both more likely to succeed, but also
>>>> > increases the likelihood of harm to the ecosystem.
>>>> >
>>>> > Cheers,
>>>> > Greg
>>>> >
>>>> > [1]
>>>> >
>>>> > https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-June/014497.html
>>>> >
>>>> > --
>>>> > Please do not email me anything that you are not comfortable also
>>>> > sharing
>>>> > with the NSA.
>>>> >
>>>> > On Jun 6, 2017, at 6:54 PM, James Hilliard <james.hilliard1 at gmail.com>
>>>> > wrote:
>>>> >
>>>> > This is a BIP8 style soft fork so mandatory signalling will be active
>>>> > after Aug 1st regardless.
>>>> >
>>>> > On Tue, Jun 6, 2017 at 8:51 PM, Tao Effect <contact at taoeffect.com>
>>>> > wrote:
>>>> >
>>>> > What is the probability that a 65% threshold is too low and can allow a
>>>> > "surprise miner attack", whereby miners are kept offline before the
>>>> > deadline, and brought online immediately after, creating potential
>>>> > havoc?
>>>> >
>>>> > (Nit: "simple majority" usually refers to >50%, I think, might cause
>>>> > confusion.)
>>>> >
>>>> > -Greg Slepak
>>>> >
>>>> > --
>>>> > Please do not email me anything that you are not comfortable also
>>>> > sharing
>>>> > with the NSA.
>>>> >
>>>> > On Jun 6, 2017, at 5:56 PM, James Hilliard via bitcoin-dev
>>>> > <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>>> >
>>>> > Due to the proposed calendar(https://segwit2x.github.io/) for the
>>>> > SegWit2x agreement being too slow to activate SegWit mandatory
>>>> > signalling ahead of BIP148 using BIP91 I would like to propose another
>>>> > option that miners can use to prevent a chain split ahead of the Aug
>>>> > 1st BIP148 activation date.
>>>> >
>>>> > The splitprotection soft fork is essentially BIP91 but using BIP8
>>>> > instead of BIP9 with a lower activation threshold and immediate
>>>> > mandatory signalling lock-in. This allows for a majority of miners to
>>>> > activate mandatory SegWit signalling and prevent a potential chain
>>>> > split ahead of BIP148 activation.
>>>> >
>>>> > This BIP allows for miners to respond to market forces quickly ahead
>>>> > of BIP148 activation by signalling for splitprotection. Any miners
>>>> > already running BIP148 should be encouraged to use splitprotection.
>>>> >
>>>> > <pre>
>>>> > BIP: splitprotection
>>>> > Layer: Consensus (soft fork)
>>>> > Title: User Activated Soft Fork Split Protection
>>>> > Author: James Hilliard <james.hilliard1 at gmail.com>
>>>> > Comments-Summary: No comments yet.
>>>> > Comments-URI:
>>>> > Status: Draft
>>>> > Type: Standards Track
>>>> > Created: 2017-05-22
>>>> > License: BSD-3-Clause
>>>> >          CC0-1.0
>>>> > </pre>
>>>> >
>>>> > ==Abstract==
>>>> >
>>>> > This document specifies a coordination mechanism for a simple majority
>>>> > of miners to prevent a chain split ahead of BIP148 activation.
>>>> >
>>>> > ==Definitions==
>>>> >
>>>> > "existing segwit deployment" refer to the BIP9 "segwit" deployment
>>>> > using bit 1, between November 15th 2016 and November 15th 2017 to
>>>> > activate BIP141, BIP143 and BIP147.
>>>> >
>>>> > ==Motivation==
>>>> >
>>>> > The biggest risk of BIP148 is an extended chain split, this BIP
>>>> > provides a way for a simple majority of miners to eliminate that risk.
>>>> >
>>>> > This BIP provides a way for a simple majority of miners to coordinate
>>>> > activation of the existing segwit deployment with less than 95%
>>>> > hashpower before BIP148 activation. Due to time constraints unless
>>>> > immediately deployed BIP91 will likely not be able to enforce
>>>> > mandatory signalling of segwit before the Aug 1st activation of
>>>> > BIP148. This BIP provides a method for rapid miner activation of
>>>> > SegWit mandatory signalling ahead of the BIP148 activation date. Since
>>>> > the primary goal of this BIP is to reduce the chance of an extended
>>>> > chain split as much as possible we activate using a simple miner
>>>> > majority of 65% over a 504 block interval rather than a higher
>>>> > percentage. This BIP also allows miners to signal their intention to
>>>> > run BIP148 in order to prevent a chain split.
>>>> >
>>>> > ==Specification==
>>>> >
>>>> > While this BIP is active, all blocks must set the nVersion header top
>>>> > 3 bits to 001 together with bit field (1<<1) (according to the
>>>> > existing segwit deployment). Blocks that do not signal as required
>>>> > will be rejected.
>>>> >
>>>> > ==Deployment==
>>>> >
>>>> > This BIP will be deployed by "version bits" with a 65%(this can be
>>>> > adjusted if desired) activation threshold BIP9 with the name
>>>> > "splitprotecion" and using bit 2.
>>>> >
>>>> > This BIP starts immediately and is a BIP8 style soft fork since
>>>> > mandatory signalling will start on midnight August 1st 2017 (epoch
>>>> > time 1501545600) regardless of whether or not this BIP has reached its
>>>> > own signalling threshold. This BIP will cease to be active when segwit
>>>> > is locked-in.
>>>> >
>>>> > === Reference implementation ===
>>>> >
>>>> > <pre>
>>>> > // Check if Segregated Witness is Locked In
>>>> > bool IsWitnessLockedIn(const CBlockIndex* pindexPrev, const
>>>> > Consensus::Params& params)
>>>> > {
>>>> >   LOCK(cs_main);
>>>> >   return (VersionBitsState(pindexPrev, params,
>>>> > Consensus::DEPLOYMENT_SEGWIT, versionbitscache) ==
>>>> > THRESHOLD_LOCKED_IN);
>>>> > }
>>>> >
>>>> > // SPLITPROTECTION mandatory segwit signalling.
>>>> > if ( VersionBitsState(pindex->pprev, chainparams.GetConsensus(),
>>>> > Consensus::DEPLOYMENT_SPLITPROTECTION, versionbitscache) ==
>>>> > THRESHOLD_LOCKED_IN &&
>>>> >    !IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
>>>> > // Segwit is not locked in
>>>> >    !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus()) ) //
>>>> > and is not active.
>>>> > {
>>>> >   bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
>>>> > VERSIONBITS_TOP_BITS;
>>>> >   bool fSegbit = (pindex->nVersion &
>>>> > VersionBitsMask(chainparams.GetConsensus(),
>>>> > Consensus::DEPLOYMENT_SEGWIT)) != 0;
>>>> >   if (!(fVersionBits && fSegbit)) {
>>>> >       return state.DoS(0, error("ConnectBlock(): relayed block must
>>>> > signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
>>>> >   }
>>>> > }
>>>> >
>>>> > // BIP148 mandatory segwit signalling.
>>>> > int64_t nMedianTimePast = pindex->GetMedianTimePast();
>>>> > if ( (nMedianTimePast >= 1501545600) &&  // Tue 01 Aug 2017 00:00:00 UTC
>>>> >    (nMedianTimePast <= 1510704000) &&  // Wed 15 Nov 2017 00:00:00 UTC
>>>> >    (!IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
>>>> > // Segwit is not locked in
>>>> >     !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus())) )
>>>> > // and is not active.
>>>> > {
>>>> >   bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
>>>> > VERSIONBITS_TOP_BITS;
>>>> >   bool fSegbit = (pindex->nVersion &
>>>> > VersionBitsMask(chainparams.GetConsensus(),
>>>> > Consensus::DEPLOYMENT_SEGWIT)) != 0;
>>>> >   if (!(fVersionBits && fSegbit)) {
>>>> >       return state.DoS(0, error("ConnectBlock(): relayed block must
>>>> > signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
>>>> >   }
>>>> > }
>>>> > </pre>
>>>> >
>>>> >
>>>> > https://github.com/bitcoin/bitcoin/compare/0.14...jameshilliard:splitprotection-v0.14.1
>>>> >
>>>> > ==Backwards Compatibility==
>>>> >
>>>> > This deployment is compatible with the existing "segwit" bit 1
>>>> > deployment scheduled between midnight November 15th, 2016 and midnight
>>>> > November 15th, 2017. This deployment is also compatible with the
>>>> > existing BIP148 deployment. This BIP is compatible with BIP91 only if
>>>> > BIP91 activates before it and before BIP148. Miners will need to
>>>> > upgrade their nodes to support splitprotection otherwise they may
>>>> > build on top of an invalid block. While this bip is active users
>>>> > should either upgrade to splitprotection or wait for additional
>>>> > confirmations when accepting payments.
>>>> >
>>>> > ==Rationale==
>>>> >
>>>> > Historically we have used IsSuperMajority() to activate soft forks
>>>> > such as BIP66 which has a mandatory signalling requirement for miners
>>>> > once activated, this ensures that miners are aware of new rules being
>>>> > enforced. This technique can be leveraged to lower the signalling
>>>> > threshold of a soft fork while it is in the process of being deployed
>>>> > in a backwards compatible way. We also use a BIP8 style timeout to
>>>> > ensure that this BIP is compatible with BIP148 and that BIP148
>>>> > compatible mandatory signalling activates regardless of miner
>>>> > signalling levels.
>>>> >
>>>> > By orphaning non-signalling blocks during the BIP9 bit 1 "segwit"
>>>> > deployment, this BIP can cause the existing "segwit" deployment to
>>>> > activate without needing to release a new deployment. As we approach
>>>> > BIP148 activation it may be desirable for a majority of miners to have
>>>> > a method that will ensure that there is no chain split.
>>>> >
>>>> > ==References==
>>>> >
>>>> >
>>>> > *[https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-March/013714.html
>>>> > Mailing list discussion]
>>>> >
>>>> > *[https://github.com/bitcoin/bitcoin/blob/v0.6.0/src/main.cpp#L1281-L1283
>>>> > P2SH flag day activation]
>>>> > *[[bip-0009.mediawiki|BIP9 Version bits with timeout and delay]]
>>>> > *[[bip-0016.mediawiki|BIP16 Pay to Script Hash]]
>>>> > *[[bip-0091.mediawiki|BIP91 Reduced threshold Segwit MASF]]
>>>> > *[[bip-0141.mediawiki|BIP141 Segregated Witness (Consensus layer)]]
>>>> > *[[bip-0143.mediawiki|BIP143 Transaction Signature Verification for
>>>> > Version 0 Witness Program]]
>>>> > *[[bip-0147.mediawiki|BIP147 Dealing with dummy stack element
>>>> > malleability]]
>>>> > *[[bip-0148.mediawiki|BIP148 Mandatory activation of segwit deployment]]
>>>> > *[[bip-0149.mediawiki|BIP149 Segregated Witness (second deployment)]]
>>>> > *[https://bitcoincore.org/en/2016/01/26/segwit-benefits/ Segwit
>>>> > benefits]
>>>> >
>>>> > ==Copyright==
>>>> >
>>>> > This document is dual licensed as BSD 3-clause, and Creative Commons
>>>> > CC0 1.0 Universal.
>>>> > _______________________________________________
>>>> > bitcoin-dev mailing list
>>>> > bitcoin-dev at lists.linuxfoundation.org
>>>> > https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>>> >
>>>> >
>>>> >
>>>> _______________________________________________
>>>> bitcoin-dev mailing list
>>>> bitcoin-dev at lists.linuxfoundation.org
>>>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>>
>>>
>>>
>>> _______________________________________________
>>> bitcoin-dev mailing list
>>> bitcoin-dev at lists.linuxfoundation.org
>>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>>

From jaredr26 at gmail.com  Wed Jun  7 21:50:18 2017
From: jaredr26 at gmail.com (Jared Lee Richardson)
Date: Wed, 7 Jun 2017 14:50:18 -0700
Subject: [bitcoin-dev] User Activated Soft Fork Split Protection
In-Reply-To: <CADvTj4rz4exYMvBEmYi=bTZDgDm0drLjpRZmZUo17inzCzCRVg@mail.gmail.com>
References: <CADvTj4qpH-t5Gx6qyn3yToyUE_GFaBE989=AWNHLKMpMNW3R+w@mail.gmail.com>
	<CAD1TkXviJouao7YoHjiDN3mTUWFEbMY9mtCqkQ8zp8JthyhT7Q@mail.gmail.com>
	<CADvTj4rz4exYMvBEmYi=bTZDgDm0drLjpRZmZUo17inzCzCRVg@mail.gmail.com>
Message-ID: <CAD1TkXskei1gk_kungSvdWGmbdJMA8AG+-zK+Osz6u5vSCN8BQ@mail.gmail.com>

Could this risk mitigation measure be an optional flag?  And if so,
could it+BIP91 signal on a different bit than bit4?

The reason being, if for some reason the segwit2x activation cannot
take place in time, it would be preferable for miners to have a more
standard approach to activation that requires stronger consensus and
may be more forgiving than BIP148.  If the segwit2x activation is on
time to cooperate with BIP148, it could be signaled through the
non-bit4 approach and everything could go smoothly.  Thoughts on that
idea?  It may add more complexity and more developer time, but may
also address your concerns among others.

> Since this BIP
> only activates with a clear miner majority it should not increase the
> risk of an extended chain split.

The concern I'm raising is more about the psychology of giving BIP148
a sense of safety that may not be valid.  Without several more steps,
BIP148 is definitely on track to be a risky chainsplit, and without
segwit2x it will almost certainly be a small minority chain. (Unless
the segwit2x compromise falls apart before then, and even in that case
it is likely to be a minority chain)

Jared


On Wed, Jun 7, 2017 at 2:42 PM, James Hilliard
<james.hilliard1 at gmail.com> wrote:
> I don't really see how this would increase the likelihood of an
> extended chain split assuming BIP148 is going to have
> non-insignificant economic backing. This BIP is designed to provide a
> risk mitigation measure that miners can safely deploy. Since this BIP
> only activates with a clear miner majority it should not increase the
> risk of an extended chain split. At this point it is not completely
> clear how much economic support there is for BIP148 but support
> certainly seems to be growing and we have nearly 2 months until BIP148
> activation. I intentionally used a shorter activation period here so
> that decisions by miners can be made close to the BIP148 activation
> date.
>
> On Wed, Jun 7, 2017 at 4:29 PM, Jared Lee Richardson <jaredr26 at gmail.com> wrote:
>> I think this BIP represents a gamble, and the gamble may not be a good
>> one.  The gamble here is that if the segwit2x changes are rolled out
>> on time, and if the signatories accept the bit4 + bit1 signaling
>> proposals within BIP91, the launch will go smoother, as intended.  But
>> conversely, if either the segwit2x signatories balk about the Bit1
>> signaling OR if the timelines for segwit2mb are missed even by a bit,
>> it may cause the BIP148 chainsplit to be worse than it would be
>> without.  Given the frequent concerns raised in multiple places about
>> the aggressiveness of the segwit2x timelines, including the
>> non-hardfork timelines, this does not seem like a great gamble to be
>> making.
>>
>> The reason I say it may make the chainsplit be worse than it would
>> otherwise be is that it may provide a false sense of safety for BIP148
>> that currently does not currently exist(and should not, as it is a
>> chainsplit).  That sense of safety would only be legitimate if the
>> segwit2x signatories were on board, and the segwit2x code effectively
>> enforced BIP148 simultaneously, neither of which are guaranteed.  If
>> users and more miners had a false sense that BIP148 was *not* going to
>> chainsplit from default / segwit2x, they might not follow the news if
>> suddenly the segwit2x plan were delayed for a few days.  While any
>> additional support would definitely be cheered on by BIP148
>> supporters, the practical reality might be that this proposal would
>> take BIP148 from the "unlikely to have any viable chain after flag day
>> without segwit2x" category into the "small but viable minority chain"
>> category, and even worse, it might strengthen the chainsplit just days
>> before segwit is activated on BOTH chains, putting the BIP148
>> supporters on the wrong pro-segwit, but still-viable chain.
>>
>> If Core had taken a strong stance to include BIP148 into the client,
>> and if BIP148 support were much much broader, I would feel differently
>> as the gamble would be more likely to discourage a chainsplit (By
>> forcing the acceleration of segwit2x) rather than encourage it (by
>> strengthening an extreme minority chainsplit that may wind up on the
>> wrong side of two segwit-activated chains).  As it stands now, this
>> seems like a very dangerous attempt to compromise with a small but
>> vocal group that are the ones creating the threat to begin with.
>>
>> Jared
>>
>> On Tue, Jun 6, 2017 at 5:56 PM, James Hilliard via bitcoin-dev
>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>> Due to the proposed calendar(https://segwit2x.github.io/) for the
>>> SegWit2x agreement being too slow to activate SegWit mandatory
>>> signalling ahead of BIP148 using BIP91 I would like to propose another
>>> option that miners can use to prevent a chain split ahead of the Aug
>>> 1st BIP148 activation date.
>>>
>>> The splitprotection soft fork is essentially BIP91 but using BIP8
>>> instead of BIP9 with a lower activation threshold and immediate
>>> mandatory signalling lock-in. This allows for a majority of miners to
>>> activate mandatory SegWit signalling and prevent a potential chain
>>> split ahead of BIP148 activation.
>>>
>>> This BIP allows for miners to respond to market forces quickly ahead
>>> of BIP148 activation by signalling for splitprotection. Any miners
>>> already running BIP148 should be encouraged to use splitprotection.
>>>
>>> <pre>
>>>   BIP: splitprotection
>>>   Layer: Consensus (soft fork)
>>>   Title: User Activated Soft Fork Split Protection
>>>   Author: James Hilliard <james.hilliard1 at gmail.com>
>>>   Comments-Summary: No comments yet.
>>>   Comments-URI:
>>>   Status: Draft
>>>   Type: Standards Track
>>>   Created: 2017-05-22
>>>   License: BSD-3-Clause
>>>            CC0-1.0
>>> </pre>
>>>
>>> ==Abstract==
>>>
>>> This document specifies a coordination mechanism for a simple majority
>>> of miners to prevent a chain split ahead of BIP148 activation.
>>>
>>> ==Definitions==
>>>
>>> "existing segwit deployment" refer to the BIP9 "segwit" deployment
>>> using bit 1, between November 15th 2016 and November 15th 2017 to
>>> activate BIP141, BIP143 and BIP147.
>>>
>>> ==Motivation==
>>>
>>> The biggest risk of BIP148 is an extended chain split, this BIP
>>> provides a way for a simple majority of miners to eliminate that risk.
>>>
>>> This BIP provides a way for a simple majority of miners to coordinate
>>> activation of the existing segwit deployment with less than 95%
>>> hashpower before BIP148 activation. Due to time constraints unless
>>> immediately deployed BIP91 will likely not be able to enforce
>>> mandatory signalling of segwit before the Aug 1st activation of
>>> BIP148. This BIP provides a method for rapid miner activation of
>>> SegWit mandatory signalling ahead of the BIP148 activation date. Since
>>> the primary goal of this BIP is to reduce the chance of an extended
>>> chain split as much as possible we activate using a simple miner
>>> majority of 65% over a 504 block interval rather than a higher
>>> percentage. This BIP also allows miners to signal their intention to
>>> run BIP148 in order to prevent a chain split.
>>>
>>> ==Specification==
>>>
>>> While this BIP is active, all blocks must set the nVersion header top
>>> 3 bits to 001 together with bit field (1<<1) (according to the
>>> existing segwit deployment). Blocks that do not signal as required
>>> will be rejected.
>>>
>>> ==Deployment==
>>>
>>> This BIP will be deployed by "version bits" with a 65%(this can be
>>> adjusted if desired) activation threshold BIP9 with the name
>>> "splitprotecion" and using bit 2.
>>>
>>> This BIP starts immediately and is a BIP8 style soft fork since
>>> mandatory signalling will start on midnight August 1st 2017 (epoch
>>> time 1501545600) regardless of whether or not this BIP has reached its
>>> own signalling threshold. This BIP will cease to be active when segwit
>>> is locked-in.
>>>
>>> === Reference implementation ===
>>>
>>> <pre>
>>> // Check if Segregated Witness is Locked In
>>> bool IsWitnessLockedIn(const CBlockIndex* pindexPrev, const
>>> Consensus::Params& params)
>>> {
>>>     LOCK(cs_main);
>>>     return (VersionBitsState(pindexPrev, params,
>>> Consensus::DEPLOYMENT_SEGWIT, versionbitscache) ==
>>> THRESHOLD_LOCKED_IN);
>>> }
>>>
>>> // SPLITPROTECTION mandatory segwit signalling.
>>> if ( VersionBitsState(pindex->pprev, chainparams.GetConsensus(),
>>> Consensus::DEPLOYMENT_SPLITPROTECTION, versionbitscache) ==
>>> THRESHOLD_LOCKED_IN &&
>>>      !IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
>>> // Segwit is not locked in
>>>      !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus()) ) //
>>> and is not active.
>>> {
>>>     bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
>>> VERSIONBITS_TOP_BITS;
>>>     bool fSegbit = (pindex->nVersion &
>>> VersionBitsMask(chainparams.GetConsensus(),
>>> Consensus::DEPLOYMENT_SEGWIT)) != 0;
>>>     if (!(fVersionBits && fSegbit)) {
>>>         return state.DoS(0, error("ConnectBlock(): relayed block must
>>> signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
>>>     }
>>> }
>>>
>>> // BIP148 mandatory segwit signalling.
>>> int64_t nMedianTimePast = pindex->GetMedianTimePast();
>>> if ( (nMedianTimePast >= 1501545600) &&  // Tue 01 Aug 2017 00:00:00 UTC
>>>      (nMedianTimePast <= 1510704000) &&  // Wed 15 Nov 2017 00:00:00 UTC
>>>      (!IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
>>>  // Segwit is not locked in
>>>       !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus())) )
>>>  // and is not active.
>>> {
>>>     bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
>>> VERSIONBITS_TOP_BITS;
>>>     bool fSegbit = (pindex->nVersion &
>>> VersionBitsMask(chainparams.GetConsensus(),
>>> Consensus::DEPLOYMENT_SEGWIT)) != 0;
>>>     if (!(fVersionBits && fSegbit)) {
>>>         return state.DoS(0, error("ConnectBlock(): relayed block must
>>> signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
>>>     }
>>> }
>>> </pre>
>>>
>>> https://github.com/bitcoin/bitcoin/compare/0.14...jameshilliard:splitprotection-v0.14.1
>>>
>>> ==Backwards Compatibility==
>>>
>>> This deployment is compatible with the existing "segwit" bit 1
>>> deployment scheduled between midnight November 15th, 2016 and midnight
>>> November 15th, 2017. This deployment is also compatible with the
>>> existing BIP148 deployment. This BIP is compatible with BIP91 only if
>>> BIP91 activates before it and before BIP148. Miners will need to
>>> upgrade their nodes to support splitprotection otherwise they may
>>> build on top of an invalid block. While this bip is active users
>>> should either upgrade to splitprotection or wait for additional
>>> confirmations when accepting payments.
>>>
>>> ==Rationale==
>>>
>>> Historically we have used IsSuperMajority() to activate soft forks
>>> such as BIP66 which has a mandatory signalling requirement for miners
>>> once activated, this ensures that miners are aware of new rules being
>>> enforced. This technique can be leveraged to lower the signalling
>>> threshold of a soft fork while it is in the process of being deployed
>>> in a backwards compatible way. We also use a BIP8 style timeout to
>>> ensure that this BIP is compatible with BIP148 and that BIP148
>>> compatible mandatory signalling activates regardless of miner
>>> signalling levels.
>>>
>>> By orphaning non-signalling blocks during the BIP9 bit 1 "segwit"
>>> deployment, this BIP can cause the existing "segwit" deployment to
>>> activate without needing to release a new deployment. As we approach
>>> BIP148 activation it may be desirable for a majority of miners to have
>>> a method that will ensure that there is no chain split.
>>>
>>> ==References==
>>>
>>> *[https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-March/013714.html
>>> Mailing list discussion]
>>> *[https://github.com/bitcoin/bitcoin/blob/v0.6.0/src/main.cpp#L1281-L1283
>>> P2SH flag day activation]
>>> *[[bip-0009.mediawiki|BIP9 Version bits with timeout and delay]]
>>> *[[bip-0016.mediawiki|BIP16 Pay to Script Hash]]
>>> *[[bip-0091.mediawiki|BIP91 Reduced threshold Segwit MASF]]
>>> *[[bip-0141.mediawiki|BIP141 Segregated Witness (Consensus layer)]]
>>> *[[bip-0143.mediawiki|BIP143 Transaction Signature Verification for
>>> Version 0 Witness Program]]
>>> *[[bip-0147.mediawiki|BIP147 Dealing with dummy stack element malleability]]
>>> *[[bip-0148.mediawiki|BIP148 Mandatory activation of segwit deployment]]
>>> *[[bip-0149.mediawiki|BIP149 Segregated Witness (second deployment)]]
>>> *[https://bitcoincore.org/en/2016/01/26/segwit-benefits/ Segwit benefits]
>>>
>>> ==Copyright==
>>>
>>> This document is dual licensed as BSD 3-clause, and Creative Commons
>>> CC0 1.0 Universal.
>>> _______________________________________________
>>> bitcoin-dev mailing list
>>> bitcoin-dev at lists.linuxfoundation.org
>>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev

From james.hilliard1 at gmail.com  Wed Jun  7 22:23:31 2017
From: james.hilliard1 at gmail.com (James Hilliard)
Date: Wed, 7 Jun 2017 17:23:31 -0500
Subject: [bitcoin-dev] User Activated Soft Fork Split Protection
In-Reply-To: <CAD1TkXskei1gk_kungSvdWGmbdJMA8AG+-zK+Osz6u5vSCN8BQ@mail.gmail.com>
References: <CADvTj4qpH-t5Gx6qyn3yToyUE_GFaBE989=AWNHLKMpMNW3R+w@mail.gmail.com>
	<CAD1TkXviJouao7YoHjiDN3mTUWFEbMY9mtCqkQ8zp8JthyhT7Q@mail.gmail.com>
	<CADvTj4rz4exYMvBEmYi=bTZDgDm0drLjpRZmZUo17inzCzCRVg@mail.gmail.com>
	<CAD1TkXskei1gk_kungSvdWGmbdJMA8AG+-zK+Osz6u5vSCN8BQ@mail.gmail.com>
Message-ID: <CADvTj4poO1L+Wg5J+M71sJMz-Xcg_st3MkAcQK=bfHhTJ3i8ow@mail.gmail.com>

On Wed, Jun 7, 2017 at 4:50 PM, Jared Lee Richardson <jaredr26 at gmail.com> wrote:
> Could this risk mitigation measure be an optional flag?  And if so,
> could it+BIP91 signal on a different bit than bit4?
It's fairly trivial for miners to signal for BIP91 on bit4 or a
different bit at the same time as the code is trivial enough to
combine
>
> The reason being, if for some reason the segwit2x activation cannot
> take place in time, it would be preferable for miners to have a more
> standard approach to activation that requires stronger consensus and
> may be more forgiving than BIP148.  If the segwit2x activation is on
> time to cooperate with BIP148, it could be signaled through the
> non-bit4 approach and everything could go smoothly.  Thoughts on that
> idea?  It may add more complexity and more developer time, but may
> also address your concerns among others.
This does give miners another approach to activate segwit ahead of
BIP148, if segwit2x activation is rolled out and activated immediately
then this would not be needed however based on the timeline here
https://segwit2x.github.io/ it would not be possible for BIP91 to
enforce mandatory signalling ahead of BIP148. Maybe that can be
changed though, I've suggested an immediate rollout with a placeholder
client timeout instead of the HF code initially in order to accelerate
that.
>
>> Since this BIP
>> only activates with a clear miner majority it should not increase the
>> risk of an extended chain split.
>
> The concern I'm raising is more about the psychology of giving BIP148
> a sense of safety that may not be valid.  Without several more steps,
> BIP148 is definitely on track to be a risky chainsplit, and without
> segwit2x it will almost certainly be a small minority chain. (Unless
> the segwit2x compromise falls apart before then, and even in that case
> it is likely to be a minority chain)
There are 2 primary factors involved here, economic support and
hashpower either of which is enough to make a permanent chain split
unlikely, miners will mine whichever chain is most profitable(see
ETH/ETC hashpower profitability equilibrium for an example of how this
works in practice) however there may be lag time immediately after the
split if there is an economic majority but not a hashpower majority
initially. This is risk mitigation that only requires miners support
however. The main issue is just one of activation timelines, BIP91 as
is takes too long to activate unless started ahead of the existing
segwit2x schedule and it's unlikely that BIP148 will get pushed back
any further.
>
> Jared
>
>
> On Wed, Jun 7, 2017 at 2:42 PM, James Hilliard
> <james.hilliard1 at gmail.com> wrote:
>> I don't really see how this would increase the likelihood of an
>> extended chain split assuming BIP148 is going to have
>> non-insignificant economic backing. This BIP is designed to provide a
>> risk mitigation measure that miners can safely deploy. Since this BIP
>> only activates with a clear miner majority it should not increase the
>> risk of an extended chain split. At this point it is not completely
>> clear how much economic support there is for BIP148 but support
>> certainly seems to be growing and we have nearly 2 months until BIP148
>> activation. I intentionally used a shorter activation period here so
>> that decisions by miners can be made close to the BIP148 activation
>> date.
>>
>> On Wed, Jun 7, 2017 at 4:29 PM, Jared Lee Richardson <jaredr26 at gmail.com> wrote:
>>> I think this BIP represents a gamble, and the gamble may not be a good
>>> one.  The gamble here is that if the segwit2x changes are rolled out
>>> on time, and if the signatories accept the bit4 + bit1 signaling
>>> proposals within BIP91, the launch will go smoother, as intended.  But
>>> conversely, if either the segwit2x signatories balk about the Bit1
>>> signaling OR if the timelines for segwit2mb are missed even by a bit,
>>> it may cause the BIP148 chainsplit to be worse than it would be
>>> without.  Given the frequent concerns raised in multiple places about
>>> the aggressiveness of the segwit2x timelines, including the
>>> non-hardfork timelines, this does not seem like a great gamble to be
>>> making.
>>>
>>> The reason I say it may make the chainsplit be worse than it would
>>> otherwise be is that it may provide a false sense of safety for BIP148
>>> that currently does not currently exist(and should not, as it is a
>>> chainsplit).  That sense of safety would only be legitimate if the
>>> segwit2x signatories were on board, and the segwit2x code effectively
>>> enforced BIP148 simultaneously, neither of which are guaranteed.  If
>>> users and more miners had a false sense that BIP148 was *not* going to
>>> chainsplit from default / segwit2x, they might not follow the news if
>>> suddenly the segwit2x plan were delayed for a few days.  While any
>>> additional support would definitely be cheered on by BIP148
>>> supporters, the practical reality might be that this proposal would
>>> take BIP148 from the "unlikely to have any viable chain after flag day
>>> without segwit2x" category into the "small but viable minority chain"
>>> category, and even worse, it might strengthen the chainsplit just days
>>> before segwit is activated on BOTH chains, putting the BIP148
>>> supporters on the wrong pro-segwit, but still-viable chain.
>>>
>>> If Core had taken a strong stance to include BIP148 into the client,
>>> and if BIP148 support were much much broader, I would feel differently
>>> as the gamble would be more likely to discourage a chainsplit (By
>>> forcing the acceleration of segwit2x) rather than encourage it (by
>>> strengthening an extreme minority chainsplit that may wind up on the
>>> wrong side of two segwit-activated chains).  As it stands now, this
>>> seems like a very dangerous attempt to compromise with a small but
>>> vocal group that are the ones creating the threat to begin with.
>>>
>>> Jared
>>>
>>> On Tue, Jun 6, 2017 at 5:56 PM, James Hilliard via bitcoin-dev
>>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>>> Due to the proposed calendar(https://segwit2x.github.io/) for the
>>>> SegWit2x agreement being too slow to activate SegWit mandatory
>>>> signalling ahead of BIP148 using BIP91 I would like to propose another
>>>> option that miners can use to prevent a chain split ahead of the Aug
>>>> 1st BIP148 activation date.
>>>>
>>>> The splitprotection soft fork is essentially BIP91 but using BIP8
>>>> instead of BIP9 with a lower activation threshold and immediate
>>>> mandatory signalling lock-in. This allows for a majority of miners to
>>>> activate mandatory SegWit signalling and prevent a potential chain
>>>> split ahead of BIP148 activation.
>>>>
>>>> This BIP allows for miners to respond to market forces quickly ahead
>>>> of BIP148 activation by signalling for splitprotection. Any miners
>>>> already running BIP148 should be encouraged to use splitprotection.
>>>>
>>>> <pre>
>>>>   BIP: splitprotection
>>>>   Layer: Consensus (soft fork)
>>>>   Title: User Activated Soft Fork Split Protection
>>>>   Author: James Hilliard <james.hilliard1 at gmail.com>
>>>>   Comments-Summary: No comments yet.
>>>>   Comments-URI:
>>>>   Status: Draft
>>>>   Type: Standards Track
>>>>   Created: 2017-05-22
>>>>   License: BSD-3-Clause
>>>>            CC0-1.0
>>>> </pre>
>>>>
>>>> ==Abstract==
>>>>
>>>> This document specifies a coordination mechanism for a simple majority
>>>> of miners to prevent a chain split ahead of BIP148 activation.
>>>>
>>>> ==Definitions==
>>>>
>>>> "existing segwit deployment" refer to the BIP9 "segwit" deployment
>>>> using bit 1, between November 15th 2016 and November 15th 2017 to
>>>> activate BIP141, BIP143 and BIP147.
>>>>
>>>> ==Motivation==
>>>>
>>>> The biggest risk of BIP148 is an extended chain split, this BIP
>>>> provides a way for a simple majority of miners to eliminate that risk.
>>>>
>>>> This BIP provides a way for a simple majority of miners to coordinate
>>>> activation of the existing segwit deployment with less than 95%
>>>> hashpower before BIP148 activation. Due to time constraints unless
>>>> immediately deployed BIP91 will likely not be able to enforce
>>>> mandatory signalling of segwit before the Aug 1st activation of
>>>> BIP148. This BIP provides a method for rapid miner activation of
>>>> SegWit mandatory signalling ahead of the BIP148 activation date. Since
>>>> the primary goal of this BIP is to reduce the chance of an extended
>>>> chain split as much as possible we activate using a simple miner
>>>> majority of 65% over a 504 block interval rather than a higher
>>>> percentage. This BIP also allows miners to signal their intention to
>>>> run BIP148 in order to prevent a chain split.
>>>>
>>>> ==Specification==
>>>>
>>>> While this BIP is active, all blocks must set the nVersion header top
>>>> 3 bits to 001 together with bit field (1<<1) (according to the
>>>> existing segwit deployment). Blocks that do not signal as required
>>>> will be rejected.
>>>>
>>>> ==Deployment==
>>>>
>>>> This BIP will be deployed by "version bits" with a 65%(this can be
>>>> adjusted if desired) activation threshold BIP9 with the name
>>>> "splitprotecion" and using bit 2.
>>>>
>>>> This BIP starts immediately and is a BIP8 style soft fork since
>>>> mandatory signalling will start on midnight August 1st 2017 (epoch
>>>> time 1501545600) regardless of whether or not this BIP has reached its
>>>> own signalling threshold. This BIP will cease to be active when segwit
>>>> is locked-in.
>>>>
>>>> === Reference implementation ===
>>>>
>>>> <pre>
>>>> // Check if Segregated Witness is Locked In
>>>> bool IsWitnessLockedIn(const CBlockIndex* pindexPrev, const
>>>> Consensus::Params& params)
>>>> {
>>>>     LOCK(cs_main);
>>>>     return (VersionBitsState(pindexPrev, params,
>>>> Consensus::DEPLOYMENT_SEGWIT, versionbitscache) ==
>>>> THRESHOLD_LOCKED_IN);
>>>> }
>>>>
>>>> // SPLITPROTECTION mandatory segwit signalling.
>>>> if ( VersionBitsState(pindex->pprev, chainparams.GetConsensus(),
>>>> Consensus::DEPLOYMENT_SPLITPROTECTION, versionbitscache) ==
>>>> THRESHOLD_LOCKED_IN &&
>>>>      !IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
>>>> // Segwit is not locked in
>>>>      !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus()) ) //
>>>> and is not active.
>>>> {
>>>>     bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
>>>> VERSIONBITS_TOP_BITS;
>>>>     bool fSegbit = (pindex->nVersion &
>>>> VersionBitsMask(chainparams.GetConsensus(),
>>>> Consensus::DEPLOYMENT_SEGWIT)) != 0;
>>>>     if (!(fVersionBits && fSegbit)) {
>>>>         return state.DoS(0, error("ConnectBlock(): relayed block must
>>>> signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
>>>>     }
>>>> }
>>>>
>>>> // BIP148 mandatory segwit signalling.
>>>> int64_t nMedianTimePast = pindex->GetMedianTimePast();
>>>> if ( (nMedianTimePast >= 1501545600) &&  // Tue 01 Aug 2017 00:00:00 UTC
>>>>      (nMedianTimePast <= 1510704000) &&  // Wed 15 Nov 2017 00:00:00 UTC
>>>>      (!IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
>>>>  // Segwit is not locked in
>>>>       !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus())) )
>>>>  // and is not active.
>>>> {
>>>>     bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
>>>> VERSIONBITS_TOP_BITS;
>>>>     bool fSegbit = (pindex->nVersion &
>>>> VersionBitsMask(chainparams.GetConsensus(),
>>>> Consensus::DEPLOYMENT_SEGWIT)) != 0;
>>>>     if (!(fVersionBits && fSegbit)) {
>>>>         return state.DoS(0, error("ConnectBlock(): relayed block must
>>>> signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
>>>>     }
>>>> }
>>>> </pre>
>>>>
>>>> https://github.com/bitcoin/bitcoin/compare/0.14...jameshilliard:splitprotection-v0.14.1
>>>>
>>>> ==Backwards Compatibility==
>>>>
>>>> This deployment is compatible with the existing "segwit" bit 1
>>>> deployment scheduled between midnight November 15th, 2016 and midnight
>>>> November 15th, 2017. This deployment is also compatible with the
>>>> existing BIP148 deployment. This BIP is compatible with BIP91 only if
>>>> BIP91 activates before it and before BIP148. Miners will need to
>>>> upgrade their nodes to support splitprotection otherwise they may
>>>> build on top of an invalid block. While this bip is active users
>>>> should either upgrade to splitprotection or wait for additional
>>>> confirmations when accepting payments.
>>>>
>>>> ==Rationale==
>>>>
>>>> Historically we have used IsSuperMajority() to activate soft forks
>>>> such as BIP66 which has a mandatory signalling requirement for miners
>>>> once activated, this ensures that miners are aware of new rules being
>>>> enforced. This technique can be leveraged to lower the signalling
>>>> threshold of a soft fork while it is in the process of being deployed
>>>> in a backwards compatible way. We also use a BIP8 style timeout to
>>>> ensure that this BIP is compatible with BIP148 and that BIP148
>>>> compatible mandatory signalling activates regardless of miner
>>>> signalling levels.
>>>>
>>>> By orphaning non-signalling blocks during the BIP9 bit 1 "segwit"
>>>> deployment, this BIP can cause the existing "segwit" deployment to
>>>> activate without needing to release a new deployment. As we approach
>>>> BIP148 activation it may be desirable for a majority of miners to have
>>>> a method that will ensure that there is no chain split.
>>>>
>>>> ==References==
>>>>
>>>> *[https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-March/013714.html
>>>> Mailing list discussion]
>>>> *[https://github.com/bitcoin/bitcoin/blob/v0.6.0/src/main.cpp#L1281-L1283
>>>> P2SH flag day activation]
>>>> *[[bip-0009.mediawiki|BIP9 Version bits with timeout and delay]]
>>>> *[[bip-0016.mediawiki|BIP16 Pay to Script Hash]]
>>>> *[[bip-0091.mediawiki|BIP91 Reduced threshold Segwit MASF]]
>>>> *[[bip-0141.mediawiki|BIP141 Segregated Witness (Consensus layer)]]
>>>> *[[bip-0143.mediawiki|BIP143 Transaction Signature Verification for
>>>> Version 0 Witness Program]]
>>>> *[[bip-0147.mediawiki|BIP147 Dealing with dummy stack element malleability]]
>>>> *[[bip-0148.mediawiki|BIP148 Mandatory activation of segwit deployment]]
>>>> *[[bip-0149.mediawiki|BIP149 Segregated Witness (second deployment)]]
>>>> *[https://bitcoincore.org/en/2016/01/26/segwit-benefits/ Segwit benefits]
>>>>
>>>> ==Copyright==
>>>>
>>>> This document is dual licensed as BSD 3-clause, and Creative Commons
>>>> CC0 1.0 Universal.
>>>> _______________________________________________
>>>> bitcoin-dev mailing list
>>>> bitcoin-dev at lists.linuxfoundation.org
>>>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev

From jaredr26 at gmail.com  Wed Jun  7 22:53:14 2017
From: jaredr26 at gmail.com (Jared Lee Richardson)
Date: Wed, 7 Jun 2017 15:53:14 -0700
Subject: [bitcoin-dev] User Activated Soft Fork Split Protection
In-Reply-To: <CADvTj4poO1L+Wg5J+M71sJMz-Xcg_st3MkAcQK=bfHhTJ3i8ow@mail.gmail.com>
References: <CADvTj4qpH-t5Gx6qyn3yToyUE_GFaBE989=AWNHLKMpMNW3R+w@mail.gmail.com>
	<CAD1TkXviJouao7YoHjiDN3mTUWFEbMY9mtCqkQ8zp8JthyhT7Q@mail.gmail.com>
	<CADvTj4rz4exYMvBEmYi=bTZDgDm0drLjpRZmZUo17inzCzCRVg@mail.gmail.com>
	<CAD1TkXskei1gk_kungSvdWGmbdJMA8AG+-zK+Osz6u5vSCN8BQ@mail.gmail.com>
	<CADvTj4poO1L+Wg5J+M71sJMz-Xcg_st3MkAcQK=bfHhTJ3i8ow@mail.gmail.com>
Message-ID: <CAD1TkXumetRnPO6LxhJeVoci=0=YHD7hEB0K0YH+2McRBJ-QHw@mail.gmail.com>

> There are 2 primary factors involved here, economic support and
hashpower either of which is enough to make a permanent chain split
unlikely, miners will mine whichever chain is most profitable(see
ETH/ETC hashpower profitability equilibrium for an example of how this
works in practice)

That's not a comparable example.  ETC did not face potentially years of
slow blocktimes before it normalized, whereas BIP148 is on track to do
exactly that.  Moreover, ETC represented a fundamental break from the
majority consensus that could not be rectified, whereas BIP148 represents
only a minority attempt to accelerate something that an overwhelming
majority of miners have already agreed to activate under segwit2x.  Lastly
ETC was required to add replay protection, just like any minority fork
proposed by any crypto-currency has been, something that BIP148 both lacks
and refuses to add or even acknowledge the necessity of.  Without replay
protection, ETC could not have become profitable enough to be a viable
minority chain.  If BIP148's chain is not the majority chain and it does
not have replay protection, it will face the same problems, but that
required replay protection will turn it into a hardfork.  This will be a
very bad position for UASF supporters to find themselves in - Either
hardfork and hope the price is higher and the majority converts, or die as
the minority chain with no reliable methods of economic conversion.

I believe, but don't have data to back this, that most of the BIP148
insistence comes not from a legitimate attempt to gain consensus (or else
they would either outright oppose segwit2mb for its hardfork, or they would
outright support it), but rather from an attempt for BIP148 supporters to
save face for BIP148 being a failure.  If I'm correct, that's a terrible
and highly non-technical reason for segwit2mb to bend over backwards
attempting to support BIP148's attempt to save face.

> The main issue is just one of activation timelines, BIP91 as
is takes too long to activate unless started ahead of the existing
segwit2x schedule and it's unlikely that BIP148 will get pushed back
any further.

Even if I'm not correct on the above, I and others find it hard to accept
that this timeline conflict is segwit2x's fault.  Segwit2x has both some
flexibility and broad support that crosses contentious pro-segwit and
pro-blocksize-increase divisions that have existed for two years.  BIP148
is attempting to hold segwit2x's timelines and code hostage by claiming
inflexibility and claiming broad support, and not only are neither of those
assertions are backed by real data, BIP148 (by being so inflexible) is
pushing a position that deepens the divides between those groups.  For
there to be technical reasons for compatibility (so long as there are
tradeoffs, which there are), there needs to be hard data showing that
BIP148 is a viable minority fork that won't simply die off on its own.

Jared


On Wed, Jun 7, 2017 at 3:23 PM, James Hilliard <james.hilliard1 at gmail.com>
wrote:

> On Wed, Jun 7, 2017 at 4:50 PM, Jared Lee Richardson <jaredr26 at gmail.com>
> wrote:
> > Could this risk mitigation measure be an optional flag?  And if so,
> > could it+BIP91 signal on a different bit than bit4?
> It's fairly trivial for miners to signal for BIP91 on bit4 or a
> different bit at the same time as the code is trivial enough to
> combine
> >
> > The reason being, if for some reason the segwit2x activation cannot
> > take place in time, it would be preferable for miners to have a more
> > standard approach to activation that requires stronger consensus and
> > may be more forgiving than BIP148.  If the segwit2x activation is on
> > time to cooperate with BIP148, it could be signaled through the
> > non-bit4 approach and everything could go smoothly.  Thoughts on that
> > idea?  It may add more complexity and more developer time, but may
> > also address your concerns among others.
> This does give miners another approach to activate segwit ahead of
> BIP148, if segwit2x activation is rolled out and activated immediately
> then this would not be needed however based on the timeline here
> https://segwit2x.github.io/ it would not be possible for BIP91 to
> enforce mandatory signalling ahead of BIP148. Maybe that can be
> changed though, I've suggested an immediate rollout with a placeholder
> client timeout instead of the HF code initially in order to accelerate
> that.
> >
> >> Since this BIP
> >> only activates with a clear miner majority it should not increase the
> >> risk of an extended chain split.
> >
> > The concern I'm raising is more about the psychology of giving BIP148
> > a sense of safety that may not be valid.  Without several more steps,
> > BIP148 is definitely on track to be a risky chainsplit, and without
> > segwit2x it will almost certainly be a small minority chain. (Unless
> > the segwit2x compromise falls apart before then, and even in that case
> > it is likely to be a minority chain)
> There are 2 primary factors involved here, economic support and
> hashpower either of which is enough to make a permanent chain split
> unlikely, miners will mine whichever chain is most profitable(see
> ETH/ETC hashpower profitability equilibrium for an example of how this
> works in practice) however there may be lag time immediately after the
> split if there is an economic majority but not a hashpower majority
> initially. This is risk mitigation that only requires miners support
> however. The main issue is just one of activation timelines, BIP91 as
> is takes too long to activate unless started ahead of the existing
> segwit2x schedule and it's unlikely that BIP148 will get pushed back
> any further.
> >
> > Jared
> >
> >
> > On Wed, Jun 7, 2017 at 2:42 PM, James Hilliard
> > <james.hilliard1 at gmail.com> wrote:
> >> I don't really see how this would increase the likelihood of an
> >> extended chain split assuming BIP148 is going to have
> >> non-insignificant economic backing. This BIP is designed to provide a
> >> risk mitigation measure that miners can safely deploy. Since this BIP
> >> only activates with a clear miner majority it should not increase the
> >> risk of an extended chain split. At this point it is not completely
> >> clear how much economic support there is for BIP148 but support
> >> certainly seems to be growing and we have nearly 2 months until BIP148
> >> activation. I intentionally used a shorter activation period here so
> >> that decisions by miners can be made close to the BIP148 activation
> >> date.
> >>
> >> On Wed, Jun 7, 2017 at 4:29 PM, Jared Lee Richardson <
> jaredr26 at gmail.com> wrote:
> >>> I think this BIP represents a gamble, and the gamble may not be a good
> >>> one.  The gamble here is that if the segwit2x changes are rolled out
> >>> on time, and if the signatories accept the bit4 + bit1 signaling
> >>> proposals within BIP91, the launch will go smoother, as intended.  But
> >>> conversely, if either the segwit2x signatories balk about the Bit1
> >>> signaling OR if the timelines for segwit2mb are missed even by a bit,
> >>> it may cause the BIP148 chainsplit to be worse than it would be
> >>> without.  Given the frequent concerns raised in multiple places about
> >>> the aggressiveness of the segwit2x timelines, including the
> >>> non-hardfork timelines, this does not seem like a great gamble to be
> >>> making.
> >>>
> >>> The reason I say it may make the chainsplit be worse than it would
> >>> otherwise be is that it may provide a false sense of safety for BIP148
> >>> that currently does not currently exist(and should not, as it is a
> >>> chainsplit).  That sense of safety would only be legitimate if the
> >>> segwit2x signatories were on board, and the segwit2x code effectively
> >>> enforced BIP148 simultaneously, neither of which are guaranteed.  If
> >>> users and more miners had a false sense that BIP148 was *not* going to
> >>> chainsplit from default / segwit2x, they might not follow the news if
> >>> suddenly the segwit2x plan were delayed for a few days.  While any
> >>> additional support would definitely be cheered on by BIP148
> >>> supporters, the practical reality might be that this proposal would
> >>> take BIP148 from the "unlikely to have any viable chain after flag day
> >>> without segwit2x" category into the "small but viable minority chain"
> >>> category, and even worse, it might strengthen the chainsplit just days
> >>> before segwit is activated on BOTH chains, putting the BIP148
> >>> supporters on the wrong pro-segwit, but still-viable chain.
> >>>
> >>> If Core had taken a strong stance to include BIP148 into the client,
> >>> and if BIP148 support were much much broader, I would feel differently
> >>> as the gamble would be more likely to discourage a chainsplit (By
> >>> forcing the acceleration of segwit2x) rather than encourage it (by
> >>> strengthening an extreme minority chainsplit that may wind up on the
> >>> wrong side of two segwit-activated chains).  As it stands now, this
> >>> seems like a very dangerous attempt to compromise with a small but
> >>> vocal group that are the ones creating the threat to begin with.
> >>>
> >>> Jared
> >>>
> >>> On Tue, Jun 6, 2017 at 5:56 PM, James Hilliard via bitcoin-dev
> >>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
> >>>> Due to the proposed calendar(https://segwit2x.github.io/) for the
> >>>> SegWit2x agreement being too slow to activate SegWit mandatory
> >>>> signalling ahead of BIP148 using BIP91 I would like to propose another
> >>>> option that miners can use to prevent a chain split ahead of the Aug
> >>>> 1st BIP148 activation date.
> >>>>
> >>>> The splitprotection soft fork is essentially BIP91 but using BIP8
> >>>> instead of BIP9 with a lower activation threshold and immediate
> >>>> mandatory signalling lock-in. This allows for a majority of miners to
> >>>> activate mandatory SegWit signalling and prevent a potential chain
> >>>> split ahead of BIP148 activation.
> >>>>
> >>>> This BIP allows for miners to respond to market forces quickly ahead
> >>>> of BIP148 activation by signalling for splitprotection. Any miners
> >>>> already running BIP148 should be encouraged to use splitprotection.
> >>>>
> >>>> <pre>
> >>>>   BIP: splitprotection
> >>>>   Layer: Consensus (soft fork)
> >>>>   Title: User Activated Soft Fork Split Protection
> >>>>   Author: James Hilliard <james.hilliard1 at gmail.com>
> >>>>   Comments-Summary: No comments yet.
> >>>>   Comments-URI:
> >>>>   Status: Draft
> >>>>   Type: Standards Track
> >>>>   Created: 2017-05-22
> >>>>   License: BSD-3-Clause
> >>>>            CC0-1.0
> >>>> </pre>
> >>>>
> >>>> ==Abstract==
> >>>>
> >>>> This document specifies a coordination mechanism for a simple majority
> >>>> of miners to prevent a chain split ahead of BIP148 activation.
> >>>>
> >>>> ==Definitions==
> >>>>
> >>>> "existing segwit deployment" refer to the BIP9 "segwit" deployment
> >>>> using bit 1, between November 15th 2016 and November 15th 2017 to
> >>>> activate BIP141, BIP143 and BIP147.
> >>>>
> >>>> ==Motivation==
> >>>>
> >>>> The biggest risk of BIP148 is an extended chain split, this BIP
> >>>> provides a way for a simple majority of miners to eliminate that risk.
> >>>>
> >>>> This BIP provides a way for a simple majority of miners to coordinate
> >>>> activation of the existing segwit deployment with less than 95%
> >>>> hashpower before BIP148 activation. Due to time constraints unless
> >>>> immediately deployed BIP91 will likely not be able to enforce
> >>>> mandatory signalling of segwit before the Aug 1st activation of
> >>>> BIP148. This BIP provides a method for rapid miner activation of
> >>>> SegWit mandatory signalling ahead of the BIP148 activation date. Since
> >>>> the primary goal of this BIP is to reduce the chance of an extended
> >>>> chain split as much as possible we activate using a simple miner
> >>>> majority of 65% over a 504 block interval rather than a higher
> >>>> percentage. This BIP also allows miners to signal their intention to
> >>>> run BIP148 in order to prevent a chain split.
> >>>>
> >>>> ==Specification==
> >>>>
> >>>> While this BIP is active, all blocks must set the nVersion header top
> >>>> 3 bits to 001 together with bit field (1<<1) (according to the
> >>>> existing segwit deployment). Blocks that do not signal as required
> >>>> will be rejected.
> >>>>
> >>>> ==Deployment==
> >>>>
> >>>> This BIP will be deployed by "version bits" with a 65%(this can be
> >>>> adjusted if desired) activation threshold BIP9 with the name
> >>>> "splitprotecion" and using bit 2.
> >>>>
> >>>> This BIP starts immediately and is a BIP8 style soft fork since
> >>>> mandatory signalling will start on midnight August 1st 2017 (epoch
> >>>> time 1501545600) regardless of whether or not this BIP has reached its
> >>>> own signalling threshold. This BIP will cease to be active when segwit
> >>>> is locked-in.
> >>>>
> >>>> === Reference implementation ===
> >>>>
> >>>> <pre>
> >>>> // Check if Segregated Witness is Locked In
> >>>> bool IsWitnessLockedIn(const CBlockIndex* pindexPrev, const
> >>>> Consensus::Params& params)
> >>>> {
> >>>>     LOCK(cs_main);
> >>>>     return (VersionBitsState(pindexPrev, params,
> >>>> Consensus::DEPLOYMENT_SEGWIT, versionbitscache) ==
> >>>> THRESHOLD_LOCKED_IN);
> >>>> }
> >>>>
> >>>> // SPLITPROTECTION mandatory segwit signalling.
> >>>> if ( VersionBitsState(pindex->pprev, chainparams.GetConsensus(),
> >>>> Consensus::DEPLOYMENT_SPLITPROTECTION, versionbitscache) ==
> >>>> THRESHOLD_LOCKED_IN &&
> >>>>      !IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
> >>>> // Segwit is not locked in
> >>>>      !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus()) )
> //
> >>>> and is not active.
> >>>> {
> >>>>     bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
> >>>> VERSIONBITS_TOP_BITS;
> >>>>     bool fSegbit = (pindex->nVersion &
> >>>> VersionBitsMask(chainparams.GetConsensus(),
> >>>> Consensus::DEPLOYMENT_SEGWIT)) != 0;
> >>>>     if (!(fVersionBits && fSegbit)) {
> >>>>         return state.DoS(0, error("ConnectBlock(): relayed block must
> >>>> signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
> >>>>     }
> >>>> }
> >>>>
> >>>> // BIP148 mandatory segwit signalling.
> >>>> int64_t nMedianTimePast = pindex->GetMedianTimePast();
> >>>> if ( (nMedianTimePast >= 1501545600) &&  // Tue 01 Aug 2017 00:00:00
> UTC
> >>>>      (nMedianTimePast <= 1510704000) &&  // Wed 15 Nov 2017 00:00:00
> UTC
> >>>>      (!IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus())
> &&
> >>>>  // Segwit is not locked in
> >>>>       !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus())) )
> >>>>  // and is not active.
> >>>> {
> >>>>     bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
> >>>> VERSIONBITS_TOP_BITS;
> >>>>     bool fSegbit = (pindex->nVersion &
> >>>> VersionBitsMask(chainparams.GetConsensus(),
> >>>> Consensus::DEPLOYMENT_SEGWIT)) != 0;
> >>>>     if (!(fVersionBits && fSegbit)) {
> >>>>         return state.DoS(0, error("ConnectBlock(): relayed block must
> >>>> signal for segwit, please upgrade"), REJECT_INVALID, "bad-no-segwit");
> >>>>     }
> >>>> }
> >>>> </pre>
> >>>>
> >>>> https://github.com/bitcoin/bitcoin/compare/0.14...
> jameshilliard:splitprotection-v0.14.1
> >>>>
> >>>> ==Backwards Compatibility==
> >>>>
> >>>> This deployment is compatible with the existing "segwit" bit 1
> >>>> deployment scheduled between midnight November 15th, 2016 and midnight
> >>>> November 15th, 2017. This deployment is also compatible with the
> >>>> existing BIP148 deployment. This BIP is compatible with BIP91 only if
> >>>> BIP91 activates before it and before BIP148. Miners will need to
> >>>> upgrade their nodes to support splitprotection otherwise they may
> >>>> build on top of an invalid block. While this bip is active users
> >>>> should either upgrade to splitprotection or wait for additional
> >>>> confirmations when accepting payments.
> >>>>
> >>>> ==Rationale==
> >>>>
> >>>> Historically we have used IsSuperMajority() to activate soft forks
> >>>> such as BIP66 which has a mandatory signalling requirement for miners
> >>>> once activated, this ensures that miners are aware of new rules being
> >>>> enforced. This technique can be leveraged to lower the signalling
> >>>> threshold of a soft fork while it is in the process of being deployed
> >>>> in a backwards compatible way. We also use a BIP8 style timeout to
> >>>> ensure that this BIP is compatible with BIP148 and that BIP148
> >>>> compatible mandatory signalling activates regardless of miner
> >>>> signalling levels.
> >>>>
> >>>> By orphaning non-signalling blocks during the BIP9 bit 1 "segwit"
> >>>> deployment, this BIP can cause the existing "segwit" deployment to
> >>>> activate without needing to release a new deployment. As we approach
> >>>> BIP148 activation it may be desirable for a majority of miners to have
> >>>> a method that will ensure that there is no chain split.
> >>>>
> >>>> ==References==
> >>>>
> >>>> *[https://lists.linuxfoundation.org/pipermail/
> bitcoin-dev/2017-March/013714.html
> >>>> Mailing list discussion]
> >>>> *[https://github.com/bitcoin/bitcoin/blob/v0.6.0/src/main.
> cpp#L1281-L1283
> >>>> P2SH flag day activation]
> >>>> *[[bip-0009.mediawiki|BIP9 Version bits with timeout and delay]]
> >>>> *[[bip-0016.mediawiki|BIP16 Pay to Script Hash]]
> >>>> *[[bip-0091.mediawiki|BIP91 Reduced threshold Segwit MASF]]
> >>>> *[[bip-0141.mediawiki|BIP141 Segregated Witness (Consensus layer)]]
> >>>> *[[bip-0143.mediawiki|BIP143 Transaction Signature Verification for
> >>>> Version 0 Witness Program]]
> >>>> *[[bip-0147.mediawiki|BIP147 Dealing with dummy stack element
> malleability]]
> >>>> *[[bip-0148.mediawiki|BIP148 Mandatory activation of segwit
> deployment]]
> >>>> *[[bip-0149.mediawiki|BIP149 Segregated Witness (second deployment)]]
> >>>> *[https://bitcoincore.org/en/2016/01/26/segwit-benefits/ Segwit
> benefits]
> >>>>
> >>>> ==Copyright==
> >>>>
> >>>> This document is dual licensed as BSD 3-clause, and Creative Commons
> >>>> CC0 1.0 Universal.
> >>>> _______________________________________________
> >>>> bitcoin-dev mailing list
> >>>> bitcoin-dev at lists.linuxfoundation.org
> >>>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170607/304cb174/attachment-0001.html>

From james.hilliard1 at gmail.com  Wed Jun  7 23:11:00 2017
From: james.hilliard1 at gmail.com (James Hilliard)
Date: Wed, 7 Jun 2017 18:11:00 -0500
Subject: [bitcoin-dev] User Activated Soft Fork Split Protection
In-Reply-To: <CAD1TkXumetRnPO6LxhJeVoci=0=YHD7hEB0K0YH+2McRBJ-QHw@mail.gmail.com>
References: <CADvTj4qpH-t5Gx6qyn3yToyUE_GFaBE989=AWNHLKMpMNW3R+w@mail.gmail.com>
	<CAD1TkXviJouao7YoHjiDN3mTUWFEbMY9mtCqkQ8zp8JthyhT7Q@mail.gmail.com>
	<CADvTj4rz4exYMvBEmYi=bTZDgDm0drLjpRZmZUo17inzCzCRVg@mail.gmail.com>
	<CAD1TkXskei1gk_kungSvdWGmbdJMA8AG+-zK+Osz6u5vSCN8BQ@mail.gmail.com>
	<CADvTj4poO1L+Wg5J+M71sJMz-Xcg_st3MkAcQK=bfHhTJ3i8ow@mail.gmail.com>
	<CAD1TkXumetRnPO6LxhJeVoci=0=YHD7hEB0K0YH+2McRBJ-QHw@mail.gmail.com>
Message-ID: <CADvTj4pFna4tX37XmgrP7ueZB+Yv4T9NWmp99CwKSx5mzdiJJQ@mail.gmail.com>

On Wed, Jun 7, 2017 at 5:53 PM, Jared Lee Richardson <jaredr26 at gmail.com> wrote:
>> There are 2 primary factors involved here, economic support and
> hashpower either of which is enough to make a permanent chain split
> unlikely, miners will mine whichever chain is most profitable(see
> ETH/ETC hashpower profitability equilibrium for an example of how this
> works in practice)
>
> That's not a comparable example.  ETC did not face potentially years of slow
> blocktimes before it normalized, whereas BIP148 is on track to do exactly
> that.  Moreover, ETC represented a fundamental break from the majority
> consensus that could not be rectified, whereas BIP148 represents only a
> minority attempt to accelerate something that an overwhelming majority of
> miners have already agreed to activate under segwit2x.  Lastly ETC was
> required to add replay protection, just like any minority fork proposed by
> any crypto-currency has been, something that BIP148 both lacks and refuses
> to add or even acknowledge the necessity of.  Without replay protection, ETC
> could not have become profitable enough to be a viable minority chain.  If
> BIP148's chain is not the majority chain and it does not have replay
> protection, it will face the same problems, but that required replay
> protection will turn it into a hardfork.  This will be a very bad position
> for UASF supporters to find themselves in - Either hardfork and hope the
> price is higher and the majority converts, or die as the minority chain with
> no reliable methods of economic conversion.
Higher transaction fees on a minority chain can compensate miners for
a lower price which would likely be enough to get the BIP148 chain to
a difficulty reduction. BIP148 however is a consensus change that can
be rectified if it gets more work, this would act as an additional
incentive for mine the BIP148 side since there would be no wipeout
risk there. ETC replay protection was done after the fork on an as
needed basis(there are multiple reliable techniques that can be used
to split UTXO's), the same can happen with BIP148 and it is easier to
do with Bitcoin than with the ETH/ETC split IMO.
>
> I believe, but don't have data to back this, that most of the BIP148
> insistence comes not from a legitimate attempt to gain consensus (or else
> they would either outright oppose segwit2mb for its hardfork, or they would
> outright support it), but rather from an attempt for BIP148 supporters to
> save face for BIP148 being a failure.  If I'm correct, that's a terrible and
> highly non-technical reason for segwit2mb to bend over backwards attempting
> to support BIP148's attempt to save face.
A big reason BIP148 still has support is because up until SegWit
actually activates there's no guarantee segwit2mb will actually have
the necessary support to activate SegWit.
>
>> The main issue is just one of activation timelines, BIP91 as
> is takes too long to activate unless started ahead of the existing
> segwit2x schedule and it's unlikely that BIP148 will get pushed back
> any further.
>
> Even if I'm not correct on the above, I and others find it hard to accept
> that this timeline conflict is segwit2x's fault.  Segwit2x has both some
> flexibility and broad support that crosses contentious pro-segwit and
> pro-blocksize-increase divisions that have existed for two years.  BIP148 is
> attempting to hold segwit2x's timelines and code hostage by claiming
> inflexibility and claiming broad support, and not only are neither of those
> assertions are backed by real data, BIP148 (by being so inflexible) is
> pushing a position that deepens the divides between those groups.  For there
> to be technical reasons for compatibility (so long as there are tradeoffs,
> which there are), there needs to be hard data showing that BIP148 is a
> viable minority fork that won't simply die off on its own.
This is largely an issue due to segwit2x's bundling, if the SW and HF
part of segwit2x were unbundled then there would be no reason to delay
BIP91 activation, this is especially a problem since it takes a good
deal of time to properly code and test a HF. Unfortunately segwit2x
has been quite inflexible in regards to the bundling aspect even
though there are clearly no technical reasons for it to be there.
>
> Jared
>
>
> On Wed, Jun 7, 2017 at 3:23 PM, James Hilliard <james.hilliard1 at gmail.com>
> wrote:
>>
>> On Wed, Jun 7, 2017 at 4:50 PM, Jared Lee Richardson <jaredr26 at gmail.com>
>> wrote:
>> > Could this risk mitigation measure be an optional flag?  And if so,
>> > could it+BIP91 signal on a different bit than bit4?
>> It's fairly trivial for miners to signal for BIP91 on bit4 or a
>> different bit at the same time as the code is trivial enough to
>> combine
>> >
>> > The reason being, if for some reason the segwit2x activation cannot
>> > take place in time, it would be preferable for miners to have a more
>> > standard approach to activation that requires stronger consensus and
>> > may be more forgiving than BIP148.  If the segwit2x activation is on
>> > time to cooperate with BIP148, it could be signaled through the
>> > non-bit4 approach and everything could go smoothly.  Thoughts on that
>> > idea?  It may add more complexity and more developer time, but may
>> > also address your concerns among others.
>> This does give miners another approach to activate segwit ahead of
>> BIP148, if segwit2x activation is rolled out and activated immediately
>> then this would not be needed however based on the timeline here
>> https://segwit2x.github.io/ it would not be possible for BIP91 to
>> enforce mandatory signalling ahead of BIP148. Maybe that can be
>> changed though, I've suggested an immediate rollout with a placeholder
>> client timeout instead of the HF code initially in order to accelerate
>> that.
>> >
>> >> Since this BIP
>> >> only activates with a clear miner majority it should not increase the
>> >> risk of an extended chain split.
>> >
>> > The concern I'm raising is more about the psychology of giving BIP148
>> > a sense of safety that may not be valid.  Without several more steps,
>> > BIP148 is definitely on track to be a risky chainsplit, and without
>> > segwit2x it will almost certainly be a small minority chain. (Unless
>> > the segwit2x compromise falls apart before then, and even in that case
>> > it is likely to be a minority chain)
>> There are 2 primary factors involved here, economic support and
>> hashpower either of which is enough to make a permanent chain split
>> unlikely, miners will mine whichever chain is most profitable(see
>> ETH/ETC hashpower profitability equilibrium for an example of how this
>> works in practice) however there may be lag time immediately after the
>> split if there is an economic majority but not a hashpower majority
>> initially. This is risk mitigation that only requires miners support
>> however. The main issue is just one of activation timelines, BIP91 as
>> is takes too long to activate unless started ahead of the existing
>> segwit2x schedule and it's unlikely that BIP148 will get pushed back
>> any further.
>> >
>> > Jared
>> >
>> >
>> > On Wed, Jun 7, 2017 at 2:42 PM, James Hilliard
>> > <james.hilliard1 at gmail.com> wrote:
>> >> I don't really see how this would increase the likelihood of an
>> >> extended chain split assuming BIP148 is going to have
>> >> non-insignificant economic backing. This BIP is designed to provide a
>> >> risk mitigation measure that miners can safely deploy. Since this BIP
>> >> only activates with a clear miner majority it should not increase the
>> >> risk of an extended chain split. At this point it is not completely
>> >> clear how much economic support there is for BIP148 but support
>> >> certainly seems to be growing and we have nearly 2 months until BIP148
>> >> activation. I intentionally used a shorter activation period here so
>> >> that decisions by miners can be made close to the BIP148 activation
>> >> date.
>> >>
>> >> On Wed, Jun 7, 2017 at 4:29 PM, Jared Lee Richardson
>> >> <jaredr26 at gmail.com> wrote:
>> >>> I think this BIP represents a gamble, and the gamble may not be a good
>> >>> one.  The gamble here is that if the segwit2x changes are rolled out
>> >>> on time, and if the signatories accept the bit4 + bit1 signaling
>> >>> proposals within BIP91, the launch will go smoother, as intended.  But
>> >>> conversely, if either the segwit2x signatories balk about the Bit1
>> >>> signaling OR if the timelines for segwit2mb are missed even by a bit,
>> >>> it may cause the BIP148 chainsplit to be worse than it would be
>> >>> without.  Given the frequent concerns raised in multiple places about
>> >>> the aggressiveness of the segwit2x timelines, including the
>> >>> non-hardfork timelines, this does not seem like a great gamble to be
>> >>> making.
>> >>>
>> >>> The reason I say it may make the chainsplit be worse than it would
>> >>> otherwise be is that it may provide a false sense of safety for BIP148
>> >>> that currently does not currently exist(and should not, as it is a
>> >>> chainsplit).  That sense of safety would only be legitimate if the
>> >>> segwit2x signatories were on board, and the segwit2x code effectively
>> >>> enforced BIP148 simultaneously, neither of which are guaranteed.  If
>> >>> users and more miners had a false sense that BIP148 was *not* going to
>> >>> chainsplit from default / segwit2x, they might not follow the news if
>> >>> suddenly the segwit2x plan were delayed for a few days.  While any
>> >>> additional support would definitely be cheered on by BIP148
>> >>> supporters, the practical reality might be that this proposal would
>> >>> take BIP148 from the "unlikely to have any viable chain after flag day
>> >>> without segwit2x" category into the "small but viable minority chain"
>> >>> category, and even worse, it might strengthen the chainsplit just days
>> >>> before segwit is activated on BOTH chains, putting the BIP148
>> >>> supporters on the wrong pro-segwit, but still-viable chain.
>> >>>
>> >>> If Core had taken a strong stance to include BIP148 into the client,
>> >>> and if BIP148 support were much much broader, I would feel differently
>> >>> as the gamble would be more likely to discourage a chainsplit (By
>> >>> forcing the acceleration of segwit2x) rather than encourage it (by
>> >>> strengthening an extreme minority chainsplit that may wind up on the
>> >>> wrong side of two segwit-activated chains).  As it stands now, this
>> >>> seems like a very dangerous attempt to compromise with a small but
>> >>> vocal group that are the ones creating the threat to begin with.
>> >>>
>> >>> Jared
>> >>>
>> >>> On Tue, Jun 6, 2017 at 5:56 PM, James Hilliard via bitcoin-dev
>> >>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>> >>>> Due to the proposed calendar(https://segwit2x.github.io/) for the
>> >>>> SegWit2x agreement being too slow to activate SegWit mandatory
>> >>>> signalling ahead of BIP148 using BIP91 I would like to propose
>> >>>> another
>> >>>> option that miners can use to prevent a chain split ahead of the Aug
>> >>>> 1st BIP148 activation date.
>> >>>>
>> >>>> The splitprotection soft fork is essentially BIP91 but using BIP8
>> >>>> instead of BIP9 with a lower activation threshold and immediate
>> >>>> mandatory signalling lock-in. This allows for a majority of miners to
>> >>>> activate mandatory SegWit signalling and prevent a potential chain
>> >>>> split ahead of BIP148 activation.
>> >>>>
>> >>>> This BIP allows for miners to respond to market forces quickly ahead
>> >>>> of BIP148 activation by signalling for splitprotection. Any miners
>> >>>> already running BIP148 should be encouraged to use splitprotection.
>> >>>>
>> >>>> <pre>
>> >>>>   BIP: splitprotection
>> >>>>   Layer: Consensus (soft fork)
>> >>>>   Title: User Activated Soft Fork Split Protection
>> >>>>   Author: James Hilliard <james.hilliard1 at gmail.com>
>> >>>>   Comments-Summary: No comments yet.
>> >>>>   Comments-URI:
>> >>>>   Status: Draft
>> >>>>   Type: Standards Track
>> >>>>   Created: 2017-05-22
>> >>>>   License: BSD-3-Clause
>> >>>>            CC0-1.0
>> >>>> </pre>
>> >>>>
>> >>>> ==Abstract==
>> >>>>
>> >>>> This document specifies a coordination mechanism for a simple
>> >>>> majority
>> >>>> of miners to prevent a chain split ahead of BIP148 activation.
>> >>>>
>> >>>> ==Definitions==
>> >>>>
>> >>>> "existing segwit deployment" refer to the BIP9 "segwit" deployment
>> >>>> using bit 1, between November 15th 2016 and November 15th 2017 to
>> >>>> activate BIP141, BIP143 and BIP147.
>> >>>>
>> >>>> ==Motivation==
>> >>>>
>> >>>> The biggest risk of BIP148 is an extended chain split, this BIP
>> >>>> provides a way for a simple majority of miners to eliminate that
>> >>>> risk.
>> >>>>
>> >>>> This BIP provides a way for a simple majority of miners to coordinate
>> >>>> activation of the existing segwit deployment with less than 95%
>> >>>> hashpower before BIP148 activation. Due to time constraints unless
>> >>>> immediately deployed BIP91 will likely not be able to enforce
>> >>>> mandatory signalling of segwit before the Aug 1st activation of
>> >>>> BIP148. This BIP provides a method for rapid miner activation of
>> >>>> SegWit mandatory signalling ahead of the BIP148 activation date.
>> >>>> Since
>> >>>> the primary goal of this BIP is to reduce the chance of an extended
>> >>>> chain split as much as possible we activate using a simple miner
>> >>>> majority of 65% over a 504 block interval rather than a higher
>> >>>> percentage. This BIP also allows miners to signal their intention to
>> >>>> run BIP148 in order to prevent a chain split.
>> >>>>
>> >>>> ==Specification==
>> >>>>
>> >>>> While this BIP is active, all blocks must set the nVersion header top
>> >>>> 3 bits to 001 together with bit field (1<<1) (according to the
>> >>>> existing segwit deployment). Blocks that do not signal as required
>> >>>> will be rejected.
>> >>>>
>> >>>> ==Deployment==
>> >>>>
>> >>>> This BIP will be deployed by "version bits" with a 65%(this can be
>> >>>> adjusted if desired) activation threshold BIP9 with the name
>> >>>> "splitprotecion" and using bit 2.
>> >>>>
>> >>>> This BIP starts immediately and is a BIP8 style soft fork since
>> >>>> mandatory signalling will start on midnight August 1st 2017 (epoch
>> >>>> time 1501545600) regardless of whether or not this BIP has reached
>> >>>> its
>> >>>> own signalling threshold. This BIP will cease to be active when
>> >>>> segwit
>> >>>> is locked-in.
>> >>>>
>> >>>> === Reference implementation ===
>> >>>>
>> >>>> <pre>
>> >>>> // Check if Segregated Witness is Locked In
>> >>>> bool IsWitnessLockedIn(const CBlockIndex* pindexPrev, const
>> >>>> Consensus::Params& params)
>> >>>> {
>> >>>>     LOCK(cs_main);
>> >>>>     return (VersionBitsState(pindexPrev, params,
>> >>>> Consensus::DEPLOYMENT_SEGWIT, versionbitscache) ==
>> >>>> THRESHOLD_LOCKED_IN);
>> >>>> }
>> >>>>
>> >>>> // SPLITPROTECTION mandatory segwit signalling.
>> >>>> if ( VersionBitsState(pindex->pprev, chainparams.GetConsensus(),
>> >>>> Consensus::DEPLOYMENT_SPLITPROTECTION, versionbitscache) ==
>> >>>> THRESHOLD_LOCKED_IN &&
>> >>>>      !IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus()) &&
>> >>>> // Segwit is not locked in
>> >>>>      !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus()) )
>> >>>> //
>> >>>> and is not active.
>> >>>> {
>> >>>>     bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
>> >>>> VERSIONBITS_TOP_BITS;
>> >>>>     bool fSegbit = (pindex->nVersion &
>> >>>> VersionBitsMask(chainparams.GetConsensus(),
>> >>>> Consensus::DEPLOYMENT_SEGWIT)) != 0;
>> >>>>     if (!(fVersionBits && fSegbit)) {
>> >>>>         return state.DoS(0, error("ConnectBlock(): relayed block must
>> >>>> signal for segwit, please upgrade"), REJECT_INVALID,
>> >>>> "bad-no-segwit");
>> >>>>     }
>> >>>> }
>> >>>>
>> >>>> // BIP148 mandatory segwit signalling.
>> >>>> int64_t nMedianTimePast = pindex->GetMedianTimePast();
>> >>>> if ( (nMedianTimePast >= 1501545600) &&  // Tue 01 Aug 2017 00:00:00
>> >>>> UTC
>> >>>>      (nMedianTimePast <= 1510704000) &&  // Wed 15 Nov 2017 00:00:00
>> >>>> UTC
>> >>>>      (!IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus())
>> >>>> &&
>> >>>>  // Segwit is not locked in
>> >>>>       !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus())) )
>> >>>>  // and is not active.
>> >>>> {
>> >>>>     bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK) ==
>> >>>> VERSIONBITS_TOP_BITS;
>> >>>>     bool fSegbit = (pindex->nVersion &
>> >>>> VersionBitsMask(chainparams.GetConsensus(),
>> >>>> Consensus::DEPLOYMENT_SEGWIT)) != 0;
>> >>>>     if (!(fVersionBits && fSegbit)) {
>> >>>>         return state.DoS(0, error("ConnectBlock(): relayed block must
>> >>>> signal for segwit, please upgrade"), REJECT_INVALID,
>> >>>> "bad-no-segwit");
>> >>>>     }
>> >>>> }
>> >>>> </pre>
>> >>>>
>> >>>>
>> >>>> https://github.com/bitcoin/bitcoin/compare/0.14...jameshilliard:splitprotection-v0.14.1
>> >>>>
>> >>>> ==Backwards Compatibility==
>> >>>>
>> >>>> This deployment is compatible with the existing "segwit" bit 1
>> >>>> deployment scheduled between midnight November 15th, 2016 and
>> >>>> midnight
>> >>>> November 15th, 2017. This deployment is also compatible with the
>> >>>> existing BIP148 deployment. This BIP is compatible with BIP91 only if
>> >>>> BIP91 activates before it and before BIP148. Miners will need to
>> >>>> upgrade their nodes to support splitprotection otherwise they may
>> >>>> build on top of an invalid block. While this bip is active users
>> >>>> should either upgrade to splitprotection or wait for additional
>> >>>> confirmations when accepting payments.
>> >>>>
>> >>>> ==Rationale==
>> >>>>
>> >>>> Historically we have used IsSuperMajority() to activate soft forks
>> >>>> such as BIP66 which has a mandatory signalling requirement for miners
>> >>>> once activated, this ensures that miners are aware of new rules being
>> >>>> enforced. This technique can be leveraged to lower the signalling
>> >>>> threshold of a soft fork while it is in the process of being deployed
>> >>>> in a backwards compatible way. We also use a BIP8 style timeout to
>> >>>> ensure that this BIP is compatible with BIP148 and that BIP148
>> >>>> compatible mandatory signalling activates regardless of miner
>> >>>> signalling levels.
>> >>>>
>> >>>> By orphaning non-signalling blocks during the BIP9 bit 1 "segwit"
>> >>>> deployment, this BIP can cause the existing "segwit" deployment to
>> >>>> activate without needing to release a new deployment. As we approach
>> >>>> BIP148 activation it may be desirable for a majority of miners to
>> >>>> have
>> >>>> a method that will ensure that there is no chain split.
>> >>>>
>> >>>> ==References==
>> >>>>
>> >>>>
>> >>>> *[https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-March/013714.html
>> >>>> Mailing list discussion]
>> >>>>
>> >>>> *[https://github.com/bitcoin/bitcoin/blob/v0.6.0/src/main.cpp#L1281-L1283
>> >>>> P2SH flag day activation]
>> >>>> *[[bip-0009.mediawiki|BIP9 Version bits with timeout and delay]]
>> >>>> *[[bip-0016.mediawiki|BIP16 Pay to Script Hash]]
>> >>>> *[[bip-0091.mediawiki|BIP91 Reduced threshold Segwit MASF]]
>> >>>> *[[bip-0141.mediawiki|BIP141 Segregated Witness (Consensus layer)]]
>> >>>> *[[bip-0143.mediawiki|BIP143 Transaction Signature Verification for
>> >>>> Version 0 Witness Program]]
>> >>>> *[[bip-0147.mediawiki|BIP147 Dealing with dummy stack element
>> >>>> malleability]]
>> >>>> *[[bip-0148.mediawiki|BIP148 Mandatory activation of segwit
>> >>>> deployment]]
>> >>>> *[[bip-0149.mediawiki|BIP149 Segregated Witness (second deployment)]]
>> >>>> *[https://bitcoincore.org/en/2016/01/26/segwit-benefits/ Segwit
>> >>>> benefits]
>> >>>>
>> >>>> ==Copyright==
>> >>>>
>> >>>> This document is dual licensed as BSD 3-clause, and Creative Commons
>> >>>> CC0 1.0 Universal.
>> >>>> _______________________________________________
>> >>>> bitcoin-dev mailing list
>> >>>> bitcoin-dev at lists.linuxfoundation.org
>> >>>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>
>

From jaredr26 at gmail.com  Wed Jun  7 23:43:57 2017
From: jaredr26 at gmail.com (Jared Lee Richardson)
Date: Wed, 7 Jun 2017 16:43:57 -0700
Subject: [bitcoin-dev] User Activated Soft Fork Split Protection
In-Reply-To: <CADvTj4pFna4tX37XmgrP7ueZB+Yv4T9NWmp99CwKSx5mzdiJJQ@mail.gmail.com>
References: <CADvTj4qpH-t5Gx6qyn3yToyUE_GFaBE989=AWNHLKMpMNW3R+w@mail.gmail.com>
	<CAD1TkXviJouao7YoHjiDN3mTUWFEbMY9mtCqkQ8zp8JthyhT7Q@mail.gmail.com>
	<CADvTj4rz4exYMvBEmYi=bTZDgDm0drLjpRZmZUo17inzCzCRVg@mail.gmail.com>
	<CAD1TkXskei1gk_kungSvdWGmbdJMA8AG+-zK+Osz6u5vSCN8BQ@mail.gmail.com>
	<CADvTj4poO1L+Wg5J+M71sJMz-Xcg_st3MkAcQK=bfHhTJ3i8ow@mail.gmail.com>
	<CAD1TkXumetRnPO6LxhJeVoci=0=YHD7hEB0K0YH+2McRBJ-QHw@mail.gmail.com>
	<CADvTj4pFna4tX37XmgrP7ueZB+Yv4T9NWmp99CwKSx5mzdiJJQ@mail.gmail.com>
Message-ID: <CAD1TkXtmj3H3k+k7X2DgA0cNxXBNSSrzf_o33qFO8cA9eSUTnw@mail.gmail.com>

> BIP148 however is a consensus change that can
> be rectified if it gets more work, this would act as an additional
> incentive for mine the BIP148 side since there would be no wipeout
> risk there.

This statement is misleading.  Wipeout risks don't apply to any consensus
changes; It is a consensus change, it can only be abandoned.  The BIP148
chain carries just as many risks of being abandoned or even more with
segwit2x on the table.  No miner would consider "wipeout risk" an advantage
when the real threat is chain abandonment.

> Higher transaction fees on a minority chain can compensate miners for
> a lower price which would likely be enough to get the BIP148 chain to
> a difficulty reduction.

Higher transaction fees suffers the same problem as exchange support does.
Without replay protection, it is very difficult for any average user to
force transactions onto one chain or the other.  Thus, without replay
protection, the UASF chain is unlikely to develop any viable fee market;
Its few miners 99% of the time will simply choose from the highest fees
that were already available to the other chain, which is basically no
advantage at all.

>  ETC replay protection was done after the fork on an as
> needed basis(there are multiple reliable techniques that can be used
> to split UTXO's), the same can happen with BIP148 and it is easier to
> do with Bitcoin than with the ETH/ETC split IMO.

ETC replay protection was added because they were already a hardfork and
without it they would not have had a viable chain.  BIP148 is not supposed
to be a hardfork, and if it added replay protection to remain viable it
would lose the frequently touted "wipeout advantage" as well as the ability
to call itself a softfork.  And are you seriously suggesting that what
happened with ETC and ETH is a desirable and good situation for Bitcoin,
and that UASF is ETC?

> A big reason BIP148 still has support is because up until SegWit
> actually activates there's no guarantee segwit2mb will actually have
> the necessary support to activate SegWit.

For a miners blowing through six million dollars a day in mining
operational costs, that's a pretty crappy reason.  Serious miners can't
afford to prop up a non-viable chain based on philosophy or maybes.  BIP148
is based entirely upon people who aren't putting anything on the line
trying to convince others to take the huge risks for them.  With
deceptively fallacious logic, in my opinion.

Even segwit2x is based on the assumption that all miners can reach
consensus.  Break that assumption and segwit2x will have the same problems
as UASF.

> This is largely an issue due to segwit2x's bundling, if the SW and HF
> part of segwit2x were unbundled then there would be no reason to delay
> BIP91 activation

They are bundled.  Segwit alone doesn't have the desired overwhelming
consensus, unless core wishes to fork 71% to 29%, and maybe not even that
high.  That's the technical reason, and they can't be unbundled without
breaking that consensus.

Jared


On Wed, Jun 7, 2017 at 4:11 PM, James Hilliard <james.hilliard1 at gmail.com>
wrote:

> On Wed, Jun 7, 2017 at 5:53 PM, Jared Lee Richardson <jaredr26 at gmail.com>
> wrote:
> >> There are 2 primary factors involved here, economic support and
> > hashpower either of which is enough to make a permanent chain split
> > unlikely, miners will mine whichever chain is most profitable(see
> > ETH/ETC hashpower profitability equilibrium for an example of how this
> > works in practice)
> >
> > That's not a comparable example.  ETC did not face potentially years of
> slow
> > blocktimes before it normalized, whereas BIP148 is on track to do exactly
> > that.  Moreover, ETC represented a fundamental break from the majority
> > consensus that could not be rectified, whereas BIP148 represents only a
> > minority attempt to accelerate something that an overwhelming majority of
> > miners have already agreed to activate under segwit2x.  Lastly ETC was
> > required to add replay protection, just like any minority fork proposed
> by
> > any crypto-currency has been, something that BIP148 both lacks and
> refuses
> > to add or even acknowledge the necessity of.  Without replay protection,
> ETC
> > could not have become profitable enough to be a viable minority chain.
> If
> > BIP148's chain is not the majority chain and it does not have replay
> > protection, it will face the same problems, but that required replay
> > protection will turn it into a hardfork.  This will be a very bad
> position
> > for UASF supporters to find themselves in - Either hardfork and hope the
> > price is higher and the majority converts, or die as the minority chain
> with
> > no reliable methods of economic conversion.
> Higher transaction fees on a minority chain can compensate miners for
> a lower price which would likely be enough to get the BIP148 chain to
> a difficulty reduction. BIP148 however is a consensus change that can
> be rectified if it gets more work, this would act as an additional
> incentive for mine the BIP148 side since there would be no wipeout
> risk there. ETC replay protection was done after the fork on an as
> needed basis(there are multiple reliable techniques that can be used
> to split UTXO's), the same can happen with BIP148 and it is easier to
> do with Bitcoin than with the ETH/ETC split IMO.
> >
> > I believe, but don't have data to back this, that most of the BIP148
> > insistence comes not from a legitimate attempt to gain consensus (or else
> > they would either outright oppose segwit2mb for its hardfork, or they
> would
> > outright support it), but rather from an attempt for BIP148 supporters to
> > save face for BIP148 being a failure.  If I'm correct, that's a terrible
> and
> > highly non-technical reason for segwit2mb to bend over backwards
> attempting
> > to support BIP148's attempt to save face.
> A big reason BIP148 still has support is because up until SegWit
> actually activates there's no guarantee segwit2mb will actually have
> the necessary support to activate SegWit.
> >
> >> The main issue is just one of activation timelines, BIP91 as
> > is takes too long to activate unless started ahead of the existing
> > segwit2x schedule and it's unlikely that BIP148 will get pushed back
> > any further.
> >
> > Even if I'm not correct on the above, I and others find it hard to accept
> > that this timeline conflict is segwit2x's fault.  Segwit2x has both some
> > flexibility and broad support that crosses contentious pro-segwit and
> > pro-blocksize-increase divisions that have existed for two years.
> BIP148 is
> > attempting to hold segwit2x's timelines and code hostage by claiming
> > inflexibility and claiming broad support, and not only are neither of
> those
> > assertions are backed by real data, BIP148 (by being so inflexible) is
> > pushing a position that deepens the divides between those groups.  For
> there
> > to be technical reasons for compatibility (so long as there are
> tradeoffs,
> > which there are), there needs to be hard data showing that BIP148 is a
> > viable minority fork that won't simply die off on its own.
> This is largely an issue due to segwit2x's bundling, if the SW and HF
> part of segwit2x were unbundled then there would be no reason to delay
> BIP91 activation, this is especially a problem since it takes a good
> deal of time to properly code and test a HF. Unfortunately segwit2x
> has been quite inflexible in regards to the bundling aspect even
> though there are clearly no technical reasons for it to be there.
> >
> > Jared
> >
> >
> > On Wed, Jun 7, 2017 at 3:23 PM, James Hilliard <
> james.hilliard1 at gmail.com>
> > wrote:
> >>
> >> On Wed, Jun 7, 2017 at 4:50 PM, Jared Lee Richardson <
> jaredr26 at gmail.com>
> >> wrote:
> >> > Could this risk mitigation measure be an optional flag?  And if so,
> >> > could it+BIP91 signal on a different bit than bit4?
> >> It's fairly trivial for miners to signal for BIP91 on bit4 or a
> >> different bit at the same time as the code is trivial enough to
> >> combine
> >> >
> >> > The reason being, if for some reason the segwit2x activation cannot
> >> > take place in time, it would be preferable for miners to have a more
> >> > standard approach to activation that requires stronger consensus and
> >> > may be more forgiving than BIP148.  If the segwit2x activation is on
> >> > time to cooperate with BIP148, it could be signaled through the
> >> > non-bit4 approach and everything could go smoothly.  Thoughts on that
> >> > idea?  It may add more complexity and more developer time, but may
> >> > also address your concerns among others.
> >> This does give miners another approach to activate segwit ahead of
> >> BIP148, if segwit2x activation is rolled out and activated immediately
> >> then this would not be needed however based on the timeline here
> >> https://segwit2x.github.io/ it would not be possible for BIP91 to
> >> enforce mandatory signalling ahead of BIP148. Maybe that can be
> >> changed though, I've suggested an immediate rollout with a placeholder
> >> client timeout instead of the HF code initially in order to accelerate
> >> that.
> >> >
> >> >> Since this BIP
> >> >> only activates with a clear miner majority it should not increase the
> >> >> risk of an extended chain split.
> >> >
> >> > The concern I'm raising is more about the psychology of giving BIP148
> >> > a sense of safety that may not be valid.  Without several more steps,
> >> > BIP148 is definitely on track to be a risky chainsplit, and without
> >> > segwit2x it will almost certainly be a small minority chain. (Unless
> >> > the segwit2x compromise falls apart before then, and even in that case
> >> > it is likely to be a minority chain)
> >> There are 2 primary factors involved here, economic support and
> >> hashpower either of which is enough to make a permanent chain split
> >> unlikely, miners will mine whichever chain is most profitable(see
> >> ETH/ETC hashpower profitability equilibrium for an example of how this
> >> works in practice) however there may be lag time immediately after the
> >> split if there is an economic majority but not a hashpower majority
> >> initially. This is risk mitigation that only requires miners support
> >> however. The main issue is just one of activation timelines, BIP91 as
> >> is takes too long to activate unless started ahead of the existing
> >> segwit2x schedule and it's unlikely that BIP148 will get pushed back
> >> any further.
> >> >
> >> > Jared
> >> >
> >> >
> >> > On Wed, Jun 7, 2017 at 2:42 PM, James Hilliard
> >> > <james.hilliard1 at gmail.com> wrote:
> >> >> I don't really see how this would increase the likelihood of an
> >> >> extended chain split assuming BIP148 is going to have
> >> >> non-insignificant economic backing. This BIP is designed to provide a
> >> >> risk mitigation measure that miners can safely deploy. Since this BIP
> >> >> only activates with a clear miner majority it should not increase the
> >> >> risk of an extended chain split. At this point it is not completely
> >> >> clear how much economic support there is for BIP148 but support
> >> >> certainly seems to be growing and we have nearly 2 months until
> BIP148
> >> >> activation. I intentionally used a shorter activation period here so
> >> >> that decisions by miners can be made close to the BIP148 activation
> >> >> date.
> >> >>
> >> >> On Wed, Jun 7, 2017 at 4:29 PM, Jared Lee Richardson
> >> >> <jaredr26 at gmail.com> wrote:
> >> >>> I think this BIP represents a gamble, and the gamble may not be a
> good
> >> >>> one.  The gamble here is that if the segwit2x changes are rolled out
> >> >>> on time, and if the signatories accept the bit4 + bit1 signaling
> >> >>> proposals within BIP91, the launch will go smoother, as intended.
> But
> >> >>> conversely, if either the segwit2x signatories balk about the Bit1
> >> >>> signaling OR if the timelines for segwit2mb are missed even by a
> bit,
> >> >>> it may cause the BIP148 chainsplit to be worse than it would be
> >> >>> without.  Given the frequent concerns raised in multiple places
> about
> >> >>> the aggressiveness of the segwit2x timelines, including the
> >> >>> non-hardfork timelines, this does not seem like a great gamble to be
> >> >>> making.
> >> >>>
> >> >>> The reason I say it may make the chainsplit be worse than it would
> >> >>> otherwise be is that it may provide a false sense of safety for
> BIP148
> >> >>> that currently does not currently exist(and should not, as it is a
> >> >>> chainsplit).  That sense of safety would only be legitimate if the
> >> >>> segwit2x signatories were on board, and the segwit2x code
> effectively
> >> >>> enforced BIP148 simultaneously, neither of which are guaranteed.  If
> >> >>> users and more miners had a false sense that BIP148 was *not* going
> to
> >> >>> chainsplit from default / segwit2x, they might not follow the news
> if
> >> >>> suddenly the segwit2x plan were delayed for a few days.  While any
> >> >>> additional support would definitely be cheered on by BIP148
> >> >>> supporters, the practical reality might be that this proposal would
> >> >>> take BIP148 from the "unlikely to have any viable chain after flag
> day
> >> >>> without segwit2x" category into the "small but viable minority
> chain"
> >> >>> category, and even worse, it might strengthen the chainsplit just
> days
> >> >>> before segwit is activated on BOTH chains, putting the BIP148
> >> >>> supporters on the wrong pro-segwit, but still-viable chain.
> >> >>>
> >> >>> If Core had taken a strong stance to include BIP148 into the client,
> >> >>> and if BIP148 support were much much broader, I would feel
> differently
> >> >>> as the gamble would be more likely to discourage a chainsplit (By
> >> >>> forcing the acceleration of segwit2x) rather than encourage it (by
> >> >>> strengthening an extreme minority chainsplit that may wind up on the
> >> >>> wrong side of two segwit-activated chains).  As it stands now, this
> >> >>> seems like a very dangerous attempt to compromise with a small but
> >> >>> vocal group that are the ones creating the threat to begin with.
> >> >>>
> >> >>> Jared
> >> >>>
> >> >>> On Tue, Jun 6, 2017 at 5:56 PM, James Hilliard via bitcoin-dev
> >> >>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
> >> >>>> Due to the proposed calendar(https://segwit2x.github.io/) for the
> >> >>>> SegWit2x agreement being too slow to activate SegWit mandatory
> >> >>>> signalling ahead of BIP148 using BIP91 I would like to propose
> >> >>>> another
> >> >>>> option that miners can use to prevent a chain split ahead of the
> Aug
> >> >>>> 1st BIP148 activation date.
> >> >>>>
> >> >>>> The splitprotection soft fork is essentially BIP91 but using BIP8
> >> >>>> instead of BIP9 with a lower activation threshold and immediate
> >> >>>> mandatory signalling lock-in. This allows for a majority of miners
> to
> >> >>>> activate mandatory SegWit signalling and prevent a potential chain
> >> >>>> split ahead of BIP148 activation.
> >> >>>>
> >> >>>> This BIP allows for miners to respond to market forces quickly
> ahead
> >> >>>> of BIP148 activation by signalling for splitprotection. Any miners
> >> >>>> already running BIP148 should be encouraged to use splitprotection.
> >> >>>>
> >> >>>> <pre>
> >> >>>>   BIP: splitprotection
> >> >>>>   Layer: Consensus (soft fork)
> >> >>>>   Title: User Activated Soft Fork Split Protection
> >> >>>>   Author: James Hilliard <james.hilliard1 at gmail.com>
> >> >>>>   Comments-Summary: No comments yet.
> >> >>>>   Comments-URI:
> >> >>>>   Status: Draft
> >> >>>>   Type: Standards Track
> >> >>>>   Created: 2017-05-22
> >> >>>>   License: BSD-3-Clause
> >> >>>>            CC0-1.0
> >> >>>> </pre>
> >> >>>>
> >> >>>> ==Abstract==
> >> >>>>
> >> >>>> This document specifies a coordination mechanism for a simple
> >> >>>> majority
> >> >>>> of miners to prevent a chain split ahead of BIP148 activation.
> >> >>>>
> >> >>>> ==Definitions==
> >> >>>>
> >> >>>> "existing segwit deployment" refer to the BIP9 "segwit" deployment
> >> >>>> using bit 1, between November 15th 2016 and November 15th 2017 to
> >> >>>> activate BIP141, BIP143 and BIP147.
> >> >>>>
> >> >>>> ==Motivation==
> >> >>>>
> >> >>>> The biggest risk of BIP148 is an extended chain split, this BIP
> >> >>>> provides a way for a simple majority of miners to eliminate that
> >> >>>> risk.
> >> >>>>
> >> >>>> This BIP provides a way for a simple majority of miners to
> coordinate
> >> >>>> activation of the existing segwit deployment with less than 95%
> >> >>>> hashpower before BIP148 activation. Due to time constraints unless
> >> >>>> immediately deployed BIP91 will likely not be able to enforce
> >> >>>> mandatory signalling of segwit before the Aug 1st activation of
> >> >>>> BIP148. This BIP provides a method for rapid miner activation of
> >> >>>> SegWit mandatory signalling ahead of the BIP148 activation date.
> >> >>>> Since
> >> >>>> the primary goal of this BIP is to reduce the chance of an extended
> >> >>>> chain split as much as possible we activate using a simple miner
> >> >>>> majority of 65% over a 504 block interval rather than a higher
> >> >>>> percentage. This BIP also allows miners to signal their intention
> to
> >> >>>> run BIP148 in order to prevent a chain split.
> >> >>>>
> >> >>>> ==Specification==
> >> >>>>
> >> >>>> While this BIP is active, all blocks must set the nVersion header
> top
> >> >>>> 3 bits to 001 together with bit field (1<<1) (according to the
> >> >>>> existing segwit deployment). Blocks that do not signal as required
> >> >>>> will be rejected.
> >> >>>>
> >> >>>> ==Deployment==
> >> >>>>
> >> >>>> This BIP will be deployed by "version bits" with a 65%(this can be
> >> >>>> adjusted if desired) activation threshold BIP9 with the name
> >> >>>> "splitprotecion" and using bit 2.
> >> >>>>
> >> >>>> This BIP starts immediately and is a BIP8 style soft fork since
> >> >>>> mandatory signalling will start on midnight August 1st 2017 (epoch
> >> >>>> time 1501545600) regardless of whether or not this BIP has reached
> >> >>>> its
> >> >>>> own signalling threshold. This BIP will cease to be active when
> >> >>>> segwit
> >> >>>> is locked-in.
> >> >>>>
> >> >>>> === Reference implementation ===
> >> >>>>
> >> >>>> <pre>
> >> >>>> // Check if Segregated Witness is Locked In
> >> >>>> bool IsWitnessLockedIn(const CBlockIndex* pindexPrev, const
> >> >>>> Consensus::Params& params)
> >> >>>> {
> >> >>>>     LOCK(cs_main);
> >> >>>>     return (VersionBitsState(pindexPrev, params,
> >> >>>> Consensus::DEPLOYMENT_SEGWIT, versionbitscache) ==
> >> >>>> THRESHOLD_LOCKED_IN);
> >> >>>> }
> >> >>>>
> >> >>>> // SPLITPROTECTION mandatory segwit signalling.
> >> >>>> if ( VersionBitsState(pindex->pprev, chainparams.GetConsensus(),
> >> >>>> Consensus::DEPLOYMENT_SPLITPROTECTION, versionbitscache) ==
> >> >>>> THRESHOLD_LOCKED_IN &&
> >> >>>>      !IsWitnessLockedIn(pindex->pprev,
> chainparams.GetConsensus()) &&
> >> >>>> // Segwit is not locked in
> >> >>>>      !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus())
> )
> >> >>>> //
> >> >>>> and is not active.
> >> >>>> {
> >> >>>>     bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK)
> ==
> >> >>>> VERSIONBITS_TOP_BITS;
> >> >>>>     bool fSegbit = (pindex->nVersion &
> >> >>>> VersionBitsMask(chainparams.GetConsensus(),
> >> >>>> Consensus::DEPLOYMENT_SEGWIT)) != 0;
> >> >>>>     if (!(fVersionBits && fSegbit)) {
> >> >>>>         return state.DoS(0, error("ConnectBlock(): relayed block
> must
> >> >>>> signal for segwit, please upgrade"), REJECT_INVALID,
> >> >>>> "bad-no-segwit");
> >> >>>>     }
> >> >>>> }
> >> >>>>
> >> >>>> // BIP148 mandatory segwit signalling.
> >> >>>> int64_t nMedianTimePast = pindex->GetMedianTimePast();
> >> >>>> if ( (nMedianTimePast >= 1501545600) &&  // Tue 01 Aug 2017
> 00:00:00
> >> >>>> UTC
> >> >>>>      (nMedianTimePast <= 1510704000) &&  // Wed 15 Nov 2017
> 00:00:00
> >> >>>> UTC
> >> >>>>      (!IsWitnessLockedIn(pindex->pprev,
> chainparams.GetConsensus())
> >> >>>> &&
> >> >>>>  // Segwit is not locked in
> >> >>>>       !IsWitnessEnabled(pindex->pprev,
> chainparams.GetConsensus())) )
> >> >>>>  // and is not active.
> >> >>>> {
> >> >>>>     bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK)
> ==
> >> >>>> VERSIONBITS_TOP_BITS;
> >> >>>>     bool fSegbit = (pindex->nVersion &
> >> >>>> VersionBitsMask(chainparams.GetConsensus(),
> >> >>>> Consensus::DEPLOYMENT_SEGWIT)) != 0;
> >> >>>>     if (!(fVersionBits && fSegbit)) {
> >> >>>>         return state.DoS(0, error("ConnectBlock(): relayed block
> must
> >> >>>> signal for segwit, please upgrade"), REJECT_INVALID,
> >> >>>> "bad-no-segwit");
> >> >>>>     }
> >> >>>> }
> >> >>>> </pre>
> >> >>>>
> >> >>>>
> >> >>>> https://github.com/bitcoin/bitcoin/compare/0.14...
> jameshilliard:splitprotection-v0.14.1
> >> >>>>
> >> >>>> ==Backwards Compatibility==
> >> >>>>
> >> >>>> This deployment is compatible with the existing "segwit" bit 1
> >> >>>> deployment scheduled between midnight November 15th, 2016 and
> >> >>>> midnight
> >> >>>> November 15th, 2017. This deployment is also compatible with the
> >> >>>> existing BIP148 deployment. This BIP is compatible with BIP91 only
> if
> >> >>>> BIP91 activates before it and before BIP148. Miners will need to
> >> >>>> upgrade their nodes to support splitprotection otherwise they may
> >> >>>> build on top of an invalid block. While this bip is active users
> >> >>>> should either upgrade to splitprotection or wait for additional
> >> >>>> confirmations when accepting payments.
> >> >>>>
> >> >>>> ==Rationale==
> >> >>>>
> >> >>>> Historically we have used IsSuperMajority() to activate soft forks
> >> >>>> such as BIP66 which has a mandatory signalling requirement for
> miners
> >> >>>> once activated, this ensures that miners are aware of new rules
> being
> >> >>>> enforced. This technique can be leveraged to lower the signalling
> >> >>>> threshold of a soft fork while it is in the process of being
> deployed
> >> >>>> in a backwards compatible way. We also use a BIP8 style timeout to
> >> >>>> ensure that this BIP is compatible with BIP148 and that BIP148
> >> >>>> compatible mandatory signalling activates regardless of miner
> >> >>>> signalling levels.
> >> >>>>
> >> >>>> By orphaning non-signalling blocks during the BIP9 bit 1 "segwit"
> >> >>>> deployment, this BIP can cause the existing "segwit" deployment to
> >> >>>> activate without needing to release a new deployment. As we
> approach
> >> >>>> BIP148 activation it may be desirable for a majority of miners to
> >> >>>> have
> >> >>>> a method that will ensure that there is no chain split.
> >> >>>>
> >> >>>> ==References==
> >> >>>>
> >> >>>>
> >> >>>> *[https://lists.linuxfoundation.org/pipermail/
> bitcoin-dev/2017-March/013714.html
> >> >>>> Mailing list discussion]
> >> >>>>
> >> >>>> *[https://github.com/bitcoin/bitcoin/blob/v0.6.0/src/main.
> cpp#L1281-L1283
> >> >>>> P2SH flag day activation]
> >> >>>> *[[bip-0009.mediawiki|BIP9 Version bits with timeout and delay]]
> >> >>>> *[[bip-0016.mediawiki|BIP16 Pay to Script Hash]]
> >> >>>> *[[bip-0091.mediawiki|BIP91 Reduced threshold Segwit MASF]]
> >> >>>> *[[bip-0141.mediawiki|BIP141 Segregated Witness (Consensus layer)]]
> >> >>>> *[[bip-0143.mediawiki|BIP143 Transaction Signature Verification for
> >> >>>> Version 0 Witness Program]]
> >> >>>> *[[bip-0147.mediawiki|BIP147 Dealing with dummy stack element
> >> >>>> malleability]]
> >> >>>> *[[bip-0148.mediawiki|BIP148 Mandatory activation of segwit
> >> >>>> deployment]]
> >> >>>> *[[bip-0149.mediawiki|BIP149 Segregated Witness (second
> deployment)]]
> >> >>>> *[https://bitcoincore.org/en/2016/01/26/segwit-benefits/ Segwit
> >> >>>> benefits]
> >> >>>>
> >> >>>> ==Copyright==
> >> >>>>
> >> >>>> This document is dual licensed as BSD 3-clause, and Creative
> Commons
> >> >>>> CC0 1.0 Universal.
> >> >>>> _______________________________________________
> >> >>>> bitcoin-dev mailing list
> >> >>>> bitcoin-dev at lists.linuxfoundation.org
> >> >>>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170607/875ec296/attachment-0001.html>

From james.hilliard1 at gmail.com  Thu Jun  8 00:01:19 2017
From: james.hilliard1 at gmail.com (James Hilliard)
Date: Wed, 7 Jun 2017 19:01:19 -0500
Subject: [bitcoin-dev] User Activated Soft Fork Split Protection
In-Reply-To: <CAD1TkXtmj3H3k+k7X2DgA0cNxXBNSSrzf_o33qFO8cA9eSUTnw@mail.gmail.com>
References: <CADvTj4qpH-t5Gx6qyn3yToyUE_GFaBE989=AWNHLKMpMNW3R+w@mail.gmail.com>
	<CAD1TkXviJouao7YoHjiDN3mTUWFEbMY9mtCqkQ8zp8JthyhT7Q@mail.gmail.com>
	<CADvTj4rz4exYMvBEmYi=bTZDgDm0drLjpRZmZUo17inzCzCRVg@mail.gmail.com>
	<CAD1TkXskei1gk_kungSvdWGmbdJMA8AG+-zK+Osz6u5vSCN8BQ@mail.gmail.com>
	<CADvTj4poO1L+Wg5J+M71sJMz-Xcg_st3MkAcQK=bfHhTJ3i8ow@mail.gmail.com>
	<CAD1TkXumetRnPO6LxhJeVoci=0=YHD7hEB0K0YH+2McRBJ-QHw@mail.gmail.com>
	<CADvTj4pFna4tX37XmgrP7ueZB+Yv4T9NWmp99CwKSx5mzdiJJQ@mail.gmail.com>
	<CAD1TkXtmj3H3k+k7X2DgA0cNxXBNSSrzf_o33qFO8cA9eSUTnw@mail.gmail.com>
Message-ID: <CADvTj4o5tTD2XN080dmHq1DuNwSZtmAytv3=7F5zGeBdhiPMrA@mail.gmail.com>

On Wed, Jun 7, 2017 at 6:43 PM, Jared Lee Richardson <jaredr26 at gmail.com> wrote:
>> BIP148 however is a consensus change that can
>> be rectified if it gets more work, this would act as an additional
>> incentive for mine the BIP148 side since there would be no wipeout
>> risk there.
>
> This statement is misleading.  Wipeout risks don't apply to any consensus
> changes; It is a consensus change, it can only be abandoned.  The BIP148
> chain carries just as many risks of being abandoned or even more with
> segwit2x on the table.  No miner would consider "wipeout risk" an advantage
> when the real threat is chain abandonment.
Both are issues, but wipeout risk is different, the ETH/ETC split for
example didn't have any wipeout risk for either side the same is not
true for BIP148(and it is the non-BIP148 side that carries the risk of
chain wipeout).
>
>> Higher transaction fees on a minority chain can compensate miners for
>> a lower price which would likely be enough to get the BIP148 chain to
>> a difficulty reduction.
>
> Higher transaction fees suffers the same problem as exchange support does.
> Without replay protection, it is very difficult for any average user to
> force transactions onto one chain or the other.  Thus, without replay
> protection, the UASF chain is unlikely to develop any viable fee market; Its
> few miners 99% of the time will simply choose from the highest fees that
> were already available to the other chain, which is basically no advantage
> at all.
Not really, there are a few relatively simple techniques such as RBF
which can be leveraged to get confirmations on on-side before double
spending on another. Once a transaction is confirmed on the non-BIP148
chain then the high fee transactions can be made on only the BIP148
side of the split using RBF. Exchanges will likely do this splitting
automatically for uses as well.
>
>>  ETC replay protection was done after the fork on an as
>> needed basis(there are multiple reliable techniques that can be used
>> to split UTXO's), the same can happen with BIP148 and it is easier to
>> do with Bitcoin than with the ETH/ETC split IMO.
>
> ETC replay protection was added because they were already a hardfork and
> without it they would not have had a viable chain.  BIP148 is not supposed
> to be a hardfork, and if it added replay protection to remain viable it
> would lose the frequently touted "wipeout advantage" as well as the ability
> to call itself a softfork.  And are you seriously suggesting that what
> happened with ETC and ETH is a desirable and good situation for Bitcoin, and
> that UASF is ETC?
There wasn't proper replay protection at split time for ETH/ETC since
normal transactions would get executed on both sides originally,
however replay protection was added by wallets(mainly using splitting
contracts). I don't think a split is desirable however, which is why
I've proposed this BIP.
>
>> A big reason BIP148 still has support is because up until SegWit
>> actually activates there's no guarantee segwit2mb will actually have
>> the necessary support to activate SegWit.
>
> For a miners blowing through six million dollars a day in mining operational
> costs, that's a pretty crappy reason.  Serious miners can't afford to prop
> up a non-viable chain based on philosophy or maybes.  BIP148 is based
> entirely upon people who aren't putting anything on the line trying to
> convince others to take the huge risks for them.  With deceptively
> fallacious logic, in my opinion.
Yes, miners aren't likely to waste operational mining costs, that's
ultimately why miners would follow the BIP148 side of the chain
assuming it has sufficient economic support or if it's more profitable
to mine.
>
> Even segwit2x is based on the assumption that all miners can reach
> consensus.  Break that assumption and segwit2x will have the same problems
> as UASF.
segwit2x has more issues since the HF part requires users to reach consensus
>
>> This is largely an issue due to segwit2x's bundling, if the SW and HF
>> part of segwit2x were unbundled then there would be no reason to delay
>> BIP91 activation
>
> They are bundled.  Segwit alone doesn't have the desired overwhelming
> consensus, unless core wishes to fork 71% to 29%, and maybe not even that
> high.  That's the technical reason, and they can't be unbundled without
> breaking that consensus.
That's a political reason not a technical reason.
>
> Jared
>
>
> On Wed, Jun 7, 2017 at 4:11 PM, James Hilliard <james.hilliard1 at gmail.com>
> wrote:
>>
>> On Wed, Jun 7, 2017 at 5:53 PM, Jared Lee Richardson <jaredr26 at gmail.com>
>> wrote:
>> >> There are 2 primary factors involved here, economic support and
>> > hashpower either of which is enough to make a permanent chain split
>> > unlikely, miners will mine whichever chain is most profitable(see
>> > ETH/ETC hashpower profitability equilibrium for an example of how this
>> > works in practice)
>> >
>> > That's not a comparable example.  ETC did not face potentially years of
>> > slow
>> > blocktimes before it normalized, whereas BIP148 is on track to do
>> > exactly
>> > that.  Moreover, ETC represented a fundamental break from the majority
>> > consensus that could not be rectified, whereas BIP148 represents only a
>> > minority attempt to accelerate something that an overwhelming majority
>> > of
>> > miners have already agreed to activate under segwit2x.  Lastly ETC was
>> > required to add replay protection, just like any minority fork proposed
>> > by
>> > any crypto-currency has been, something that BIP148 both lacks and
>> > refuses
>> > to add or even acknowledge the necessity of.  Without replay protection,
>> > ETC
>> > could not have become profitable enough to be a viable minority chain.
>> > If
>> > BIP148's chain is not the majority chain and it does not have replay
>> > protection, it will face the same problems, but that required replay
>> > protection will turn it into a hardfork.  This will be a very bad
>> > position
>> > for UASF supporters to find themselves in - Either hardfork and hope the
>> > price is higher and the majority converts, or die as the minority chain
>> > with
>> > no reliable methods of economic conversion.
>> Higher transaction fees on a minority chain can compensate miners for
>> a lower price which would likely be enough to get the BIP148 chain to
>> a difficulty reduction. BIP148 however is a consensus change that can
>> be rectified if it gets more work, this would act as an additional
>> incentive for mine the BIP148 side since there would be no wipeout
>> risk there. ETC replay protection was done after the fork on an as
>> needed basis(there are multiple reliable techniques that can be used
>> to split UTXO's), the same can happen with BIP148 and it is easier to
>> do with Bitcoin than with the ETH/ETC split IMO.
>> >
>> > I believe, but don't have data to back this, that most of the BIP148
>> > insistence comes not from a legitimate attempt to gain consensus (or
>> > else
>> > they would either outright oppose segwit2mb for its hardfork, or they
>> > would
>> > outright support it), but rather from an attempt for BIP148 supporters
>> > to
>> > save face for BIP148 being a failure.  If I'm correct, that's a terrible
>> > and
>> > highly non-technical reason for segwit2mb to bend over backwards
>> > attempting
>> > to support BIP148's attempt to save face.
>> A big reason BIP148 still has support is because up until SegWit
>> actually activates there's no guarantee segwit2mb will actually have
>> the necessary support to activate SegWit.
>> >
>> >> The main issue is just one of activation timelines, BIP91 as
>> > is takes too long to activate unless started ahead of the existing
>> > segwit2x schedule and it's unlikely that BIP148 will get pushed back
>> > any further.
>> >
>> > Even if I'm not correct on the above, I and others find it hard to
>> > accept
>> > that this timeline conflict is segwit2x's fault.  Segwit2x has both some
>> > flexibility and broad support that crosses contentious pro-segwit and
>> > pro-blocksize-increase divisions that have existed for two years.
>> > BIP148 is
>> > attempting to hold segwit2x's timelines and code hostage by claiming
>> > inflexibility and claiming broad support, and not only are neither of
>> > those
>> > assertions are backed by real data, BIP148 (by being so inflexible) is
>> > pushing a position that deepens the divides between those groups.  For
>> > there
>> > to be technical reasons for compatibility (so long as there are
>> > tradeoffs,
>> > which there are), there needs to be hard data showing that BIP148 is a
>> > viable minority fork that won't simply die off on its own.
>> This is largely an issue due to segwit2x's bundling, if the SW and HF
>> part of segwit2x were unbundled then there would be no reason to delay
>> BIP91 activation, this is especially a problem since it takes a good
>> deal of time to properly code and test a HF. Unfortunately segwit2x
>> has been quite inflexible in regards to the bundling aspect even
>> though there are clearly no technical reasons for it to be there.
>> >
>> > Jared
>> >
>> >
>> > On Wed, Jun 7, 2017 at 3:23 PM, James Hilliard
>> > <james.hilliard1 at gmail.com>
>> > wrote:
>> >>
>> >> On Wed, Jun 7, 2017 at 4:50 PM, Jared Lee Richardson
>> >> <jaredr26 at gmail.com>
>> >> wrote:
>> >> > Could this risk mitigation measure be an optional flag?  And if so,
>> >> > could it+BIP91 signal on a different bit than bit4?
>> >> It's fairly trivial for miners to signal for BIP91 on bit4 or a
>> >> different bit at the same time as the code is trivial enough to
>> >> combine
>> >> >
>> >> > The reason being, if for some reason the segwit2x activation cannot
>> >> > take place in time, it would be preferable for miners to have a more
>> >> > standard approach to activation that requires stronger consensus and
>> >> > may be more forgiving than BIP148.  If the segwit2x activation is on
>> >> > time to cooperate with BIP148, it could be signaled through the
>> >> > non-bit4 approach and everything could go smoothly.  Thoughts on that
>> >> > idea?  It may add more complexity and more developer time, but may
>> >> > also address your concerns among others.
>> >> This does give miners another approach to activate segwit ahead of
>> >> BIP148, if segwit2x activation is rolled out and activated immediately
>> >> then this would not be needed however based on the timeline here
>> >> https://segwit2x.github.io/ it would not be possible for BIP91 to
>> >> enforce mandatory signalling ahead of BIP148. Maybe that can be
>> >> changed though, I've suggested an immediate rollout with a placeholder
>> >> client timeout instead of the HF code initially in order to accelerate
>> >> that.
>> >> >
>> >> >> Since this BIP
>> >> >> only activates with a clear miner majority it should not increase
>> >> >> the
>> >> >> risk of an extended chain split.
>> >> >
>> >> > The concern I'm raising is more about the psychology of giving BIP148
>> >> > a sense of safety that may not be valid.  Without several more steps,
>> >> > BIP148 is definitely on track to be a risky chainsplit, and without
>> >> > segwit2x it will almost certainly be a small minority chain. (Unless
>> >> > the segwit2x compromise falls apart before then, and even in that
>> >> > case
>> >> > it is likely to be a minority chain)
>> >> There are 2 primary factors involved here, economic support and
>> >> hashpower either of which is enough to make a permanent chain split
>> >> unlikely, miners will mine whichever chain is most profitable(see
>> >> ETH/ETC hashpower profitability equilibrium for an example of how this
>> >> works in practice) however there may be lag time immediately after the
>> >> split if there is an economic majority but not a hashpower majority
>> >> initially. This is risk mitigation that only requires miners support
>> >> however. The main issue is just one of activation timelines, BIP91 as
>> >> is takes too long to activate unless started ahead of the existing
>> >> segwit2x schedule and it's unlikely that BIP148 will get pushed back
>> >> any further.
>> >> >
>> >> > Jared
>> >> >
>> >> >
>> >> > On Wed, Jun 7, 2017 at 2:42 PM, James Hilliard
>> >> > <james.hilliard1 at gmail.com> wrote:
>> >> >> I don't really see how this would increase the likelihood of an
>> >> >> extended chain split assuming BIP148 is going to have
>> >> >> non-insignificant economic backing. This BIP is designed to provide
>> >> >> a
>> >> >> risk mitigation measure that miners can safely deploy. Since this
>> >> >> BIP
>> >> >> only activates with a clear miner majority it should not increase
>> >> >> the
>> >> >> risk of an extended chain split. At this point it is not completely
>> >> >> clear how much economic support there is for BIP148 but support
>> >> >> certainly seems to be growing and we have nearly 2 months until
>> >> >> BIP148
>> >> >> activation. I intentionally used a shorter activation period here so
>> >> >> that decisions by miners can be made close to the BIP148 activation
>> >> >> date.
>> >> >>
>> >> >> On Wed, Jun 7, 2017 at 4:29 PM, Jared Lee Richardson
>> >> >> <jaredr26 at gmail.com> wrote:
>> >> >>> I think this BIP represents a gamble, and the gamble may not be a
>> >> >>> good
>> >> >>> one.  The gamble here is that if the segwit2x changes are rolled
>> >> >>> out
>> >> >>> on time, and if the signatories accept the bit4 + bit1 signaling
>> >> >>> proposals within BIP91, the launch will go smoother, as intended.
>> >> >>> But
>> >> >>> conversely, if either the segwit2x signatories balk about the Bit1
>> >> >>> signaling OR if the timelines for segwit2mb are missed even by a
>> >> >>> bit,
>> >> >>> it may cause the BIP148 chainsplit to be worse than it would be
>> >> >>> without.  Given the frequent concerns raised in multiple places
>> >> >>> about
>> >> >>> the aggressiveness of the segwit2x timelines, including the
>> >> >>> non-hardfork timelines, this does not seem like a great gamble to
>> >> >>> be
>> >> >>> making.
>> >> >>>
>> >> >>> The reason I say it may make the chainsplit be worse than it would
>> >> >>> otherwise be is that it may provide a false sense of safety for
>> >> >>> BIP148
>> >> >>> that currently does not currently exist(and should not, as it is a
>> >> >>> chainsplit).  That sense of safety would only be legitimate if the
>> >> >>> segwit2x signatories were on board, and the segwit2x code
>> >> >>> effectively
>> >> >>> enforced BIP148 simultaneously, neither of which are guaranteed.
>> >> >>> If
>> >> >>> users and more miners had a false sense that BIP148 was *not* going
>> >> >>> to
>> >> >>> chainsplit from default / segwit2x, they might not follow the news
>> >> >>> if
>> >> >>> suddenly the segwit2x plan were delayed for a few days.  While any
>> >> >>> additional support would definitely be cheered on by BIP148
>> >> >>> supporters, the practical reality might be that this proposal would
>> >> >>> take BIP148 from the "unlikely to have any viable chain after flag
>> >> >>> day
>> >> >>> without segwit2x" category into the "small but viable minority
>> >> >>> chain"
>> >> >>> category, and even worse, it might strengthen the chainsplit just
>> >> >>> days
>> >> >>> before segwit is activated on BOTH chains, putting the BIP148
>> >> >>> supporters on the wrong pro-segwit, but still-viable chain.
>> >> >>>
>> >> >>> If Core had taken a strong stance to include BIP148 into the
>> >> >>> client,
>> >> >>> and if BIP148 support were much much broader, I would feel
>> >> >>> differently
>> >> >>> as the gamble would be more likely to discourage a chainsplit (By
>> >> >>> forcing the acceleration of segwit2x) rather than encourage it (by
>> >> >>> strengthening an extreme minority chainsplit that may wind up on
>> >> >>> the
>> >> >>> wrong side of two segwit-activated chains).  As it stands now, this
>> >> >>> seems like a very dangerous attempt to compromise with a small but
>> >> >>> vocal group that are the ones creating the threat to begin with.
>> >> >>>
>> >> >>> Jared
>> >> >>>
>> >> >>> On Tue, Jun 6, 2017 at 5:56 PM, James Hilliard via bitcoin-dev
>> >> >>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>> >> >>>> Due to the proposed calendar(https://segwit2x.github.io/) for the
>> >> >>>> SegWit2x agreement being too slow to activate SegWit mandatory
>> >> >>>> signalling ahead of BIP148 using BIP91 I would like to propose
>> >> >>>> another
>> >> >>>> option that miners can use to prevent a chain split ahead of the
>> >> >>>> Aug
>> >> >>>> 1st BIP148 activation date.
>> >> >>>>
>> >> >>>> The splitprotection soft fork is essentially BIP91 but using BIP8
>> >> >>>> instead of BIP9 with a lower activation threshold and immediate
>> >> >>>> mandatory signalling lock-in. This allows for a majority of miners
>> >> >>>> to
>> >> >>>> activate mandatory SegWit signalling and prevent a potential chain
>> >> >>>> split ahead of BIP148 activation.
>> >> >>>>
>> >> >>>> This BIP allows for miners to respond to market forces quickly
>> >> >>>> ahead
>> >> >>>> of BIP148 activation by signalling for splitprotection. Any miners
>> >> >>>> already running BIP148 should be encouraged to use
>> >> >>>> splitprotection.
>> >> >>>>
>> >> >>>> <pre>
>> >> >>>>   BIP: splitprotection
>> >> >>>>   Layer: Consensus (soft fork)
>> >> >>>>   Title: User Activated Soft Fork Split Protection
>> >> >>>>   Author: James Hilliard <james.hilliard1 at gmail.com>
>> >> >>>>   Comments-Summary: No comments yet.
>> >> >>>>   Comments-URI:
>> >> >>>>   Status: Draft
>> >> >>>>   Type: Standards Track
>> >> >>>>   Created: 2017-05-22
>> >> >>>>   License: BSD-3-Clause
>> >> >>>>            CC0-1.0
>> >> >>>> </pre>
>> >> >>>>
>> >> >>>> ==Abstract==
>> >> >>>>
>> >> >>>> This document specifies a coordination mechanism for a simple
>> >> >>>> majority
>> >> >>>> of miners to prevent a chain split ahead of BIP148 activation.
>> >> >>>>
>> >> >>>> ==Definitions==
>> >> >>>>
>> >> >>>> "existing segwit deployment" refer to the BIP9 "segwit" deployment
>> >> >>>> using bit 1, between November 15th 2016 and November 15th 2017 to
>> >> >>>> activate BIP141, BIP143 and BIP147.
>> >> >>>>
>> >> >>>> ==Motivation==
>> >> >>>>
>> >> >>>> The biggest risk of BIP148 is an extended chain split, this BIP
>> >> >>>> provides a way for a simple majority of miners to eliminate that
>> >> >>>> risk.
>> >> >>>>
>> >> >>>> This BIP provides a way for a simple majority of miners to
>> >> >>>> coordinate
>> >> >>>> activation of the existing segwit deployment with less than 95%
>> >> >>>> hashpower before BIP148 activation. Due to time constraints unless
>> >> >>>> immediately deployed BIP91 will likely not be able to enforce
>> >> >>>> mandatory signalling of segwit before the Aug 1st activation of
>> >> >>>> BIP148. This BIP provides a method for rapid miner activation of
>> >> >>>> SegWit mandatory signalling ahead of the BIP148 activation date.
>> >> >>>> Since
>> >> >>>> the primary goal of this BIP is to reduce the chance of an
>> >> >>>> extended
>> >> >>>> chain split as much as possible we activate using a simple miner
>> >> >>>> majority of 65% over a 504 block interval rather than a higher
>> >> >>>> percentage. This BIP also allows miners to signal their intention
>> >> >>>> to
>> >> >>>> run BIP148 in order to prevent a chain split.
>> >> >>>>
>> >> >>>> ==Specification==
>> >> >>>>
>> >> >>>> While this BIP is active, all blocks must set the nVersion header
>> >> >>>> top
>> >> >>>> 3 bits to 001 together with bit field (1<<1) (according to the
>> >> >>>> existing segwit deployment). Blocks that do not signal as required
>> >> >>>> will be rejected.
>> >> >>>>
>> >> >>>> ==Deployment==
>> >> >>>>
>> >> >>>> This BIP will be deployed by "version bits" with a 65%(this can be
>> >> >>>> adjusted if desired) activation threshold BIP9 with the name
>> >> >>>> "splitprotecion" and using bit 2.
>> >> >>>>
>> >> >>>> This BIP starts immediately and is a BIP8 style soft fork since
>> >> >>>> mandatory signalling will start on midnight August 1st 2017 (epoch
>> >> >>>> time 1501545600) regardless of whether or not this BIP has reached
>> >> >>>> its
>> >> >>>> own signalling threshold. This BIP will cease to be active when
>> >> >>>> segwit
>> >> >>>> is locked-in.
>> >> >>>>
>> >> >>>> === Reference implementation ===
>> >> >>>>
>> >> >>>> <pre>
>> >> >>>> // Check if Segregated Witness is Locked In
>> >> >>>> bool IsWitnessLockedIn(const CBlockIndex* pindexPrev, const
>> >> >>>> Consensus::Params& params)
>> >> >>>> {
>> >> >>>>     LOCK(cs_main);
>> >> >>>>     return (VersionBitsState(pindexPrev, params,
>> >> >>>> Consensus::DEPLOYMENT_SEGWIT, versionbitscache) ==
>> >> >>>> THRESHOLD_LOCKED_IN);
>> >> >>>> }
>> >> >>>>
>> >> >>>> // SPLITPROTECTION mandatory segwit signalling.
>> >> >>>> if ( VersionBitsState(pindex->pprev, chainparams.GetConsensus(),
>> >> >>>> Consensus::DEPLOYMENT_SPLITPROTECTION, versionbitscache) ==
>> >> >>>> THRESHOLD_LOCKED_IN &&
>> >> >>>>      !IsWitnessLockedIn(pindex->pprev, chainparams.GetConsensus())
>> >> >>>> &&
>> >> >>>> // Segwit is not locked in
>> >> >>>>      !IsWitnessEnabled(pindex->pprev, chainparams.GetConsensus())
>> >> >>>> )
>> >> >>>> //
>> >> >>>> and is not active.
>> >> >>>> {
>> >> >>>>     bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK)
>> >> >>>> ==
>> >> >>>> VERSIONBITS_TOP_BITS;
>> >> >>>>     bool fSegbit = (pindex->nVersion &
>> >> >>>> VersionBitsMask(chainparams.GetConsensus(),
>> >> >>>> Consensus::DEPLOYMENT_SEGWIT)) != 0;
>> >> >>>>     if (!(fVersionBits && fSegbit)) {
>> >> >>>>         return state.DoS(0, error("ConnectBlock(): relayed block
>> >> >>>> must
>> >> >>>> signal for segwit, please upgrade"), REJECT_INVALID,
>> >> >>>> "bad-no-segwit");
>> >> >>>>     }
>> >> >>>> }
>> >> >>>>
>> >> >>>> // BIP148 mandatory segwit signalling.
>> >> >>>> int64_t nMedianTimePast = pindex->GetMedianTimePast();
>> >> >>>> if ( (nMedianTimePast >= 1501545600) &&  // Tue 01 Aug 2017
>> >> >>>> 00:00:00
>> >> >>>> UTC
>> >> >>>>      (nMedianTimePast <= 1510704000) &&  // Wed 15 Nov 2017
>> >> >>>> 00:00:00
>> >> >>>> UTC
>> >> >>>>      (!IsWitnessLockedIn(pindex->pprev,
>> >> >>>> chainparams.GetConsensus())
>> >> >>>> &&
>> >> >>>>  // Segwit is not locked in
>> >> >>>>       !IsWitnessEnabled(pindex->pprev,
>> >> >>>> chainparams.GetConsensus())) )
>> >> >>>>  // and is not active.
>> >> >>>> {
>> >> >>>>     bool fVersionBits = (pindex->nVersion & VERSIONBITS_TOP_MASK)
>> >> >>>> ==
>> >> >>>> VERSIONBITS_TOP_BITS;
>> >> >>>>     bool fSegbit = (pindex->nVersion &
>> >> >>>> VersionBitsMask(chainparams.GetConsensus(),
>> >> >>>> Consensus::DEPLOYMENT_SEGWIT)) != 0;
>> >> >>>>     if (!(fVersionBits && fSegbit)) {
>> >> >>>>         return state.DoS(0, error("ConnectBlock(): relayed block
>> >> >>>> must
>> >> >>>> signal for segwit, please upgrade"), REJECT_INVALID,
>> >> >>>> "bad-no-segwit");
>> >> >>>>     }
>> >> >>>> }
>> >> >>>> </pre>
>> >> >>>>
>> >> >>>>
>> >> >>>>
>> >> >>>> https://github.com/bitcoin/bitcoin/compare/0.14...jameshilliard:splitprotection-v0.14.1
>> >> >>>>
>> >> >>>> ==Backwards Compatibility==
>> >> >>>>
>> >> >>>> This deployment is compatible with the existing "segwit" bit 1
>> >> >>>> deployment scheduled between midnight November 15th, 2016 and
>> >> >>>> midnight
>> >> >>>> November 15th, 2017. This deployment is also compatible with the
>> >> >>>> existing BIP148 deployment. This BIP is compatible with BIP91 only
>> >> >>>> if
>> >> >>>> BIP91 activates before it and before BIP148. Miners will need to
>> >> >>>> upgrade their nodes to support splitprotection otherwise they may
>> >> >>>> build on top of an invalid block. While this bip is active users
>> >> >>>> should either upgrade to splitprotection or wait for additional
>> >> >>>> confirmations when accepting payments.
>> >> >>>>
>> >> >>>> ==Rationale==
>> >> >>>>
>> >> >>>> Historically we have used IsSuperMajority() to activate soft forks
>> >> >>>> such as BIP66 which has a mandatory signalling requirement for
>> >> >>>> miners
>> >> >>>> once activated, this ensures that miners are aware of new rules
>> >> >>>> being
>> >> >>>> enforced. This technique can be leveraged to lower the signalling
>> >> >>>> threshold of a soft fork while it is in the process of being
>> >> >>>> deployed
>> >> >>>> in a backwards compatible way. We also use a BIP8 style timeout to
>> >> >>>> ensure that this BIP is compatible with BIP148 and that BIP148
>> >> >>>> compatible mandatory signalling activates regardless of miner
>> >> >>>> signalling levels.
>> >> >>>>
>> >> >>>> By orphaning non-signalling blocks during the BIP9 bit 1 "segwit"
>> >> >>>> deployment, this BIP can cause the existing "segwit" deployment to
>> >> >>>> activate without needing to release a new deployment. As we
>> >> >>>> approach
>> >> >>>> BIP148 activation it may be desirable for a majority of miners to
>> >> >>>> have
>> >> >>>> a method that will ensure that there is no chain split.
>> >> >>>>
>> >> >>>> ==References==
>> >> >>>>
>> >> >>>>
>> >> >>>>
>> >> >>>> *[https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-March/013714.html
>> >> >>>> Mailing list discussion]
>> >> >>>>
>> >> >>>>
>> >> >>>> *[https://github.com/bitcoin/bitcoin/blob/v0.6.0/src/main.cpp#L1281-L1283
>> >> >>>> P2SH flag day activation]
>> >> >>>> *[[bip-0009.mediawiki|BIP9 Version bits with timeout and delay]]
>> >> >>>> *[[bip-0016.mediawiki|BIP16 Pay to Script Hash]]
>> >> >>>> *[[bip-0091.mediawiki|BIP91 Reduced threshold Segwit MASF]]
>> >> >>>> *[[bip-0141.mediawiki|BIP141 Segregated Witness (Consensus
>> >> >>>> layer)]]
>> >> >>>> *[[bip-0143.mediawiki|BIP143 Transaction Signature Verification
>> >> >>>> for
>> >> >>>> Version 0 Witness Program]]
>> >> >>>> *[[bip-0147.mediawiki|BIP147 Dealing with dummy stack element
>> >> >>>> malleability]]
>> >> >>>> *[[bip-0148.mediawiki|BIP148 Mandatory activation of segwit
>> >> >>>> deployment]]
>> >> >>>> *[[bip-0149.mediawiki|BIP149 Segregated Witness (second
>> >> >>>> deployment)]]
>> >> >>>> *[https://bitcoincore.org/en/2016/01/26/segwit-benefits/ Segwit
>> >> >>>> benefits]
>> >> >>>>
>> >> >>>> ==Copyright==
>> >> >>>>
>> >> >>>> This document is dual licensed as BSD 3-clause, and Creative
>> >> >>>> Commons
>> >> >>>> CC0 1.0 Universal.
>> >> >>>> _______________________________________________
>> >> >>>> bitcoin-dev mailing list
>> >> >>>> bitcoin-dev at lists.linuxfoundation.org
>> >> >>>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>> >
>> >
>
>

From jaredr26 at gmail.com  Thu Jun  8 00:20:23 2017
From: jaredr26 at gmail.com (Jared Lee Richardson)
Date: Wed, 7 Jun 2017 17:20:23 -0700
Subject: [bitcoin-dev] User Activated Soft Fork Split Protection
In-Reply-To: <CADvTj4o5tTD2XN080dmHq1DuNwSZtmAytv3=7F5zGeBdhiPMrA@mail.gmail.com>
References: <CADvTj4qpH-t5Gx6qyn3yToyUE_GFaBE989=AWNHLKMpMNW3R+w@mail.gmail.com>
	<CAD1TkXviJouao7YoHjiDN3mTUWFEbMY9mtCqkQ8zp8JthyhT7Q@mail.gmail.com>
	<CADvTj4rz4exYMvBEmYi=bTZDgDm0drLjpRZmZUo17inzCzCRVg@mail.gmail.com>
	<CAD1TkXskei1gk_kungSvdWGmbdJMA8AG+-zK+Osz6u5vSCN8BQ@mail.gmail.com>
	<CADvTj4poO1L+Wg5J+M71sJMz-Xcg_st3MkAcQK=bfHhTJ3i8ow@mail.gmail.com>
	<CAD1TkXumetRnPO6LxhJeVoci=0=YHD7hEB0K0YH+2McRBJ-QHw@mail.gmail.com>
	<CADvTj4pFna4tX37XmgrP7ueZB+Yv4T9NWmp99CwKSx5mzdiJJQ@mail.gmail.com>
	<CAD1TkXtmj3H3k+k7X2DgA0cNxXBNSSrzf_o33qFO8cA9eSUTnw@mail.gmail.com>
	<CADvTj4o5tTD2XN080dmHq1DuNwSZtmAytv3=7F5zGeBdhiPMrA@mail.gmail.com>
Message-ID: <CAD1TkXuBc8nQr7ZSog4aYbppqR9Bg4cX=gFdSZCvBXfZmmhQww@mail.gmail.com>

> Not really, there are a few relatively simple techniques such as RBF
> which can be leveraged to get confirmations on on-side before double
> spending on another. Once a transaction is confirmed on the non-BIP148
> chain then the high fee transactions can be made on only the BIP148
> side of the split using RBF.

Ah, so the BIP148 client handles this on behalf of its less technical users
on their behalf then, yes?

>  Exchanges will likely do this splitting
> automatically for uses as well.

Sure, Exchanges are going to dedicate hundreds of developer hours and
thousands of support hours to support something that they've repeatedly
told everyone must have replay protection to be supported.  They're going
to do this because 8% of nodes and <0.5% of miners say they'll be rewarded
richly.  Somehow I find that hard to believe.

Besides, if the BIP148 client does it for them, they wouldn't have to
dedicate those hundreds of developer hours.  Right?

I can't imagine how this logic is getting you from where the real data is
to the assumption that an economic majority will push BIP148 into being
such a more valuable chain that switching chains will be attractive to
enough miners.  There's got to be some real data that convinces you of this
somewhere?

> Both are issues, but wipeout risk is different, the ETH/ETC split for
> example didn't have any wipeout risk for either side the same is not
> true for BIP148(and it is the non-BIP148 side that carries the risk of
> chain wipeout).

Wipeout risk is a serious issue when 45% of the miners support one chain
and 55% support the other chain.  Segwit doesn't even have 35% of the
miners; There's no data or statements anywhere that indicate that UASF is
going to reach the point where wipeout risk is even comparable to
abandonment risk.

> Yes, miners aren't likely to waste operational mining costs, that's
> ultimately why miners would follow the BIP148 side of the chain
> assuming it has sufficient economic support or if it's more profitable
> to mine.

To convince miners you would have to have some data SOMEWHERE supporting
the economic majority argument.  Is there any such data?

> segwit2x has more issues since the HF part requires users to reach
consensus

It doesn't have those issues during the segwit activation, ergo there is no
reason for segwit-activation problems to take priority over the very real
hardfork activation problems.

> That's a political reason not a technical reason.

In a consensus system they are frequently the same, unfortunately.
Technical awesomeness without people agreeing = zero consensus.  So the
choice is either to "technically" break the consensus without a
super-majority and see what happens, or to go with the choice that has real
data showing the most consensus and hope the tiny minority chain actually
dies off.

Jared

On Wed, Jun 7, 2017 at 5:01 PM, James Hilliard <james.hilliard1 at gmail.com>
wrote:

> On Wed, Jun 7, 2017 at 6:43 PM, Jared Lee Richardson <jaredr26 at gmail.com>
> wrote:
> >> BIP148 however is a consensus change that can
> >> be rectified if it gets more work, this would act as an additional
> >> incentive for mine the BIP148 side since there would be no wipeout
> >> risk there.
> >
> > This statement is misleading.  Wipeout risks don't apply to any consensus
> > changes; It is a consensus change, it can only be abandoned.  The BIP148
> > chain carries just as many risks of being abandoned or even more with
> > segwit2x on the table.  No miner would consider "wipeout risk" an
> advantage
> > when the real threat is chain abandonment.
> Both are issues, but wipeout risk is different, the ETH/ETC split for
> example didn't have any wipeout risk for either side the same is not
> true for BIP148(and it is the non-BIP148 side that carries the risk of
> chain wipeout).
> >
> >> Higher transaction fees on a minority chain can compensate miners for
> >> a lower price which would likely be enough to get the BIP148 chain to
> >> a difficulty reduction.
> >
> > Higher transaction fees suffers the same problem as exchange support
> does.
> > Without replay protection, it is very difficult for any average user to
> > force transactions onto one chain or the other.  Thus, without replay
> > protection, the UASF chain is unlikely to develop any viable fee market;
> Its
> > few miners 99% of the time will simply choose from the highest fees that
> > were already available to the other chain, which is basically no
> advantage
> > at all.
> Not really, there are a few relatively simple techniques such as RBF
> which can be leveraged to get confirmations on on-side before double
> spending on another. Once a transaction is confirmed on the non-BIP148
> chain then the high fee transactions can be made on only the BIP148
> side of the split using RBF. Exchanges will likely do this splitting
> automatically for uses as well.
> >
> >>  ETC replay protection was done after the fork on an as
> >> needed basis(there are multiple reliable techniques that can be used
> >> to split UTXO's), the same can happen with BIP148 and it is easier to
> >> do with Bitcoin than with the ETH/ETC split IMO.
> >
> > ETC replay protection was added because they were already a hardfork and
> > without it they would not have had a viable chain.  BIP148 is not
> supposed
> > to be a hardfork, and if it added replay protection to remain viable it
> > would lose the frequently touted "wipeout advantage" as well as the
> ability
> > to call itself a softfork.  And are you seriously suggesting that what
> > happened with ETC and ETH is a desirable and good situation for Bitcoin,
> and
> > that UASF is ETC?
> There wasn't proper replay protection at split time for ETH/ETC since
> normal transactions would get executed on both sides originally,
> however replay protection was added by wallets(mainly using splitting
> contracts). I don't think a split is desirable however, which is why
> I've proposed this BIP.
> >
> >> A big reason BIP148 still has support is because up until SegWit
> >> actually activates there's no guarantee segwit2mb will actually have
> >> the necessary support to activate SegWit.
> >
> > For a miners blowing through six million dollars a day in mining
> operational
> > costs, that's a pretty crappy reason.  Serious miners can't afford to
> prop
> > up a non-viable chain based on philosophy or maybes.  BIP148 is based
> > entirely upon people who aren't putting anything on the line trying to
> > convince others to take the huge risks for them.  With deceptively
> > fallacious logic, in my opinion.
> Yes, miners aren't likely to waste operational mining costs, that's
> ultimately why miners would follow the BIP148 side of the chain
> assuming it has sufficient economic support or if it's more profitable
> to mine.
> >
> > Even segwit2x is based on the assumption that all miners can reach
> > consensus.  Break that assumption and segwit2x will have the same
> problems
> > as UASF.
> segwit2x has more issues since the HF part requires users to reach
> consensus
> >
> >> This is largely an issue due to segwit2x's bundling, if the SW and HF
> >> part of segwit2x were unbundled then there would be no reason to delay
> >> BIP91 activation
> >
> > They are bundled.  Segwit alone doesn't have the desired overwhelming
> > consensus, unless core wishes to fork 71% to 29%, and maybe not even that
> > high.  That's the technical reason, and they can't be unbundled without
> > breaking that consensus.
> That's a political reason not a technical reason.
> >
> > Jared
> >
> >
> > On Wed, Jun 7, 2017 at 4:11 PM, James Hilliard <
> james.hilliard1 at gmail.com>
> > wrote:
> >>
> >> On Wed, Jun 7, 2017 at 5:53 PM, Jared Lee Richardson <
> jaredr26 at gmail.com>
> >> wrote:
> >> >> There are 2 primary factors involved here, economic support and
> >> > hashpower either of which is enough to make a permanent chain split
> >> > unlikely, miners will mine whichever chain is most profitable(see
> >> > ETH/ETC hashpower profitability equilibrium for an example of how this
> >> > works in practice)
> >> >
> >> > That's not a comparable example.  ETC did not face potentially years
> of
> >> > slow
> >> > blocktimes before it normalized, whereas BIP148 is on track to do
> >> > exactly
> >> > that.  Moreover, ETC represented a fundamental break from the majority
> >> > consensus that could not be rectified, whereas BIP148 represents only
> a
> >> > minority attempt to accelerate something that an overwhelming majority
> >> > of
> >> > miners have already agreed to activate under segwit2x.  Lastly ETC was
> >> > required to add replay protection, just like any minority fork
> proposed
> >> > by
> >> > any crypto-currency has been, something that BIP148 both lacks and
> >> > refuses
> >> > to add or even acknowledge the necessity of.  Without replay
> protection,
> >> > ETC
> >> > could not have become profitable enough to be a viable minority chain.
> >> > If
> >> > BIP148's chain is not the majority chain and it does not have replay
> >> > protection, it will face the same problems, but that required replay
> >> > protection will turn it into a hardfork.  This will be a very bad
> >> > position
> >> > for UASF supporters to find themselves in - Either hardfork and hope
> the
> >> > price is higher and the majority converts, or die as the minority
> chain
> >> > with
> >> > no reliable methods of economic conversion.
> >> Higher transaction fees on a minority chain can compensate miners for
> >> a lower price which would likely be enough to get the BIP148 chain to
> >> a difficulty reduction. BIP148 however is a consensus change that can
> >> be rectified if it gets more work, this would act as an additional
> >> incentive for mine the BIP148 side since there would be no wipeout
> >> risk there. ETC replay protection was done after the fork on an as
> >> needed basis(there are multiple reliable techniques that can be used
> >> to split UTXO's), the same can happen with BIP148 and it is easier to
> >> do with Bitcoin than with the ETH/ETC split IMO.
> >> >
> >> > I believe, but don't have data to back this, that most of the BIP148
> >> > insistence comes not from a legitimate attempt to gain consensus (or
> >> > else
> >> > they would either outright oppose segwit2mb for its hardfork, or they
> >> > would
> >> > outright support it), but rather from an attempt for BIP148 supporters
> >> > to
> >> > save face for BIP148 being a failure.  If I'm correct, that's a
> terrible
> >> > and
> >> > highly non-technical reason for segwit2mb to bend over backwards
> >> > attempting
> >> > to support BIP148's attempt to save face.
> >> A big reason BIP148 still has support is because up until SegWit
> >> actually activates there's no guarantee segwit2mb will actually have
> >> the necessary support to activate SegWit.
> >> >
> >> >> The main issue is just one of activation timelines, BIP91 as
> >> > is takes too long to activate unless started ahead of the existing
> >> > segwit2x schedule and it's unlikely that BIP148 will get pushed back
> >> > any further.
> >> >
> >> > Even if I'm not correct on the above, I and others find it hard to
> >> > accept
> >> > that this timeline conflict is segwit2x's fault.  Segwit2x has both
> some
> >> > flexibility and broad support that crosses contentious pro-segwit and
> >> > pro-blocksize-increase divisions that have existed for two years.
> >> > BIP148 is
> >> > attempting to hold segwit2x's timelines and code hostage by claiming
> >> > inflexibility and claiming broad support, and not only are neither of
> >> > those
> >> > assertions are backed by real data, BIP148 (by being so inflexible) is
> >> > pushing a position that deepens the divides between those groups.  For
> >> > there
> >> > to be technical reasons for compatibility (so long as there are
> >> > tradeoffs,
> >> > which there are), there needs to be hard data showing that BIP148 is a
> >> > viable minority fork that won't simply die off on its own.
> >> This is largely an issue due to segwit2x's bundling, if the SW and HF
> >> part of segwit2x were unbundled then there would be no reason to delay
> >> BIP91 activation, this is especially a problem since it takes a good
> >> deal of time to properly code and test a HF. Unfortunately segwit2x
> >> has been quite inflexible in regards to the bundling aspect even
> >> though there are clearly no technical reasons for it to be there.
> >> >
> >> > Jared
> >> >
> >> >
> >> > On Wed, Jun 7, 2017 at 3:23 PM, James Hilliard
> >> > <james.hilliard1 at gmail.com>
> >> > wrote:
> >> >>
> >> >> On Wed, Jun 7, 2017 at 4:50 PM, Jared Lee Richardson
> >> >> <jaredr26 at gmail.com>
> >> >> wrote:
> >> >> > Could this risk mitigation measure be an optional flag?  And if so,
> >> >> > could it+BIP91 signal on a different bit than bit4?
> >> >> It's fairly trivial for miners to signal for BIP91 on bit4 or a
> >> >> different bit at the same time as the code is trivial enough to
> >> >> combine
> >> >> >
> >> >> > The reason being, if for some reason the segwit2x activation cannot
> >> >> > take place in time, it would be preferable for miners to have a
> more
> >> >> > standard approach to activation that requires stronger consensus
> and
> >> >> > may be more forgiving than BIP148.  If the segwit2x activation is
> on
> >> >> > time to cooperate with BIP148, it could be signaled through the
> >> >> > non-bit4 approach and everything could go smoothly.  Thoughts on
> that
> >> >> > idea?  It may add more complexity and more developer time, but may
> >> >> > also address your concerns among others.
> >> >> This does give miners another approach to activate segwit ahead of
> >> >> BIP148, if segwit2x activation is rolled out and activated
> immediately
> >> >> then this would not be needed however based on the timeline here
> >> >> https://segwit2x.github.io/ it would not be possible for BIP91 to
> >> >> enforce mandatory signalling ahead of BIP148. Maybe that can be
> >> >> changed though, I've suggested an immediate rollout with a
> placeholder
> >> >> client timeout instead of the HF code initially in order to
> accelerate
> >> >> that.
> >> >> >
> >> >> >> Since this BIP
> >> >> >> only activates with a clear miner majority it should not increase
> >> >> >> the
> >> >> >> risk of an extended chain split.
> >> >> >
> >> >> > The concern I'm raising is more about the psychology of giving
> BIP148
> >> >> > a sense of safety that may not be valid.  Without several more
> steps,
> >> >> > BIP148 is definitely on track to be a risky chainsplit, and without
> >> >> > segwit2x it will almost certainly be a small minority chain.
> (Unless
> >> >> > the segwit2x compromise falls apart before then, and even in that
> >> >> > case
> >> >> > it is likely to be a minority chain)
> >> >> There are 2 primary factors involved here, economic support and
> >> >> hashpower either of which is enough to make a permanent chain split
> >> >> unlikely, miners will mine whichever chain is most profitable(see
> >> >> ETH/ETC hashpower profitability equilibrium for an example of how
> this
> >> >> works in practice) however there may be lag time immediately after
> the
> >> >> split if there is an economic majority but not a hashpower majority
> >> >> initially. This is risk mitigation that only requires miners support
> >> >> however. The main issue is just one of activation timelines, BIP91 as
> >> >> is takes too long to activate unless started ahead of the existing
> >> >> segwit2x schedule and it's unlikely that BIP148 will get pushed back
> >> >> any further.
> >> >> >
> >> >> > Jared
> >> >> >
> >> >> >
> >> >> > On Wed, Jun 7, 2017 at 2:42 PM, James Hilliard
> >> >> > <james.hilliard1 at gmail.com> wrote:
> >> >> >> I don't really see how this would increase the likelihood of an
> >> >> >> extended chain split assuming BIP148 is going to have
> >> >> >> non-insignificant economic backing. This BIP is designed to
> provide
> >> >> >> a
> >> >> >> risk mitigation measure that miners can safely deploy. Since this
> >> >> >> BIP
> >> >> >> only activates with a clear miner majority it should not increase
> >> >> >> the
> >> >> >> risk of an extended chain split. At this point it is not
> completely
> >> >> >> clear how much economic support there is for BIP148 but support
> >> >> >> certainly seems to be growing and we have nearly 2 months until
> >> >> >> BIP148
> >> >> >> activation. I intentionally used a shorter activation period here
> so
> >> >> >> that decisions by miners can be made close to the BIP148
> activation
> >> >> >> date.
> >> >> >>
> >> >> >> On Wed, Jun 7, 2017 at 4:29 PM, Jared Lee Richardson
> >> >> >> <jaredr26 at gmail.com> wrote:
> >> >> >>> I think this BIP represents a gamble, and the gamble may not be a
> >> >> >>> good
> >> >> >>> one.  The gamble here is that if the segwit2x changes are rolled
> >> >> >>> out
> >> >> >>> on time, and if the signatories accept the bit4 + bit1 signaling
> >> >> >>> proposals within BIP91, the launch will go smoother, as intended.
> >> >> >>> But
> >> >> >>> conversely, if either the segwit2x signatories balk about the
> Bit1
> >> >> >>> signaling OR if the timelines for segwit2mb are missed even by a
> >> >> >>> bit,
> >> >> >>> it may cause the BIP148 chainsplit to be worse than it would be
> >> >> >>> without.  Given the frequent concerns raised in multiple places
> >> >> >>> about
> >> >> >>> the aggressiveness of the segwit2x timelines, including the
> >> >> >>> non-hardfork timelines, this does not seem like a great gamble to
> >> >> >>> be
> >> >> >>> making.
> >> >> >>>
> >> >> >>> The reason I say it may make the chainsplit be worse than it
> would
> >> >> >>> otherwise be is that it may provide a false sense of safety for
> >> >> >>> BIP148
> >> >> >>> that currently does not currently exist(and should not, as it is
> a
> >> >> >>> chainsplit).  That sense of safety would only be legitimate if
> the
> >> >> >>> segwit2x signatories were on board, and the segwit2x code
> >> >> >>> effectively
> >> >> >>> enforced BIP148 simultaneously, neither of which are guaranteed.
> >> >> >>> If
> >> >> >>> users and more miners had a false sense that BIP148 was *not*
> going
> >> >> >>> to
> >> >> >>> chainsplit from default / segwit2x, they might not follow the
> news
> >> >> >>> if
> >> >> >>> suddenly the segwit2x plan were delayed for a few days.  While
> any
> >> >> >>> additional support would definitely be cheered on by BIP148
> >> >> >>> supporters, the practical reality might be that this proposal
> would
> >> >> >>> take BIP148 from the "unlikely to have any viable chain after
> flag
> >> >> >>> day
> >> >> >>> without segwit2x" category into the "small but viable minority
> >> >> >>> chain"
> >> >> >>> category, and even worse, it might strengthen the chainsplit just
> >> >> >>> days
> >> >> >>> before segwit is activated on BOTH chains, putting the BIP148
> >> >> >>> supporters on the wrong pro-segwit, but still-viable chain.
> >> >> >>>
> >> >> >>> If Core had taken a strong stance to include BIP148 into the
> >> >> >>> client,
> >> >> >>> and if BIP148 support were much much broader, I would feel
> >> >> >>> differently
> >> >> >>> as the gamble would be more likely to discourage a chainsplit (By
> >> >> >>> forcing the acceleration of segwit2x) rather than encourage it
> (by
> >> >> >>> strengthening an extreme minority chainsplit that may wind up on
> >> >> >>> the
> >> >> >>> wrong side of two segwit-activated chains).  As it stands now,
> this
> >> >> >>> seems like a very dangerous attempt to compromise with a small
> but
> >> >> >>> vocal group that are the ones creating the threat to begin with.
> >> >> >>>
> >> >> >>> Jared
> >> >> >>>
> >> >> >>> On Tue, Jun 6, 2017 at 5:56 PM, James Hilliard via bitcoin-dev
> >> >> >>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
> >> >> >>>> Due to the proposed calendar(https://segwit2x.github.io/) for
> the
> >> >> >>>> SegWit2x agreement being too slow to activate SegWit mandatory
> >> >> >>>> signalling ahead of BIP148 using BIP91 I would like to propose
> >> >> >>>> another
> >> >> >>>> option that miners can use to prevent a chain split ahead of the
> >> >> >>>> Aug
> >> >> >>>> 1st BIP148 activation date.
> >> >> >>>>
> >> >> >>>> The splitprotection soft fork is essentially BIP91 but using
> BIP8
> >> >> >>>> instead of BIP9 with a lower activation threshold and immediate
> >> >> >>>> mandatory signalling lock-in. This allows for a majority of
> miners
> >> >> >>>> to
> >> >> >>>> activate mandatory SegWit signalling and prevent a potential
> chain
> >> >> >>>> split ahead of BIP148 activation.
> >> >> >>>>
> >> >> >>>> This BIP allows for miners to respond to market forces quickly
> >> >> >>>> ahead
> >> >> >>>> of BIP148 activation by signalling for splitprotection. Any
> miners
> >> >> >>>> already running BIP148 should be encouraged to use
> >> >> >>>> splitprotection.
> >> >> >>>>
> >> >> >>>> <pre>
> >> >> >>>>   BIP: splitprotection
> >> >> >>>>   Layer: Consensus (soft fork)
> >> >> >>>>   Title: User Activated Soft Fork Split Protection
> >> >> >>>>   Author: James Hilliard <james.hilliard1 at gmail.com>
> >> >> >>>>   Comments-Summary: No comments yet.
> >> >> >>>>   Comments-URI:
> >> >> >>>>   Status: Draft
> >> >> >>>>   Type: Standards Track
> >> >> >>>>   Created: 2017-05-22
> >> >> >>>>   License: BSD-3-Clause
> >> >> >>>>            CC0-1.0
> >> >> >>>> </pre>
> >> >> >>>>
> >> >> >>>> ==Abstract==
> >> >> >>>>
> >> >> >>>> This document specifies a coordination mechanism for a simple
> >> >> >>>> majority
> >> >> >>>> of miners to prevent a chain split ahead of BIP148 activation.
> >> >> >>>>
> >> >> >>>> ==Definitions==
> >> >> >>>>
> >> >> >>>> "existing segwit deployment" refer to the BIP9 "segwit"
> deployment
> >> >> >>>> using bit 1, between November 15th 2016 and November 15th 2017
> to
> >> >> >>>> activate BIP141, BIP143 and BIP147.
> >> >> >>>>
> >> >> >>>> ==Motivation==
> >> >> >>>>
> >> >> >>>> The biggest risk of BIP148 is an extended chain split, this BIP
> >> >> >>>> provides a way for a simple majority of miners to eliminate that
> >> >> >>>> risk.
> >> >> >>>>
> >> >> >>>> This BIP provides a way for a simple majority of miners to
> >> >> >>>> coordinate
> >> >> >>>> activation of the existing segwit deployment with less than 95%
> >> >> >>>> hashpower before BIP148 activation. Due to time constraints
> unless
> >> >> >>>> immediately deployed BIP91 will likely not be able to enforce
> >> >> >>>> mandatory signalling of segwit before the Aug 1st activation of
> >> >> >>>> BIP148. This BIP provides a method for rapid miner activation of
> >> >> >>>> SegWit mandatory signalling ahead of the BIP148 activation date.
> >> >> >>>> Since
> >> >> >>>> the primary goal of this BIP is to reduce the chance of an
> >> >> >>>> extended
> >> >> >>>> chain split as much as possible we activate using a simple miner
> >> >> >>>> majority of 65% over a 504 block interval rather than a higher
> >> >> >>>> percentage. This BIP also allows miners to signal their
> intention
> >> >> >>>> to
> >> >> >>>> run BIP148 in order to prevent a chain split.
> >> >> >>>>
> >> >> >>>> ==Specification==
> >> >> >>>>
> >> >> >>>> While this BIP is active, all blocks must set the nVersion
> header
> >> >> >>>> top
> >> >> >>>> 3 bits to 001 together with bit field (1<<1) (according to the
> >> >> >>>> existing segwit deployment). Blocks that do not signal as
> required
> >> >> >>>> will be rejected.
> >> >> >>>>
> >> >> >>>> ==Deployment==
> >> >> >>>>
> >> >> >>>> This BIP will be deployed by "version bits" with a 65%(this can
> be
> >> >> >>>> adjusted if desired) activation threshold BIP9 with the name
> >> >> >>>> "splitprotecion" and using bit 2.
> >> >> >>>>
> >> >> >>>> This BIP starts immediately and is a BIP8 style soft fork since
> >> >> >>>> mandatory signalling will start on midnight August 1st 2017
> (epoch
> >> >> >>>> time 1501545600) regardless of whether or not this BIP has
> reached
> >> >> >>>> its
> >> >> >>>> own signalling threshold. This BIP will cease to be active when
> >> >> >>>> segwit
> >> >> >>>> is locked-in.
> >> >> >>>>
> >> >> >>>> === Reference implementation ===
> >> >> >>>>
> >> >> >>>> <pre>
> >> >> >>>> // Check if Segregated Witness is Locked In
> >> >> >>>> bool IsWitnessLockedIn(const CBlockIndex* pindexPrev, const
> >> >> >>>> Consensus::Params& params)
> >> >> >>>> {
> >> >> >>>>     LOCK(cs_main);
> >> >> >>>>     return (VersionBitsState(pindexPrev, params,
> >> >> >>>> Consensus::DEPLOYMENT_SEGWIT, versionbitscache) ==
> >> >> >>>> THRESHOLD_LOCKED_IN);
> >> >> >>>> }
> >> >> >>>>
> >> >> >>>> // SPLITPROTECTION mandatory segwit signalling.
> >> >> >>>> if ( VersionBitsState(pindex->pprev,
> chainparams.GetConsensus(),
> >> >> >>>> Consensus::DEPLOYMENT_SPLITPROTECTION, versionbitscache) ==
> >> >> >>>> THRESHOLD_LOCKED_IN &&
> >> >> >>>>      !IsWitnessLockedIn(pindex->pprev,
> chainparams.GetConsensus())
> >> >> >>>> &&
> >> >> >>>> // Segwit is not locked in
> >> >> >>>>      !IsWitnessEnabled(pindex->pprev,
> chainparams.GetConsensus())
> >> >> >>>> )
> >> >> >>>> //
> >> >> >>>> and is not active.
> >> >> >>>> {
> >> >> >>>>     bool fVersionBits = (pindex->nVersion &
> VERSIONBITS_TOP_MASK)
> >> >> >>>> ==
> >> >> >>>> VERSIONBITS_TOP_BITS;
> >> >> >>>>     bool fSegbit = (pindex->nVersion &
> >> >> >>>> VersionBitsMask(chainparams.GetConsensus(),
> >> >> >>>> Consensus::DEPLOYMENT_SEGWIT)) != 0;
> >> >> >>>>     if (!(fVersionBits && fSegbit)) {
> >> >> >>>>         return state.DoS(0, error("ConnectBlock(): relayed block
> >> >> >>>> must
> >> >> >>>> signal for segwit, please upgrade"), REJECT_INVALID,
> >> >> >>>> "bad-no-segwit");
> >> >> >>>>     }
> >> >> >>>> }
> >> >> >>>>
> >> >> >>>> // BIP148 mandatory segwit signalling.
> >> >> >>>> int64_t nMedianTimePast = pindex->GetMedianTimePast();
> >> >> >>>> if ( (nMedianTimePast >= 1501545600) &&  // Tue 01 Aug 2017
> >> >> >>>> 00:00:00
> >> >> >>>> UTC
> >> >> >>>>      (nMedianTimePast <= 1510704000) &&  // Wed 15 Nov 2017
> >> >> >>>> 00:00:00
> >> >> >>>> UTC
> >> >> >>>>      (!IsWitnessLockedIn(pindex->pprev,
> >> >> >>>> chainparams.GetConsensus())
> >> >> >>>> &&
> >> >> >>>>  // Segwit is not locked in
> >> >> >>>>       !IsWitnessEnabled(pindex->pprev,
> >> >> >>>> chainparams.GetConsensus())) )
> >> >> >>>>  // and is not active.
> >> >> >>>> {
> >> >> >>>>     bool fVersionBits = (pindex->nVersion &
> VERSIONBITS_TOP_MASK)
> >> >> >>>> ==
> >> >> >>>> VERSIONBITS_TOP_BITS;
> >> >> >>>>     bool fSegbit = (pindex->nVersion &
> >> >> >>>> VersionBitsMask(chainparams.GetConsensus(),
> >> >> >>>> Consensus::DEPLOYMENT_SEGWIT)) != 0;
> >> >> >>>>     if (!(fVersionBits && fSegbit)) {
> >> >> >>>>         return state.DoS(0, error("ConnectBlock(): relayed block
> >> >> >>>> must
> >> >> >>>> signal for segwit, please upgrade"), REJECT_INVALID,
> >> >> >>>> "bad-no-segwit");
> >> >> >>>>     }
> >> >> >>>> }
> >> >> >>>> </pre>
> >> >> >>>>
> >> >> >>>>
> >> >> >>>>
> >> >> >>>> https://github.com/bitcoin/bitcoin/compare/0.14...
> jameshilliard:splitprotection-v0.14.1
> >> >> >>>>
> >> >> >>>> ==Backwards Compatibility==
> >> >> >>>>
> >> >> >>>> This deployment is compatible with the existing "segwit" bit 1
> >> >> >>>> deployment scheduled between midnight November 15th, 2016 and
> >> >> >>>> midnight
> >> >> >>>> November 15th, 2017. This deployment is also compatible with the
> >> >> >>>> existing BIP148 deployment. This BIP is compatible with BIP91
> only
> >> >> >>>> if
> >> >> >>>> BIP91 activates before it and before BIP148. Miners will need to
> >> >> >>>> upgrade their nodes to support splitprotection otherwise they
> may
> >> >> >>>> build on top of an invalid block. While this bip is active users
> >> >> >>>> should either upgrade to splitprotection or wait for additional
> >> >> >>>> confirmations when accepting payments.
> >> >> >>>>
> >> >> >>>> ==Rationale==
> >> >> >>>>
> >> >> >>>> Historically we have used IsSuperMajority() to activate soft
> forks
> >> >> >>>> such as BIP66 which has a mandatory signalling requirement for
> >> >> >>>> miners
> >> >> >>>> once activated, this ensures that miners are aware of new rules
> >> >> >>>> being
> >> >> >>>> enforced. This technique can be leveraged to lower the
> signalling
> >> >> >>>> threshold of a soft fork while it is in the process of being
> >> >> >>>> deployed
> >> >> >>>> in a backwards compatible way. We also use a BIP8 style timeout
> to
> >> >> >>>> ensure that this BIP is compatible with BIP148 and that BIP148
> >> >> >>>> compatible mandatory signalling activates regardless of miner
> >> >> >>>> signalling levels.
> >> >> >>>>
> >> >> >>>> By orphaning non-signalling blocks during the BIP9 bit 1
> "segwit"
> >> >> >>>> deployment, this BIP can cause the existing "segwit" deployment
> to
> >> >> >>>> activate without needing to release a new deployment. As we
> >> >> >>>> approach
> >> >> >>>> BIP148 activation it may be desirable for a majority of miners
> to
> >> >> >>>> have
> >> >> >>>> a method that will ensure that there is no chain split.
> >> >> >>>>
> >> >> >>>> ==References==
> >> >> >>>>
> >> >> >>>>
> >> >> >>>>
> >> >> >>>> *[https://lists.linuxfoundation.org/pipermail/
> bitcoin-dev/2017-March/013714.html
> >> >> >>>> Mailing list discussion]
> >> >> >>>>
> >> >> >>>>
> >> >> >>>> *[https://github.com/bitcoin/bitcoin/blob/v0.6.0/src/main.
> cpp#L1281-L1283
> >> >> >>>> P2SH flag day activation]
> >> >> >>>> *[[bip-0009.mediawiki|BIP9 Version bits with timeout and delay]]
> >> >> >>>> *[[bip-0016.mediawiki|BIP16 Pay to Script Hash]]
> >> >> >>>> *[[bip-0091.mediawiki|BIP91 Reduced threshold Segwit MASF]]
> >> >> >>>> *[[bip-0141.mediawiki|BIP141 Segregated Witness (Consensus
> >> >> >>>> layer)]]
> >> >> >>>> *[[bip-0143.mediawiki|BIP143 Transaction Signature Verification
> >> >> >>>> for
> >> >> >>>> Version 0 Witness Program]]
> >> >> >>>> *[[bip-0147.mediawiki|BIP147 Dealing with dummy stack element
> >> >> >>>> malleability]]
> >> >> >>>> *[[bip-0148.mediawiki|BIP148 Mandatory activation of segwit
> >> >> >>>> deployment]]
> >> >> >>>> *[[bip-0149.mediawiki|BIP149 Segregated Witness (second
> >> >> >>>> deployment)]]
> >> >> >>>> *[https://bitcoincore.org/en/2016/01/26/segwit-benefits/ Segwit
> >> >> >>>> benefits]
> >> >> >>>>
> >> >> >>>> ==Copyright==
> >> >> >>>>
> >> >> >>>> This document is dual licensed as BSD 3-clause, and Creative
> >> >> >>>> Commons
> >> >> >>>> CC0 1.0 Universal.
> >> >> >>>> _______________________________________________
> >> >> >>>> bitcoin-dev mailing list
> >> >> >>>> bitcoin-dev at lists.linuxfoundation.org
> >> >> >>>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
> >> >
> >> >
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170607/23cd8979/attachment-0001.html>

From james.hilliard1 at gmail.com  Thu Jun  8 00:44:38 2017
From: james.hilliard1 at gmail.com (James Hilliard)
Date: Wed, 7 Jun 2017 19:44:38 -0500
Subject: [bitcoin-dev] User Activated Soft Fork Split Protection
In-Reply-To: <CAD1TkXuBc8nQr7ZSog4aYbppqR9Bg4cX=gFdSZCvBXfZmmhQww@mail.gmail.com>
References: <CADvTj4qpH-t5Gx6qyn3yToyUE_GFaBE989=AWNHLKMpMNW3R+w@mail.gmail.com>
	<CAD1TkXviJouao7YoHjiDN3mTUWFEbMY9mtCqkQ8zp8JthyhT7Q@mail.gmail.com>
	<CADvTj4rz4exYMvBEmYi=bTZDgDm0drLjpRZmZUo17inzCzCRVg@mail.gmail.com>
	<CAD1TkXskei1gk_kungSvdWGmbdJMA8AG+-zK+Osz6u5vSCN8BQ@mail.gmail.com>
	<CADvTj4poO1L+Wg5J+M71sJMz-Xcg_st3MkAcQK=bfHhTJ3i8ow@mail.gmail.com>
	<CAD1TkXumetRnPO6LxhJeVoci=0=YHD7hEB0K0YH+2McRBJ-QHw@mail.gmail.com>
	<CADvTj4pFna4tX37XmgrP7ueZB+Yv4T9NWmp99CwKSx5mzdiJJQ@mail.gmail.com>
	<CAD1TkXtmj3H3k+k7X2DgA0cNxXBNSSrzf_o33qFO8cA9eSUTnw@mail.gmail.com>
	<CADvTj4o5tTD2XN080dmHq1DuNwSZtmAytv3=7F5zGeBdhiPMrA@mail.gmail.com>
	<CAD1TkXuBc8nQr7ZSog4aYbppqR9Bg4cX=gFdSZCvBXfZmmhQww@mail.gmail.com>
Message-ID: <CADvTj4r6aHYd53Zi-kE+MQZoDv-ONdFf6CDmNA8YXgqVdwmR=g@mail.gmail.com>

On Wed, Jun 7, 2017 at 7:20 PM, Jared Lee Richardson <jaredr26 at gmail.com> wrote:
>> Not really, there are a few relatively simple techniques such as RBF
>> which can be leveraged to get confirmations on on-side before double
>> spending on another. Once a transaction is confirmed on the non-BIP148
>> chain then the high fee transactions can be made on only the BIP148
>> side of the split using RBF.
>
> Ah, so the BIP148 client handles this on behalf of its less technical users
> on their behalf then, yes?
It's not automatic but exchanges will likely handle it on behalf of
the less technical users. BIP148 is not intended to cause a permanent
chain split however which is why this was not built in.
>
>>  Exchanges will likely do this splitting
>> automatically for uses as well.
>
> Sure, Exchanges are going to dedicate hundreds of developer hours and
> thousands of support hours to support something that they've repeatedly told
> everyone must have replay protection to be supported.  They're going to do
> this because 8% of nodes and <0.5% of miners say they'll be rewarded richly.
> Somehow I find that hard to believe.
They are very likely to, most have contingency plans for this sort of
thing ready to go due to their experience with the ETH/ETC fork.
>
> Besides, if the BIP148 client does it for them, they wouldn't have to
> dedicate those hundreds of developer hours.  Right?
>
> I can't imagine how this logic is getting you from where the real data is to
> the assumption that an economic majority will push BIP148 into being such a
> more valuable chain that switching chains will be attractive to enough
> miners.  There's got to be some real data that convinces you of this
> somewhere?
If you're looking for hard numbers at this point you aren't likely to
find them because not everything is easy to measure directly.
>
>> Both are issues, but wipeout risk is different, the ETH/ETC split for
>> example didn't have any wipeout risk for either side the same is not
>> true for BIP148(and it is the non-BIP148 side that carries the risk of
>> chain wipeout).
>
> Wipeout risk is a serious issue when 45% of the miners support one chain and
> 55% support the other chain.  Segwit doesn't even have 35% of the miners;
> There's no data or statements anywhere that indicate that UASF is going to
> reach the point where wipeout risk is even comparable to abandonment risk.
It's mostly economic support that will dictate this, not hashpower
support since the hashpower follows the economy.
>
>> Yes, miners aren't likely to waste operational mining costs, that's
>> ultimately why miners would follow the BIP148 side of the chain
>> assuming it has sufficient economic support or if it's more profitable
>> to mine.
>
> To convince miners you would have to have some data SOMEWHERE supporting the
> economic majority argument.  Is there any such data?
We'll know more as we get closer to BIP148 activation by looking at the markets.
>
>> segwit2x has more issues since the HF part requires users to reach
>> consensus
>
> It doesn't have those issues during the segwit activation, ergo there is no
> reason for segwit-activation problems to take priority over the very real
> hardfork activation problems.
And yet segwit2x is insisting on activation bundling which needlessly
complicates and delays SegWit activation.
>
>> That's a political reason not a technical reason.
>
> In a consensus system they are frequently the same, unfortunately.
> Technical awesomeness without people agreeing = zero consensus.  So the
> choice is either to "technically" break the consensus without a
> super-majority and see what happens, or to go with the choice that has real
> data showing the most consensus and hope the tiny minority chain actually
> dies off.
Sure, technical changes can be made for political reasons, we should
at least be clear in regards to why particular decisions are being
made. I'm supportive of a hard fork for technical reasons but not
political ones as are many others.
>
> Jared
>
> On Wed, Jun 7, 2017 at 5:01 PM, James Hilliard <james.hilliard1 at gmail.com>
> wrote:
>>
>> On Wed, Jun 7, 2017 at 6:43 PM, Jared Lee Richardson <jaredr26 at gmail.com>
>> wrote:
>> >> BIP148 however is a consensus change that can
>> >> be rectified if it gets more work, this would act as an additional
>> >> incentive for mine the BIP148 side since there would be no wipeout
>> >> risk there.
>> >
>> > This statement is misleading.  Wipeout risks don't apply to any
>> > consensus
>> > changes; It is a consensus change, it can only be abandoned.  The BIP148
>> > chain carries just as many risks of being abandoned or even more with
>> > segwit2x on the table.  No miner would consider "wipeout risk" an
>> > advantage
>> > when the real threat is chain abandonment.
>> Both are issues, but wipeout risk is different, the ETH/ETC split for
>> example didn't have any wipeout risk for either side the same is not
>> true for BIP148(and it is the non-BIP148 side that carries the risk of
>> chain wipeout).
>> >
>> >> Higher transaction fees on a minority chain can compensate miners for
>> >> a lower price which would likely be enough to get the BIP148 chain to
>> >> a difficulty reduction.
>> >
>> > Higher transaction fees suffers the same problem as exchange support
>> > does.
>> > Without replay protection, it is very difficult for any average user to
>> > force transactions onto one chain or the other.  Thus, without replay
>> > protection, the UASF chain is unlikely to develop any viable fee market;
>> > Its
>> > few miners 99% of the time will simply choose from the highest fees that
>> > were already available to the other chain, which is basically no
>> > advantage
>> > at all.
>> Not really, there are a few relatively simple techniques such as RBF
>> which can be leveraged to get confirmations on on-side before double
>> spending on another. Once a transaction is confirmed on the non-BIP148
>> chain then the high fee transactions can be made on only the BIP148
>> side of the split using RBF. Exchanges will likely do this splitting
>> automatically for uses as well.
>> >
>> >>  ETC replay protection was done after the fork on an as
>> >> needed basis(there are multiple reliable techniques that can be used
>> >> to split UTXO's), the same can happen with BIP148 and it is easier to
>> >> do with Bitcoin than with the ETH/ETC split IMO.
>> >
>> > ETC replay protection was added because they were already a hardfork and
>> > without it they would not have had a viable chain.  BIP148 is not
>> > supposed
>> > to be a hardfork, and if it added replay protection to remain viable it
>> > would lose the frequently touted "wipeout advantage" as well as the
>> > ability
>> > to call itself a softfork.  And are you seriously suggesting that what
>> > happened with ETC and ETH is a desirable and good situation for Bitcoin,
>> > and
>> > that UASF is ETC?
>> There wasn't proper replay protection at split time for ETH/ETC since
>> normal transactions would get executed on both sides originally,
>> however replay protection was added by wallets(mainly using splitting
>> contracts). I don't think a split is desirable however, which is why
>> I've proposed this BIP.
>> >
>> >> A big reason BIP148 still has support is because up until SegWit
>> >> actually activates there's no guarantee segwit2mb will actually have
>> >> the necessary support to activate SegWit.
>> >
>> > For a miners blowing through six million dollars a day in mining
>> > operational
>> > costs, that's a pretty crappy reason.  Serious miners can't afford to
>> > prop
>> > up a non-viable chain based on philosophy or maybes.  BIP148 is based
>> > entirely upon people who aren't putting anything on the line trying to
>> > convince others to take the huge risks for them.  With deceptively
>> > fallacious logic, in my opinion.
>> Yes, miners aren't likely to waste operational mining costs, that's
>> ultimately why miners would follow the BIP148 side of the chain
>> assuming it has sufficient economic support or if it's more profitable
>> to mine.
>> >
>> > Even segwit2x is based on the assumption that all miners can reach
>> > consensus.  Break that assumption and segwit2x will have the same
>> > problems
>> > as UASF.
>> segwit2x has more issues since the HF part requires users to reach
>> consensus
>> >
>> >> This is largely an issue due to segwit2x's bundling, if the SW and HF
>> >> part of segwit2x were unbundled then there would be no reason to delay
>> >> BIP91 activation
>> >
>> > They are bundled.  Segwit alone doesn't have the desired overwhelming
>> > consensus, unless core wishes to fork 71% to 29%, and maybe not even
>> > that
>> > high.  That's the technical reason, and they can't be unbundled without
>> > breaking that consensus.
>> That's a political reason not a technical reason.
>> >
>> > Jared
>> >
>> >
>> > On Wed, Jun 7, 2017 at 4:11 PM, James Hilliard
>> > <james.hilliard1 at gmail.com>
>> > wrote:
>> >>
>> >> On Wed, Jun 7, 2017 at 5:53 PM, Jared Lee Richardson
>> >> <jaredr26 at gmail.com>
>> >> wrote:
>> >> >> There are 2 primary factors involved here, economic support and
>> >> > hashpower either of which is enough to make a permanent chain split
>> >> > unlikely, miners will mine whichever chain is most profitable(see
>> >> > ETH/ETC hashpower profitability equilibrium for an example of how
>> >> > this
>> >> > works in practice)
>> >> >
>> >> > That's not a comparable example.  ETC did not face potentially years
>> >> > of
>> >> > slow
>> >> > blocktimes before it normalized, whereas BIP148 is on track to do
>> >> > exactly
>> >> > that.  Moreover, ETC represented a fundamental break from the
>> >> > majority
>> >> > consensus that could not be rectified, whereas BIP148 represents only
>> >> > a
>> >> > minority attempt to accelerate something that an overwhelming
>> >> > majority
>> >> > of
>> >> > miners have already agreed to activate under segwit2x.  Lastly ETC
>> >> > was
>> >> > required to add replay protection, just like any minority fork
>> >> > proposed
>> >> > by
>> >> > any crypto-currency has been, something that BIP148 both lacks and
>> >> > refuses
>> >> > to add or even acknowledge the necessity of.  Without replay
>> >> > protection,
>> >> > ETC
>> >> > could not have become profitable enough to be a viable minority
>> >> > chain.
>> >> > If
>> >> > BIP148's chain is not the majority chain and it does not have replay
>> >> > protection, it will face the same problems, but that required replay
>> >> > protection will turn it into a hardfork.  This will be a very bad
>> >> > position
>> >> > for UASF supporters to find themselves in - Either hardfork and hope
>> >> > the
>> >> > price is higher and the majority converts, or die as the minority
>> >> > chain
>> >> > with
>> >> > no reliable methods of economic conversion.
>> >> Higher transaction fees on a minority chain can compensate miners for
>> >> a lower price which would likely be enough to get the BIP148 chain to
>> >> a difficulty reduction. BIP148 however is a consensus change that can
>> >> be rectified if it gets more work, this would act as an additional
>> >> incentive for mine the BIP148 side since there would be no wipeout
>> >> risk there. ETC replay protection was done after the fork on an as
>> >> needed basis(there are multiple reliable techniques that can be used
>> >> to split UTXO's), the same can happen with BIP148 and it is easier to
>> >> do with Bitcoin than with the ETH/ETC split IMO.
>> >> >
>> >> > I believe, but don't have data to back this, that most of the BIP148
>> >> > insistence comes not from a legitimate attempt to gain consensus (or
>> >> > else
>> >> > they would either outright oppose segwit2mb for its hardfork, or they
>> >> > would
>> >> > outright support it), but rather from an attempt for BIP148
>> >> > supporters
>> >> > to
>> >> > save face for BIP148 being a failure.  If I'm correct, that's a
>> >> > terrible
>> >> > and
>> >> > highly non-technical reason for segwit2mb to bend over backwards
>> >> > attempting
>> >> > to support BIP148's attempt to save face.
>> >> A big reason BIP148 still has support is because up until SegWit
>> >> actually activates there's no guarantee segwit2mb will actually have
>> >> the necessary support to activate SegWit.
>> >> >
>> >> >> The main issue is just one of activation timelines, BIP91 as
>> >> > is takes too long to activate unless started ahead of the existing
>> >> > segwit2x schedule and it's unlikely that BIP148 will get pushed back
>> >> > any further.
>> >> >
>> >> > Even if I'm not correct on the above, I and others find it hard to
>> >> > accept
>> >> > that this timeline conflict is segwit2x's fault.  Segwit2x has both
>> >> > some
>> >> > flexibility and broad support that crosses contentious pro-segwit and
>> >> > pro-blocksize-increase divisions that have existed for two years.
>> >> > BIP148 is
>> >> > attempting to hold segwit2x's timelines and code hostage by claiming
>> >> > inflexibility and claiming broad support, and not only are neither of
>> >> > those
>> >> > assertions are backed by real data, BIP148 (by being so inflexible)
>> >> > is
>> >> > pushing a position that deepens the divides between those groups.
>> >> > For
>> >> > there
>> >> > to be technical reasons for compatibility (so long as there are
>> >> > tradeoffs,
>> >> > which there are), there needs to be hard data showing that BIP148 is
>> >> > a
>> >> > viable minority fork that won't simply die off on its own.
>> >> This is largely an issue due to segwit2x's bundling, if the SW and HF
>> >> part of segwit2x were unbundled then there would be no reason to delay
>> >> BIP91 activation, this is especially a problem since it takes a good
>> >> deal of time to properly code and test a HF. Unfortunately segwit2x
>> >> has been quite inflexible in regards to the bundling aspect even
>> >> though there are clearly no technical reasons for it to be there.
>> >> >
>> >> > Jared
>> >> >
>> >> >
>> >> > On Wed, Jun 7, 2017 at 3:23 PM, James Hilliard
>> >> > <james.hilliard1 at gmail.com>
>> >> > wrote:
>> >> >>
>> >> >> On Wed, Jun 7, 2017 at 4:50 PM, Jared Lee Richardson
>> >> >> <jaredr26 at gmail.com>
>> >> >> wrote:
>> >> >> > Could this risk mitigation measure be an optional flag?  And if
>> >> >> > so,
>> >> >> > could it+BIP91 signal on a different bit than bit4?
>> >> >> It's fairly trivial for miners to signal for BIP91 on bit4 or a
>> >> >> different bit at the same time as the code is trivial enough to
>> >> >> combine
>> >> >> >
>> >> >> > The reason being, if for some reason the segwit2x activation
>> >> >> > cannot
>> >> >> > take place in time, it would be preferable for miners to have a
>> >> >> > more
>> >> >> > standard approach to activation that requires stronger consensus
>> >> >> > and
>> >> >> > may be more forgiving than BIP148.  If the segwit2x activation is
>> >> >> > on
>> >> >> > time to cooperate with BIP148, it could be signaled through the
>> >> >> > non-bit4 approach and everything could go smoothly.  Thoughts on
>> >> >> > that
>> >> >> > idea?  It may add more complexity and more developer time, but may
>> >> >> > also address your concerns among others.
>> >> >> This does give miners another approach to activate segwit ahead of
>> >> >> BIP148, if segwit2x activation is rolled out and activated
>> >> >> immediately
>> >> >> then this would not be needed however based on the timeline here
>> >> >> https://segwit2x.github.io/ it would not be possible for BIP91 to
>> >> >> enforce mandatory signalling ahead of BIP148. Maybe that can be
>> >> >> changed though, I've suggested an immediate rollout with a
>> >> >> placeholder
>> >> >> client timeout instead of the HF code initially in order to
>> >> >> accelerate
>> >> >> that.
>> >> >> >
>> >> >> >> Since this BIP
>> >> >> >> only activates with a clear miner majority it should not increase
>> >> >> >> the
>> >> >> >> risk of an extended chain split.
>> >> >> >
>> >> >> > The concern I'm raising is more about the psychology of giving
>> >> >> > BIP148
>> >> >> > a sense of safety that may not be valid.  Without several more
>> >> >> > steps,
>> >> >> > BIP148 is definitely on track to be a risky chainsplit, and
>> >> >> > without
>> >> >> > segwit2x it will almost certainly be a small minority chain.
>> >> >> > (Unless
>> >> >> > the segwit2x compromise falls apart before then, and even in that
>> >> >> > case
>> >> >> > it is likely to be a minority chain)
>> >> >> There are 2 primary factors involved here, economic support and
>> >> >> hashpower either of which is enough to make a permanent chain split
>> >> >> unlikely, miners will mine whichever chain is most profitable(see
>> >> >> ETH/ETC hashpower profitability equilibrium for an example of how
>> >> >> this
>> >> >> works in practice) however there may be lag time immediately after
>> >> >> the
>> >> >> split if there is an economic majority but not a hashpower majority
>> >> >> initially. This is risk mitigation that only requires miners support
>> >> >> however. The main issue is just one of activation timelines, BIP91
>> >> >> as
>> >> >> is takes too long to activate unless started ahead of the existing
>> >> >> segwit2x schedule and it's unlikely that BIP148 will get pushed back
>> >> >> any further.
>> >> >> >
>> >> >> > Jared
>> >> >> >
>> >> >> >
>> >> >> > On Wed, Jun 7, 2017 at 2:42 PM, James Hilliard
>> >> >> > <james.hilliard1 at gmail.com> wrote:
>> >> >> >> I don't really see how this would increase the likelihood of an
>> >> >> >> extended chain split assuming BIP148 is going to have
>> >> >> >> non-insignificant economic backing. This BIP is designed to
>> >> >> >> provide
>> >> >> >> a
>> >> >> >> risk mitigation measure that miners can safely deploy. Since this
>> >> >> >> BIP
>> >> >> >> only activates with a clear miner majority it should not increase
>> >> >> >> the
>> >> >> >> risk of an extended chain split. At this point it is not
>> >> >> >> completely
>> >> >> >> clear how much economic support there is for BIP148 but support
>> >> >> >> certainly seems to be growing and we have nearly 2 months until
>> >> >> >> BIP148
>> >> >> >> activation. I intentionally used a shorter activation period here
>> >> >> >> so
>> >> >> >> that decisions by miners can be made close to the BIP148
>> >> >> >> activation
>> >> >> >> date.
>> >> >> >>
>> >> >> >> On Wed, Jun 7, 2017 at 4:29 PM, Jared Lee Richardson
>> >> >> >> <jaredr26 at gmail.com> wrote:
>> >> >> >>> I think this BIP represents a gamble, and the gamble may not be
>> >> >> >>> a
>> >> >> >>> good
>> >> >> >>> one.  The gamble here is that if the segwit2x changes are rolled
>> >> >> >>> out
>> >> >> >>> on time, and if the signatories accept the bit4 + bit1 signaling
>> >> >> >>> proposals within BIP91, the launch will go smoother, as
>> >> >> >>> intended.
>> >> >> >>> But
>> >> >> >>> conversely, if either the segwit2x signatories balk about the
>> >> >> >>> Bit1
>> >> >> >>> signaling OR if the timelines for segwit2mb are missed even by a
>> >> >> >>> bit,
>> >> >> >>> it may cause the BIP148 chainsplit to be worse than it would be
>> >> >> >>> without.  Given the frequent concerns raised in multiple places
>> >> >> >>> about
>> >> >> >>> the aggressiveness of the segwit2x timelines, including the
>> >> >> >>> non-hardfork timelines, this does not seem like a great gamble
>> >> >> >>> to
>> >> >> >>> be
>> >> >> >>> making.
>> >> >> >>>
>> >> >> >>> The reason I say it may make the chainsplit be worse than it
>> >> >> >>> would
>> >> >> >>> otherwise be is that it may provide a false sense of safety for
>> >> >> >>> BIP148
>> >> >> >>> that currently does not currently exist(and should not, as it is
>> >> >> >>> a
>> >> >> >>> chainsplit).  That sense of safety would only be legitimate if
>> >> >> >>> the
>> >> >> >>> segwit2x signatories were on board, and the segwit2x code
>> >> >> >>> effectively
>> >> >> >>> enforced BIP148 simultaneously, neither of which are guaranteed.
>> >> >> >>> If
>> >> >> >>> users and more miners had a false sense that BIP148 was *not*
>> >> >> >>> going
>> >> >> >>> to
>> >> >> >>> chainsplit from default / segwit2x, they might not follow the
>> >> >> >>> news
>> >> >> >>> if
>> >> >> >>> suddenly the segwit2x plan were delayed for a few days.  While
>> >> >> >>> any
>> >> >> >>> additional support would definitely be cheered on by BIP148
>> >> >> >>> supporters, the practical reality might be that this proposal
>> >> >> >>> would
>> >> >> >>> take BIP148 from the "unlikely to have any viable chain after
>> >> >> >>> flag
>> >> >> >>> day
>> >> >> >>> without segwit2x" category into the "small but viable minority
>> >> >> >>> chain"
>> >> >> >>> category, and even worse, it might strengthen the chainsplit
>> >> >> >>> just
>> >> >> >>> days
>> >> >> >>> before segwit is activated on BOTH chains, putting the BIP148
>> >> >> >>> supporters on the wrong pro-segwit, but still-viable chain.
>> >> >> >>>
>> >> >> >>> If Core had taken a strong stance to include BIP148 into the
>> >> >> >>> client,
>> >> >> >>> and if BIP148 support were much much broader, I would feel
>> >> >> >>> differently
>> >> >> >>> as the gamble would be more likely to discourage a chainsplit
>> >> >> >>> (By
>> >> >> >>> forcing the acceleration of segwit2x) rather than encourage it
>> >> >> >>> (by
>> >> >> >>> strengthening an extreme minority chainsplit that may wind up on
>> >> >> >>> the
>> >> >> >>> wrong side of two segwit-activated chains).  As it stands now,
>> >> >> >>> this
>> >> >> >>> seems like a very dangerous attempt to compromise with a small
>> >> >> >>> but
>> >> >> >>> vocal group that are the ones creating the threat to begin with.
>> >> >> >>>
>> >> >> >>> Jared
>> >> >> >>>
>> >> >> >>> On Tue, Jun 6, 2017 at 5:56 PM, James Hilliard via bitcoin-dev
>> >> >> >>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>> >> >> >>>> Due to the proposed calendar(https://segwit2x.github.io/) for
>> >> >> >>>> the
>> >> >> >>>> SegWit2x agreement being too slow to activate SegWit mandatory
>> >> >> >>>> signalling ahead of BIP148 using BIP91 I would like to propose
>> >> >> >>>> another
>> >> >> >>>> option that miners can use to prevent a chain split ahead of
>> >> >> >>>> the
>> >> >> >>>> Aug
>> >> >> >>>> 1st BIP148 activation date.
>> >> >> >>>>
>> >> >> >>>> The splitprotection soft fork is essentially BIP91 but using
>> >> >> >>>> BIP8
>> >> >> >>>> instead of BIP9 with a lower activation threshold and immediate
>> >> >> >>>> mandatory signalling lock-in. This allows for a majority of
>> >> >> >>>> miners
>> >> >> >>>> to
>> >> >> >>>> activate mandatory SegWit signalling and prevent a potential
>> >> >> >>>> chain
>> >> >> >>>> split ahead of BIP148 activation.
>> >> >> >>>>
>> >> >> >>>> This BIP allows for miners to respond to market forces quickly
>> >> >> >>>> ahead
>> >> >> >>>> of BIP148 activation by signalling for splitprotection. Any
>> >> >> >>>> miners
>> >> >> >>>> already running BIP148 should be encouraged to use
>> >> >> >>>> splitprotection.
>> >> >> >>>>
>> >> >> >>>> <pre>
>> >> >> >>>>   BIP: splitprotection
>> >> >> >>>>   Layer: Consensus (soft fork)
>> >> >> >>>>   Title: User Activated Soft Fork Split Protection
>> >> >> >>>>   Author: James Hilliard <james.hilliard1 at gmail.com>
>> >> >> >>>>   Comments-Summary: No comments yet.
>> >> >> >>>>   Comments-URI:
>> >> >> >>>>   Status: Draft
>> >> >> >>>>   Type: Standards Track
>> >> >> >>>>   Created: 2017-05-22
>> >> >> >>>>   License: BSD-3-Clause
>> >> >> >>>>            CC0-1.0
>> >> >> >>>> </pre>
>> >> >> >>>>
>> >> >> >>>> ==Abstract==
>> >> >> >>>>
>> >> >> >>>> This document specifies a coordination mechanism for a simple
>> >> >> >>>> majority
>> >> >> >>>> of miners to prevent a chain split ahead of BIP148 activation.
>> >> >> >>>>
>> >> >> >>>> ==Definitions==
>> >> >> >>>>
>> >> >> >>>> "existing segwit deployment" refer to the BIP9 "segwit"
>> >> >> >>>> deployment
>> >> >> >>>> using bit 1, between November 15th 2016 and November 15th 2017
>> >> >> >>>> to
>> >> >> >>>> activate BIP141, BIP143 and BIP147.
>> >> >> >>>>
>> >> >> >>>> ==Motivation==
>> >> >> >>>>
>> >> >> >>>> The biggest risk of BIP148 is an extended chain split, this BIP
>> >> >> >>>> provides a way for a simple majority of miners to eliminate
>> >> >> >>>> that
>> >> >> >>>> risk.
>> >> >> >>>>
>> >> >> >>>> This BIP provides a way for a simple majority of miners to
>> >> >> >>>> coordinate
>> >> >> >>>> activation of the existing segwit deployment with less than 95%
>> >> >> >>>> hashpower before BIP148 activation. Due to time constraints
>> >> >> >>>> unless
>> >> >> >>>> immediately deployed BIP91 will likely not be able to enforce
>> >> >> >>>> mandatory signalling of segwit before the Aug 1st activation of
>> >> >> >>>> BIP148. This BIP provides a method for rapid miner activation
>> >> >> >>>> of
>> >> >> >>>> SegWit mandatory signalling ahead of the BIP148 activation
>> >> >> >>>> date.
>> >> >> >>>> Since
>> >> >> >>>> the primary goal of this BIP is to reduce the chance of an
>> >> >> >>>> extended
>> >> >> >>>> chain split as much as possible we activate using a simple
>> >> >> >>>> miner
>> >> >> >>>> majority of 65% over a 504 block interval rather than a higher
>> >> >> >>>> percentage. This BIP also allows miners to signal their
>> >> >> >>>> intention
>> >> >> >>>> to
>> >> >> >>>> run BIP148 in order to prevent a chain split.
>> >> >> >>>>
>> >> >> >>>> ==Specification==
>> >> >> >>>>
>> >> >> >>>> While this BIP is active, all blocks must set the nVersion
>> >> >> >>>> header
>> >> >> >>>> top
>> >> >> >>>> 3 bits to 001 together with bit field (1<<1) (according to the
>> >> >> >>>> existing segwit deployment). Blocks that do not signal as
>> >> >> >>>> required
>> >> >> >>>> will be rejected.
>> >> >> >>>>
>> >> >> >>>> ==Deployment==
>> >> >> >>>>
>> >> >> >>>> This BIP will be deployed by "version bits" with a 65%(this can
>> >> >> >>>> be
>> >> >> >>>> adjusted if desired) activation threshold BIP9 with the name
>> >> >> >>>> "splitprotecion" and using bit 2.
>> >> >> >>>>
>> >> >> >>>> This BIP starts immediately and is a BIP8 style soft fork since
>> >> >> >>>> mandatory signalling will start on midnight August 1st 2017
>> >> >> >>>> (epoch
>> >> >> >>>> time 1501545600) regardless of whether or not this BIP has
>> >> >> >>>> reached
>> >> >> >>>> its
>> >> >> >>>> own signalling threshold. This BIP will cease to be active when
>> >> >> >>>> segwit
>> >> >> >>>> is locked-in.
>> >> >> >>>>
>> >> >> >>>> === Reference implementation ===
>> >> >> >>>>
>> >> >> >>>> <pre>
>> >> >> >>>> // Check if Segregated Witness is Locked In
>> >> >> >>>> bool IsWitnessLockedIn(const CBlockIndex* pindexPrev, const
>> >> >> >>>> Consensus::Params& params)
>> >> >> >>>> {
>> >> >> >>>>     LOCK(cs_main);
>> >> >> >>>>     return (VersionBitsState(pindexPrev, params,
>> >> >> >>>> Consensus::DEPLOYMENT_SEGWIT, versionbitscache) ==
>> >> >> >>>> THRESHOLD_LOCKED_IN);
>> >> >> >>>> }
>> >> >> >>>>
>> >> >> >>>> // SPLITPROTECTION mandatory segwit signalling.
>> >> >> >>>> if ( VersionBitsState(pindex->pprev,
>> >> >> >>>> chainparams.GetConsensus(),
>> >> >> >>>> Consensus::DEPLOYMENT_SPLITPROTECTION, versionbitscache) ==
>> >> >> >>>> THRESHOLD_LOCKED_IN &&
>> >> >> >>>>      !IsWitnessLockedIn(pindex->pprev,
>> >> >> >>>> chainparams.GetConsensus())
>> >> >> >>>> &&
>> >> >> >>>> // Segwit is not locked in
>> >> >> >>>>      !IsWitnessEnabled(pindex->pprev,
>> >> >> >>>> chainparams.GetConsensus())
>> >> >> >>>> )
>> >> >> >>>> //
>> >> >> >>>> and is not active.
>> >> >> >>>> {
>> >> >> >>>>     bool fVersionBits = (pindex->nVersion &
>> >> >> >>>> VERSIONBITS_TOP_MASK)
>> >> >> >>>> ==
>> >> >> >>>> VERSIONBITS_TOP_BITS;
>> >> >> >>>>     bool fSegbit = (pindex->nVersion &
>> >> >> >>>> VersionBitsMask(chainparams.GetConsensus(),
>> >> >> >>>> Consensus::DEPLOYMENT_SEGWIT)) != 0;
>> >> >> >>>>     if (!(fVersionBits && fSegbit)) {
>> >> >> >>>>         return state.DoS(0, error("ConnectBlock(): relayed
>> >> >> >>>> block
>> >> >> >>>> must
>> >> >> >>>> signal for segwit, please upgrade"), REJECT_INVALID,
>> >> >> >>>> "bad-no-segwit");
>> >> >> >>>>     }
>> >> >> >>>> }
>> >> >> >>>>
>> >> >> >>>> // BIP148 mandatory segwit signalling.
>> >> >> >>>> int64_t nMedianTimePast = pindex->GetMedianTimePast();
>> >> >> >>>> if ( (nMedianTimePast >= 1501545600) &&  // Tue 01 Aug 2017
>> >> >> >>>> 00:00:00
>> >> >> >>>> UTC
>> >> >> >>>>      (nMedianTimePast <= 1510704000) &&  // Wed 15 Nov 2017
>> >> >> >>>> 00:00:00
>> >> >> >>>> UTC
>> >> >> >>>>      (!IsWitnessLockedIn(pindex->pprev,
>> >> >> >>>> chainparams.GetConsensus())
>> >> >> >>>> &&
>> >> >> >>>>  // Segwit is not locked in
>> >> >> >>>>       !IsWitnessEnabled(pindex->pprev,
>> >> >> >>>> chainparams.GetConsensus())) )
>> >> >> >>>>  // and is not active.
>> >> >> >>>> {
>> >> >> >>>>     bool fVersionBits = (pindex->nVersion &
>> >> >> >>>> VERSIONBITS_TOP_MASK)
>> >> >> >>>> ==
>> >> >> >>>> VERSIONBITS_TOP_BITS;
>> >> >> >>>>     bool fSegbit = (pindex->nVersion &
>> >> >> >>>> VersionBitsMask(chainparams.GetConsensus(),
>> >> >> >>>> Consensus::DEPLOYMENT_SEGWIT)) != 0;
>> >> >> >>>>     if (!(fVersionBits && fSegbit)) {
>> >> >> >>>>         return state.DoS(0, error("ConnectBlock(): relayed
>> >> >> >>>> block
>> >> >> >>>> must
>> >> >> >>>> signal for segwit, please upgrade"), REJECT_INVALID,
>> >> >> >>>> "bad-no-segwit");
>> >> >> >>>>     }
>> >> >> >>>> }
>> >> >> >>>> </pre>
>> >> >> >>>>
>> >> >> >>>>
>> >> >> >>>>
>> >> >> >>>>
>> >> >> >>>> https://github.com/bitcoin/bitcoin/compare/0.14...jameshilliard:splitprotection-v0.14.1
>> >> >> >>>>
>> >> >> >>>> ==Backwards Compatibility==
>> >> >> >>>>
>> >> >> >>>> This deployment is compatible with the existing "segwit" bit 1
>> >> >> >>>> deployment scheduled between midnight November 15th, 2016 and
>> >> >> >>>> midnight
>> >> >> >>>> November 15th, 2017. This deployment is also compatible with
>> >> >> >>>> the
>> >> >> >>>> existing BIP148 deployment. This BIP is compatible with BIP91
>> >> >> >>>> only
>> >> >> >>>> if
>> >> >> >>>> BIP91 activates before it and before BIP148. Miners will need
>> >> >> >>>> to
>> >> >> >>>> upgrade their nodes to support splitprotection otherwise they
>> >> >> >>>> may
>> >> >> >>>> build on top of an invalid block. While this bip is active
>> >> >> >>>> users
>> >> >> >>>> should either upgrade to splitprotection or wait for additional
>> >> >> >>>> confirmations when accepting payments.
>> >> >> >>>>
>> >> >> >>>> ==Rationale==
>> >> >> >>>>
>> >> >> >>>> Historically we have used IsSuperMajority() to activate soft
>> >> >> >>>> forks
>> >> >> >>>> such as BIP66 which has a mandatory signalling requirement for
>> >> >> >>>> miners
>> >> >> >>>> once activated, this ensures that miners are aware of new rules
>> >> >> >>>> being
>> >> >> >>>> enforced. This technique can be leveraged to lower the
>> >> >> >>>> signalling
>> >> >> >>>> threshold of a soft fork while it is in the process of being
>> >> >> >>>> deployed
>> >> >> >>>> in a backwards compatible way. We also use a BIP8 style timeout
>> >> >> >>>> to
>> >> >> >>>> ensure that this BIP is compatible with BIP148 and that BIP148
>> >> >> >>>> compatible mandatory signalling activates regardless of miner
>> >> >> >>>> signalling levels.
>> >> >> >>>>
>> >> >> >>>> By orphaning non-signalling blocks during the BIP9 bit 1
>> >> >> >>>> "segwit"
>> >> >> >>>> deployment, this BIP can cause the existing "segwit" deployment
>> >> >> >>>> to
>> >> >> >>>> activate without needing to release a new deployment. As we
>> >> >> >>>> approach
>> >> >> >>>> BIP148 activation it may be desirable for a majority of miners
>> >> >> >>>> to
>> >> >> >>>> have
>> >> >> >>>> a method that will ensure that there is no chain split.
>> >> >> >>>>
>> >> >> >>>> ==References==
>> >> >> >>>>
>> >> >> >>>>
>> >> >> >>>>
>> >> >> >>>>
>> >> >> >>>> *[https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-March/013714.html
>> >> >> >>>> Mailing list discussion]
>> >> >> >>>>
>> >> >> >>>>
>> >> >> >>>>
>> >> >> >>>> *[https://github.com/bitcoin/bitcoin/blob/v0.6.0/src/main.cpp#L1281-L1283
>> >> >> >>>> P2SH flag day activation]
>> >> >> >>>> *[[bip-0009.mediawiki|BIP9 Version bits with timeout and
>> >> >> >>>> delay]]
>> >> >> >>>> *[[bip-0016.mediawiki|BIP16 Pay to Script Hash]]
>> >> >> >>>> *[[bip-0091.mediawiki|BIP91 Reduced threshold Segwit MASF]]
>> >> >> >>>> *[[bip-0141.mediawiki|BIP141 Segregated Witness (Consensus
>> >> >> >>>> layer)]]
>> >> >> >>>> *[[bip-0143.mediawiki|BIP143 Transaction Signature Verification
>> >> >> >>>> for
>> >> >> >>>> Version 0 Witness Program]]
>> >> >> >>>> *[[bip-0147.mediawiki|BIP147 Dealing with dummy stack element
>> >> >> >>>> malleability]]
>> >> >> >>>> *[[bip-0148.mediawiki|BIP148 Mandatory activation of segwit
>> >> >> >>>> deployment]]
>> >> >> >>>> *[[bip-0149.mediawiki|BIP149 Segregated Witness (second
>> >> >> >>>> deployment)]]
>> >> >> >>>> *[https://bitcoincore.org/en/2016/01/26/segwit-benefits/ Segwit
>> >> >> >>>> benefits]
>> >> >> >>>>
>> >> >> >>>> ==Copyright==
>> >> >> >>>>
>> >> >> >>>> This document is dual licensed as BSD 3-clause, and Creative
>> >> >> >>>> Commons
>> >> >> >>>> CC0 1.0 Universal.
>> >> >> >>>> _______________________________________________
>> >> >> >>>> bitcoin-dev mailing list
>> >> >> >>>> bitcoin-dev at lists.linuxfoundation.org
>> >> >> >>>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>> >> >
>> >> >
>> >
>> >
>
>

From jaredr26 at gmail.com  Thu Jun  8 01:01:38 2017
From: jaredr26 at gmail.com (Jared Lee Richardson)
Date: Wed, 7 Jun 2017 18:01:38 -0700
Subject: [bitcoin-dev] User Activated Soft Fork Split Protection
In-Reply-To: <CADvTj4r6aHYd53Zi-kE+MQZoDv-ONdFf6CDmNA8YXgqVdwmR=g@mail.gmail.com>
References: <CADvTj4qpH-t5Gx6qyn3yToyUE_GFaBE989=AWNHLKMpMNW3R+w@mail.gmail.com>
	<CAD1TkXviJouao7YoHjiDN3mTUWFEbMY9mtCqkQ8zp8JthyhT7Q@mail.gmail.com>
	<CADvTj4rz4exYMvBEmYi=bTZDgDm0drLjpRZmZUo17inzCzCRVg@mail.gmail.com>
	<CAD1TkXskei1gk_kungSvdWGmbdJMA8AG+-zK+Osz6u5vSCN8BQ@mail.gmail.com>
	<CADvTj4poO1L+Wg5J+M71sJMz-Xcg_st3MkAcQK=bfHhTJ3i8ow@mail.gmail.com>
	<CAD1TkXumetRnPO6LxhJeVoci=0=YHD7hEB0K0YH+2McRBJ-QHw@mail.gmail.com>
	<CADvTj4pFna4tX37XmgrP7ueZB+Yv4T9NWmp99CwKSx5mzdiJJQ@mail.gmail.com>
	<CAD1TkXtmj3H3k+k7X2DgA0cNxXBNSSrzf_o33qFO8cA9eSUTnw@mail.gmail.com>
	<CADvTj4o5tTD2XN080dmHq1DuNwSZtmAytv3=7F5zGeBdhiPMrA@mail.gmail.com>
	<CAD1TkXuBc8nQr7ZSog4aYbppqR9Bg4cX=gFdSZCvBXfZmmhQww@mail.gmail.com>
	<CADvTj4r6aHYd53Zi-kE+MQZoDv-ONdFf6CDmNA8YXgqVdwmR=g@mail.gmail.com>
Message-ID: <CAD1TkXs2zN9ZuvP+QeF+U-YsK-1rXRCREQAZgaKrA5xt2W2w-Q@mail.gmail.com>

> If you're looking for hard numbers at this point you aren't likely to
> find them because not everything is easy to measure directly.

There's quite a few hard numbers that are available that are of varying
use.  Mining commitments are a major one because of the stalled chain
problem.  Node signaling represents some data because while it can be
sybiled, they are cheap but not free to run.  Upvotes and comments on
reddit and other forums might be of some use, but there's not a clear
supermajority driving every pro-uasf comment up and every anti-uasf comment
down, and Reddit obscures the upvote/downvotes pretty well.  It could be a
gleaned datapoint if someone pulled the comments, manually evaluated their
likely position on the matter(neutrally), and then reported on it, but that
is a lot of work and I think it is unlikely to show anything except how
deep the rifts in the community are.  Of the two main statistics available,
they do not support the idea that UASF has any chance of success.  Of the
third, it at least shows that there is deep opposition that is nearly equal
to the support amongst the forums most likely to support UASF.

So I'll take anything, any statistic that actually indicates UASF has a
chance in hell of succeeding, at least that would be worth something.
Otherwise it's all much ado about nothing.

> We'll know more as we get closer to BIP148 activation by looking at the
markets.

What markets?  Where?  How would we know?

> > It doesn't have those issues during the segwit activation, ergo there
is no
> > reason for segwit-activation problems to take priority over the very
real
> > hardfork activation problems.

> And yet segwit2x is insisting on activation bundling which needlessly
> complicates and delays SegWit activation.

Because it is not segwit that has appears to have the supermajority
consensus.

> Sure, technical changes can be made for political reasons, we should
> at least be clear in regards to why particular decisions are being
> made. I'm supportive of a hard fork for technical reasons but not
> political ones as are many others.

Well, then we have a point of agreement at least. :)


On Wed, Jun 7, 2017 at 5:44 PM, James Hilliard <james.hilliard1 at gmail.com>
wrote:

> On Wed, Jun 7, 2017 at 7:20 PM, Jared Lee Richardson <jaredr26 at gmail.com>
> wrote:
> >> Not really, there are a few relatively simple techniques such as RBF
> >> which can be leveraged to get confirmations on on-side before double
> >> spending on another. Once a transaction is confirmed on the non-BIP148
> >> chain then the high fee transactions can be made on only the BIP148
> >> side of the split using RBF.
> >
> > Ah, so the BIP148 client handles this on behalf of its less technical
> users
> > on their behalf then, yes?
> It's not automatic but exchanges will likely handle it on behalf of
> the less technical users. BIP148 is not intended to cause a permanent
> chain split however which is why this was not built in.
> >
> >>  Exchanges will likely do this splitting
> >> automatically for uses as well.
> >
> > Sure, Exchanges are going to dedicate hundreds of developer hours and
> > thousands of support hours to support something that they've repeatedly
> told
> > everyone must have replay protection to be supported.  They're going to
> do
> > this because 8% of nodes and <0.5% of miners say they'll be rewarded
> richly.
> > Somehow I find that hard to believe.
> They are very likely to, most have contingency plans for this sort of
> thing ready to go due to their experience with the ETH/ETC fork.
> >
> > Besides, if the BIP148 client does it for them, they wouldn't have to
> > dedicate those hundreds of developer hours.  Right?
> >
> > I can't imagine how this logic is getting you from where the real data
> is to
> > the assumption that an economic majority will push BIP148 into being
> such a
> > more valuable chain that switching chains will be attractive to enough
> > miners.  There's got to be some real data that convinces you of this
> > somewhere?
> If you're looking for hard numbers at this point you aren't likely to
> find them because not everything is easy to measure directly.
> >
> >> Both are issues, but wipeout risk is different, the ETH/ETC split for
> >> example didn't have any wipeout risk for either side the same is not
> >> true for BIP148(and it is the non-BIP148 side that carries the risk of
> >> chain wipeout).
> >
> > Wipeout risk is a serious issue when 45% of the miners support one chain
> and
> > 55% support the other chain.  Segwit doesn't even have 35% of the miners;
> > There's no data or statements anywhere that indicate that UASF is going
> to
> > reach the point where wipeout risk is even comparable to abandonment
> risk.
> It's mostly economic support that will dictate this, not hashpower
> support since the hashpower follows the economy.
> >
> >> Yes, miners aren't likely to waste operational mining costs, that's
> >> ultimately why miners would follow the BIP148 side of the chain
> >> assuming it has sufficient economic support or if it's more profitable
> >> to mine.
> >
> > To convince miners you would have to have some data SOMEWHERE supporting
> the
> > economic majority argument.  Is there any such data?
> We'll know more as we get closer to BIP148 activation by looking at the
> markets.
> >
> >> segwit2x has more issues since the HF part requires users to reach
> >> consensus
> >
> > It doesn't have those issues during the segwit activation, ergo there is
> no
> > reason for segwit-activation problems to take priority over the very real
> > hardfork activation problems.
> And yet segwit2x is insisting on activation bundling which needlessly
> complicates and delays SegWit activation.
> >
> >> That's a political reason not a technical reason.
> >
> > In a consensus system they are frequently the same, unfortunately.
> > Technical awesomeness without people agreeing = zero consensus.  So the
> > choice is either to "technically" break the consensus without a
> > super-majority and see what happens, or to go with the choice that has
> real
> > data showing the most consensus and hope the tiny minority chain actually
> > dies off.
> Sure, technical changes can be made for political reasons, we should
> at least be clear in regards to why particular decisions are being
> made. I'm supportive of a hard fork for technical reasons but not
> political ones as are many others.
> >
> > Jared
> >
> > On Wed, Jun 7, 2017 at 5:01 PM, James Hilliard <
> james.hilliard1 at gmail.com>
> > wrote:
> >>
> >> On Wed, Jun 7, 2017 at 6:43 PM, Jared Lee Richardson <
> jaredr26 at gmail.com>
> >> wrote:
> >> >> BIP148 however is a consensus change that can
> >> >> be rectified if it gets more work, this would act as an additional
> >> >> incentive for mine the BIP148 side since there would be no wipeout
> >> >> risk there.
> >> >
> >> > This statement is misleading.  Wipeout risks don't apply to any
> >> > consensus
> >> > changes; It is a consensus change, it can only be abandoned.  The
> BIP148
> >> > chain carries just as many risks of being abandoned or even more with
> >> > segwit2x on the table.  No miner would consider "wipeout risk" an
> >> > advantage
> >> > when the real threat is chain abandonment.
> >> Both are issues, but wipeout risk is different, the ETH/ETC split for
> >> example didn't have any wipeout risk for either side the same is not
> >> true for BIP148(and it is the non-BIP148 side that carries the risk of
> >> chain wipeout).
> >> >
> >> >> Higher transaction fees on a minority chain can compensate miners for
> >> >> a lower price which would likely be enough to get the BIP148 chain to
> >> >> a difficulty reduction.
> >> >
> >> > Higher transaction fees suffers the same problem as exchange support
> >> > does.
> >> > Without replay protection, it is very difficult for any average user
> to
> >> > force transactions onto one chain or the other.  Thus, without replay
> >> > protection, the UASF chain is unlikely to develop any viable fee
> market;
> >> > Its
> >> > few miners 99% of the time will simply choose from the highest fees
> that
> >> > were already available to the other chain, which is basically no
> >> > advantage
> >> > at all.
> >> Not really, there are a few relatively simple techniques such as RBF
> >> which can be leveraged to get confirmations on on-side before double
> >> spending on another. Once a transaction is confirmed on the non-BIP148
> >> chain then the high fee transactions can be made on only the BIP148
> >> side of the split using RBF. Exchanges will likely do this splitting
> >> automatically for uses as well.
> >> >
> >> >>  ETC replay protection was done after the fork on an as
> >> >> needed basis(there are multiple reliable techniques that can be used
> >> >> to split UTXO's), the same can happen with BIP148 and it is easier to
> >> >> do with Bitcoin than with the ETH/ETC split IMO.
> >> >
> >> > ETC replay protection was added because they were already a hardfork
> and
> >> > without it they would not have had a viable chain.  BIP148 is not
> >> > supposed
> >> > to be a hardfork, and if it added replay protection to remain viable
> it
> >> > would lose the frequently touted "wipeout advantage" as well as the
> >> > ability
> >> > to call itself a softfork.  And are you seriously suggesting that what
> >> > happened with ETC and ETH is a desirable and good situation for
> Bitcoin,
> >> > and
> >> > that UASF is ETC?
> >> There wasn't proper replay protection at split time for ETH/ETC since
> >> normal transactions would get executed on both sides originally,
> >> however replay protection was added by wallets(mainly using splitting
> >> contracts). I don't think a split is desirable however, which is why
> >> I've proposed this BIP.
> >> >
> >> >> A big reason BIP148 still has support is because up until SegWit
> >> >> actually activates there's no guarantee segwit2mb will actually have
> >> >> the necessary support to activate SegWit.
> >> >
> >> > For a miners blowing through six million dollars a day in mining
> >> > operational
> >> > costs, that's a pretty crappy reason.  Serious miners can't afford to
> >> > prop
> >> > up a non-viable chain based on philosophy or maybes.  BIP148 is based
> >> > entirely upon people who aren't putting anything on the line trying to
> >> > convince others to take the huge risks for them.  With deceptively
> >> > fallacious logic, in my opinion.
> >> Yes, miners aren't likely to waste operational mining costs, that's
> >> ultimately why miners would follow the BIP148 side of the chain
> >> assuming it has sufficient economic support or if it's more profitable
> >> to mine.
> >> >
> >> > Even segwit2x is based on the assumption that all miners can reach
> >> > consensus.  Break that assumption and segwit2x will have the same
> >> > problems
> >> > as UASF.
> >> segwit2x has more issues since the HF part requires users to reach
> >> consensus
> >> >
> >> >> This is largely an issue due to segwit2x's bundling, if the SW and HF
> >> >> part of segwit2x were unbundled then there would be no reason to
> delay
> >> >> BIP91 activation
> >> >
> >> > They are bundled.  Segwit alone doesn't have the desired overwhelming
> >> > consensus, unless core wishes to fork 71% to 29%, and maybe not even
> >> > that
> >> > high.  That's the technical reason, and they can't be unbundled
> without
> >> > breaking that consensus.
> >> That's a political reason not a technical reason.
> >> >
> >> > Jared
> >> >
> >> >
> >> > On Wed, Jun 7, 2017 at 4:11 PM, James Hilliard
> >> > <james.hilliard1 at gmail.com>
> >> > wrote:
> >> >>
> >> >> On Wed, Jun 7, 2017 at 5:53 PM, Jared Lee Richardson
> >> >> <jaredr26 at gmail.com>
> >> >> wrote:
> >> >> >> There are 2 primary factors involved here, economic support and
> >> >> > hashpower either of which is enough to make a permanent chain split
> >> >> > unlikely, miners will mine whichever chain is most profitable(see
> >> >> > ETH/ETC hashpower profitability equilibrium for an example of how
> >> >> > this
> >> >> > works in practice)
> >> >> >
> >> >> > That's not a comparable example.  ETC did not face potentially
> years
> >> >> > of
> >> >> > slow
> >> >> > blocktimes before it normalized, whereas BIP148 is on track to do
> >> >> > exactly
> >> >> > that.  Moreover, ETC represented a fundamental break from the
> >> >> > majority
> >> >> > consensus that could not be rectified, whereas BIP148 represents
> only
> >> >> > a
> >> >> > minority attempt to accelerate something that an overwhelming
> >> >> > majority
> >> >> > of
> >> >> > miners have already agreed to activate under segwit2x.  Lastly ETC
> >> >> > was
> >> >> > required to add replay protection, just like any minority fork
> >> >> > proposed
> >> >> > by
> >> >> > any crypto-currency has been, something that BIP148 both lacks and
> >> >> > refuses
> >> >> > to add or even acknowledge the necessity of.  Without replay
> >> >> > protection,
> >> >> > ETC
> >> >> > could not have become profitable enough to be a viable minority
> >> >> > chain.
> >> >> > If
> >> >> > BIP148's chain is not the majority chain and it does not have
> replay
> >> >> > protection, it will face the same problems, but that required
> replay
> >> >> > protection will turn it into a hardfork.  This will be a very bad
> >> >> > position
> >> >> > for UASF supporters to find themselves in - Either hardfork and
> hope
> >> >> > the
> >> >> > price is higher and the majority converts, or die as the minority
> >> >> > chain
> >> >> > with
> >> >> > no reliable methods of economic conversion.
> >> >> Higher transaction fees on a minority chain can compensate miners for
> >> >> a lower price which would likely be enough to get the BIP148 chain to
> >> >> a difficulty reduction. BIP148 however is a consensus change that can
> >> >> be rectified if it gets more work, this would act as an additional
> >> >> incentive for mine the BIP148 side since there would be no wipeout
> >> >> risk there. ETC replay protection was done after the fork on an as
> >> >> needed basis(there are multiple reliable techniques that can be used
> >> >> to split UTXO's), the same can happen with BIP148 and it is easier to
> >> >> do with Bitcoin than with the ETH/ETC split IMO.
> >> >> >
> >> >> > I believe, but don't have data to back this, that most of the
> BIP148
> >> >> > insistence comes not from a legitimate attempt to gain consensus
> (or
> >> >> > else
> >> >> > they would either outright oppose segwit2mb for its hardfork, or
> they
> >> >> > would
> >> >> > outright support it), but rather from an attempt for BIP148
> >> >> > supporters
> >> >> > to
> >> >> > save face for BIP148 being a failure.  If I'm correct, that's a
> >> >> > terrible
> >> >> > and
> >> >> > highly non-technical reason for segwit2mb to bend over backwards
> >> >> > attempting
> >> >> > to support BIP148's attempt to save face.
> >> >> A big reason BIP148 still has support is because up until SegWit
> >> >> actually activates there's no guarantee segwit2mb will actually have
> >> >> the necessary support to activate SegWit.
> >> >> >
> >> >> >> The main issue is just one of activation timelines, BIP91 as
> >> >> > is takes too long to activate unless started ahead of the existing
> >> >> > segwit2x schedule and it's unlikely that BIP148 will get pushed
> back
> >> >> > any further.
> >> >> >
> >> >> > Even if I'm not correct on the above, I and others find it hard to
> >> >> > accept
> >> >> > that this timeline conflict is segwit2x's fault.  Segwit2x has both
> >> >> > some
> >> >> > flexibility and broad support that crosses contentious pro-segwit
> and
> >> >> > pro-blocksize-increase divisions that have existed for two years.
> >> >> > BIP148 is
> >> >> > attempting to hold segwit2x's timelines and code hostage by
> claiming
> >> >> > inflexibility and claiming broad support, and not only are neither
> of
> >> >> > those
> >> >> > assertions are backed by real data, BIP148 (by being so inflexible)
> >> >> > is
> >> >> > pushing a position that deepens the divides between those groups.
> >> >> > For
> >> >> > there
> >> >> > to be technical reasons for compatibility (so long as there are
> >> >> > tradeoffs,
> >> >> > which there are), there needs to be hard data showing that BIP148
> is
> >> >> > a
> >> >> > viable minority fork that won't simply die off on its own.
> >> >> This is largely an issue due to segwit2x's bundling, if the SW and HF
> >> >> part of segwit2x were unbundled then there would be no reason to
> delay
> >> >> BIP91 activation, this is especially a problem since it takes a good
> >> >> deal of time to properly code and test a HF. Unfortunately segwit2x
> >> >> has been quite inflexible in regards to the bundling aspect even
> >> >> though there are clearly no technical reasons for it to be there.
> >> >> >
> >> >> > Jared
> >> >> >
> >> >> >
> >> >> > On Wed, Jun 7, 2017 at 3:23 PM, James Hilliard
> >> >> > <james.hilliard1 at gmail.com>
> >> >> > wrote:
> >> >> >>
> >> >> >> On Wed, Jun 7, 2017 at 4:50 PM, Jared Lee Richardson
> >> >> >> <jaredr26 at gmail.com>
> >> >> >> wrote:
> >> >> >> > Could this risk mitigation measure be an optional flag?  And if
> >> >> >> > so,
> >> >> >> > could it+BIP91 signal on a different bit than bit4?
> >> >> >> It's fairly trivial for miners to signal for BIP91 on bit4 or a
> >> >> >> different bit at the same time as the code is trivial enough to
> >> >> >> combine
> >> >> >> >
> >> >> >> > The reason being, if for some reason the segwit2x activation
> >> >> >> > cannot
> >> >> >> > take place in time, it would be preferable for miners to have a
> >> >> >> > more
> >> >> >> > standard approach to activation that requires stronger consensus
> >> >> >> > and
> >> >> >> > may be more forgiving than BIP148.  If the segwit2x activation
> is
> >> >> >> > on
> >> >> >> > time to cooperate with BIP148, it could be signaled through the
> >> >> >> > non-bit4 approach and everything could go smoothly.  Thoughts on
> >> >> >> > that
> >> >> >> > idea?  It may add more complexity and more developer time, but
> may
> >> >> >> > also address your concerns among others.
> >> >> >> This does give miners another approach to activate segwit ahead of
> >> >> >> BIP148, if segwit2x activation is rolled out and activated
> >> >> >> immediately
> >> >> >> then this would not be needed however based on the timeline here
> >> >> >> https://segwit2x.github.io/ it would not be possible for BIP91 to
> >> >> >> enforce mandatory signalling ahead of BIP148. Maybe that can be
> >> >> >> changed though, I've suggested an immediate rollout with a
> >> >> >> placeholder
> >> >> >> client timeout instead of the HF code initially in order to
> >> >> >> accelerate
> >> >> >> that.
> >> >> >> >
> >> >> >> >> Since this BIP
> >> >> >> >> only activates with a clear miner majority it should not
> increase
> >> >> >> >> the
> >> >> >> >> risk of an extended chain split.
> >> >> >> >
> >> >> >> > The concern I'm raising is more about the psychology of giving
> >> >> >> > BIP148
> >> >> >> > a sense of safety that may not be valid.  Without several more
> >> >> >> > steps,
> >> >> >> > BIP148 is definitely on track to be a risky chainsplit, and
> >> >> >> > without
> >> >> >> > segwit2x it will almost certainly be a small minority chain.
> >> >> >> > (Unless
> >> >> >> > the segwit2x compromise falls apart before then, and even in
> that
> >> >> >> > case
> >> >> >> > it is likely to be a minority chain)
> >> >> >> There are 2 primary factors involved here, economic support and
> >> >> >> hashpower either of which is enough to make a permanent chain
> split
> >> >> >> unlikely, miners will mine whichever chain is most profitable(see
> >> >> >> ETH/ETC hashpower profitability equilibrium for an example of how
> >> >> >> this
> >> >> >> works in practice) however there may be lag time immediately after
> >> >> >> the
> >> >> >> split if there is an economic majority but not a hashpower
> majority
> >> >> >> initially. This is risk mitigation that only requires miners
> support
> >> >> >> however. The main issue is just one of activation timelines, BIP91
> >> >> >> as
> >> >> >> is takes too long to activate unless started ahead of the existing
> >> >> >> segwit2x schedule and it's unlikely that BIP148 will get pushed
> back
> >> >> >> any further.
> >> >> >> >
> >> >> >> > Jared
> >> >> >> >
> >> >> >> >
> >> >> >> > On Wed, Jun 7, 2017 at 2:42 PM, James Hilliard
> >> >> >> > <james.hilliard1 at gmail.com> wrote:
> >> >> >> >> I don't really see how this would increase the likelihood of an
> >> >> >> >> extended chain split assuming BIP148 is going to have
> >> >> >> >> non-insignificant economic backing. This BIP is designed to
> >> >> >> >> provide
> >> >> >> >> a
> >> >> >> >> risk mitigation measure that miners can safely deploy. Since
> this
> >> >> >> >> BIP
> >> >> >> >> only activates with a clear miner majority it should not
> increase
> >> >> >> >> the
> >> >> >> >> risk of an extended chain split. At this point it is not
> >> >> >> >> completely
> >> >> >> >> clear how much economic support there is for BIP148 but support
> >> >> >> >> certainly seems to be growing and we have nearly 2 months until
> >> >> >> >> BIP148
> >> >> >> >> activation. I intentionally used a shorter activation period
> here
> >> >> >> >> so
> >> >> >> >> that decisions by miners can be made close to the BIP148
> >> >> >> >> activation
> >> >> >> >> date.
> >> >> >> >>
> >> >> >> >> On Wed, Jun 7, 2017 at 4:29 PM, Jared Lee Richardson
> >> >> >> >> <jaredr26 at gmail.com> wrote:
> >> >> >> >>> I think this BIP represents a gamble, and the gamble may not
> be
> >> >> >> >>> a
> >> >> >> >>> good
> >> >> >> >>> one.  The gamble here is that if the segwit2x changes are
> rolled
> >> >> >> >>> out
> >> >> >> >>> on time, and if the signatories accept the bit4 + bit1
> signaling
> >> >> >> >>> proposals within BIP91, the launch will go smoother, as
> >> >> >> >>> intended.
> >> >> >> >>> But
> >> >> >> >>> conversely, if either the segwit2x signatories balk about the
> >> >> >> >>> Bit1
> >> >> >> >>> signaling OR if the timelines for segwit2mb are missed even
> by a
> >> >> >> >>> bit,
> >> >> >> >>> it may cause the BIP148 chainsplit to be worse than it would
> be
> >> >> >> >>> without.  Given the frequent concerns raised in multiple
> places
> >> >> >> >>> about
> >> >> >> >>> the aggressiveness of the segwit2x timelines, including the
> >> >> >> >>> non-hardfork timelines, this does not seem like a great gamble
> >> >> >> >>> to
> >> >> >> >>> be
> >> >> >> >>> making.
> >> >> >> >>>
> >> >> >> >>> The reason I say it may make the chainsplit be worse than it
> >> >> >> >>> would
> >> >> >> >>> otherwise be is that it may provide a false sense of safety
> for
> >> >> >> >>> BIP148
> >> >> >> >>> that currently does not currently exist(and should not, as it
> is
> >> >> >> >>> a
> >> >> >> >>> chainsplit).  That sense of safety would only be legitimate if
> >> >> >> >>> the
> >> >> >> >>> segwit2x signatories were on board, and the segwit2x code
> >> >> >> >>> effectively
> >> >> >> >>> enforced BIP148 simultaneously, neither of which are
> guaranteed.
> >> >> >> >>> If
> >> >> >> >>> users and more miners had a false sense that BIP148 was *not*
> >> >> >> >>> going
> >> >> >> >>> to
> >> >> >> >>> chainsplit from default / segwit2x, they might not follow the
> >> >> >> >>> news
> >> >> >> >>> if
> >> >> >> >>> suddenly the segwit2x plan were delayed for a few days.  While
> >> >> >> >>> any
> >> >> >> >>> additional support would definitely be cheered on by BIP148
> >> >> >> >>> supporters, the practical reality might be that this proposal
> >> >> >> >>> would
> >> >> >> >>> take BIP148 from the "unlikely to have any viable chain after
> >> >> >> >>> flag
> >> >> >> >>> day
> >> >> >> >>> without segwit2x" category into the "small but viable minority
> >> >> >> >>> chain"
> >> >> >> >>> category, and even worse, it might strengthen the chainsplit
> >> >> >> >>> just
> >> >> >> >>> days
> >> >> >> >>> before segwit is activated on BOTH chains, putting the BIP148
> >> >> >> >>> supporters on the wrong pro-segwit, but still-viable chain.
> >> >> >> >>>
> >> >> >> >>> If Core had taken a strong stance to include BIP148 into the
> >> >> >> >>> client,
> >> >> >> >>> and if BIP148 support were much much broader, I would feel
> >> >> >> >>> differently
> >> >> >> >>> as the gamble would be more likely to discourage a chainsplit
> >> >> >> >>> (By
> >> >> >> >>> forcing the acceleration of segwit2x) rather than encourage it
> >> >> >> >>> (by
> >> >> >> >>> strengthening an extreme minority chainsplit that may wind up
> on
> >> >> >> >>> the
> >> >> >> >>> wrong side of two segwit-activated chains).  As it stands now,
> >> >> >> >>> this
> >> >> >> >>> seems like a very dangerous attempt to compromise with a small
> >> >> >> >>> but
> >> >> >> >>> vocal group that are the ones creating the threat to begin
> with.
> >> >> >> >>>
> >> >> >> >>> Jared
> >> >> >> >>>
> >> >> >> >>> On Tue, Jun 6, 2017 at 5:56 PM, James Hilliard via bitcoin-dev
> >> >> >> >>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
> >> >> >> >>>> Due to the proposed calendar(https://segwit2x.github.io/)
> for
> >> >> >> >>>> the
> >> >> >> >>>> SegWit2x agreement being too slow to activate SegWit
> mandatory
> >> >> >> >>>> signalling ahead of BIP148 using BIP91 I would like to
> propose
> >> >> >> >>>> another
> >> >> >> >>>> option that miners can use to prevent a chain split ahead of
> >> >> >> >>>> the
> >> >> >> >>>> Aug
> >> >> >> >>>> 1st BIP148 activation date.
> >> >> >> >>>>
> >> >> >> >>>> The splitprotection soft fork is essentially BIP91 but using
> >> >> >> >>>> BIP8
> >> >> >> >>>> instead of BIP9 with a lower activation threshold and
> immediate
> >> >> >> >>>> mandatory signalling lock-in. This allows for a majority of
> >> >> >> >>>> miners
> >> >> >> >>>> to
> >> >> >> >>>> activate mandatory SegWit signalling and prevent a potential
> >> >> >> >>>> chain
> >> >> >> >>>> split ahead of BIP148 activation.
> >> >> >> >>>>
> >> >> >> >>>> This BIP allows for miners to respond to market forces
> quickly
> >> >> >> >>>> ahead
> >> >> >> >>>> of BIP148 activation by signalling for splitprotection. Any
> >> >> >> >>>> miners
> >> >> >> >>>> already running BIP148 should be encouraged to use
> >> >> >> >>>> splitprotection.
> >> >> >> >>>>
> >> >> >> >>>> <pre>
> >> >> >> >>>>   BIP: splitprotection
> >> >> >> >>>>   Layer: Consensus (soft fork)
> >> >> >> >>>>   Title: User Activated Soft Fork Split Protection
> >> >> >> >>>>   Author: James Hilliard <james.hilliard1 at gmail.com>
> >> >> >> >>>>   Comments-Summary: No comments yet.
> >> >> >> >>>>   Comments-URI:
> >> >> >> >>>>   Status: Draft
> >> >> >> >>>>   Type: Standards Track
> >> >> >> >>>>   Created: 2017-05-22
> >> >> >> >>>>   License: BSD-3-Clause
> >> >> >> >>>>            CC0-1.0
> >> >> >> >>>> </pre>
> >> >> >> >>>>
> >> >> >> >>>> ==Abstract==
> >> >> >> >>>>
> >> >> >> >>>> This document specifies a coordination mechanism for a simple
> >> >> >> >>>> majority
> >> >> >> >>>> of miners to prevent a chain split ahead of BIP148
> activation.
> >> >> >> >>>>
> >> >> >> >>>> ==Definitions==
> >> >> >> >>>>
> >> >> >> >>>> "existing segwit deployment" refer to the BIP9 "segwit"
> >> >> >> >>>> deployment
> >> >> >> >>>> using bit 1, between November 15th 2016 and November 15th
> 2017
> >> >> >> >>>> to
> >> >> >> >>>> activate BIP141, BIP143 and BIP147.
> >> >> >> >>>>
> >> >> >> >>>> ==Motivation==
> >> >> >> >>>>
> >> >> >> >>>> The biggest risk of BIP148 is an extended chain split, this
> BIP
> >> >> >> >>>> provides a way for a simple majority of miners to eliminate
> >> >> >> >>>> that
> >> >> >> >>>> risk.
> >> >> >> >>>>
> >> >> >> >>>> This BIP provides a way for a simple majority of miners to
> >> >> >> >>>> coordinate
> >> >> >> >>>> activation of the existing segwit deployment with less than
> 95%
> >> >> >> >>>> hashpower before BIP148 activation. Due to time constraints
> >> >> >> >>>> unless
> >> >> >> >>>> immediately deployed BIP91 will likely not be able to enforce
> >> >> >> >>>> mandatory signalling of segwit before the Aug 1st activation
> of
> >> >> >> >>>> BIP148. This BIP provides a method for rapid miner activation
> >> >> >> >>>> of
> >> >> >> >>>> SegWit mandatory signalling ahead of the BIP148 activation
> >> >> >> >>>> date.
> >> >> >> >>>> Since
> >> >> >> >>>> the primary goal of this BIP is to reduce the chance of an
> >> >> >> >>>> extended
> >> >> >> >>>> chain split as much as possible we activate using a simple
> >> >> >> >>>> miner
> >> >> >> >>>> majority of 65% over a 504 block interval rather than a
> higher
> >> >> >> >>>> percentage. This BIP also allows miners to signal their
> >> >> >> >>>> intention
> >> >> >> >>>> to
> >> >> >> >>>> run BIP148 in order to prevent a chain split.
> >> >> >> >>>>
> >> >> >> >>>> ==Specification==
> >> >> >> >>>>
> >> >> >> >>>> While this BIP is active, all blocks must set the nVersion
> >> >> >> >>>> header
> >> >> >> >>>> top
> >> >> >> >>>> 3 bits to 001 together with bit field (1<<1) (according to
> the
> >> >> >> >>>> existing segwit deployment). Blocks that do not signal as
> >> >> >> >>>> required
> >> >> >> >>>> will be rejected.
> >> >> >> >>>>
> >> >> >> >>>> ==Deployment==
> >> >> >> >>>>
> >> >> >> >>>> This BIP will be deployed by "version bits" with a 65%(this
> can
> >> >> >> >>>> be
> >> >> >> >>>> adjusted if desired) activation threshold BIP9 with the name
> >> >> >> >>>> "splitprotecion" and using bit 2.
> >> >> >> >>>>
> >> >> >> >>>> This BIP starts immediately and is a BIP8 style soft fork
> since
> >> >> >> >>>> mandatory signalling will start on midnight August 1st 2017
> >> >> >> >>>> (epoch
> >> >> >> >>>> time 1501545600) regardless of whether or not this BIP has
> >> >> >> >>>> reached
> >> >> >> >>>> its
> >> >> >> >>>> own signalling threshold. This BIP will cease to be active
> when
> >> >> >> >>>> segwit
> >> >> >> >>>> is locked-in.
> >> >> >> >>>>
> >> >> >> >>>> === Reference implementation ===
> >> >> >> >>>>
> >> >> >> >>>> <pre>
> >> >> >> >>>> // Check if Segregated Witness is Locked In
> >> >> >> >>>> bool IsWitnessLockedIn(const CBlockIndex* pindexPrev, const
> >> >> >> >>>> Consensus::Params& params)
> >> >> >> >>>> {
> >> >> >> >>>>     LOCK(cs_main);
> >> >> >> >>>>     return (VersionBitsState(pindexPrev, params,
> >> >> >> >>>> Consensus::DEPLOYMENT_SEGWIT, versionbitscache) ==
> >> >> >> >>>> THRESHOLD_LOCKED_IN);
> >> >> >> >>>> }
> >> >> >> >>>>
> >> >> >> >>>> // SPLITPROTECTION mandatory segwit signalling.
> >> >> >> >>>> if ( VersionBitsState(pindex->pprev,
> >> >> >> >>>> chainparams.GetConsensus(),
> >> >> >> >>>> Consensus::DEPLOYMENT_SPLITPROTECTION, versionbitscache) ==
> >> >> >> >>>> THRESHOLD_LOCKED_IN &&
> >> >> >> >>>>      !IsWitnessLockedIn(pindex->pprev,
> >> >> >> >>>> chainparams.GetConsensus())
> >> >> >> >>>> &&
> >> >> >> >>>> // Segwit is not locked in
> >> >> >> >>>>      !IsWitnessEnabled(pindex->pprev,
> >> >> >> >>>> chainparams.GetConsensus())
> >> >> >> >>>> )
> >> >> >> >>>> //
> >> >> >> >>>> and is not active.
> >> >> >> >>>> {
> >> >> >> >>>>     bool fVersionBits = (pindex->nVersion &
> >> >> >> >>>> VERSIONBITS_TOP_MASK)
> >> >> >> >>>> ==
> >> >> >> >>>> VERSIONBITS_TOP_BITS;
> >> >> >> >>>>     bool fSegbit = (pindex->nVersion &
> >> >> >> >>>> VersionBitsMask(chainparams.GetConsensus(),
> >> >> >> >>>> Consensus::DEPLOYMENT_SEGWIT)) != 0;
> >> >> >> >>>>     if (!(fVersionBits && fSegbit)) {
> >> >> >> >>>>         return state.DoS(0, error("ConnectBlock(): relayed
> >> >> >> >>>> block
> >> >> >> >>>> must
> >> >> >> >>>> signal for segwit, please upgrade"), REJECT_INVALID,
> >> >> >> >>>> "bad-no-segwit");
> >> >> >> >>>>     }
> >> >> >> >>>> }
> >> >> >> >>>>
> >> >> >> >>>> // BIP148 mandatory segwit signalling.
> >> >> >> >>>> int64_t nMedianTimePast = pindex->GetMedianTimePast();
> >> >> >> >>>> if ( (nMedianTimePast >= 1501545600) &&  // Tue 01 Aug 2017
> >> >> >> >>>> 00:00:00
> >> >> >> >>>> UTC
> >> >> >> >>>>      (nMedianTimePast <= 1510704000) &&  // Wed 15 Nov 2017
> >> >> >> >>>> 00:00:00
> >> >> >> >>>> UTC
> >> >> >> >>>>      (!IsWitnessLockedIn(pindex->pprev,
> >> >> >> >>>> chainparams.GetConsensus())
> >> >> >> >>>> &&
> >> >> >> >>>>  // Segwit is not locked in
> >> >> >> >>>>       !IsWitnessEnabled(pindex->pprev,
> >> >> >> >>>> chainparams.GetConsensus())) )
> >> >> >> >>>>  // and is not active.
> >> >> >> >>>> {
> >> >> >> >>>>     bool fVersionBits = (pindex->nVersion &
> >> >> >> >>>> VERSIONBITS_TOP_MASK)
> >> >> >> >>>> ==
> >> >> >> >>>> VERSIONBITS_TOP_BITS;
> >> >> >> >>>>     bool fSegbit = (pindex->nVersion &
> >> >> >> >>>> VersionBitsMask(chainparams.GetConsensus(),
> >> >> >> >>>> Consensus::DEPLOYMENT_SEGWIT)) != 0;
> >> >> >> >>>>     if (!(fVersionBits && fSegbit)) {
> >> >> >> >>>>         return state.DoS(0, error("ConnectBlock(): relayed
> >> >> >> >>>> block
> >> >> >> >>>> must
> >> >> >> >>>> signal for segwit, please upgrade"), REJECT_INVALID,
> >> >> >> >>>> "bad-no-segwit");
> >> >> >> >>>>     }
> >> >> >> >>>> }
> >> >> >> >>>> </pre>
> >> >> >> >>>>
> >> >> >> >>>>
> >> >> >> >>>>
> >> >> >> >>>>
> >> >> >> >>>> https://github.com/bitcoin/bitcoin/compare/0.14...
> jameshilliard:splitprotection-v0.14.1
> >> >> >> >>>>
> >> >> >> >>>> ==Backwards Compatibility==
> >> >> >> >>>>
> >> >> >> >>>> This deployment is compatible with the existing "segwit" bit
> 1
> >> >> >> >>>> deployment scheduled between midnight November 15th, 2016 and
> >> >> >> >>>> midnight
> >> >> >> >>>> November 15th, 2017. This deployment is also compatible with
> >> >> >> >>>> the
> >> >> >> >>>> existing BIP148 deployment. This BIP is compatible with BIP91
> >> >> >> >>>> only
> >> >> >> >>>> if
> >> >> >> >>>> BIP91 activates before it and before BIP148. Miners will need
> >> >> >> >>>> to
> >> >> >> >>>> upgrade their nodes to support splitprotection otherwise they
> >> >> >> >>>> may
> >> >> >> >>>> build on top of an invalid block. While this bip is active
> >> >> >> >>>> users
> >> >> >> >>>> should either upgrade to splitprotection or wait for
> additional
> >> >> >> >>>> confirmations when accepting payments.
> >> >> >> >>>>
> >> >> >> >>>> ==Rationale==
> >> >> >> >>>>
> >> >> >> >>>> Historically we have used IsSuperMajority() to activate soft
> >> >> >> >>>> forks
> >> >> >> >>>> such as BIP66 which has a mandatory signalling requirement
> for
> >> >> >> >>>> miners
> >> >> >> >>>> once activated, this ensures that miners are aware of new
> rules
> >> >> >> >>>> being
> >> >> >> >>>> enforced. This technique can be leveraged to lower the
> >> >> >> >>>> signalling
> >> >> >> >>>> threshold of a soft fork while it is in the process of being
> >> >> >> >>>> deployed
> >> >> >> >>>> in a backwards compatible way. We also use a BIP8 style
> timeout
> >> >> >> >>>> to
> >> >> >> >>>> ensure that this BIP is compatible with BIP148 and that
> BIP148
> >> >> >> >>>> compatible mandatory signalling activates regardless of miner
> >> >> >> >>>> signalling levels.
> >> >> >> >>>>
> >> >> >> >>>> By orphaning non-signalling blocks during the BIP9 bit 1
> >> >> >> >>>> "segwit"
> >> >> >> >>>> deployment, this BIP can cause the existing "segwit"
> deployment
> >> >> >> >>>> to
> >> >> >> >>>> activate without needing to release a new deployment. As we
> >> >> >> >>>> approach
> >> >> >> >>>> BIP148 activation it may be desirable for a majority of
> miners
> >> >> >> >>>> to
> >> >> >> >>>> have
> >> >> >> >>>> a method that will ensure that there is no chain split.
> >> >> >> >>>>
> >> >> >> >>>> ==References==
> >> >> >> >>>>
> >> >> >> >>>>
> >> >> >> >>>>
> >> >> >> >>>>
> >> >> >> >>>> *[https://lists.linuxfoundation.org/pipermail/
> bitcoin-dev/2017-March/013714.html
> >> >> >> >>>> Mailing list discussion]
> >> >> >> >>>>
> >> >> >> >>>>
> >> >> >> >>>>
> >> >> >> >>>> *[https://github.com/bitcoin/bitcoin/blob/v0.6.0/src/main.
> cpp#L1281-L1283
> >> >> >> >>>> P2SH flag day activation]
> >> >> >> >>>> *[[bip-0009.mediawiki|BIP9 Version bits with timeout and
> >> >> >> >>>> delay]]
> >> >> >> >>>> *[[bip-0016.mediawiki|BIP16 Pay to Script Hash]]
> >> >> >> >>>> *[[bip-0091.mediawiki|BIP91 Reduced threshold Segwit MASF]]
> >> >> >> >>>> *[[bip-0141.mediawiki|BIP141 Segregated Witness (Consensus
> >> >> >> >>>> layer)]]
> >> >> >> >>>> *[[bip-0143.mediawiki|BIP143 Transaction Signature
> Verification
> >> >> >> >>>> for
> >> >> >> >>>> Version 0 Witness Program]]
> >> >> >> >>>> *[[bip-0147.mediawiki|BIP147 Dealing with dummy stack element
> >> >> >> >>>> malleability]]
> >> >> >> >>>> *[[bip-0148.mediawiki|BIP148 Mandatory activation of segwit
> >> >> >> >>>> deployment]]
> >> >> >> >>>> *[[bip-0149.mediawiki|BIP149 Segregated Witness (second
> >> >> >> >>>> deployment)]]
> >> >> >> >>>> *[https://bitcoincore.org/en/2016/01/26/segwit-benefits/
> Segwit
> >> >> >> >>>> benefits]
> >> >> >> >>>>
> >> >> >> >>>> ==Copyright==
> >> >> >> >>>>
> >> >> >> >>>> This document is dual licensed as BSD 3-clause, and Creative
> >> >> >> >>>> Commons
> >> >> >> >>>> CC0 1.0 Universal.
> >> >> >> >>>> _______________________________________________
> >> >> >> >>>> bitcoin-dev mailing list
> >> >> >> >>>> bitcoin-dev at lists.linuxfoundation.org
> >> >> >> >>>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-
> dev
> >> >> >
> >> >> >
> >> >
> >> >
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170607/0f69b0fc/attachment-0001.html>

From james.hilliard1 at gmail.com  Thu Jun  8 09:20:28 2017
From: james.hilliard1 at gmail.com (James Hilliard)
Date: Thu, 8 Jun 2017 04:20:28 -0500
Subject: [bitcoin-dev] User Activated Soft Fork Split Protection
In-Reply-To: <CAD1TkXs2zN9ZuvP+QeF+U-YsK-1rXRCREQAZgaKrA5xt2W2w-Q@mail.gmail.com>
References: <CADvTj4qpH-t5Gx6qyn3yToyUE_GFaBE989=AWNHLKMpMNW3R+w@mail.gmail.com>
	<CAD1TkXviJouao7YoHjiDN3mTUWFEbMY9mtCqkQ8zp8JthyhT7Q@mail.gmail.com>
	<CADvTj4rz4exYMvBEmYi=bTZDgDm0drLjpRZmZUo17inzCzCRVg@mail.gmail.com>
	<CAD1TkXskei1gk_kungSvdWGmbdJMA8AG+-zK+Osz6u5vSCN8BQ@mail.gmail.com>
	<CADvTj4poO1L+Wg5J+M71sJMz-Xcg_st3MkAcQK=bfHhTJ3i8ow@mail.gmail.com>
	<CAD1TkXumetRnPO6LxhJeVoci=0=YHD7hEB0K0YH+2McRBJ-QHw@mail.gmail.com>
	<CADvTj4pFna4tX37XmgrP7ueZB+Yv4T9NWmp99CwKSx5mzdiJJQ@mail.gmail.com>
	<CAD1TkXtmj3H3k+k7X2DgA0cNxXBNSSrzf_o33qFO8cA9eSUTnw@mail.gmail.com>
	<CADvTj4o5tTD2XN080dmHq1DuNwSZtmAytv3=7F5zGeBdhiPMrA@mail.gmail.com>
	<CAD1TkXuBc8nQr7ZSog4aYbppqR9Bg4cX=gFdSZCvBXfZmmhQww@mail.gmail.com>
	<CADvTj4r6aHYd53Zi-kE+MQZoDv-ONdFf6CDmNA8YXgqVdwmR=g@mail.gmail.com>
	<CAD1TkXs2zN9ZuvP+QeF+U-YsK-1rXRCREQAZgaKrA5xt2W2w-Q@mail.gmail.com>
Message-ID: <CADvTj4oVj4yRAA+4YLe7doXnSXWfB6sOcFWGoMhXb9Y-B5m6sg@mail.gmail.com>

On Wed, Jun 7, 2017 at 8:01 PM, Jared Lee Richardson <jaredr26 at gmail.com> wrote:
>> If you're looking for hard numbers at this point you aren't likely to
>> find them because not everything is easy to measure directly.
>
> There's quite a few hard numbers that are available that are of varying use.
> Mining commitments are a major one because of the stalled chain problem.
> Node signaling represents some data because while it can be sybiled, they
> are cheap but not free to run.  Upvotes and comments on reddit and other
> forums might be of some use, but there's not a clear supermajority driving
> every pro-uasf comment up and every anti-uasf comment down, and Reddit
> obscures the upvote/downvotes pretty well.  It could be a gleaned datapoint
> if someone pulled the comments, manually evaluated their likely position on
> the matter(neutrally), and then reported on it, but that is a lot of work
> and I think it is unlikely to show anything except how deep the rifts in the
> community are.  Of the two main statistics available, they do not support
> the idea that UASF has any chance of success.  Of the third, it at least
> shows that there is deep opposition that is nearly equal to the support
> amongst the forums most likely to support UASF.
Right, it's not straight forward to measure because the hard numbers
that we do have tell an incomplete story. In addition the metric that
BIP148 primarily depends on(economic support) is much harder to
measure than other metrics such as hashpower support.
>
> So I'll take anything, any statistic that actually indicates UASF has a
> chance in hell of succeeding, at least that would be worth something.
> Otherwise it's all much ado about nothing.
>
>> We'll know more as we get closer to BIP148 activation by looking at the
>> markets.
>
> What markets?  Where?  How would we know?
There will likely be some exchanges offering markets for each side of
a potential split separately ahead of BIP148 activation.
>
>> > It doesn't have those issues during the segwit activation, ergo there is
>> > no
>> > reason for segwit-activation problems to take priority over the very
>> > real
>> > hardfork activation problems.
>
>> And yet segwit2x is insisting on activation bundling which needlessly
>> complicates and delays SegWit activation.
>
> Because it is not segwit that has appears to have the supermajority
> consensus.
I think you've misunderstood the situation, SegWit has widespread
support but has been turned into a political bargaining chip for other
less desirable changes that do not have widespread support.
>
>> Sure, technical changes can be made for political reasons, we should
>> at least be clear in regards to why particular decisions are being
>> made. I'm supportive of a hard fork for technical reasons but not
>> political ones as are many others.
>
> Well, then we have a point of agreement at least. :)
>
>
> On Wed, Jun 7, 2017 at 5:44 PM, James Hilliard <james.hilliard1 at gmail.com>
> wrote:
>>
>> On Wed, Jun 7, 2017 at 7:20 PM, Jared Lee Richardson <jaredr26 at gmail.com>
>> wrote:
>> >> Not really, there are a few relatively simple techniques such as RBF
>> >> which can be leveraged to get confirmations on on-side before double
>> >> spending on another. Once a transaction is confirmed on the non-BIP148
>> >> chain then the high fee transactions can be made on only the BIP148
>> >> side of the split using RBF.
>> >
>> > Ah, so the BIP148 client handles this on behalf of its less technical
>> > users
>> > on their behalf then, yes?
>> It's not automatic but exchanges will likely handle it on behalf of
>> the less technical users. BIP148 is not intended to cause a permanent
>> chain split however which is why this was not built in.
>> >
>> >>  Exchanges will likely do this splitting
>> >> automatically for uses as well.
>> >
>> > Sure, Exchanges are going to dedicate hundreds of developer hours and
>> > thousands of support hours to support something that they've repeatedly
>> > told
>> > everyone must have replay protection to be supported.  They're going to
>> > do
>> > this because 8% of nodes and <0.5% of miners say they'll be rewarded
>> > richly.
>> > Somehow I find that hard to believe.
>> They are very likely to, most have contingency plans for this sort of
>> thing ready to go due to their experience with the ETH/ETC fork.
>> >
>> > Besides, if the BIP148 client does it for them, they wouldn't have to
>> > dedicate those hundreds of developer hours.  Right?
>> >
>> > I can't imagine how this logic is getting you from where the real data
>> > is to
>> > the assumption that an economic majority will push BIP148 into being
>> > such a
>> > more valuable chain that switching chains will be attractive to enough
>> > miners.  There's got to be some real data that convinces you of this
>> > somewhere?
>> If you're looking for hard numbers at this point you aren't likely to
>> find them because not everything is easy to measure directly.
>> >
>> >> Both are issues, but wipeout risk is different, the ETH/ETC split for
>> >> example didn't have any wipeout risk for either side the same is not
>> >> true for BIP148(and it is the non-BIP148 side that carries the risk of
>> >> chain wipeout).
>> >
>> > Wipeout risk is a serious issue when 45% of the miners support one chain
>> > and
>> > 55% support the other chain.  Segwit doesn't even have 35% of the
>> > miners;
>> > There's no data or statements anywhere that indicate that UASF is going
>> > to
>> > reach the point where wipeout risk is even comparable to abandonment
>> > risk.
>> It's mostly economic support that will dictate this, not hashpower
>> support since the hashpower follows the economy.
>> >
>> >> Yes, miners aren't likely to waste operational mining costs, that's
>> >> ultimately why miners would follow the BIP148 side of the chain
>> >> assuming it has sufficient economic support or if it's more profitable
>> >> to mine.
>> >
>> > To convince miners you would have to have some data SOMEWHERE supporting
>> > the
>> > economic majority argument.  Is there any such data?
>> We'll know more as we get closer to BIP148 activation by looking at the
>> markets.
>> >
>> >> segwit2x has more issues since the HF part requires users to reach
>> >> consensus
>> >
>> > It doesn't have those issues during the segwit activation, ergo there is
>> > no
>> > reason for segwit-activation problems to take priority over the very
>> > real
>> > hardfork activation problems.
>> And yet segwit2x is insisting on activation bundling which needlessly
>> complicates and delays SegWit activation.
>> >
>> >> That's a political reason not a technical reason.
>> >
>> > In a consensus system they are frequently the same, unfortunately.
>> > Technical awesomeness without people agreeing = zero consensus.  So the
>> > choice is either to "technically" break the consensus without a
>> > super-majority and see what happens, or to go with the choice that has
>> > real
>> > data showing the most consensus and hope the tiny minority chain
>> > actually
>> > dies off.
>> Sure, technical changes can be made for political reasons, we should
>> at least be clear in regards to why particular decisions are being
>> made. I'm supportive of a hard fork for technical reasons but not
>> political ones as are many others.
>> >
>> > Jared
>> >
>> > On Wed, Jun 7, 2017 at 5:01 PM, James Hilliard
>> > <james.hilliard1 at gmail.com>
>> > wrote:
>> >>
>> >> On Wed, Jun 7, 2017 at 6:43 PM, Jared Lee Richardson
>> >> <jaredr26 at gmail.com>
>> >> wrote:
>> >> >> BIP148 however is a consensus change that can
>> >> >> be rectified if it gets more work, this would act as an additional
>> >> >> incentive for mine the BIP148 side since there would be no wipeout
>> >> >> risk there.
>> >> >
>> >> > This statement is misleading.  Wipeout risks don't apply to any
>> >> > consensus
>> >> > changes; It is a consensus change, it can only be abandoned.  The
>> >> > BIP148
>> >> > chain carries just as many risks of being abandoned or even more with
>> >> > segwit2x on the table.  No miner would consider "wipeout risk" an
>> >> > advantage
>> >> > when the real threat is chain abandonment.
>> >> Both are issues, but wipeout risk is different, the ETH/ETC split for
>> >> example didn't have any wipeout risk for either side the same is not
>> >> true for BIP148(and it is the non-BIP148 side that carries the risk of
>> >> chain wipeout).
>> >> >
>> >> >> Higher transaction fees on a minority chain can compensate miners
>> >> >> for
>> >> >> a lower price which would likely be enough to get the BIP148 chain
>> >> >> to
>> >> >> a difficulty reduction.
>> >> >
>> >> > Higher transaction fees suffers the same problem as exchange support
>> >> > does.
>> >> > Without replay protection, it is very difficult for any average user
>> >> > to
>> >> > force transactions onto one chain or the other.  Thus, without replay
>> >> > protection, the UASF chain is unlikely to develop any viable fee
>> >> > market;
>> >> > Its
>> >> > few miners 99% of the time will simply choose from the highest fees
>> >> > that
>> >> > were already available to the other chain, which is basically no
>> >> > advantage
>> >> > at all.
>> >> Not really, there are a few relatively simple techniques such as RBF
>> >> which can be leveraged to get confirmations on on-side before double
>> >> spending on another. Once a transaction is confirmed on the non-BIP148
>> >> chain then the high fee transactions can be made on only the BIP148
>> >> side of the split using RBF. Exchanges will likely do this splitting
>> >> automatically for uses as well.
>> >> >
>> >> >>  ETC replay protection was done after the fork on an as
>> >> >> needed basis(there are multiple reliable techniques that can be used
>> >> >> to split UTXO's), the same can happen with BIP148 and it is easier
>> >> >> to
>> >> >> do with Bitcoin than with the ETH/ETC split IMO.
>> >> >
>> >> > ETC replay protection was added because they were already a hardfork
>> >> > and
>> >> > without it they would not have had a viable chain.  BIP148 is not
>> >> > supposed
>> >> > to be a hardfork, and if it added replay protection to remain viable
>> >> > it
>> >> > would lose the frequently touted "wipeout advantage" as well as the
>> >> > ability
>> >> > to call itself a softfork.  And are you seriously suggesting that
>> >> > what
>> >> > happened with ETC and ETH is a desirable and good situation for
>> >> > Bitcoin,
>> >> > and
>> >> > that UASF is ETC?
>> >> There wasn't proper replay protection at split time for ETH/ETC since
>> >> normal transactions would get executed on both sides originally,
>> >> however replay protection was added by wallets(mainly using splitting
>> >> contracts). I don't think a split is desirable however, which is why
>> >> I've proposed this BIP.
>> >> >
>> >> >> A big reason BIP148 still has support is because up until SegWit
>> >> >> actually activates there's no guarantee segwit2mb will actually have
>> >> >> the necessary support to activate SegWit.
>> >> >
>> >> > For a miners blowing through six million dollars a day in mining
>> >> > operational
>> >> > costs, that's a pretty crappy reason.  Serious miners can't afford to
>> >> > prop
>> >> > up a non-viable chain based on philosophy or maybes.  BIP148 is based
>> >> > entirely upon people who aren't putting anything on the line trying
>> >> > to
>> >> > convince others to take the huge risks for them.  With deceptively
>> >> > fallacious logic, in my opinion.
>> >> Yes, miners aren't likely to waste operational mining costs, that's
>> >> ultimately why miners would follow the BIP148 side of the chain
>> >> assuming it has sufficient economic support or if it's more profitable
>> >> to mine.
>> >> >
>> >> > Even segwit2x is based on the assumption that all miners can reach
>> >> > consensus.  Break that assumption and segwit2x will have the same
>> >> > problems
>> >> > as UASF.
>> >> segwit2x has more issues since the HF part requires users to reach
>> >> consensus
>> >> >
>> >> >> This is largely an issue due to segwit2x's bundling, if the SW and
>> >> >> HF
>> >> >> part of segwit2x were unbundled then there would be no reason to
>> >> >> delay
>> >> >> BIP91 activation
>> >> >
>> >> > They are bundled.  Segwit alone doesn't have the desired overwhelming
>> >> > consensus, unless core wishes to fork 71% to 29%, and maybe not even
>> >> > that
>> >> > high.  That's the technical reason, and they can't be unbundled
>> >> > without
>> >> > breaking that consensus.
>> >> That's a political reason not a technical reason.
>> >> >
>> >> > Jared
>> >> >
>> >> >
>> >> > On Wed, Jun 7, 2017 at 4:11 PM, James Hilliard
>> >> > <james.hilliard1 at gmail.com>
>> >> > wrote:
>> >> >>
>> >> >> On Wed, Jun 7, 2017 at 5:53 PM, Jared Lee Richardson
>> >> >> <jaredr26 at gmail.com>
>> >> >> wrote:
>> >> >> >> There are 2 primary factors involved here, economic support and
>> >> >> > hashpower either of which is enough to make a permanent chain
>> >> >> > split
>> >> >> > unlikely, miners will mine whichever chain is most profitable(see
>> >> >> > ETH/ETC hashpower profitability equilibrium for an example of how
>> >> >> > this
>> >> >> > works in practice)
>> >> >> >
>> >> >> > That's not a comparable example.  ETC did not face potentially
>> >> >> > years
>> >> >> > of
>> >> >> > slow
>> >> >> > blocktimes before it normalized, whereas BIP148 is on track to do
>> >> >> > exactly
>> >> >> > that.  Moreover, ETC represented a fundamental break from the
>> >> >> > majority
>> >> >> > consensus that could not be rectified, whereas BIP148 represents
>> >> >> > only
>> >> >> > a
>> >> >> > minority attempt to accelerate something that an overwhelming
>> >> >> > majority
>> >> >> > of
>> >> >> > miners have already agreed to activate under segwit2x.  Lastly ETC
>> >> >> > was
>> >> >> > required to add replay protection, just like any minority fork
>> >> >> > proposed
>> >> >> > by
>> >> >> > any crypto-currency has been, something that BIP148 both lacks and
>> >> >> > refuses
>> >> >> > to add or even acknowledge the necessity of.  Without replay
>> >> >> > protection,
>> >> >> > ETC
>> >> >> > could not have become profitable enough to be a viable minority
>> >> >> > chain.
>> >> >> > If
>> >> >> > BIP148's chain is not the majority chain and it does not have
>> >> >> > replay
>> >> >> > protection, it will face the same problems, but that required
>> >> >> > replay
>> >> >> > protection will turn it into a hardfork.  This will be a very bad
>> >> >> > position
>> >> >> > for UASF supporters to find themselves in - Either hardfork and
>> >> >> > hope
>> >> >> > the
>> >> >> > price is higher and the majority converts, or die as the minority
>> >> >> > chain
>> >> >> > with
>> >> >> > no reliable methods of economic conversion.
>> >> >> Higher transaction fees on a minority chain can compensate miners
>> >> >> for
>> >> >> a lower price which would likely be enough to get the BIP148 chain
>> >> >> to
>> >> >> a difficulty reduction. BIP148 however is a consensus change that
>> >> >> can
>> >> >> be rectified if it gets more work, this would act as an additional
>> >> >> incentive for mine the BIP148 side since there would be no wipeout
>> >> >> risk there. ETC replay protection was done after the fork on an as
>> >> >> needed basis(there are multiple reliable techniques that can be used
>> >> >> to split UTXO's), the same can happen with BIP148 and it is easier
>> >> >> to
>> >> >> do with Bitcoin than with the ETH/ETC split IMO.
>> >> >> >
>> >> >> > I believe, but don't have data to back this, that most of the
>> >> >> > BIP148
>> >> >> > insistence comes not from a legitimate attempt to gain consensus
>> >> >> > (or
>> >> >> > else
>> >> >> > they would either outright oppose segwit2mb for its hardfork, or
>> >> >> > they
>> >> >> > would
>> >> >> > outright support it), but rather from an attempt for BIP148
>> >> >> > supporters
>> >> >> > to
>> >> >> > save face for BIP148 being a failure.  If I'm correct, that's a
>> >> >> > terrible
>> >> >> > and
>> >> >> > highly non-technical reason for segwit2mb to bend over backwards
>> >> >> > attempting
>> >> >> > to support BIP148's attempt to save face.
>> >> >> A big reason BIP148 still has support is because up until SegWit
>> >> >> actually activates there's no guarantee segwit2mb will actually have
>> >> >> the necessary support to activate SegWit.
>> >> >> >
>> >> >> >> The main issue is just one of activation timelines, BIP91 as
>> >> >> > is takes too long to activate unless started ahead of the existing
>> >> >> > segwit2x schedule and it's unlikely that BIP148 will get pushed
>> >> >> > back
>> >> >> > any further.
>> >> >> >
>> >> >> > Even if I'm not correct on the above, I and others find it hard to
>> >> >> > accept
>> >> >> > that this timeline conflict is segwit2x's fault.  Segwit2x has
>> >> >> > both
>> >> >> > some
>> >> >> > flexibility and broad support that crosses contentious pro-segwit
>> >> >> > and
>> >> >> > pro-blocksize-increase divisions that have existed for two years.
>> >> >> > BIP148 is
>> >> >> > attempting to hold segwit2x's timelines and code hostage by
>> >> >> > claiming
>> >> >> > inflexibility and claiming broad support, and not only are neither
>> >> >> > of
>> >> >> > those
>> >> >> > assertions are backed by real data, BIP148 (by being so
>> >> >> > inflexible)
>> >> >> > is
>> >> >> > pushing a position that deepens the divides between those groups.
>> >> >> > For
>> >> >> > there
>> >> >> > to be technical reasons for compatibility (so long as there are
>> >> >> > tradeoffs,
>> >> >> > which there are), there needs to be hard data showing that BIP148
>> >> >> > is
>> >> >> > a
>> >> >> > viable minority fork that won't simply die off on its own.
>> >> >> This is largely an issue due to segwit2x's bundling, if the SW and
>> >> >> HF
>> >> >> part of segwit2x were unbundled then there would be no reason to
>> >> >> delay
>> >> >> BIP91 activation, this is especially a problem since it takes a good
>> >> >> deal of time to properly code and test a HF. Unfortunately segwit2x
>> >> >> has been quite inflexible in regards to the bundling aspect even
>> >> >> though there are clearly no technical reasons for it to be there.
>> >> >> >
>> >> >> > Jared
>> >> >> >
>> >> >> >
>> >> >> > On Wed, Jun 7, 2017 at 3:23 PM, James Hilliard
>> >> >> > <james.hilliard1 at gmail.com>
>> >> >> > wrote:
>> >> >> >>
>> >> >> >> On Wed, Jun 7, 2017 at 4:50 PM, Jared Lee Richardson
>> >> >> >> <jaredr26 at gmail.com>
>> >> >> >> wrote:
>> >> >> >> > Could this risk mitigation measure be an optional flag?  And if
>> >> >> >> > so,
>> >> >> >> > could it+BIP91 signal on a different bit than bit4?
>> >> >> >> It's fairly trivial for miners to signal for BIP91 on bit4 or a
>> >> >> >> different bit at the same time as the code is trivial enough to
>> >> >> >> combine
>> >> >> >> >
>> >> >> >> > The reason being, if for some reason the segwit2x activation
>> >> >> >> > cannot
>> >> >> >> > take place in time, it would be preferable for miners to have a
>> >> >> >> > more
>> >> >> >> > standard approach to activation that requires stronger
>> >> >> >> > consensus
>> >> >> >> > and
>> >> >> >> > may be more forgiving than BIP148.  If the segwit2x activation
>> >> >> >> > is
>> >> >> >> > on
>> >> >> >> > time to cooperate with BIP148, it could be signaled through the
>> >> >> >> > non-bit4 approach and everything could go smoothly.  Thoughts
>> >> >> >> > on
>> >> >> >> > that
>> >> >> >> > idea?  It may add more complexity and more developer time, but
>> >> >> >> > may
>> >> >> >> > also address your concerns among others.
>> >> >> >> This does give miners another approach to activate segwit ahead
>> >> >> >> of
>> >> >> >> BIP148, if segwit2x activation is rolled out and activated
>> >> >> >> immediately
>> >> >> >> then this would not be needed however based on the timeline here
>> >> >> >> https://segwit2x.github.io/ it would not be possible for BIP91 to
>> >> >> >> enforce mandatory signalling ahead of BIP148. Maybe that can be
>> >> >> >> changed though, I've suggested an immediate rollout with a
>> >> >> >> placeholder
>> >> >> >> client timeout instead of the HF code initially in order to
>> >> >> >> accelerate
>> >> >> >> that.
>> >> >> >> >
>> >> >> >> >> Since this BIP
>> >> >> >> >> only activates with a clear miner majority it should not
>> >> >> >> >> increase
>> >> >> >> >> the
>> >> >> >> >> risk of an extended chain split.
>> >> >> >> >
>> >> >> >> > The concern I'm raising is more about the psychology of giving
>> >> >> >> > BIP148
>> >> >> >> > a sense of safety that may not be valid.  Without several more
>> >> >> >> > steps,
>> >> >> >> > BIP148 is definitely on track to be a risky chainsplit, and
>> >> >> >> > without
>> >> >> >> > segwit2x it will almost certainly be a small minority chain.
>> >> >> >> > (Unless
>> >> >> >> > the segwit2x compromise falls apart before then, and even in
>> >> >> >> > that
>> >> >> >> > case
>> >> >> >> > it is likely to be a minority chain)
>> >> >> >> There are 2 primary factors involved here, economic support and
>> >> >> >> hashpower either of which is enough to make a permanent chain
>> >> >> >> split
>> >> >> >> unlikely, miners will mine whichever chain is most profitable(see
>> >> >> >> ETH/ETC hashpower profitability equilibrium for an example of how
>> >> >> >> this
>> >> >> >> works in practice) however there may be lag time immediately
>> >> >> >> after
>> >> >> >> the
>> >> >> >> split if there is an economic majority but not a hashpower
>> >> >> >> majority
>> >> >> >> initially. This is risk mitigation that only requires miners
>> >> >> >> support
>> >> >> >> however. The main issue is just one of activation timelines,
>> >> >> >> BIP91
>> >> >> >> as
>> >> >> >> is takes too long to activate unless started ahead of the
>> >> >> >> existing
>> >> >> >> segwit2x schedule and it's unlikely that BIP148 will get pushed
>> >> >> >> back
>> >> >> >> any further.
>> >> >> >> >
>> >> >> >> > Jared
>> >> >> >> >
>> >> >> >> >
>> >> >> >> > On Wed, Jun 7, 2017 at 2:42 PM, James Hilliard
>> >> >> >> > <james.hilliard1 at gmail.com> wrote:
>> >> >> >> >> I don't really see how this would increase the likelihood of
>> >> >> >> >> an
>> >> >> >> >> extended chain split assuming BIP148 is going to have
>> >> >> >> >> non-insignificant economic backing. This BIP is designed to
>> >> >> >> >> provide
>> >> >> >> >> a
>> >> >> >> >> risk mitigation measure that miners can safely deploy. Since
>> >> >> >> >> this
>> >> >> >> >> BIP
>> >> >> >> >> only activates with a clear miner majority it should not
>> >> >> >> >> increase
>> >> >> >> >> the
>> >> >> >> >> risk of an extended chain split. At this point it is not
>> >> >> >> >> completely
>> >> >> >> >> clear how much economic support there is for BIP148 but
>> >> >> >> >> support
>> >> >> >> >> certainly seems to be growing and we have nearly 2 months
>> >> >> >> >> until
>> >> >> >> >> BIP148
>> >> >> >> >> activation. I intentionally used a shorter activation period
>> >> >> >> >> here
>> >> >> >> >> so
>> >> >> >> >> that decisions by miners can be made close to the BIP148
>> >> >> >> >> activation
>> >> >> >> >> date.
>> >> >> >> >>
>> >> >> >> >> On Wed, Jun 7, 2017 at 4:29 PM, Jared Lee Richardson
>> >> >> >> >> <jaredr26 at gmail.com> wrote:
>> >> >> >> >>> I think this BIP represents a gamble, and the gamble may not
>> >> >> >> >>> be
>> >> >> >> >>> a
>> >> >> >> >>> good
>> >> >> >> >>> one.  The gamble here is that if the segwit2x changes are
>> >> >> >> >>> rolled
>> >> >> >> >>> out
>> >> >> >> >>> on time, and if the signatories accept the bit4 + bit1
>> >> >> >> >>> signaling
>> >> >> >> >>> proposals within BIP91, the launch will go smoother, as
>> >> >> >> >>> intended.
>> >> >> >> >>> But
>> >> >> >> >>> conversely, if either the segwit2x signatories balk about the
>> >> >> >> >>> Bit1
>> >> >> >> >>> signaling OR if the timelines for segwit2mb are missed even
>> >> >> >> >>> by a
>> >> >> >> >>> bit,
>> >> >> >> >>> it may cause the BIP148 chainsplit to be worse than it would
>> >> >> >> >>> be
>> >> >> >> >>> without.  Given the frequent concerns raised in multiple
>> >> >> >> >>> places
>> >> >> >> >>> about
>> >> >> >> >>> the aggressiveness of the segwit2x timelines, including the
>> >> >> >> >>> non-hardfork timelines, this does not seem like a great
>> >> >> >> >>> gamble
>> >> >> >> >>> to
>> >> >> >> >>> be
>> >> >> >> >>> making.
>> >> >> >> >>>
>> >> >> >> >>> The reason I say it may make the chainsplit be worse than it
>> >> >> >> >>> would
>> >> >> >> >>> otherwise be is that it may provide a false sense of safety
>> >> >> >> >>> for
>> >> >> >> >>> BIP148
>> >> >> >> >>> that currently does not currently exist(and should not, as it
>> >> >> >> >>> is
>> >> >> >> >>> a
>> >> >> >> >>> chainsplit).  That sense of safety would only be legitimate
>> >> >> >> >>> if
>> >> >> >> >>> the
>> >> >> >> >>> segwit2x signatories were on board, and the segwit2x code
>> >> >> >> >>> effectively
>> >> >> >> >>> enforced BIP148 simultaneously, neither of which are
>> >> >> >> >>> guaranteed.
>> >> >> >> >>> If
>> >> >> >> >>> users and more miners had a false sense that BIP148 was *not*
>> >> >> >> >>> going
>> >> >> >> >>> to
>> >> >> >> >>> chainsplit from default / segwit2x, they might not follow the
>> >> >> >> >>> news
>> >> >> >> >>> if
>> >> >> >> >>> suddenly the segwit2x plan were delayed for a few days.
>> >> >> >> >>> While
>> >> >> >> >>> any
>> >> >> >> >>> additional support would definitely be cheered on by BIP148
>> >> >> >> >>> supporters, the practical reality might be that this proposal
>> >> >> >> >>> would
>> >> >> >> >>> take BIP148 from the "unlikely to have any viable chain after
>> >> >> >> >>> flag
>> >> >> >> >>> day
>> >> >> >> >>> without segwit2x" category into the "small but viable
>> >> >> >> >>> minority
>> >> >> >> >>> chain"
>> >> >> >> >>> category, and even worse, it might strengthen the chainsplit
>> >> >> >> >>> just
>> >> >> >> >>> days
>> >> >> >> >>> before segwit is activated on BOTH chains, putting the BIP148
>> >> >> >> >>> supporters on the wrong pro-segwit, but still-viable chain.
>> >> >> >> >>>
>> >> >> >> >>> If Core had taken a strong stance to include BIP148 into the
>> >> >> >> >>> client,
>> >> >> >> >>> and if BIP148 support were much much broader, I would feel
>> >> >> >> >>> differently
>> >> >> >> >>> as the gamble would be more likely to discourage a chainsplit
>> >> >> >> >>> (By
>> >> >> >> >>> forcing the acceleration of segwit2x) rather than encourage
>> >> >> >> >>> it
>> >> >> >> >>> (by
>> >> >> >> >>> strengthening an extreme minority chainsplit that may wind up
>> >> >> >> >>> on
>> >> >> >> >>> the
>> >> >> >> >>> wrong side of two segwit-activated chains).  As it stands
>> >> >> >> >>> now,
>> >> >> >> >>> this
>> >> >> >> >>> seems like a very dangerous attempt to compromise with a
>> >> >> >> >>> small
>> >> >> >> >>> but
>> >> >> >> >>> vocal group that are the ones creating the threat to begin
>> >> >> >> >>> with.
>> >> >> >> >>>
>> >> >> >> >>> Jared
>> >> >> >> >>>
>> >> >> >> >>> On Tue, Jun 6, 2017 at 5:56 PM, James Hilliard via
>> >> >> >> >>> bitcoin-dev
>> >> >> >> >>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>> >> >> >> >>>> Due to the proposed calendar(https://segwit2x.github.io/)
>> >> >> >> >>>> for
>> >> >> >> >>>> the
>> >> >> >> >>>> SegWit2x agreement being too slow to activate SegWit
>> >> >> >> >>>> mandatory
>> >> >> >> >>>> signalling ahead of BIP148 using BIP91 I would like to
>> >> >> >> >>>> propose
>> >> >> >> >>>> another
>> >> >> >> >>>> option that miners can use to prevent a chain split ahead of
>> >> >> >> >>>> the
>> >> >> >> >>>> Aug
>> >> >> >> >>>> 1st BIP148 activation date.
>> >> >> >> >>>>
>> >> >> >> >>>> The splitprotection soft fork is essentially BIP91 but using
>> >> >> >> >>>> BIP8
>> >> >> >> >>>> instead of BIP9 with a lower activation threshold and
>> >> >> >> >>>> immediate
>> >> >> >> >>>> mandatory signalling lock-in. This allows for a majority of
>> >> >> >> >>>> miners
>> >> >> >> >>>> to
>> >> >> >> >>>> activate mandatory SegWit signalling and prevent a potential
>> >> >> >> >>>> chain
>> >> >> >> >>>> split ahead of BIP148 activation.
>> >> >> >> >>>>
>> >> >> >> >>>> This BIP allows for miners to respond to market forces
>> >> >> >> >>>> quickly
>> >> >> >> >>>> ahead
>> >> >> >> >>>> of BIP148 activation by signalling for splitprotection. Any
>> >> >> >> >>>> miners
>> >> >> >> >>>> already running BIP148 should be encouraged to use
>> >> >> >> >>>> splitprotection.
>> >> >> >> >>>>
>> >> >> >> >>>> <pre>
>> >> >> >> >>>>   BIP: splitprotection
>> >> >> >> >>>>   Layer: Consensus (soft fork)
>> >> >> >> >>>>   Title: User Activated Soft Fork Split Protection
>> >> >> >> >>>>   Author: James Hilliard <james.hilliard1 at gmail.com>
>> >> >> >> >>>>   Comments-Summary: No comments yet.
>> >> >> >> >>>>   Comments-URI:
>> >> >> >> >>>>   Status: Draft
>> >> >> >> >>>>   Type: Standards Track
>> >> >> >> >>>>   Created: 2017-05-22
>> >> >> >> >>>>   License: BSD-3-Clause
>> >> >> >> >>>>            CC0-1.0
>> >> >> >> >>>> </pre>
>> >> >> >> >>>>
>> >> >> >> >>>> ==Abstract==
>> >> >> >> >>>>
>> >> >> >> >>>> This document specifies a coordination mechanism for a
>> >> >> >> >>>> simple
>> >> >> >> >>>> majority
>> >> >> >> >>>> of miners to prevent a chain split ahead of BIP148
>> >> >> >> >>>> activation.
>> >> >> >> >>>>
>> >> >> >> >>>> ==Definitions==
>> >> >> >> >>>>
>> >> >> >> >>>> "existing segwit deployment" refer to the BIP9 "segwit"
>> >> >> >> >>>> deployment
>> >> >> >> >>>> using bit 1, between November 15th 2016 and November 15th
>> >> >> >> >>>> 2017
>> >> >> >> >>>> to
>> >> >> >> >>>> activate BIP141, BIP143 and BIP147.
>> >> >> >> >>>>
>> >> >> >> >>>> ==Motivation==
>> >> >> >> >>>>
>> >> >> >> >>>> The biggest risk of BIP148 is an extended chain split, this
>> >> >> >> >>>> BIP
>> >> >> >> >>>> provides a way for a simple majority of miners to eliminate
>> >> >> >> >>>> that
>> >> >> >> >>>> risk.
>> >> >> >> >>>>
>> >> >> >> >>>> This BIP provides a way for a simple majority of miners to
>> >> >> >> >>>> coordinate
>> >> >> >> >>>> activation of the existing segwit deployment with less than
>> >> >> >> >>>> 95%
>> >> >> >> >>>> hashpower before BIP148 activation. Due to time constraints
>> >> >> >> >>>> unless
>> >> >> >> >>>> immediately deployed BIP91 will likely not be able to
>> >> >> >> >>>> enforce
>> >> >> >> >>>> mandatory signalling of segwit before the Aug 1st activation
>> >> >> >> >>>> of
>> >> >> >> >>>> BIP148. This BIP provides a method for rapid miner
>> >> >> >> >>>> activation
>> >> >> >> >>>> of
>> >> >> >> >>>> SegWit mandatory signalling ahead of the BIP148 activation
>> >> >> >> >>>> date.
>> >> >> >> >>>> Since
>> >> >> >> >>>> the primary goal of this BIP is to reduce the chance of an
>> >> >> >> >>>> extended
>> >> >> >> >>>> chain split as much as possible we activate using a simple
>> >> >> >> >>>> miner
>> >> >> >> >>>> majority of 65% over a 504 block interval rather than a
>> >> >> >> >>>> higher
>> >> >> >> >>>> percentage. This BIP also allows miners to signal their
>> >> >> >> >>>> intention
>> >> >> >> >>>> to
>> >> >> >> >>>> run BIP148 in order to prevent a chain split.
>> >> >> >> >>>>
>> >> >> >> >>>> ==Specification==
>> >> >> >> >>>>
>> >> >> >> >>>> While this BIP is active, all blocks must set the nVersion
>> >> >> >> >>>> header
>> >> >> >> >>>> top
>> >> >> >> >>>> 3 bits to 001 together with bit field (1<<1) (according to
>> >> >> >> >>>> the
>> >> >> >> >>>> existing segwit deployment). Blocks that do not signal as
>> >> >> >> >>>> required
>> >> >> >> >>>> will be rejected.
>> >> >> >> >>>>
>> >> >> >> >>>> ==Deployment==
>> >> >> >> >>>>
>> >> >> >> >>>> This BIP will be deployed by "version bits" with a 65%(this
>> >> >> >> >>>> can
>> >> >> >> >>>> be
>> >> >> >> >>>> adjusted if desired) activation threshold BIP9 with the name
>> >> >> >> >>>> "splitprotecion" and using bit 2.
>> >> >> >> >>>>
>> >> >> >> >>>> This BIP starts immediately and is a BIP8 style soft fork
>> >> >> >> >>>> since
>> >> >> >> >>>> mandatory signalling will start on midnight August 1st 2017
>> >> >> >> >>>> (epoch
>> >> >> >> >>>> time 1501545600) regardless of whether or not this BIP has
>> >> >> >> >>>> reached
>> >> >> >> >>>> its
>> >> >> >> >>>> own signalling threshold. This BIP will cease to be active
>> >> >> >> >>>> when
>> >> >> >> >>>> segwit
>> >> >> >> >>>> is locked-in.
>> >> >> >> >>>>
>> >> >> >> >>>> === Reference implementation ===
>> >> >> >> >>>>
>> >> >> >> >>>> <pre>
>> >> >> >> >>>> // Check if Segregated Witness is Locked In
>> >> >> >> >>>> bool IsWitnessLockedIn(const CBlockIndex* pindexPrev, const
>> >> >> >> >>>> Consensus::Params& params)
>> >> >> >> >>>> {
>> >> >> >> >>>>     LOCK(cs_main);
>> >> >> >> >>>>     return (VersionBitsState(pindexPrev, params,
>> >> >> >> >>>> Consensus::DEPLOYMENT_SEGWIT, versionbitscache) ==
>> >> >> >> >>>> THRESHOLD_LOCKED_IN);
>> >> >> >> >>>> }
>> >> >> >> >>>>
>> >> >> >> >>>> // SPLITPROTECTION mandatory segwit signalling.
>> >> >> >> >>>> if ( VersionBitsState(pindex->pprev,
>> >> >> >> >>>> chainparams.GetConsensus(),
>> >> >> >> >>>> Consensus::DEPLOYMENT_SPLITPROTECTION, versionbitscache) ==
>> >> >> >> >>>> THRESHOLD_LOCKED_IN &&
>> >> >> >> >>>>      !IsWitnessLockedIn(pindex->pprev,
>> >> >> >> >>>> chainparams.GetConsensus())
>> >> >> >> >>>> &&
>> >> >> >> >>>> // Segwit is not locked in
>> >> >> >> >>>>      !IsWitnessEnabled(pindex->pprev,
>> >> >> >> >>>> chainparams.GetConsensus())
>> >> >> >> >>>> )
>> >> >> >> >>>> //
>> >> >> >> >>>> and is not active.
>> >> >> >> >>>> {
>> >> >> >> >>>>     bool fVersionBits = (pindex->nVersion &
>> >> >> >> >>>> VERSIONBITS_TOP_MASK)
>> >> >> >> >>>> ==
>> >> >> >> >>>> VERSIONBITS_TOP_BITS;
>> >> >> >> >>>>     bool fSegbit = (pindex->nVersion &
>> >> >> >> >>>> VersionBitsMask(chainparams.GetConsensus(),
>> >> >> >> >>>> Consensus::DEPLOYMENT_SEGWIT)) != 0;
>> >> >> >> >>>>     if (!(fVersionBits && fSegbit)) {
>> >> >> >> >>>>         return state.DoS(0, error("ConnectBlock(): relayed
>> >> >> >> >>>> block
>> >> >> >> >>>> must
>> >> >> >> >>>> signal for segwit, please upgrade"), REJECT_INVALID,
>> >> >> >> >>>> "bad-no-segwit");
>> >> >> >> >>>>     }
>> >> >> >> >>>> }
>> >> >> >> >>>>
>> >> >> >> >>>> // BIP148 mandatory segwit signalling.
>> >> >> >> >>>> int64_t nMedianTimePast = pindex->GetMedianTimePast();
>> >> >> >> >>>> if ( (nMedianTimePast >= 1501545600) &&  // Tue 01 Aug 2017
>> >> >> >> >>>> 00:00:00
>> >> >> >> >>>> UTC
>> >> >> >> >>>>      (nMedianTimePast <= 1510704000) &&  // Wed 15 Nov 2017
>> >> >> >> >>>> 00:00:00
>> >> >> >> >>>> UTC
>> >> >> >> >>>>      (!IsWitnessLockedIn(pindex->pprev,
>> >> >> >> >>>> chainparams.GetConsensus())
>> >> >> >> >>>> &&
>> >> >> >> >>>>  // Segwit is not locked in
>> >> >> >> >>>>       !IsWitnessEnabled(pindex->pprev,
>> >> >> >> >>>> chainparams.GetConsensus())) )
>> >> >> >> >>>>  // and is not active.
>> >> >> >> >>>> {
>> >> >> >> >>>>     bool fVersionBits = (pindex->nVersion &
>> >> >> >> >>>> VERSIONBITS_TOP_MASK)
>> >> >> >> >>>> ==
>> >> >> >> >>>> VERSIONBITS_TOP_BITS;
>> >> >> >> >>>>     bool fSegbit = (pindex->nVersion &
>> >> >> >> >>>> VersionBitsMask(chainparams.GetConsensus(),
>> >> >> >> >>>> Consensus::DEPLOYMENT_SEGWIT)) != 0;
>> >> >> >> >>>>     if (!(fVersionBits && fSegbit)) {
>> >> >> >> >>>>         return state.DoS(0, error("ConnectBlock(): relayed
>> >> >> >> >>>> block
>> >> >> >> >>>> must
>> >> >> >> >>>> signal for segwit, please upgrade"), REJECT_INVALID,
>> >> >> >> >>>> "bad-no-segwit");
>> >> >> >> >>>>     }
>> >> >> >> >>>> }
>> >> >> >> >>>> </pre>
>> >> >> >> >>>>
>> >> >> >> >>>>
>> >> >> >> >>>>
>> >> >> >> >>>>
>> >> >> >> >>>>
>> >> >> >> >>>> https://github.com/bitcoin/bitcoin/compare/0.14...jameshilliard:splitprotection-v0.14.1
>> >> >> >> >>>>
>> >> >> >> >>>> ==Backwards Compatibility==
>> >> >> >> >>>>
>> >> >> >> >>>> This deployment is compatible with the existing "segwit" bit
>> >> >> >> >>>> 1
>> >> >> >> >>>> deployment scheduled between midnight November 15th, 2016
>> >> >> >> >>>> and
>> >> >> >> >>>> midnight
>> >> >> >> >>>> November 15th, 2017. This deployment is also compatible with
>> >> >> >> >>>> the
>> >> >> >> >>>> existing BIP148 deployment. This BIP is compatible with
>> >> >> >> >>>> BIP91
>> >> >> >> >>>> only
>> >> >> >> >>>> if
>> >> >> >> >>>> BIP91 activates before it and before BIP148. Miners will
>> >> >> >> >>>> need
>> >> >> >> >>>> to
>> >> >> >> >>>> upgrade their nodes to support splitprotection otherwise
>> >> >> >> >>>> they
>> >> >> >> >>>> may
>> >> >> >> >>>> build on top of an invalid block. While this bip is active
>> >> >> >> >>>> users
>> >> >> >> >>>> should either upgrade to splitprotection or wait for
>> >> >> >> >>>> additional
>> >> >> >> >>>> confirmations when accepting payments.
>> >> >> >> >>>>
>> >> >> >> >>>> ==Rationale==
>> >> >> >> >>>>
>> >> >> >> >>>> Historically we have used IsSuperMajority() to activate soft
>> >> >> >> >>>> forks
>> >> >> >> >>>> such as BIP66 which has a mandatory signalling requirement
>> >> >> >> >>>> for
>> >> >> >> >>>> miners
>> >> >> >> >>>> once activated, this ensures that miners are aware of new
>> >> >> >> >>>> rules
>> >> >> >> >>>> being
>> >> >> >> >>>> enforced. This technique can be leveraged to lower the
>> >> >> >> >>>> signalling
>> >> >> >> >>>> threshold of a soft fork while it is in the process of being
>> >> >> >> >>>> deployed
>> >> >> >> >>>> in a backwards compatible way. We also use a BIP8 style
>> >> >> >> >>>> timeout
>> >> >> >> >>>> to
>> >> >> >> >>>> ensure that this BIP is compatible with BIP148 and that
>> >> >> >> >>>> BIP148
>> >> >> >> >>>> compatible mandatory signalling activates regardless of
>> >> >> >> >>>> miner
>> >> >> >> >>>> signalling levels.
>> >> >> >> >>>>
>> >> >> >> >>>> By orphaning non-signalling blocks during the BIP9 bit 1
>> >> >> >> >>>> "segwit"
>> >> >> >> >>>> deployment, this BIP can cause the existing "segwit"
>> >> >> >> >>>> deployment
>> >> >> >> >>>> to
>> >> >> >> >>>> activate without needing to release a new deployment. As we
>> >> >> >> >>>> approach
>> >> >> >> >>>> BIP148 activation it may be desirable for a majority of
>> >> >> >> >>>> miners
>> >> >> >> >>>> to
>> >> >> >> >>>> have
>> >> >> >> >>>> a method that will ensure that there is no chain split.
>> >> >> >> >>>>
>> >> >> >> >>>> ==References==
>> >> >> >> >>>>
>> >> >> >> >>>>
>> >> >> >> >>>>
>> >> >> >> >>>>
>> >> >> >> >>>>
>> >> >> >> >>>> *[https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-March/013714.html
>> >> >> >> >>>> Mailing list discussion]
>> >> >> >> >>>>
>> >> >> >> >>>>
>> >> >> >> >>>>
>> >> >> >> >>>>
>> >> >> >> >>>> *[https://github.com/bitcoin/bitcoin/blob/v0.6.0/src/main.cpp#L1281-L1283
>> >> >> >> >>>> P2SH flag day activation]
>> >> >> >> >>>> *[[bip-0009.mediawiki|BIP9 Version bits with timeout and
>> >> >> >> >>>> delay]]
>> >> >> >> >>>> *[[bip-0016.mediawiki|BIP16 Pay to Script Hash]]
>> >> >> >> >>>> *[[bip-0091.mediawiki|BIP91 Reduced threshold Segwit MASF]]
>> >> >> >> >>>> *[[bip-0141.mediawiki|BIP141 Segregated Witness (Consensus
>> >> >> >> >>>> layer)]]
>> >> >> >> >>>> *[[bip-0143.mediawiki|BIP143 Transaction Signature
>> >> >> >> >>>> Verification
>> >> >> >> >>>> for
>> >> >> >> >>>> Version 0 Witness Program]]
>> >> >> >> >>>> *[[bip-0147.mediawiki|BIP147 Dealing with dummy stack
>> >> >> >> >>>> element
>> >> >> >> >>>> malleability]]
>> >> >> >> >>>> *[[bip-0148.mediawiki|BIP148 Mandatory activation of segwit
>> >> >> >> >>>> deployment]]
>> >> >> >> >>>> *[[bip-0149.mediawiki|BIP149 Segregated Witness (second
>> >> >> >> >>>> deployment)]]
>> >> >> >> >>>> *[https://bitcoincore.org/en/2016/01/26/segwit-benefits/
>> >> >> >> >>>> Segwit
>> >> >> >> >>>> benefits]
>> >> >> >> >>>>
>> >> >> >> >>>> ==Copyright==
>> >> >> >> >>>>
>> >> >> >> >>>> This document is dual licensed as BSD 3-clause, and Creative
>> >> >> >> >>>> Commons
>> >> >> >> >>>> CC0 1.0 Universal.
>> >> >> >> >>>> _______________________________________________
>> >> >> >> >>>> bitcoin-dev mailing list
>> >> >> >> >>>> bitcoin-dev at lists.linuxfoundation.org
>> >> >> >> >>>>
>> >> >> >> >>>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>> >> >> >
>> >> >> >
>> >> >
>> >> >
>> >
>> >
>
>

From nick at ethereum.org  Thu Jun  8 06:38:48 2017
From: nick at ethereum.org (Nick Johnson)
Date: Thu, 08 Jun 2017 06:38:48 +0000
Subject: [bitcoin-dev] Replay attacks make BIP148 and BIP149 untennable
In-Reply-To: <CACkD=vGQbO830Yi8ZqGnZKjttksgCO=S3M+r1w9c9VHZMEUovw@mail.gmail.com>
References: <31833011-7179-49D1-A07E-8FD9556C4534@taoeffect.com>
	<CAAS2fgSU+UtbJSSAhf0-Sd0GH-RGnZmv+WHWtFV2zHFW2q6_yg@mail.gmail.com>
	<CAFz7pMuQTdUBmOOB7aPrgkDNZvQTn_jfantfLQQVWoerD=D2Kg@mail.gmail.com>
	<F9930B98-BBCC-4B4D-B938-AE2CFB7721AD@taoeffect.com>
	<CAFz7pMvk5acuXRXPiMwo63A=RgdnhFXrMWmED3JLXXP5BPMf6g@mail.gmail.com>
	<CACkD=vGQbO830Yi8ZqGnZKjttksgCO=S3M+r1w9c9VHZMEUovw@mail.gmail.com>
Message-ID: <CAFz7pMs1iwYtda9qx6b9wNFdp4aakUChpDsgJFrW+AGuTLt_+Q@mail.gmail.com>

On Thu, Jun 8, 2017 at 6:44 AM Conner Fromknecht <conner at enigma.co> wrote:

> I don't normally post here, but I'm sorry, if you don't see those two as
> equal, then I think you have misunderstood the *entire* value proposition
> of cryptocurrencies.
>
> The state of any cryptocurrency should entirely (and only) be defined by
> its ledger. If the state of the system can be altered outside of the rules
> governing its ledger, then the system isn't secure.


This is true of any blockchain: you can always change the rules with the
consent of the participants.


> It doesn't matter whether the people making those changes are the ones
> that are leading the project or not. An "irregular state change" is a fancy
> term for a bailout.
>
> I'm sure I speak for more than myself in saying that an "irregular state
> change" is equivalent to modifying the underlying ledger. Let's not let
> semantics keep us from recognizing what actually took place.
>

It's not; modifying the ledger would rewrite history, erasing the record of
the original transactions. That's a fundamentally different operation, both
technically and semantically.


> -Conner
>
> On Wed, Jun 7, 2017 at 14:14 Nick Johnson via bitcoin-dev <
> bitcoin-dev at lists.linuxfoundation.org> wrote:
>
>> On Wed, Jun 7, 2017 at 5:27 PM Tao Effect <contact at taoeffect.com> wrote:
>>
>>> Nick,
>>>
>>> Please don't spread misinformation. Whatever you think of the DAO hard
>>> fork, it's a simple fact that the Ethereum ledger was not edited.
>>>
>>>
>>> This sort of email is unhelpful to this conversation, and it certainly
>>> doesn't help with the perception that Ethereum is nothing but a bunch of
>>> hypocritical Bankers 2.0.
>>>
>>
>>
>>>
>>> Everyone knows you didn't edit Ethereum Classic, but the the hard fork,
>>> which was re-branded as Ethereum, was edited.
>>>
>>
>> That's not what I was suggesting. My point is that the ledger was never
>> edited. An 'irregular state change' was added at a specific block height,
>> but the ledger remains inviolate.
>>
>> I'm sure I don't have to explain the difference between the ledger and
>> the state to you, or why it's significant that the ledger wasn't (and can't
>> be, practically) modified.
>>
>> -Nick
>>
>>
>>> - Greg
>>>
>>> --
>>> Please do not email me anything that you are not comfortable also sharing with
>>> the NSA.
>>>
>>> On Jun 7, 2017, at 6:25 AM, Nick Johnson <nick at ethereum.org> wrote:
>>>
>>> On Wed, Jun 7, 2017 at 12:02 AM Gregory Maxwell via bitcoin-dev <
>>> bitcoin-dev at lists.linuxfoundation.org> wrote:
>>>
>>>> On Tue, Jun 6, 2017 at 10:39 PM, Tao Effect via bitcoin-dev
>>>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>>> > I believe the severity of replay attacks is going unvoiced and is not
>>>> > understood within the bitcoin community because of their lack of
>>>> experience
>>>> > with them.
>>>>
>>>> Please don't insult our community-- the issues with replay were
>>>> pointed out by us to Ethereum in advance and were cited specifically
>>>> in prior hardfork discussions long before Ethereum started editing
>>>> their ledger for the economic benefit of its centralized
>>>> administrators.
>>>
>>>
>>> Please don't spread misinformation. Whatever you think of the DAO hard
>>> fork, it's a simple fact that the Ethereum ledger was not edited.
>>>
>>> -Nick Johnson
>>>
>>>
>>> _______________________________________________
>> bitcoin-dev mailing list
>> bitcoin-dev at lists.linuxfoundation.org
>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170608/dae21829/attachment.html>

From conner at enigma.co  Thu Jun  8 05:44:40 2017
From: conner at enigma.co (Conner Fromknecht)
Date: Thu, 08 Jun 2017 05:44:40 +0000
Subject: [bitcoin-dev] Replay attacks make BIP148 and BIP149 untennable
In-Reply-To: <CAFz7pMvk5acuXRXPiMwo63A=RgdnhFXrMWmED3JLXXP5BPMf6g@mail.gmail.com>
References: <31833011-7179-49D1-A07E-8FD9556C4534@taoeffect.com>
	<CAAS2fgSU+UtbJSSAhf0-Sd0GH-RGnZmv+WHWtFV2zHFW2q6_yg@mail.gmail.com>
	<CAFz7pMuQTdUBmOOB7aPrgkDNZvQTn_jfantfLQQVWoerD=D2Kg@mail.gmail.com>
	<F9930B98-BBCC-4B4D-B938-AE2CFB7721AD@taoeffect.com>
	<CAFz7pMvk5acuXRXPiMwo63A=RgdnhFXrMWmED3JLXXP5BPMf6g@mail.gmail.com>
Message-ID: <CACkD=vGQbO830Yi8ZqGnZKjttksgCO=S3M+r1w9c9VHZMEUovw@mail.gmail.com>

I don't normally post here, but I'm sorry, if you don't see those two as
equal, then I think you have misunderstood the *entire* value proposition
of cryptocurrencies.

The state of any cryptocurrency should entirely (and only) be defined by
its ledger. If the state of the system can be altered outside of the rules
governing its ledger, then the system isn't secure. It doesn't matter
whether the people making those changes are the ones that are leading the
project or not. An "irregular state change" is a fancy term for a bailout.

I'm sure I speak for more than myself in saying that an "irregular state
change" is equivalent to modifying the underlying ledger. Let's not let
semantics keep us from recognizing what actually took place.

-Conner

On Wed, Jun 7, 2017 at 14:14 Nick Johnson via bitcoin-dev <
bitcoin-dev at lists.linuxfoundation.org> wrote:

> On Wed, Jun 7, 2017 at 5:27 PM Tao Effect <contact at taoeffect.com> wrote:
>
>> Nick,
>>
>> Please don't spread misinformation. Whatever you think of the DAO hard
>> fork, it's a simple fact that the Ethereum ledger was not edited.
>>
>>
>> This sort of email is unhelpful to this conversation, and it certainly
>> doesn't help with the perception that Ethereum is nothing but a bunch of
>> hypocritical Bankers 2.0.
>>
>
>
>>
>> Everyone knows you didn't edit Ethereum Classic, but the the hard fork,
>> which was re-branded as Ethereum, was edited.
>>
>
> That's not what I was suggesting. My point is that the ledger was never
> edited. An 'irregular state change' was added at a specific block height,
> but the ledger remains inviolate.
>
> I'm sure I don't have to explain the difference between the ledger and the
> state to you, or why it's significant that the ledger wasn't (and can't be,
> practically) modified.
>
> -Nick
>
>
>> - Greg
>>
>> --
>> Please do not email me anything that you are not comfortable also sharing with
>> the NSA.
>>
>> On Jun 7, 2017, at 6:25 AM, Nick Johnson <nick at ethereum.org> wrote:
>>
>> On Wed, Jun 7, 2017 at 12:02 AM Gregory Maxwell via bitcoin-dev <
>> bitcoin-dev at lists.linuxfoundation.org> wrote:
>>
>>> On Tue, Jun 6, 2017 at 10:39 PM, Tao Effect via bitcoin-dev
>>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>> > I believe the severity of replay attacks is going unvoiced and is not
>>> > understood within the bitcoin community because of their lack of
>>> experience
>>> > with them.
>>>
>>> Please don't insult our community-- the issues with replay were
>>> pointed out by us to Ethereum in advance and were cited specifically
>>> in prior hardfork discussions long before Ethereum started editing
>>> their ledger for the economic benefit of its centralized
>>> administrators.
>>
>>
>> Please don't spread misinformation. Whatever you think of the DAO hard
>> fork, it's a simple fact that the Ethereum ledger was not edited.
>>
>> -Nick Johnson
>>
>>
>> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170608/4a1844b0/attachment-0001.html>

From tomas at tomasvdw.nl  Thu Jun  8 09:50:08 2017
From: tomas at tomasvdw.nl (Tomas)
Date: Thu, 08 Jun 2017 11:50:08 +0200
Subject: [bitcoin-dev] BIP Proposal: Compact Client Side Filtering for
 Light Clients
In-Reply-To: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
References: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
Message-ID: <1496915408.1583369.1002689000.641E8EAB@webmail.messagingengine.com>

On Thu, Jun 1, 2017, at 21:01, Olaoluwa Osuntokun via bitcoin-dev wrote:> Hi y'all, 
> 
> Alex Akselrod and I would like to propose a new light client BIP for
> consideration: 
>    * https://github.com/Roasbeef/bips/blob/master/gcs_light_client.mediawiki> 
> 

Very interesting. 

I would like to consider how this compares to another light client type
with rather different security characteristics where each client would
receive for each transaction in each block,
* The TXID (uncompressed)
* The spent outpoints (with TXIDs compressed)
* The pubkey hash (compressed to reasonable amount of false positives)

A rough estimate would indicate this to be about 2-2.5x as big per block
as your proposal, but comes with rather different security
characteristics, and would not require download since genesis.
The client could verify the TXIDs against the merkle root with a much
stronger (PoW) guarantee compared to the guarantee based on the
assumption of peers being distinct, which your proposal seems to make.
Like your proposal this removes the privacy and processing  issues from
server-side filtering, but unlike your proposal retrieval of all txids
in each block can also serve for a basis of  fraud proofs and
(disprovable) fraud hints, without resorting to full block downloads.
I don't completely understand the benefit of making the outpoints and
pubkey hashes (weakly) verifiable. These only serve as notifications and
therefore do not seem to introduce an attack vector. Omitting data is
always possible, so receiving data is a prerequisite for verification,
not an assumption that can be made.  How could an attacker benefit from
"hiding notifications"?
I think client-side filtering is definitely an important route to
take, but is it worth compressing away the information to verify the
merkle root?
Regards,
Tomas van der Wansem
bitcrust

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170608/132eadaa/attachment.html>

From laolu32 at gmail.com  Fri Jun  9 03:03:51 2017
From: laolu32 at gmail.com (Olaoluwa Osuntokun)
Date: Fri, 09 Jun 2017 03:03:51 +0000
Subject: [bitcoin-dev] BIP Proposal: Compact Client Side Filtering for
 Light Clients
In-Reply-To: <CALJw2w6Vzq8PO3x607=ERK4XKU2vrHApqKP2rWm-sw2r1ZOJMw@mail.gmail.com>
References: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
	<CALJw2w5gUgbdX7XnxPsK2FZ6PZ5cSTgmCEqiPu7-S4gwXBM-_Q@mail.gmail.com>
	<CAE0pnx+RRAP269VeWAcxKbrcS9qX4LS8_6nY_js8X5NtQ22t_A@mail.gmail.com>
	<CAE0pnxLKYnwHnktTqW949s1AA9uK=6WnVYWmRoau8B1SszzYEg@mail.gmail.com>
	<CAE0pnxJxHYQ4+2pt3tt=1WZ0-K0vDxGB4KBXY+R=WfktMmATwA@mail.gmail.com>
	<CAE0pnxK5r2XfVks=emkK=v66XRN5c-Sz-Lm_dKY+6nO=kPk6Vw@mail.gmail.com>
	<CALJw2w6Vzq8PO3x607=ERK4XKU2vrHApqKP2rWm-sw2r1ZOJMw@mail.gmail.com>
Message-ID: <CAO3Pvs-0h=E0ZQmOHcNE9Q+XgJJb7761jz9QxgginMb6+n4ogw@mail.gmail.com>

Karl wrote:

> I am also curious if you have considered digests containing multiple
> blocks. Retaining a permanent binsearchable record of the entire chain is
> obviously too space costly, but keeping the last X blocks as binsearchable
> could speed up syncing for clients tremendously, I feel.

Originally we hadn't considered such an idea. Grasping the concept a bit
better, I can see how that may result in considerable bandwidth savings
(for purely negative queries) for clients doing a historical sync, or
catching up to the chain after being inactive for months/weeks.

If we were to purse tacking this approach onto the current BIP proposal,
we could do it in the following way:

   * The `getcfilter` message gains an additional "Level" field. Using
     this field, the range of blocks to be included in the returned filter
     would be Level^2. So a level of 0 is just the single filter, 3 is 8
     blocks past the block hash etc.

   * Similarly, the `getcfheaders` message would also gain a similar field
     with identical semantics. In this case each "level" would have a
     distinct header chain for clients to verify.

> How fast are these to create? Would it make sense to provide digests on
> demand in some cases, rather than keeping them around indefinitely?

For larger blocks (like the one referenced at the end of this mail) full
construction of the regular filter takes ~10-20ms (most of this spent
extracting the data pushes). With smaller blocks, it quickly dips down to
the nano to micro second range.

Whether to keep _all_ the filters on disk, or to dynamically re-generate a
particular range (possibly most of the historical data) is an
implementation detail. Nodes that already do block pruning could discard
very old filters once the header chain is constructed allowing them to
save additional space, as it's unlikely most clients would care about the
first 300k or so blocks.

> Ahh, so you actually make a separate digest chain with prev hashes and
> everything. Once/if committed digests are soft forked in, it seems a bit
> overkill but maybe it's worth it.

Yep, this is only a hold-over until when/if a commitment to the filter is
soft-forked in. In that case, there could be some extension message to
fetch the filter hash for a particular block, along with a merkle proof of
the coinbase transaction to the merkle root in the header.

> I created digests for all blocks up until block #469805 and actually ended
> up with 5.8 GB, which is 1.1 GB lower than what you have, but may be worse
> perf-wise on false positive rates and such.

Interesting, are you creating the equivalent of both our "regular" and
"extended" filters? Each of the filter types consume about ~3.5GB in
isolation, with the extended filter type on average consuming more bytes
due to the fact that it includes sigScript/witness data as well.

It's worth noting that those numbers includes the fixed 4-byte value for
"N" that's prepended to each filter once it's serialized (though that
doesn't add a considerable amount of overhead).  Alex and I were
considering instead using Bitcoin's var-int encoding for that number
instead. This would result in using a single byte for empty filters, 1
byte for most filters (< 2^16 items), and 3 bytes for the remainder of the
cases.

> For comparison, creating the digests above (469805 of them) took
> roughly 30 mins on my end, but using the kstats format so probably
> higher on an actual node (should get around to profiling that...).

Does that include the time required to read the blocks from disk? Or just
the CPU computation of constructing the filters? I haven't yet kicked off
a full re-index of the filters, but for reference this block[1] on testnet
takes ~18ms for the _full_ indexing routine with our current code+spec.

[1]: 000000000000052184fbe86eff349e31703e4f109b52c7e6fa105cd1588ab6aa

-- Laolu


On Sun, Jun 4, 2017 at 7:18 PM Karl Johan Alm via bitcoin-dev <
bitcoin-dev at lists.linuxfoundation.org> wrote:

> On Sat, Jun 3, 2017 at 2:55 AM, Alex Akselrod via bitcoin-dev
> <bitcoin-dev at lists.linuxfoundation.org> wrote:
> > Without a soft fork, this is the only way for light clients to verify
> that
> > peers aren't lying to them. Clients can request headers (just hashes of
> the
> > filters and the previous headers, creating a chain) and look for
> conflicts
> > between peers. If a conflict is found at a certain block, the client can
> > download the block, generate a filter, calculate the header by hashing
> > together the previous header and the generated filter, and banning any
> peers
> > that don't match. A full node could prune old filters if you wanted and
> > recalculate them as necessary if you just keep the filter header chain
> info
> > as really old filters are unlikely to be requested by correctly written
> > software but you can't guarantee every client will follow best practices
> > either.
>
> Ahh, so you actually make a separate digest chain with prev hashes and
> everything. Once/if committed digests are soft forked in, it seems a
> bit overkill but maybe it's worth it. (I was always assuming committed
> digests in coinbase would come after people started using this, and
> that people could just ask a couple of random peers for the digest
> hash and ensure everyone gave the same answer as the hash of the
> downloaded digest..).
>
> > The simulations are based on completely random data within given
> parameters.
>
> I noticed an increase in FP hits when using real data sampled from
> real scriptPubKeys and such. Address reuse and other weird stuff. See
> "lies.h" in github repo for experiments and chainsim.c initial part of
> main where wallets get random stuff from the chain.
>
> > I will definitely try to reproduce my experiments with Golomb-Coded
> > sets and see what I come up with. It seems like you've got a little
> > less than half the size of my digests for 1-block digests but I
> > haven't tried making digests for all blocks (and lots of early blocks
> > are empty).
> >
> >
> > Filters for empty blocks only take a few bytes and sometimes zero when
> the
> > coinbase output is a burn that doesn't push any data (example will be in
> the
> > test vectors that I'll have ready shortly).
>
> I created digests for all blocks up until block #469805 and actually
> ended up with 5.8 GB, which is 1.1 GB lower than what you have, but
> may be worse perf-wise on false positive rates and such.
>
> > How fast are these to create? Would it make sense to provide digests
> > on demand in some cases, rather than keeping them around indefinitely?
> >
> >
> > They're pretty fast and can be pruned if desired, as mentioned above, as
> > long as the header chain is kept.
>
> For comparison, creating the digests above (469805 of them) took
> roughly 30 mins on my end, but using the kstats format so probably
> higher on an actual node (should get around to profiling that...).
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170609/86813bd3/attachment.html>

From laolu32 at gmail.com  Fri Jun  9 03:42:58 2017
From: laolu32 at gmail.com (Olaoluwa Osuntokun)
Date: Fri, 09 Jun 2017 03:42:58 +0000
Subject: [bitcoin-dev] BIP Proposal: Compact Client Side Filtering for
 Light Clients
In-Reply-To: <CAAS2fgRVTfsfXAyHBoBaCqAXpK+=QCFy-Lx3zH=d3tPteu7GcA@mail.gmail.com>
References: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
	<CAAS2fgRVTfsfXAyHBoBaCqAXpK+=QCFy-Lx3zH=d3tPteu7GcA@mail.gmail.com>
Message-ID: <CAO3Pvs-_0scKqFnT-fE7aDd7gkw+epJkTcQ-jAYZwENsWt8b=A@mail.gmail.com>

Gregory wrote:
> I see the inner loop of construction and lookup are free of
> non-constant divmod. This will result in implementations being
> needlessly slow

Ahh, sipa brought this up other day, but I thought he was referring to the
coding loop (which uses a power of 2 divisor/modulus), not the
siphash-then-reduce loop.

> I believe this can be fixed by using this approach
>
http://lemire.me/blog/2016/06/27/a-fast-alternative-to-the-modulo-reduction/
> which has the same non-uniformity as mod but needs only a multiply and
> shift.

Very cool, I wasn't aware of the existence of such a mapping.

Correct me if I'm wrong, but from my interpretation we can't use that
method as described as we need to output 64-bit integers rather than
32-bit integers. A range of 32-bits would be constrain the number of items
we could encode to be ~4096 to ensure that we don't overflow with fp
values such as 20 (which we currently use in our code).

If filter commitment are to be considered for a soft-fork in the future,
then we should definitely optimize the construction of the filters as much
as possible! I'll look into that paper you referenced to get a feel for
just how complex the optimization would be.

> Shouldn't all cases in your spec where you have N=transactions be
> n=indexed-outputs? Otherwise, I think your golomb parameter and false
> positive rate are wrong.

Yep! Nice catch. Our code is correct, but mistake in the spec was an
oversight on my part. I've pushed a commit[1] to the bip repo referenced
in the OP to fix this error.

I've also pushed another commit to explicitly take advantage of the fact
that P is a power-of-two within the coding loop [2].

-- Laolu

[1]:
https://github.com/Roasbeef/bips/commit/bc5c6d6797f3df1c4a44213963ba12e72122163d
[2]:
https://github.com/Roasbeef/bips/commit/578a4e3aa8ec04524c83bfc5d14be1b2660e7f7a


On Wed, Jun 7, 2017 at 2:41 PM Gregory Maxwell <greg at xiph.org> wrote:

> On Thu, Jun 1, 2017 at 7:01 PM, Olaoluwa Osuntokun via bitcoin-dev
> <bitcoin-dev at lists.linuxfoundation.org> wrote:
> > Hi y'all,
> >
> > Alex Akselrod and I would like to propose a new light client BIP for
> > consideration:
> >    *
> https://github.com/Roasbeef/bips/blob/master/gcs_light_client.mediawiki
>
> I see the inner loop of construction and lookup are free of
> non-constant divmod. This will result in implementations being
> needlessly slow (especially on arm, but even on modern x86_64 a
> division is a 90 cycle-ish affair.)
>
> I believe this can be fixed by using this approach
>
> http://lemire.me/blog/2016/06/27/a-fast-alternative-to-the-modulo-reduction/
>    which has the same non-uniformity as mod but needs only a multiply
> and shift.
>
> Otherwise fast implementations will have to implement the code to
> compute bit twiddling hack exact division code, which is kind of
> complicated. (e.g. via the technique in "{N}-bit Unsigned Division via
> {N}-bit Multiply-Add" by Arch D. Robison).
>
> Shouldn't all cases in your spec where you have N=transactions be
> n=indexed-outputs? Otherwise, I think your golomb parameter and false
> positive rate are wrong.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170609/d244d45b/attachment-0001.html>

From laolu32 at gmail.com  Fri Jun  9 03:50:37 2017
From: laolu32 at gmail.com (Olaoluwa Osuntokun)
Date: Fri, 09 Jun 2017 03:50:37 +0000
Subject: [bitcoin-dev] BIP Proposal: Compact Client Side Filtering for
 Light Clients
In-Reply-To: <1496915408.1583369.1002689000.641E8EAB@webmail.messagingengine.com>
References: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
	<1496915408.1583369.1002689000.641E8EAB@webmail.messagingengine.com>
Message-ID: <CAO3Pvs_0r1xOL9JMSXf7taG-vFcOanPEh7d4nuQKEPSNLZ6kXQ@mail.gmail.com>

Tomas wrote:
> A rough estimate would indicate this to be about 2-2.5x as big per block
> as your proposal, but comes with rather different security
> characteristics, and would not require download since genesis.

Our proposal _doesnt_ require downloading from genesis, if by
"downloading" you mean downloading all the blocks. Clients only need to
sync the block+filter headers, then (if they don't care about historical
blocks), will download filters from their "birthday" onwards.

> The client could verify the TXIDs against the merkle root with a much
> stronger (PoW) guarantee compared to the guarantee based on the assumption
> of peers being distinct, which your proposal seems to make

Our proposal only makes a "one honest peer" assumption, which is the same
as any other operating mode. Also as client still download all the
headers, they're able to verify PoW conformance/work as normal.

> I don't completely understand the benefit of making the outpoints and
> pubkey hashes (weakly) verifiable. These only serve as notifications and
> therefore do not seem to introduce an attack vector.

Not sure what you mean by this. Care to elaborate?

> I think client-side filtering is definitely an important route to take,
> but is it worth compressing away the information to verify the merkle
> root?

That's not the case with our proposal. Clients get the _entire_ block (if
they need it), so they can verify the merkle root as normal. Unless one of
us is misinterpreting the other here.

-- Laolu


On Thu, Jun 8, 2017 at 6:34 AM Tomas via bitcoin-dev <
bitcoin-dev at lists.linuxfoundation.org> wrote:

> On Thu, Jun 1, 2017, at 21:01, Olaoluwa Osuntokun via bitcoin-dev wrote:
>
> Hi y'all,
>
> Alex Akselrod and I would like to propose a new light client BIP for
> consideration:
>    *
> https://github.com/Roasbeef/bips/blob/master/gcs_light_client.mediawiki
>
>
>
> Very interesting.
>
> I would like to consider how this compares to another light client type
> with rather different security characteristics where each client would
> receive for each transaction in each block,
>
> * The TXID (uncompressed)
> * The spent outpoints (with TXIDs compressed)
> * The pubkey hash (compressed to reasonable amount of false positives)
>
> A rough estimate would indicate this to be about 2-2.5x as big per block
> as your proposal, but comes with rather different security characteristics,
> and would not require download since genesis.
>
> The client could verify the TXIDs against the merkle root with a much
> stronger (PoW) guarantee compared to the guarantee based on the assumption
> of peers being distinct, which your proposal seems to make. Like your
> proposal this removes the privacy and processing  issues from server-side
> filtering, but unlike your proposal retrieval of all txids in each block
> can also serve for a basis of fraud proofs and (disprovable) fraud hints,
> without resorting to full block downloads.
>
> I don't completely understand the benefit of making the outpoints and
> pubkey hashes (weakly) verifiable. These only serve as notifications and
> therefore do not seem to introduce an attack vector. Omitting data is
> always possible, so receiving data is a prerequisite for verification, not
> an assumption that can be made.  How could an attacker benefit from "hiding
> notifications"?
>
> I think client-side filtering is definitely an important route to take,
> but is it worth compressing away the information to verify the merkle root?
>
> Regards,
> Tomas van der Wansem
> bitcrust
>
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170609/f95845c2/attachment.html>

From laolu32 at gmail.com  Fri Jun  9 03:59:17 2017
From: laolu32 at gmail.com (Olaoluwa Osuntokun)
Date: Fri, 09 Jun 2017 03:59:17 +0000
Subject: [bitcoin-dev] BIP Proposal: Compact Client Side Filtering for
	Light Clients
In-Reply-To: <CAO3Pvs-nNQR_53_wjS4rPU8W20kePnrSdBvCXMwpaOG7gpUNJQ@mail.gmail.com>
References: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
	<CAO3Pvs-nNQR_53_wjS4rPU8W20kePnrSdBvCXMwpaOG7gpUNJQ@mail.gmail.com>
Message-ID: <CAO3Pvs8-GAwUNZ9Fc7DAb9ZCwP4p5Wh0sD1O0n5NSLVcY2nJtg@mail.gmail.com>

Hi y'all,

Thanks for all the comments so far!

I've pushed a series of updates to the text of the BIP repo linked in the
OP.
The fixes include: typos, components of the specification which were
incorrect
(N is the total number of items, NOT the number of txns in the block), and a
few sections have been clarified.

The latest version also includes a set of test vectors (as CSV files), which
for a series of fp rates (1/2 to 1/2^32) includes (for 6 testnet blocks,
one of
which generates a "null" filter):

   * The block height
   * The block hash
   * The raw block itself
   * The previous basic+extended filter header
   * The basic+extended filter header for the block
   * The basic+extended filter for the block

The size of the test vectors was too large to include in-line within the
document, so we put them temporarily in a distinct folder [1]. The code
used to
generate the test vectors has also been included.

-- Laolu

[1]: https://github.com/Roasbeef/bips/tree/master/gcs_light_client


On Thu, Jun 1, 2017 at 9:49 PM Olaoluwa Osuntokun <laolu32 at gmail.com> wrote:

> > In order to consider the average+median filter sizes in a world worth
> larger
> > blocks, I also ran the index for testnet:
> >
> >     * total size:  2753238530
> >     * total avg:  5918.95736054141
> >     * total median:  60202
> >     * total max:  74983
> >     * regular size:  1165148878
> >     * regular avg:  2504.856172982827
> >     * regular median:  24812
> >     * regular max:  64554
> >     * extended size:  1588089652
> >     * extended avg:  3414.1011875585823
> >     * extended median:  35260
> >     * extended max:  41731
> >
>
> Oops, realized I made a mistake. These are the stats for Feb 2016 until
> about a
> month ago (since height 400k iirc).
>
> -- Laolu
>
>
> On Thu, Jun 1, 2017 at 12:01 PM Olaoluwa Osuntokun <laolu32 at gmail.com>
> wrote:
>
>> Hi y'all,
>>
>> Alex Akselrod and I would like to propose a new light client BIP for
>> consideration:
>>    *
>> https://github.com/Roasbeef/bips/blob/master/gcs_light_client.mediawiki
>>
>> This BIP proposal describes a concrete specification (along with a
>> reference implementations[1][2][3]) for the much discussed client-side
>> filtering reversal of BIP-37. The precise details are described in the
>> BIP, but as a summary: we've implemented a new light-client mode that uses
>> client-side filtering based off of Golomb-Rice coded sets. Full-nodes
>> maintain an additional index of the chain, and serve this compact filter
>> (the index) to light clients which request them. Light clients then fetch
>> these filters, query the locally and _maybe_ fetch the block if a relevant
>> item matches. The cool part is that blocks can be fetched from _any_
>> source, once the light client deems it necessary. Our primary motivation
>> for this work was enabling a light client mode for lnd[4] in order to
>> support a more light-weight back end paving the way for the usage of
>> Lightning on mobile phones and other devices. We've integrated neutrino
>> as a back end for lnd, and will be making the updated code public very
>> soon.
>>
>> One specific area we'd like feedback on is the parameter selection. Unlike
>> BIP-37 which allows clients to dynamically tune their false positive rate,
>> our proposal uses a _fixed_ false-positive. Within the document, it's
>> currently specified as P = 1/2^20. We've done a bit of analysis and
>> optimization attempting to optimize the following sum:
>> filter_download_bandwidth + expected_block_false_positive_bandwidth. Alex
>> has made a JS calculator that allows y'all to explore the affect of
>> tweaking the false positive rate in addition to the following variables:
>> the number of items the wallet is scanning for, the size of the blocks,
>> number of blocks fetched, and the size of the filters themselves. The
>> calculator calculates the expected bandwidth utilization using the CDF of
>> the Geometric Distribution. The calculator can be found here:
>> https://aakselrod.github.io/gcs_calc.html. Alex also has an empirical
>> script he's been running on actual data, and the results seem to match up
>> rather nicely.
>>
>> We we're excited to see that Karl Johan Alm (kallewoof) has done some
>> (rather extensive!) analysis of his own, focusing on a distinct encoding
>> type [5]. I haven't had the time yet to dig into his report yet, but I
>> think I've read enough to extract the key difference in our encodings: his
>> filters use a binomial encoding _directly_ on the filter contents, will we
>> instead create a Golomb-Coded set with the contents being _hashes_ (we use
>> siphash) of the filter items.
>>
>> Using a fixed fp=20, I have some stats detailing the total index size, as
>> well as averages for both mainnet and testnet. For mainnet, using the
>> filter contents as currently described in the BIP (basic + extended), the
>> total size of the index comes out to 6.9GB. The break down is as follows:
>>
>>     * total size:  6976047156
>>     * total avg:  14997.220622758816
>>     * total median:  3801
>>     * total max:  79155
>>     * regular size:  3117183743
>>     * regular avg:  6701.372750217131
>>     * regular median:  1734
>>     * regular max:  67533
>>     * extended size:  3858863413 <(385)%20886-3413>
>>     * extended avg:  8295.847872541684
>>     * extended median:  2041
>>     * extended max:  52508
>>
>> In order to consider the average+median filter sizes in a world worth
>> larger blocks, I also ran the index for testnet:
>>
>>     * total size:  2753238530
>>     * total avg:  5918.95736054141
>>     * total median:  60202
>>     * total max:  74983
>>     * regular size:  1165148878
>>     * regular avg:  2504.856172982827
>>     * regular median:  24812
>>     * regular max:  64554
>>     * extended size:  1588089652
>>     * extended avg:  3414.1011875585823
>>     * extended median:  35260
>>     * extended max:  41731
>>
>> Finally, here are the testnet stats which take into account the increase
>> in the maximum filter size due to segwit's block-size increase. The max
>> filter sizes are a bit larger due to some of the habitual blocks I
>> created last year when testing segwit (transactions with 30k inputs, 30k
>> outputs, etc).
>>
>>      * total size:  585087597
>>      * total avg:  520.8839608674402
>>      * total median:  20
>>      * total max:  164598
>>      * regular size:  299325029
>>      * regular avg:  266.4790836307566
>>      * regular median:  13
>>      * regular max:  164583
>>      * extended size:  285762568
>>      * extended avg:  254.4048772366836
>>      * extended median:  7
>>      * extended max:  127631
>>
>> For those that are interested in the raw data, I've uploaded a CSV file
>> of raw data for each block (mainnet + testnet), which can be found here:
>>      * mainnet: (14MB):
>> https://www.dropbox.com/s/4yk2u8dj06njbuv/mainnet-gcs-stats.csv?dl=0
>>      * testnet: (25MB):
>> https://www.dropbox.com/s/w7dmmcbocnmjfbo/gcs-stats-testnet.csv?dl=0
>>
>>
>> We look forward to getting feedback from all of y'all!
>>
>> -- Laolu
>>
>>
>> [1]: https://github.com/lightninglabs/neutrino
>> [2]: https://github.com/Roasbeef/btcd/tree/segwit-cbf
>> [3]: https://github.com/Roasbeef/btcutil/tree/gcs/gcs
>> [4]: https://github.com/lightningnetwork/lnd/
>>
>> -- Laolu
>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170609/cbb5a93f/attachment-0001.html>

From laolu32 at gmail.com  Fri Jun  9 04:47:19 2017
From: laolu32 at gmail.com (Olaoluwa Osuntokun)
Date: Fri, 09 Jun 2017 04:47:19 +0000
Subject: [bitcoin-dev] BIP Proposal: Compact Client Side Filtering for
 Light Clients
In-Reply-To: <CAO3Pvs-_0scKqFnT-fE7aDd7gkw+epJkTcQ-jAYZwENsWt8b=A@mail.gmail.com>
References: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
	<CAAS2fgRVTfsfXAyHBoBaCqAXpK+=QCFy-Lx3zH=d3tPteu7GcA@mail.gmail.com>
	<CAO3Pvs-_0scKqFnT-fE7aDd7gkw+epJkTcQ-jAYZwENsWt8b=A@mail.gmail.com>
Message-ID: <CAO3Pvs-P2WcNRKGfH_FA7DFNRZOi5H+szO58wBLKA8gVh7mxZQ@mail.gmail.com>

> Correct me if I'm wrong, but from my interpretation we can't use that
> method as described as we need to output 64-bit integers rather than
> 32-bit integers.

Had a chat with gmax off-list and came to the realization that the method
_should_ indeed generalize to our case of outputting 64-bit integers.
We'll need to do a bit of bit twiddling to make it work properly. I'll
modify our implementation and report back with some basic benchmarks.

-- Laolu


On Thu, Jun 8, 2017 at 8:42 PM Olaoluwa Osuntokun <laolu32 at gmail.com> wrote:

> Gregory wrote:
> > I see the inner loop of construction and lookup are free of
> > non-constant divmod. This will result in implementations being
> > needlessly slow
>
> Ahh, sipa brought this up other day, but I thought he was referring to the
> coding loop (which uses a power of 2 divisor/modulus), not the
> siphash-then-reduce loop.
>
> > I believe this can be fixed by using this approach
> >
> http://lemire.me/blog/2016/06/27/a-fast-alternative-to-the-modulo-reduction/
> > which has the same non-uniformity as mod but needs only a multiply and
> > shift.
>
> Very cool, I wasn't aware of the existence of such a mapping.
>
> Correct me if I'm wrong, but from my interpretation we can't use that
> method as described as we need to output 64-bit integers rather than
> 32-bit integers. A range of 32-bits would be constrain the number of items
> we could encode to be ~4096 to ensure that we don't overflow with fp
> values such as 20 (which we currently use in our code).
>
> If filter commitment are to be considered for a soft-fork in the future,
> then we should definitely optimize the construction of the filters as much
> as possible! I'll look into that paper you referenced to get a feel for
> just how complex the optimization would be.
>
> > Shouldn't all cases in your spec where you have N=transactions be
> > n=indexed-outputs? Otherwise, I think your golomb parameter and false
> > positive rate are wrong.
>
> Yep! Nice catch. Our code is correct, but mistake in the spec was an
> oversight on my part. I've pushed a commit[1] to the bip repo referenced
> in the OP to fix this error.
>
> I've also pushed another commit to explicitly take advantage of the fact
> that P is a power-of-two within the coding loop [2].
>
> -- Laolu
>
> [1]:
> https://github.com/Roasbeef/bips/commit/bc5c6d6797f3df1c4a44213963ba12e72122163d
> [2]:
> https://github.com/Roasbeef/bips/commit/578a4e3aa8ec04524c83bfc5d14be1b2660e7f7a
>
>
> On Wed, Jun 7, 2017 at 2:41 PM Gregory Maxwell <greg at xiph.org> wrote:
>
>> On Thu, Jun 1, 2017 at 7:01 PM, Olaoluwa Osuntokun via bitcoin-dev
>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>> > Hi y'all,
>> >
>> > Alex Akselrod and I would like to propose a new light client BIP for
>> > consideration:
>> >    *
>> https://github.com/Roasbeef/bips/blob/master/gcs_light_client.mediawiki
>>
>> I see the inner loop of construction and lookup are free of
>> non-constant divmod. This will result in implementations being
>> needlessly slow (especially on arm, but even on modern x86_64 a
>> division is a 90 cycle-ish affair.)
>>
>> I believe this can be fixed by using this approach
>>
>> http://lemire.me/blog/2016/06/27/a-fast-alternative-to-the-modulo-reduction/
>>    which has the same non-uniformity as mod but needs only a multiply
>> and shift.
>>
>> Otherwise fast implementations will have to implement the code to
>> compute bit twiddling hack exact division code, which is kind of
>> complicated. (e.g. via the technique in "{N}-bit Unsigned Division via
>> {N}-bit Multiply-Add" by Arch D. Robison).
>>
>> Shouldn't all cases in your spec where you have N=transactions be
>> n=indexed-outputs? Otherwise, I think your golomb parameter and false
>> positive rate are wrong.
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170609/68033931/attachment.html>

From jacob.eliosoff at gmail.com  Fri Jun  9 04:40:57 2017
From: jacob.eliosoff at gmail.com (Jacob Eliosoff)
Date: Fri, 9 Jun 2017 00:40:57 -0400
Subject: [bitcoin-dev] The BIP148 chain split may be inevitable
Message-ID: <CAAUaCygRaXNX5xWuka1xrrXwKv1tqevT9-cHd-5mh_AkHpg9gA@mail.gmail.com>

I've been trying to work out the expected interaction between James
Hilliard's BIP91 [1] (or splitprotection [2], or Segwit2x [3], which both
use variants of BIP91 activation) and the BIP148 UASF [4].  Some of this is
subtle so CORRECTIONS WELCOME, but my conclusions are:
1. It's extremely unlikely BIP91-type logic can activate segwit in time to
avoid a BIP148 chain split.
2. So, in practice all we can do is ensure the BIP148 split is as painless
as possible.

REASONING:  First, some dates.  BIP148, whose deadline is already deployed
and thus unlikely to be postponed, starts orphaning non-segwit blocks on
midnight (GMT) the morning of August 1.  Meanwhile, here are Bitcoin's
rough expected next four difficulty adjustment dates (they could vary by
~1-3 days depending on block times, but it's unlikely to matter here):
1. June 17
2. June 30
3. July 13
4. July 27

If Segwit activates on adj date #5 or later (August), it will be too late
to avoid BIP148's split, which will have occurred the moment August began.
So, working backwards, and assuming we want compatibility with old BIP141
nodes:

- Segwit MUST activate by adj #4 (~July 27)
- Therefore segwit MUST be locked in by adj #3 (~July 13: this is
inflexible, since this logic is in already-deployed BIP141 nodes)
- Therefore, I *think* >50% of hashpower needs to be BIP91 miners,
signaling bit 1 and orphaning non-BIP91 (ie, BIP91's bit 4 must activate),
by adj #2 (June 30)?
- Therefore, as currently designed, BIP91 bit 4 must be locked in by adj #1
(June 17)
- Therefore, >=80% of hashrate must start signaling BIP91's bit 4 by a few
days ago...

There are ways parts of this could be sped up, eg, James' "rolling
100-block lock-in periods" [5], to get BIP91 signaling bit 1 sooner.  But
to be compatible with old BIP141 nodes, >50% of hashrate must be activated
BIP91 miners by ~June 30: there's no fudging that.

So, it seems to me that to avoid the BIP148 split, one of two things would
have to happen:
a) 95% of hashrate start signaling bit 1 by ~June 30.  Given current stat
is 32%, this would basically require magic.
b) BIP91 is deployed and >50% (80% or whatever) of hashrate is *activated*
BIP91 miners by ~June 30, ~3 weeks from now.  Again, much too soon.

So, I think the BIP148 split is inevitable.  I actually expect that few
parts of the ecosystem will join the fork, so disruption will be bearable.
But anyway let me know any flaws in the reasoning above.

[1] https://github.com/bitcoin/bips/blob/master/bip-0091.mediawiki
[2]
https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-June/014508.html
[3] https://github.com/btc1/bitcoin/pull/11
[4] https://github.com/bitcoin/bips/blob/master/bip-0148.mediawiki
[5] https://github.com/btc1/bitcoin/pull/6#issuecomment-305917729
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170609/e606bbb0/attachment-0001.html>

From jacob.eliosoff at gmail.com  Fri Jun  9 05:23:17 2017
From: jacob.eliosoff at gmail.com (Jacob Eliosoff)
Date: Fri, 9 Jun 2017 01:23:17 -0400
Subject: [bitcoin-dev] The BIP148 chain split may be inevitable
In-Reply-To: <CAAUaCygRaXNX5xWuka1xrrXwKv1tqevT9-cHd-5mh_AkHpg9gA@mail.gmail.com>
References: <CAAUaCygRaXNX5xWuka1xrrXwKv1tqevT9-cHd-5mh_AkHpg9gA@mail.gmail.com>
Message-ID: <CAAUaCyh_uBcZ7ntbLtOeOAK-6nt2Rx-cxx27QaiXRKkije21AQ@mail.gmail.com>

Ah, two corrections:
1. I meant to include an option c): of course >50% of hashpower running
BIP148 by Aug 1 avoids a split.
2. More seriously, I misrepresented BIP148's logic: it doesn't require
segwit *activation*, just orphans non-segwit-*signaling* (bit 1) blocks
from Aug 1.

I believe that means 80% of hashrate would need to be running BIP91
(signaling bit 4) by ~June 30 (so BIP91 locks in ~July 13, activates ~July
27), not "a few days ago" as I claimed.  So, tight timing, but not
impossible.

Sorry about the errors.


On Fri, Jun 9, 2017 at 12:40 AM, Jacob Eliosoff <jacob.eliosoff at gmail.com>
wrote:

> I've been trying to work out the expected interaction between James
> Hilliard's BIP91 [1] (or splitprotection [2], or Segwit2x [3], which both
> use variants of BIP91 activation) and the BIP148 UASF [4].  Some of this is
> subtle so CORRECTIONS WELCOME, but my conclusions are:
> 1. It's extremely unlikely BIP91-type logic can activate segwit in time to
> avoid a BIP148 chain split.
> 2. So, in practice all we can do is ensure the BIP148 split is as painless
> as possible.
>
> REASONING:  First, some dates.  BIP148, whose deadline is already deployed
> and thus unlikely to be postponed, starts orphaning non-segwit blocks on
> midnight (GMT) the morning of August 1.  Meanwhile, here are Bitcoin's
> rough expected next four difficulty adjustment dates (they could vary by
> ~1-3 days depending on block times, but it's unlikely to matter here):
> 1. June 17
> 2. June 30
> 3. July 13
> 4. July 27
>
> If Segwit activates on adj date #5 or later (August), it will be too late
> to avoid BIP148's split, which will have occurred the moment August began.
> So, working backwards, and assuming we want compatibility with old BIP141
> nodes:
>
> - Segwit MUST activate by adj #4 (~July 27)
> - Therefore segwit MUST be locked in by adj #3 (~July 13: this is
> inflexible, since this logic is in already-deployed BIP141 nodes)
> - Therefore, I *think* >50% of hashpower needs to be BIP91 miners,
> signaling bit 1 and orphaning non-BIP91 (ie, BIP91's bit 4 must activate),
> by adj #2 (June 30)?
> - Therefore, as currently designed, BIP91 bit 4 must be locked in by adj
> #1 (June 17)
> - Therefore, >=80% of hashrate must start signaling BIP91's bit 4 by a few
> days ago...
>
> There are ways parts of this could be sped up, eg, James' "rolling
> 100-block lock-in periods" [5], to get BIP91 signaling bit 1 sooner.  But
> to be compatible with old BIP141 nodes, >50% of hashrate must be activated
> BIP91 miners by ~June 30: there's no fudging that.
>
> So, it seems to me that to avoid the BIP148 split, one of two things would
> have to happen:
> a) 95% of hashrate start signaling bit 1 by ~June 30.  Given current stat
> is 32%, this would basically require magic.
> b) BIP91 is deployed and >50% (80% or whatever) of hashrate is *activated*
> BIP91 miners by ~June 30, ~3 weeks from now.  Again, much too soon.
>
> So, I think the BIP148 split is inevitable.  I actually expect that few
> parts of the ecosystem will join the fork, so disruption will be bearable.
> But anyway let me know any flaws in the reasoning above.
>
> [1] https://github.com/bitcoin/bips/blob/master/bip-0091.mediawiki
> [2] https://lists.linuxfoundation.org/pipermail/bitcoin-dev/
> 2017-June/014508.html
> [3] https://github.com/btc1/bitcoin/pull/11
> [4] https://github.com/bitcoin/bips/blob/master/bip-0148.mediawiki
> [5] https://github.com/btc1/bitcoin/pull/6#issuecomment-305917729
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170609/e004899e/attachment-0001.html>

From tomas at tomasvdw.nl  Fri Jun  9 08:26:52 2017
From: tomas at tomasvdw.nl (Tomas)
Date: Fri, 09 Jun 2017 10:26:52 +0200
Subject: [bitcoin-dev] BIP Proposal: Compact Client Side Filtering for
 Light Clients
In-Reply-To: <CAO3Pvs_0r1xOL9JMSXf7taG-vFcOanPEh7d4nuQKEPSNLZ6kXQ@mail.gmail.com>
References: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
	<1496915408.1583369.1002689000.641E8EAB@webmail.messagingengine.com>
	<CAO3Pvs_0r1xOL9JMSXf7taG-vFcOanPEh7d4nuQKEPSNLZ6kXQ@mail.gmail.com>
Message-ID: <1496996812.1977682.1003827768.27236ACB@webmail.messagingengine.com>


On Fri, Jun 9, 2017, at 05:50, Olaoluwa Osuntokun wrote:
> Tomas wrote:
> > I don't completely understand the benefit of making the outpoints and
> > pubkey hashes (weakly) verifiable. These only serve as notifications and
> > therefore do not seem to introduce an attack vector.
> 
> Not sure what you mean by this. Care to elaborate??
> 

I will rephrase. The BIP reads:

> Additionally, Full nodes can nearly undetectably lie by omission causing a denial of service which can 
lead to undesirable failure modes in applications whose safety
critically relies on responding to certain
on-chain events.

I understand that the compact  header chain is used to mitigate against
this, but I am unsure about the use 
cases and trade-offs.

For a normal wallet, the only thing I can imagine an attacker could do
is pretending a transaction did not confirm 
yet, causing nuisance.  

An application critically depending on knowing what happens on-chain 
surely is better off  downloading 
the TXIDs, providing PoW security? Gaining knowledge of incoming TXIDs
is nicely solved the payment protocol.

Are there enough use cases that critically depend on pub key hashes
being used on-chain, to make the compact header chain worth its costs? 

Regards,
Tomas

From sergio.d.lerner at gmail.com  Fri Jun  9 21:54:00 2017
From: sergio.d.lerner at gmail.com (Sergio Demian Lerner)
Date: Fri, 9 Jun 2017 18:54:00 -0300
Subject: [bitcoin-dev] Drivechain -- Request for Discussion
In-Reply-To: <b04f8c13-9358-303d-2335-f509cafb90a5@gmail.com>
References: <24f2b447-a237-45eb-ef9f-1a62533fad5c@gmail.com>
	<20170522133335.GA17194@fedora-23-dvm>
	<CA+XQW1h22jmwq+qN69UgOhE0LZqmUDpnrmF0ZM-+2ZpoPsTrwQ@mail.gmail.com>
	<20170528210757.GA19450@fedora-23-dvm>
	<b04f8c13-9358-303d-2335-f509cafb90a5@gmail.com>
Message-ID: <CAKzdR-qdk-qw+dy1D0d7rK+4zKDCVf4LA1eQUqgwcTXqL8fp0g@mail.gmail.com>

I'm a bit late to this party. I just want to add that there exists an
hybrid model where both a federation and the miners provide acknowledges
(sometimes known as "votes" in drivechain terms and "multi-signatures" in a
federation) of the sidechain state.

My Drivechain proposal (Feb 2016) was tailored to enable this particular
use-case, which I'm not sure Paul's proposal enable.


The proposal is on this list under the following subject: Drivechain
proposal using OP_COUNT_ACKS

BIP (draft):
https://github.com/rootstock/bips/blob/master/BIP-R10.md

Code & Test cases:
https://github.com/rootstock/bitcoin/tree/op-count-acks_devel

In this proposal, the "poll" time is sidechain-configurable, and I proposed
a few days delay was enough.
Some have said that a longer times are needed, such as 2 months.
So if you want to have a 2 month dalay for sidechain->mainchain transfers
in this code, you still can. However a better dynamic cache of acks/nacks
would be needed. However, for the hybrid use-case, one day is more than
enough.

Regards




On Tue, May 30, 2017 at 2:11 AM, Paul Sztorc via bitcoin-dev <
bitcoin-dev at lists.linuxfoundation.org> wrote:

> Hi Peter,
>
> Responses below.
>
> On 5/28/2017 5:07 PM, Peter Todd wrote:
> > On Mon, May 22, 2017 at 05:30:46PM +0200, Paul Sztorc wrote:
> >> Surprisingly, this requirement (or, more precisely, this incentive) does
> >> not effect miners relative to each other. The incentive to upgrade is
> only
> >> for the purpose of preventing a "theft" -- defined as: an improper
> >> withdrawal from a sidechain. It is not about miner revenues or the
> ability
> >> to mine generally (or conduct BMM specifically). The costs of such a
> theft
> >> (decrease in market price, decrease in future transaction fee levels)
> would
> >> be shared collectively by all future miners. Therefore, it would have no
> >> effect on miners relative to each other.
> >
> > That's not at all true. If I'm a miner with a better capability than
> another
> > miner to prevent that theft, I have reasons to induce it to happen to
> give me
> > political cover to pushing that other miner off the network.
>
> Miners can abstain from 'voting', which is politically neutral. Or, if
> they wish, smaller miners could acquiesce to the coercion and just copy
> the votes of the attacking 51% group. For users who are only running
> Bitcoin Core, there is nothing bad about that.
>
> As you say, a 51% group can arbitrarily start orphaning the blocks that
> are mined by non-member rivals. This _may_ be a problem, or it may not,
> but it is not exacerbated by drivechain.
>
> So, what exactly is "not at all true"?
>
>
> >
> > This is a very similar problem to what we had with zeroconf
> double-spending,
> > where entities such as Coinbase tried to pay off miners to guarantee
> something
> > that wasn't possible in a geninely decrentralized system: safe zeroconf
> > transactions.
>
> I don't see what you mean here. You can't stop Coinbase from donating
> BTC to a subset of miners. That will always be possible, and it has
> nothing to do with drivechain (as I see it).
>
>
> >
> >> Moreover, miners have other recourse if they are unable to run the node.
> >> They can adopt a policy of simply rejecting ("downvoting") any
> withdrawals
> >> that they don't understand. This would pause the withdraw process until
> >> enough miners understand enough of what is going on to proceed with it.
> >
> > Why are you forcing miners to run this code at all?
>
> Could we not say the same thing about the code behind CLTV?
>
> The nature of a contract, is that people are happier to be bound by some
> rules that they themselves construct (for example, a nuclear
> non-proliferation treaty).
>
> In this case, miners prefer sidechains to exist (as existence makes the
> BTC they mine more valuable, and provides additional tx fee revenues),
> and so they would like to run code which makes them possible.
>
>
> >
> > Equally, you're opening up miners to huge political risks, as rejecting
> all
> > withdrawals is preventing users' from getting their money, which gives
> other
> > miners a rational for kicking those miners off of Bitcoin entirely.
>
> As I explained above, miners can abstain from voting, which is
> politically neutral, or else they can delegate their vote to an
> aggressive miner. The "51% can orphan" concern could be raised, even in
> a world without drivechain. All that is required, is for the miners to
> be anonymous, or in private 'dark' pools (and to thereby escape censure).
>
> But there is a much bigger issue here, which is that our threat models
> are different.
>
> As you may know, my threat model [1] does not include miners "pushing
> each other off". It only cares about the miner-experience, to the extent
> that it impacts the user-experience.
>
> Moreover, I reject [2] the premise that we can even measure "miner
> centralization", or even that such a concept exists. If someone has a
> definition of this concept, which is both measurable and useful, I would
> be interested to read it.
>
> ( For what it's worth, Satoshi did not care about this, either. For
> example: "If a greedy attacker is able to assemble more CPU power than
> all the honest nodes, he...ought to find it more profitable to play by
> the rules." which implies robustness to 51% owned by one entity. )
>
> [1] http://www.truthcoin.info/blog/mining-threat-equilibrium/
> [2] http://www.truthcoin.info/blog/mirage-miner-centralization/
>
>
> >
> >> Finally, the point in dispute is a single, infrequent, true/false
> question.
> >> So miners may resort to semi-trusted methods to supplement their
> decision.
> >> In other words, they can just ask people they trust, if the withdrawal
> is
> >> correct or not. It is up to users to decide if they are comfortable with
> >> these risks, if/when they decide to deposit to a sidechain.
> >
> > Why do you think this will be infrequent? Miners with a better ability to
> > validate the drivechain have every reason to make these events more
> frequent.
>
> It is part of the spec. These timing parameters must be agreed upon when
> the sidechain is added, ie _before_ users deposit to the sidechain. Once
> the sidechain is created, the timing is enforced by nodes, the same as
> with any other protocol rules. Miner-validation-ability has no effect on
> the frequency.
>
>
> >
> >> It is a matter of comparing the costs and benefits. Ignoring theft, the
> >> costs are near-zero, and the benefits are >0. Specifically, they are: a
> >> higher BTC price and greater transaction fees. Theft is discouraged by
> >> attempting to tie a theft to a loss of confidence in the miners, as
> >> described in the spec/website.
> >> In general the incentives are very similar to those of Bitcoin itself.
> >
> > This is also a very dubious security model - I would argue that Bitcoin
> is much
> > *more* valuable if miners do everything they can to ensure that
> drivechains
> > fail, given the huge risks involved.
>
> I don't see how. Users are free to ignore the sidechain, so it can only
> benefit them.
>
> Fortunately for you, if that is actually what miners believe, then there
> will be no problem, as miners will just filter out drivechains (so that
> Bitcoin will be "much *more* valuable"), which they can easily do.
>
>
> >                                      I would also argue that users
> should do
> > user-activated-soft-forks to ensure they fail.
>
> Again, I don't think that kind of UASF can succeed, because one option
> strictly dominates the other. But the users get the final say, of course.
>
> Empirically, I have observed overwhelming support for sidechains among
> users, business, and other developers. The btc-investors I spoke to were
> all very excited about the prospect of sidechains, even more so than
> they were excited about SegWit.
>
>
> >
> > By comparison, note Adam Back and my own efforts to ensure miners have a
> > smaller part in the ecosystem, with things like committed (encrypted)
> > transactions and my closed-seal-set/truth-list approach(1). We want to
> involve
> > miners as little as possible in the consensus, not more.
>
> I agree that miners should have as little influence as possible (and
> they probably agree, as well). But a 51% group can filter any message
> they like from the blockchain. For sidechains, there will need to be two
> public networks, so concealment is not an option.
>
> And, I repeat, for regular users of Bitcoin Core, drivechain does not
> make a 51% group more dangerous than they already are.
>
> Moreover, there are cases [1] where miner-involvement can make a big
> _positive_ impact. Just as it can be beneficial (essential, in fact) for
> Bitcoin to filter out harmful interactions among txns (in other words,
> good for miners to filter out double spends), I have discovered
> situations where it is beneficial and essential for miners to filter out
> harmful interactions among multiple chains.
>
> So I think I am actually hitting the "as little as possible" target.
>
> [1] http://www.truthcoin.info/blog/wise-contracts/#wise-contracts
>
>
> >
> > I have to ask: What use-cases do you actually see for drivechains? Why
> can't
>
> Here is a tentative project list:
> http://www.drivechain.info/projects/index.html
>
> And, as I say on the FAQ, "If each individual user is free to sell
> his/her BTC in exchange for an Altcoin (or for fiat), we can hardly deny
> users the opportunity to move their money between two sidechains."
>
> So, in a strong way, the entire altcoin market makes the case for a
> usefulness of sidechains. Bitcoin is a form of money, and only one form
> of money can exist per currency area. So, if Bitcoin is not the winner,
> it will eventually cease to exist altogether. Altcoin-competition is an
> existential threat to Bitcoin, one which is far more relevant than
> anything you've presented so far.
>
> Secondly, one important value of permissionless innovation is that one
> doesn't really know, today, what cool ideas other people are going to
> come up with tomorrow. If you did, they'd be today's ideas.
>
> Third, Core's review process has two opposite problems: on one hand it
> is slow and grueling, and on the other it is fraught with the
> possibility of catastrophic error. It would be better, for everyone, to
> allow people to try their own (non-aggressive) experiments, and to make
> their own mistakes. Already, I have seen the review process abused to
> create/maintain fiefdoms of expertise, so that the abusers can extract
> money from clients/employers/VCs.
>
> Just think of all of the free time you would have, Peter, if you didn't
> have to spend it all reviewing these projects!
>
>
> > those use-cases be done in the much safer client-side validation fashion?
>
> ? How is drivechain _not_ within the category of client-side validation?
> With BMM, validation is only performed by those users ("clients") who
> opt-in to the new features. The economic model of BMM is directly
> comparable to that of Bitcoin's PoW -- the highest-bid chain should be
> the healthiest one.
>
> Can you post the Github link for your most up-to-date client-side
> validation work so that we can compare the safety and other features?
>
> Thanks,
> Paul
>
> >
> > 1) https://petertodd.org/2016/closed-seal-sets-and-truth-
> lists-for-privacy
> >
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170609/a377994a/attachment-0001.html>

From truthcoin at gmail.com  Sat Jun 10 16:28:09 2017
From: truthcoin at gmail.com (Paul Sztorc)
Date: Sat, 10 Jun 2017 12:28:09 -0400
Subject: [bitcoin-dev] Drivechain -- Request for Discussion
In-Reply-To: <CAKzdR-qdk-qw+dy1D0d7rK+4zKDCVf4LA1eQUqgwcTXqL8fp0g@mail.gmail.com>
References: <24f2b447-a237-45eb-ef9f-1a62533fad5c@gmail.com>
	<20170522133335.GA17194@fedora-23-dvm>
	<CA+XQW1h22jmwq+qN69UgOhE0LZqmUDpnrmF0ZM-+2ZpoPsTrwQ@mail.gmail.com>
	<20170528210757.GA19450@fedora-23-dvm>
	<b04f8c13-9358-303d-2335-f509cafb90a5@gmail.com>
	<CAKzdR-qdk-qw+dy1D0d7rK+4zKDCVf4LA1eQUqgwcTXqL8fp0g@mail.gmail.com>
Message-ID: <64177e57-1a30-c8c1-4743-01558b4e2369@gmail.com>

Hi Sergio / everyone,

As some of you may know, Sergio and I each did an implementation of
drivechain. I started working on mine, and he started working on his,
and then I didn't hear from him for awhile about what he was doing.

Anyways, with two versions, we each have an opportunity to double-check
our work. For example, this already happened wrt the "ACK size". Let me
share from his linked BIP:

    "By allowing miners to refer to transaction candidates by
transaction id prefixes, the space consumption for a single ack can be
as low as 2 bytes."

Sergio shared this with me last October at Scaling Milan. After
listening to him, we saw an opportunity to improve our design: now, our
miners can conjecture that miners will grant ACKs in a few simple ways
[always honest, honest+ignore some, ignore all], and it will precompute
these possibilities (guessing what rival miners will do, even before
they find and broadcast a new block). Therefore, in all honest cases,
our ACK-counting now requires zero (0) bytes to be sent over the
network. In dishonest cases it requires only a few bits per sidechain,
because we also maintain a deterministically ordered list, both of
sidechains and withdrawal attempts -- therefore it can just be a string
of binary information. This is not part of consensus, and so can be
further improved over time.

I'm sure there are still a few opportunities for mutual improvements
going forward.

In general, Sergio and I disagree over the withdrawal-frequency. a major
difference of opinion is over the withdrawal-frequency. I view
infrequent withdrawal as essential to the security model, but Sergio
does not. In both our designs, the withdrawal-time is configurable, but
Sergio's design seems to be optimized for cases with frequent withdrawal
attempts, whereas mine is optimized for cases with very infrequent
withdrawal attempts.

Another difference is that, as a direct result of earlier peer review, I
have been integrating 'blind merged mining' into my version. It may be
easy for Sergio to add BMM to his version, or it may not.

It is true that I am not interested in the hybrid model. I would not
make use of the multisig / centralized part, and so for me it
complicates the security properties for no benefit. I see why some
people are interested in it, though.

Paul



On 6/9/2017 5:54 PM, Sergio Demian Lerner wrote:
> I'm a bit late to this party. I just want to add that there exists an
> hybrid model where both a federation and the miners provide acknowledges
> (sometimes known as "votes" in drivechain terms and "multi-signatures"
> in a federation) of the sidechain state.
> 
> My Drivechain proposal (Feb 2016) was tailored to enable this particular
> use-case, which I'm not sure Paul's proposal enable.
> 
> 
> The proposal is on this list under the following subject: Drivechain
> proposal using OP_COUNT_ACKS
> 
> BIP (draft):
> https://github.com/rootstock/bips/blob/master/BIP-R10.md
> <https://github.com/rootstock/bips/blob/master/BIP-R10.md>
> 
> Code & Test cases:
> https://github.com/rootstock/bitcoin/tree/op-count-acks_devel
> <https://github.com/rootstock/bitcoin/tree/op-count-acks_devel>
> 
> In this proposal, the "poll" time is sidechain-configurable, and I
> proposed a few days delay was enough. 
> Some have said that a longer times are needed, such as 2 months.  
> So if you want to have a 2 month dalay for sidechain->mainchain
> transfers in this code, you still can. However a better dynamic cache of
> acks/nacks would be needed. However, for the hybrid use-case, one day is
> more than enough.
> 
> Regards
> 
> 
> 
> 
> On Tue, May 30, 2017 at 2:11 AM, Paul Sztorc via bitcoin-dev
> <bitcoin-dev at lists.linuxfoundation.org
> <mailto:bitcoin-dev at lists.linuxfoundation.org>> wrote:
> 
>     Hi Peter,
> 
>     Responses below.
> 
>     On 5/28/2017 5:07 PM, Peter Todd wrote:
>     > On Mon, May 22, 2017 at 05:30:46PM +0200, Paul Sztorc wrote:
>     >> Surprisingly, this requirement (or, more precisely, this incentive) does
>     >> not effect miners relative to each other. The incentive to upgrade is only
>     >> for the purpose of preventing a "theft" -- defined as: an improper
>     >> withdrawal from a sidechain. It is not about miner revenues or the ability
>     >> to mine generally (or conduct BMM specifically). The costs of such a theft
>     >> (decrease in market price, decrease in future transaction fee levels) would
>     >> be shared collectively by all future miners. Therefore, it would have no
>     >> effect on miners relative to each other.
>     >
>     > That's not at all true. If I'm a miner with a better capability than another
>     > miner to prevent that theft, I have reasons to induce it to happen to give me
>     > political cover to pushing that other miner off the network.
> 
>     Miners can abstain from 'voting', which is politically neutral. Or, if
>     they wish, smaller miners could acquiesce to the coercion and just copy
>     the votes of the attacking 51% group. For users who are only running
>     Bitcoin Core, there is nothing bad about that.
> 
>     As you say, a 51% group can arbitrarily start orphaning the blocks that
>     are mined by non-member rivals. This _may_ be a problem, or it may not,
>     but it is not exacerbated by drivechain.
> 
>     So, what exactly is "not at all true"?
> 
> 
>     >
>     > This is a very similar problem to what we had with zeroconf double-spending,
>     > where entities such as Coinbase tried to pay off miners to guarantee something
>     > that wasn't possible in a geninely decrentralized system: safe zeroconf
>     > transactions.
> 
>     I don't see what you mean here. You can't stop Coinbase from donating
>     BTC to a subset of miners. That will always be possible, and it has
>     nothing to do with drivechain (as I see it).
> 
> 
>     >
>     >> Moreover, miners have other recourse if they are unable to run the node.
>     >> They can adopt a policy of simply rejecting ("downvoting") any withdrawals
>     >> that they don't understand. This would pause the withdraw process until
>     >> enough miners understand enough of what is going on to proceed with it.
>     >
>     > Why are you forcing miners to run this code at all?
> 
>     Could we not say the same thing about the code behind CLTV?
> 
>     The nature of a contract, is that people are happier to be bound by some
>     rules that they themselves construct (for example, a nuclear
>     non-proliferation treaty).
> 
>     In this case, miners prefer sidechains to exist (as existence makes the
>     BTC they mine more valuable, and provides additional tx fee revenues),
>     and so they would like to run code which makes them possible.
> 
> 
>     >
>     > Equally, you're opening up miners to huge political risks, as rejecting all
>     > withdrawals is preventing users' from getting their money, which gives other
>     > miners a rational for kicking those miners off of Bitcoin entirely.
> 
>     As I explained above, miners can abstain from voting, which is
>     politically neutral, or else they can delegate their vote to an
>     aggressive miner. The "51% can orphan" concern could be raised, even in
>     a world without drivechain. All that is required, is for the miners to
>     be anonymous, or in private 'dark' pools (and to thereby escape
>     censure).
> 
>     But there is a much bigger issue here, which is that our threat models
>     are different.
> 
>     As you may know, my threat model [1] does not include miners "pushing
>     each other off". It only cares about the miner-experience, to the extent
>     that it impacts the user-experience.
> 
>     Moreover, I reject [2] the premise that we can even measure "miner
>     centralization", or even that such a concept exists. If someone has a
>     definition of this concept, which is both measurable and useful, I would
>     be interested to read it.
> 
>     ( For what it's worth, Satoshi did not care about this, either. For
>     example: "If a greedy attacker is able to assemble more CPU power than
>     all the honest nodes, he...ought to find it more profitable to play by
>     the rules." which implies robustness to 51% owned by one entity. )
> 
>     [1] http://www.truthcoin.info/blog/mining-threat-equilibrium/
>     <http://www.truthcoin.info/blog/mining-threat-equilibrium/>
>     [2] http://www.truthcoin.info/blog/mirage-miner-centralization/
>     <http://www.truthcoin.info/blog/mirage-miner-centralization/>
> 
> 
>     >
>     >> Finally, the point in dispute is a single, infrequent, true/false question.
>     >> So miners may resort to semi-trusted methods to supplement their decision.
>     >> In other words, they can just ask people they trust, if the withdrawal is
>     >> correct or not. It is up to users to decide if they are comfortable with
>     >> these risks, if/when they decide to deposit to a sidechain.
>     >
>     > Why do you think this will be infrequent? Miners with a better ability to
>     > validate the drivechain have every reason to make these events more frequent.
> 
>     It is part of the spec. These timing parameters must be agreed upon when
>     the sidechain is added, ie _before_ users deposit to the sidechain. Once
>     the sidechain is created, the timing is enforced by nodes, the same as
>     with any other protocol rules. Miner-validation-ability has no effect on
>     the frequency.
> 
> 
>     >
>     >> It is a matter of comparing the costs and benefits. Ignoring theft, the
>     >> costs are near-zero, and the benefits are >0. Specifically, they are: a
>     >> higher BTC price and greater transaction fees. Theft is discouraged by
>     >> attempting to tie a theft to a loss of confidence in the miners, as
>     >> described in the spec/website.
>     >> In general the incentives are very similar to those of Bitcoin itself.
>     >
>     > This is also a very dubious security model - I would argue that Bitcoin is much
>     > *more* valuable if miners do everything they can to ensure that drivechains
>     > fail, given the huge risks involved.
> 
>     I don't see how. Users are free to ignore the sidechain, so it can only
>     benefit them.
> 
>     Fortunately for you, if that is actually what miners believe, then there
>     will be no problem, as miners will just filter out drivechains (so that
>     Bitcoin will be "much *more* valuable"), which they can easily do.
> 
> 
>     >                                      I would also argue that users should do
>     > user-activated-soft-forks to ensure they fail.
> 
>     Again, I don't think that kind of UASF can succeed, because one option
>     strictly dominates the other. But the users get the final say, of
>     course.
> 
>     Empirically, I have observed overwhelming support for sidechains among
>     users, business, and other developers. The btc-investors I spoke to were
>     all very excited about the prospect of sidechains, even more so than
>     they were excited about SegWit.
> 
> 
>     >
>     > By comparison, note Adam Back and my own efforts to ensure miners have a
>     > smaller part in the ecosystem, with things like committed (encrypted)
>     > transactions and my closed-seal-set/truth-list approach(1). We want to involve
>     > miners as little as possible in the consensus, not more.
> 
>     I agree that miners should have as little influence as possible (and
>     they probably agree, as well). But a 51% group can filter any message
>     they like from the blockchain. For sidechains, there will need to be two
>     public networks, so concealment is not an option.
> 
>     And, I repeat, for regular users of Bitcoin Core, drivechain does not
>     make a 51% group more dangerous than they already are.
> 
>     Moreover, there are cases [1] where miner-involvement can make a big
>     _positive_ impact. Just as it can be beneficial (essential, in fact) for
>     Bitcoin to filter out harmful interactions among txns (in other words,
>     good for miners to filter out double spends), I have discovered
>     situations where it is beneficial and essential for miners to filter out
>     harmful interactions among multiple chains.
> 
>     So I think I am actually hitting the "as little as possible" target.
> 
>     [1] http://www.truthcoin.info/blog/wise-contracts/#wise-contracts
>     <http://www.truthcoin.info/blog/wise-contracts/#wise-contracts>
> 
> 
>     >
>     > I have to ask: What use-cases do you actually see for drivechains? Why can't
> 
>     Here is a tentative project list:
>     http://www.drivechain.info/projects/index.html
>     <http://www.drivechain.info/projects/index.html>
> 
>     And, as I say on the FAQ, "If each individual user is free to sell
>     his/her BTC in exchange for an Altcoin (or for fiat), we can hardly deny
>     users the opportunity to move their money between two sidechains."
> 
>     So, in a strong way, the entire altcoin market makes the case for a
>     usefulness of sidechains. Bitcoin is a form of money, and only one form
>     of money can exist per currency area. So, if Bitcoin is not the winner,
>     it will eventually cease to exist altogether. Altcoin-competition is an
>     existential threat to Bitcoin, one which is far more relevant than
>     anything you've presented so far.
> 
>     Secondly, one important value of permissionless innovation is that one
>     doesn't really know, today, what cool ideas other people are going to
>     come up with tomorrow. If you did, they'd be today's ideas.
> 
>     Third, Core's review process has two opposite problems: on one hand it
>     is slow and grueling, and on the other it is fraught with the
>     possibility of catastrophic error. It would be better, for everyone, to
>     allow people to try their own (non-aggressive) experiments, and to make
>     their own mistakes. Already, I have seen the review process abused to
>     create/maintain fiefdoms of expertise, so that the abusers can extract
>     money from clients/employers/VCs.
> 
>     Just think of all of the free time you would have, Peter, if you didn't
>     have to spend it all reviewing these projects!
> 
> 
>     > those use-cases be done in the much safer client-side validation fashion?
> 
>     ? How is drivechain _not_ within the category of client-side validation?
>     With BMM, validation is only performed by those users ("clients") who
>     opt-in to the new features. The economic model of BMM is directly
>     comparable to that of Bitcoin's PoW -- the highest-bid chain should be
>     the healthiest one.
> 
>     Can you post the Github link for your most up-to-date client-side
>     validation work so that we can compare the safety and other features?
> 
>     Thanks,
>     Paul
> 
>     >
>     > 1)
>     https://petertodd.org/2016/closed-seal-sets-and-truth-lists-for-privacy
>     <https://petertodd.org/2016/closed-seal-sets-and-truth-lists-for-privacy>
>     >
>     _______________________________________________
>     bitcoin-dev mailing list
>     bitcoin-dev at lists.linuxfoundation.org
>     <mailto:bitcoin-dev at lists.linuxfoundation.org>
>     https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>     <https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev>
> 
> 

From truthcoin at gmail.com  Sat Jun 10 17:04:10 2017
From: truthcoin at gmail.com (Paul Sztorc)
Date: Sat, 10 Jun 2017 13:04:10 -0400
Subject: [bitcoin-dev] Drivechain RfD -- Follow Up
In-Reply-To: <24f2b447-a237-45eb-ef9f-1a62533fad5c@gmail.com>
References: <24f2b447-a237-45eb-ef9f-1a62533fad5c@gmail.com>
Message-ID: <83671224-f6ff-16a9-81c0-20ab578aec9d@gmail.com>

Hi everyone,

It has been 3 weeks -- responses so far have been really helpful. People
jumped right in, and identified unfinished or missing parts much faster
than I thought they would (ie, ~two days). Very impressive.

Currently, we are working on the sidechain side of blind merged mining.
As you know, most of the Bitcoin cryptosystem is about finding the
longest chain, and displaying information about this chain. CryptAxe is
editing the sidechain code to handle reorganizations in a new way (an
even bigger departure than Namecoin's, imho).

I believe that I have responded to all the on-list objections that were
raised. I will 1st summarize the on-list objections, and 2nd summarize
the off-list discussion (focusing on three key themes).


On-List Objection Summary
---------------------------

In general, they were:

* Peter complained about the resources required for the BMM 'crisis
audit', I pointed out that it is actually optional (and, therefore,
free), and that it doesn't affect miners relative to each other, and
that it can be done in an ultra-cheap semi-trusted way with high
reliability.
* Peter also asked about miner incentives, I replied that it is profit
maximizing to BMM sidechains, because the equation (Tx Fees - Zero Cost)
is always positive.
* ZmnSCPxj asked a long series of clarifying questions, and I responded.
* Tier Nolan complained about my equivocation of the "Bitcoin: no block
subsidy" case and the "sidechain" case. He cites the asymmetry I point
out below (in #2). I replied, and I give an answer below.
* ZmnSCPxj pointed out an error in our OP Code (that we will fix).
* ZmnSCPxj also asked a number of new questions, I responded. Then he
responded again, in general he seemed to raise many of the points
addressed in #1 (below).
* ZmnSCPxj wanted reorg proofs, to punish reorgers, but I pointed out
that if 51% can reorg, they can also filter out the reorg proof. We are
at their mercy in all cases (for better or worse).
* ZmnSCPxj also brought up the fact that a block size limit is necessary
for a fee market, I pointed out that this limit does not need to be
imposed on miners by nodes...miners would be willing-and-able to
self-impose such a limit, as it maximizes their revenues.
* ZmnSCPxj also protested the need to soft fork in each individual
sidechain, I pointed out my strong disagreement ("Unrestrained smart
contract execution will be the death of most of the interesting
applications...[could] destabilize Bitcoin itself") and introduced my
prion metaphor.
* ZmnSCPxj and Tier Nolan both identified the problem solved by our
'ratchet' concept. I explained it to ZmnSCPxj in my reply. We had not
coded it at the time, but there is code for it now [1]. Tier proposed a
rachet design, but I think ours is better (Tier did not find ours at
all, because it is buried in obscure notes, because I didn't think
anyone would make it this far so quickly).
* Tier also advised us on how to fix the problem that ZmnSCPxj had
identified with our NOP earlier.
* Tier also had a number of suggestions about the real-time negotiation
of the OP Bribe amount between nodes and miners. I'm afraid I mostly
ignored these for now, as we aren't there yet.
* Peter complained that ACKing the sidechain could be exploited for
political reasons, and I responded that in such a case, miners are free
to simply avoid ACKing, or to acquiesce to political pressure. Neither
affect the mainchain.
* Peter complained that sidechains might provide some miners with the
opportunity to create a pretext to kick other miners off the network. I
replied that it would not, and I also brought up the fact that my
Bitcoin security model was indifferent to which people happened to be
mining at any given time. I continue to believe that "mining
centralization" does not have a useful definition.
* Peter questioned whether or not sidechains would be useful. I stated
my belief that they would be useful, and linked to my site
(drivechain.info/projects) which contains a number of sidechain
use-cases, and cited my personal anecdotal experiences.
* Peter wanted to involve miners "as little as possible", I pointed out
that I felt that I had indeed done this minimization. My view is that
Peter felt erroneously that it was possible to involve miners less,
because he neglected [1] that a 51% miner group is already involved
maximally, as they can create most messages and filter any message, and
[2] that there are cases where we need miners to filter out harmful
interactions among multiple chains (just as they filter out harmful
interactions among multiple txns [ie, "double spends"]). Peter has not
yet responded to this rebuttal.
* Peter also suggested client-side validation as "safer", and I pointed
out that sidechains+BMM _is_ client-side validation. I asked Peter for
CS-V code, so that we can compare the safety and other features.
* Sergio reminded us of his version of drivechain. Sergio and I disagree
over the emphasis on frequency/speed of withdrawals. Also Sergio
emphasizes a hybrid model, which does not interest me.

If I missed any objections, I hope someone will point them out.


Off-List / Three Points of Ongoing Confusion
---------------------------------------------

Off list, I have repeated the a similar conversation perhaps 6-10 times
over the past week. There is a cluster of remaining objections which
centers around three topics -- speed, theft, and antifragility. I will
reply here, and add the answers to my FAQ (drivechain.info/faq).

1. Speed

This objection is voiced after I point out that side-to-main transfers
("withdrawals") will probably take a long time, for example 5 months
each ( these are customizable parameters, and open for debate -- but if
withdrawals are every x=3 months, and only x=1 withdrawal can make
forward progress [on the mainchain] at a time, and only x=1 prospective
withdrawal can be assembled [by the sidechain] at a time, then we can
expect total withdrawal time to average 4.5 months [(.5)*3+3] ). The
response is something like "won't such a system be too slow, and
therefore unusable?".

Imho, replies of this kind disregard the effect of atomic cross-chain
swaps, which are instant.

( In addition, while side-to-main transfers are slow, main-to-side
transfers are quite fast, x~=10 confirmations. I would go as far as to
say that, just as the Lightning Network is enabled by SegWit and CSV,
Drivechain is enabled by the atomic swaps and of Counterparty-like
embedded consensus. )

Thanks to atomic swaps, someone can act as an investment banker or
custodian, and purchase side:BTC at a (tiny, competitive discount) and
then transfer those side-to-main at a minimal inconvenience (comparable
to that of someone who buys a bank CD). Through market activities, the
_entire system_ becomes exactly as patient as its most-patient members.
As icing on the cake, people who aren't planning on using their BTC
anytime soon (ie "the patient") can even get a tiny investment yield, in
return for providing this service.


2. Security

This objection usually says something like "Aren't you worried that 51%
[hashrate] will steal the coins, given that mining is so centralized
these days?"

The logic of drivechain is to take a known fact -- that miners do not
steal from exchanges (by coordinating to doublespend deposits to those
exchanges) -- and generalize it to a new situation -- that [hopefully]
miners will not steal from sidechains (by coordinating to make 'invalid'
withdrawals from them).

My generalization is slightly problematic, because "a large mainchain
reorg today" would hit the entire Bitcoin system and de-confirm *all* of
the network's transactions, whereas a sidechain-theft would hit only a
small portion of the system. This asymmetry is a problem because of the
1:1 peg, which is explicitly symmetrical -- the thief makes off coins
that are worth _just as much_ as those coins that he did _not_ attack.
The side:BTC are therefore relatively more vulnerable to theft, which
harms the generalization.

As I've just explained, to correct this relative deficiency, we add
extra inconvenience for any sidechain thievery, which is in this case
the long long withdrawal time of several months. (Which is also the main
distinction between DC and extension blocks).

I cannot realistically imagine an erroneous withdrawal persisting for
several weeks, let alone several months. First, over a timeframe of this
duration, there can be no pretense of 'we made an innocent mistake', nor
one that 'it is too inconvenient for us to fix this problem'. This
requires the attacker to be part of an explicitly malicious conspiracy.
Even in the conspiring case, I do not understand how miners would
coordinate the distribution of the eventual "theft" payout, ~3 months
from now -- if new hashrate comes online between now and then, does it
get a portion? -- if today's hashrate closes down, does it get a reduced
portion? -- who decides? I don't think that an algorithm can decide
(without creating a new mechanism, which -I believe- would have to be
powered by ongoing sustainable theft [which is impossible]), because the
withdrawal (ie the "theft") has to be initiated, with a known
destination, *before* it accumulates 3 months worth of acknowledgement.

Even if hashrate were controlled exclusively by one person, such a theft
would obliterate the sidechain-tx-fee revenue from all sidechains, for a
start. It would also greatly reduce the market price of [mainchain] BTC,
I feel, as it ends the sidechain experiment more-or-less permanently.

And even _that_ dire situation can be defeated by UASF-style maneuvers,
such as checkpointing. Even the threat of such maneuvers can be
persuasive enough for them never to be needed (especially over long
timeframes, which make these maneuvers convenient).

A slightly more realistic worst-case scenario is that a monopolist
imposes large fees on side-to-main transfers (which he contrives so that
only he can provide). Unless the monopoly is permanent, market forces
(atomic swaps) will still lower the fee to ultra-competitive levels,
making this mostly pointless.


3. Antifragility

There is an absolutely crucial distinction of "layers", which is often
overlooked. Which is a shame, because its importance really cannot be
understated.

Taleb's concept of antifragility is explicitly fractal -- it has layers,
and an upper layer can only be antifragile if it is composed of
individual members of a lower layer who are each *fragile*. In one of my
videos I give the example of NYC food providers -- it is _because_ the
competition is so brutal, and because each individual NYC
restaurant/supermarket/food-truck is so likely to fail, (and because
there is no safety net to catch them if they do fail), that the
consumer's experience is so positive (in NYC, you can find almost any
kind of food, at any hour of the day, at any price, despite the fact
that a staggering ~15 million people will be eating there each day).

By this, I mean there is an absolutely crucial distinction between:

1. A problem with a sidechain that negatively impacts its parent chain.
2. A problem with a sidechain that only impacts the sidechain users.

The first type of problem is unacceptable, but the second type of
problem is actually _desirable_.

If we wanted to have the best BTC currency unit possible, we would want
everyone to try all kinds of things out, _especially_ the things that we
think are terrible. We'd want lots of things to be tried, and for the
losers to "fail fast".

In practice I highly doubt the sidechain ecosystem would be anywhere
near as dynamic as NYC or Silicon Valley. But certain questions, such as
"What if a sidechain breaks / has DAO-like problems?"; "What if the
sidechain has only a few nodes? Who will run them?"; "Who will maintain
these projects?"; -- really just miss the point, I think.

Ultimately, users can vote with their feet -- if the benefits of a
sidechain outweigh its risks, some users will send some BTC there. It is
a strict improvement over the current situation, where users would need
to use an Altcoin to achieve as much. Users who aren't comfortable with
the risks of new chains / new features, can simply decline to use them.


Another Objection
------------------

Finally, two people raised an objection which I will call the "too
popular" objection or "too big to fail (tbtf)". Something like "what if
a *majority* of BTC is moved to one sidechain, and then that sidechain
has some kind of problem?".

One simple step would be to cap the quantity of BTC that can be moved to
each sidechain, (at x=10% ? aka 210,000).

Other than that, I would point out that Bitcoin has always been the
"money of principle", and that we survived the MtGox announcement (in
which ~850,000/12,400,000 = 6.85% of the total BTC were assumed to be
stolen).

I look forward to the continued feedback! Thank you all very much!

Paul

[1]
https://github.com/drivechain-project/bitcoin/commit/c4beef5c2aa8e52d2c1e11de7c044528bbde6c60


On 5/22/2017 2:17 AM, Paul Sztorc wrote:
> Dear list,
> 
> I've been working on "drivechain", a sidechain enabling technology, for
> some time.
> 
> * The technical info site is here: www.drivechain.info
> * The changes to Bitcoin are here:
> https://github.com/drivechain-project/bitcoin/tree/mainchainBMM
> * A Blank sidechain template is here:
> https://github.com/drivechain-project/bitcoin/tree/sidechainBMM
> 
> As many of you know, I've been seeking feedback in person, at various
> conferences and meetups over the past year, most prominently Scaling
> Milan. And I intend to continue to seek feedback at Consensus2017 this
> week, so if you are in NYC please just walk up and start talking to me!
> 
> But I also wanted to ask the list for feedback. Initially, I was
> hesitant because I try not to consume reviewers' scarce time until the
> author has put in a serious effort. However, I may have waiting too
> long, as today it is actually quite close to a working release.
> 
> 
> Scaling Implications
> ---------------------
> 
> This upgrade would have significant scaling implications. Since it is
> the case that sidechains can be added by soft fork, and since each of
> these chains will have its own blockspace, this theoretically removes
> the blocksize limit from "the Bitcoin system" (if one includes
> sidechains as part of such a system). People who want a LargeBlock
> bitcoin can just move their BTC over to such a network [1], and their
> txns will have no longer have an impact on "Bitcoin Core". Thus, even
> though this upgrade does not actually increase "scalability" per se, it
> may in fact put an end to the scalability debate...forever.
> 
> This work includes the relatively new concept of "Blind Merged Mining"
> [2] which I developed in January to allow SHA256^2 miners to merge-mine
> these "drivechains", even if these miners aren't running the actual
> sidechain software. The goal is to prevent sidechains from affecting the
> levelness of the mining "playing field". BMM is conceptually similar to
> ZooKeeV [3] which Peter Todd sketched out in mid-2013. BMM is not
> required for drivechain, but it would address some of the last remaining
> concerns.
> 
> 
> Total Transaction Fees in the Far Future
> -----------------------------------------
> 
> Some people feel that a maximum blocksize limit is needed to ensure that
> future total equilibrium transaction fees are non-negligible. I
> presented [4] on why I don't agree, 8 months ago. The reviewers I spoke
> to over the last year have stopped bringing this complaint up, but I am
> not sure everyone feels that way.
> 
> 
> Juxtaposition with a recent "Scaling Compromise"
> -------------------------------------------------
> 
> Recently, a scalability proposal began to circulate on social media. As
> far as I could tell, it goes something like "immediately activate
> SegWit, and then HF to double the nonwitness blockspace to 2MB within 12
> months". But such a proposal is quite meager, compared to a "LargeBlock
> Drivechain". The drivechain is better on both fronts, as it would not
> require a hardfork, and could *almost immediately* add _any_ amount of
> extra blockspace (specifically, I might expect a BIP101-like LargeBlock
> chain that has an 8 MB maxblocksize, which doubles every two years).
> 
> In other words, I don't know why anyone would support that proposal over
> mine. The only reasons would be either ignorance (ie, unfamiliarity with
> drivechain) or because there are still nagging unspoken complaints about
> drivechain which I apparently need to hear and address.
> 
> 
> Other Thoughts
> ---------------
> 
> Unfortunately, anyone who worked on the "first generation" of sidechain
> technology (the skiplist) or the "second generation" (federated /
> Liquid), will find that this is very different.
> 
> I will admit that I am very pessimistic about any conversation that
> involves scalability. It is often said that "talking politics lowers
> your IQ by 25 points". Bitcoin scalability conversations seem to drain
> 50 points. (Instead of conversing, I think people should quietly work on
> whatever they are passionate about until their problem either is solved,
> or it goes away for some other reason, or until we all agree to just
> stop talking about it.)
> 
> Cheers,
> Paul
> 
> [1] http://www.drivechain.info/faq/#can-sidechains-really-help-with-scaling
> [2] http://www.truthcoin.info/blog/blind-merged-mining/
> [3] https://s3.amazonaws.com/peter.todd/bitcoin-wizards-13-10-17.log
> [4]
> https://www.youtube.com/watch?v=YErLEuOi3xU&list=PLw8-6ARlyVciNjgS_NFhAu-qt7HPf_dtg&index=4
> 

From jacob.eliosoff at gmail.com  Sat Jun 10 18:04:32 2017
From: jacob.eliosoff at gmail.com (Jacob Eliosoff)
Date: Sat, 10 Jun 2017 14:04:32 -0400
Subject: [bitcoin-dev] The BIP148 chain split may be inevitable
In-Reply-To: <CAAUaCyh_uBcZ7ntbLtOeOAK-6nt2Rx-cxx27QaiXRKkije21AQ@mail.gmail.com>
References: <CAAUaCygRaXNX5xWuka1xrrXwKv1tqevT9-cHd-5mh_AkHpg9gA@mail.gmail.com>
	<CAAUaCyh_uBcZ7ntbLtOeOAK-6nt2Rx-cxx27QaiXRKkije21AQ@mail.gmail.com>
Message-ID: <CAAUaCyiwnspvJ9HY41GK8tMsA4ezpFPR1Ka9upik6UwsYBASnQ@mail.gmail.com>

Just a quick follow-up on BIP91's prospects of avoiding a BIP148 chain
split, because I may have left an overly pessimistic impression -

In short: the timing isn't as dire as I suggested, BUT unless concrete
progress on a plan starts taking shape, esp miner support, *the split is
indeed coming.*

THE GOOD NEWS: several refinements have been noted which could get BIP91
(or splitprotection, Segwit2x, etc) deployed faster:
- The lock-in window could be shortened, eg to splitprotection's 504 blocks
(3.5 days)
- Of course the 80% threshold could just be reduced, eg to
splitprotection's 65%
- BIP91 nodes could start signaling on bit 1 the moment bit 4 reaches
lock-in, rather than waiting another period until it  "activates".
 (Orphaning of non-bit-1-signaling blocks would probably also have to start
at or shortly after the same time [1].)

Combining these approaches, *July 26* is an approximate hard deadline for
>50% of miners to be running BIP91 in order to prevent the split.  So,
significantly less tight than my previous June 30 (or my original,
erroneous "a few days ago").

THE BAD NEWS: no one should underestimate the steps that would need to be
completed by that deadline:
1. Coordinate on a solution (BIP91, splitprotection, Segwit2x, BIP148
itself, ...)
2. Implement and test it
3. Convince >50% of miners to run it [2]
4. Miners upgrade to the new software and begin signaling

In particular, #3: afaict a lot of convincing is still needed before miner
support for any of these reaches anything like 50%.  (With the exception of
Segwit2x, but it has the additional handicap that it probably needs to
include deployable hard fork code, obviously ambitious in 1.5 months.)


[1] See Saicere's comment:
https://github.com/btc1/bitcoin/pull/11#discussion_r121086886, and related
discussion at https://github.com/btc1/bitcoin/pull/11#issuecomment-307330011
.

[2] Note that >50% need to run the *solution*, eg BIP91; old BIP141 nodes
signaling segwit support do *not* count, since they won't orphan non-bit-1
blocks.  The impending split isn't between nodes that support segwit vs
don't, but between those that reject non-segwit-supporting blocks vs don't.


On Fri, Jun 9, 2017 at 1:23 AM, Jacob Eliosoff <jacob.eliosoff at gmail.com>
wrote:

> Ah, two corrections:
> 1. I meant to include an option c): of course >50% of hashpower running
> BIP148 by Aug 1 avoids a split.
> 2. More seriously, I misrepresented BIP148's logic: it doesn't require
> segwit *activation*, just orphans non-segwit-*signaling* (bit 1) blocks
> from Aug 1.
>
> I believe that means 80% of hashrate would need to be running BIP91
> (signaling bit 4) by ~June 30 (so BIP91 locks in ~July 13, activates ~July
> 27), not "a few days ago" as I claimed.  So, tight timing, but not
> impossible.
>
> Sorry about the errors.
>
>
> On Fri, Jun 9, 2017 at 12:40 AM, Jacob Eliosoff <jacob.eliosoff at gmail.com>
> wrote:
>
>> I've been trying to work out the expected interaction between James
>> Hilliard's BIP91 [1] (or splitprotection [2], or Segwit2x [3], which both
>> use variants of BIP91 activation) and the BIP148 UASF [4].  Some of this is
>> subtle so CORRECTIONS WELCOME, but my conclusions are:
>> 1. It's extremely unlikely BIP91-type logic can activate segwit in time
>> to avoid a BIP148 chain split.
>> 2. So, in practice all we can do is ensure the BIP148 split is as
>> painless as possible.
>>
>> REASONING:  First, some dates.  BIP148, whose deadline is already
>> deployed and thus unlikely to be postponed, starts orphaning non-segwit
>> blocks on midnight (GMT) the morning of August 1.  Meanwhile, here are
>> Bitcoin's rough expected next four difficulty adjustment dates (they could
>> vary by ~1-3 days depending on block times, but it's unlikely to matter
>> here):
>> 1. June 17
>> 2. June 30
>> 3. July 13
>> 4. July 27
>>
>> If Segwit activates on adj date #5 or later (August), it will be too late
>> to avoid BIP148's split, which will have occurred the moment August began.
>> So, working backwards, and assuming we want compatibility with old BIP141
>> nodes:
>>
>> - Segwit MUST activate by adj #4 (~July 27)
>> - Therefore segwit MUST be locked in by adj #3 (~July 13: this is
>> inflexible, since this logic is in already-deployed BIP141 nodes)
>> - Therefore, I *think* >50% of hashpower needs to be BIP91 miners,
>> signaling bit 1 and orphaning non-BIP91 (ie, BIP91's bit 4 must activate),
>> by adj #2 (June 30)?
>> - Therefore, as currently designed, BIP91 bit 4 must be locked in by adj
>> #1 (June 17)
>> - Therefore, >=80% of hashrate must start signaling BIP91's bit 4 by a
>> few days ago...
>>
>> There are ways parts of this could be sped up, eg, James' "rolling
>> 100-block lock-in periods" [5], to get BIP91 signaling bit 1 sooner.  But
>> to be compatible with old BIP141 nodes, >50% of hashrate must be activated
>> BIP91 miners by ~June 30: there's no fudging that.
>>
>> So, it seems to me that to avoid the BIP148 split, one of two things
>> would have to happen:
>> a) 95% of hashrate start signaling bit 1 by ~June 30.  Given current stat
>> is 32%, this would basically require magic.
>> b) BIP91 is deployed and >50% (80% or whatever) of hashrate is
>> *activated* BIP91 miners by ~June 30, ~3 weeks from now.  Again, much too
>> soon.
>>
>> So, I think the BIP148 split is inevitable.  I actually expect that few
>> parts of the ecosystem will join the fork, so disruption will be bearable.
>> But anyway let me know any flaws in the reasoning above.
>>
>> [1] https://github.com/bitcoin/bips/blob/master/bip-0091.mediawiki
>> [2] https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017
>> -June/014508.html
>> [3] https://github.com/btc1/bitcoin/pull/11
>> [4] https://github.com/bitcoin/bips/blob/master/bip-0148.mediawiki
>> [5] https://github.com/btc1/bitcoin/pull/6#issuecomment-305917729
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170610/8122eddf/attachment.html>

From bitcoin-dev at rgrant.org  Sun Jun 11 05:48:39 2017
From: bitcoin-dev at rgrant.org (Ryan Grant)
Date: Sun, 11 Jun 2017 01:48:39 -0400
Subject: [bitcoin-dev] BIP149 timeout-- why so far in the future?
In-Reply-To: <87inkn14gq.fsf@rustcorp.com.au>
References: <CAAS2fgQNPvEuta0KubeDetgYxGhWvdGK10jig0y4ayv0EvZPLw@mail.gmail.com>
	<87r2ze2833.fsf@rustcorp.com.au>
	<63d03825-da9b-328d-56b8-0d062f3e0c62@mattcorallo.com>
	<87inkn14gq.fsf@rustcorp.com.au>
Message-ID: <CAMnpzfqqmTFkf_HKPb18ijm-bYja_MpRofBYNXd3TkqVLsJhNw@mail.gmail.com>

Is there any reason that BIP149 activation on November 16th would
cause a problem?

From jtimon at jtimon.cc  Sun Jun 11 13:17:43 2017
From: jtimon at jtimon.cc (=?UTF-8?B?Sm9yZ2UgVGltw7Nu?=)
Date: Sun, 11 Jun 2017 15:17:43 +0200
Subject: [bitcoin-dev] BIP149 timeout-- why so far in the future?
In-Reply-To: <CAMnpzfqqmTFkf_HKPb18ijm-bYja_MpRofBYNXd3TkqVLsJhNw@mail.gmail.com>
References: <CAAS2fgQNPvEuta0KubeDetgYxGhWvdGK10jig0y4ayv0EvZPLw@mail.gmail.com>
	<87r2ze2833.fsf@rustcorp.com.au>
	<63d03825-da9b-328d-56b8-0d062f3e0c62@mattcorallo.com>
	<87inkn14gq.fsf@rustcorp.com.au>
	<CAMnpzfqqmTFkf_HKPb18ijm-bYja_MpRofBYNXd3TkqVLsJhNw@mail.gmail.com>
Message-ID: <CABm2gDqr=SHgva4H1sBtW_k8-5RxupSzq+zanmz21e=X2P=6Gg@mail.gmail.com>

The current proposal assumes that bip149 would only be merged and
released after nov15, so there's not time in one day.

My preference would be a bip149 proposal that could be merged and
released now, but some people complain that would require more
testing, because if you deploy bip149 and then sw gets activated pre
nov15, then you want bip149 nodes to use the old service bit for
segwit, not the new one (you would use that one if it activates post
nov15, so that pre-bip149 nodes don't get confused).

I was slowly modifying shaolinfry's code to try to code that, but I'm
currently not working on it because there doesn't seem there's a lot
of interest in releasing bip149 before nov15...

https://github.com/jtimon/bitcoin/commits/b15-shaolinfry-bip149


On Sun, Jun 11, 2017 at 7:48 AM, Ryan Grant via bitcoin-dev
<bitcoin-dev at lists.linuxfoundation.org> wrote:
> Is there any reason that BIP149 activation on November 16th would
> cause a problem?
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev

From martijn.meijering at mevs.nl  Sun Jun 11 13:44:17 2017
From: martijn.meijering at mevs.nl (Martijn Meijering)
Date: Sun, 11 Jun 2017 15:44:17 +0200
Subject: [bitcoin-dev]  BIP149 timeout-- why so far in the future?
Message-ID: <CAODYVYc7x-C5nLxtTHYh9iJuCgv0B7XADCS7DeSW8O8VMuGvbQ@mail.gmail.com>

Jorge Tim?n wrote:

"My preference would be a bip149 proposal that could be merged and
released now, but some people complain that would require more
testing, because *if you deploy bip149 and then sw gets activated pre
nov15, then you want bip149 nodes to use the old service bit for
segwit*, not the new one (you would use that one if it activates post
nov15, so that pre-bip149 nodes don't get confused)."
(emphasis added)

Why not just make sure BIP 149 will never activate unless BIP 141 has
expired unsuccessfully? If BIP 141 should unexpectly activate, then
BIP 149 nodes would notice and act as pre-SegWit nodes indefinitely,
but remain in consensus with BIP 141 nodes.

It might be slightly less convenient for BIP 149 users to upgrade
again, but then at least we could start deploying BIP 149 sooner.

From jtimon at jtimon.cc  Sun Jun 11 14:29:08 2017
From: jtimon at jtimon.cc (=?UTF-8?B?Sm9yZ2UgVGltw7Nu?=)
Date: Sun, 11 Jun 2017 16:29:08 +0200
Subject: [bitcoin-dev] BIP149 timeout-- why so far in the future?
In-Reply-To: <CAODYVYc7x-C5nLxtTHYh9iJuCgv0B7XADCS7DeSW8O8VMuGvbQ@mail.gmail.com>
References: <CAODYVYc7x-C5nLxtTHYh9iJuCgv0B7XADCS7DeSW8O8VMuGvbQ@mail.gmail.com>
Message-ID: <CABm2gDrqrfGxB8zJNDu8B4yz8YVoD-0hs753ZexGC6=Dhybe3w@mail.gmail.com>

On Sun, Jun 11, 2017 at 3:44 PM, Martijn Meijering via bitcoin-dev
<bitcoin-dev at lists.linuxfoundation.org> wrote:
> Jorge Tim?n wrote:
> Why not just make sure BIP 149 will never activate unless BIP 141 has
> expired unsuccessfully?

Right, that would be part of it, as well as not removing the BIP141
deployment with bip9.
See https://github.com/jtimon/bitcoin/commit/62efd741740f5c75c43d78358d6318941e6d3c04

> If BIP 141 should unexpectly activate, then
> BIP 149 nodes would notice and act as pre-SegWit nodes indefinitely,
> but remain in consensus with BIP 141 nodes.
>
> It might be slightly less convenient for BIP 149 users to upgrade
> again, but then at least we could start deploying BIP 149 sooner.

No, if segwit activates pre nov15, bip149 nodse can detect and
interpret that just fine.
The problem if it activates post nov15, then you need a separate
service bit in the p2p network, for pre-BIP149 will think sw hasn't
activated while post-BIP149 would know it has activated.

If you release it only after nov15, you don't need to test
compatibility between the two for neither of this two cases.
Or do you? Actually you only save testing the easier case of pre-nov15
activation.


> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev

From jtimon at jtimon.cc  Sun Jun 11 15:06:01 2017
From: jtimon at jtimon.cc (=?UTF-8?B?Sm9yZ2UgVGltw7Nu?=)
Date: Sun, 11 Jun 2017 17:06:01 +0200
Subject: [bitcoin-dev] The BIP148 chain split may be inevitable
In-Reply-To: <CAAUaCyiwnspvJ9HY41GK8tMsA4ezpFPR1Ka9upik6UwsYBASnQ@mail.gmail.com>
References: <CAAUaCygRaXNX5xWuka1xrrXwKv1tqevT9-cHd-5mh_AkHpg9gA@mail.gmail.com>
	<CAAUaCyh_uBcZ7ntbLtOeOAK-6nt2Rx-cxx27QaiXRKkije21AQ@mail.gmail.com>
	<CAAUaCyiwnspvJ9HY41GK8tMsA4ezpFPR1Ka9upik6UwsYBASnQ@mail.gmail.com>
Message-ID: <CABm2gDoS0eiiabxbfQc4Cc7Jqk-XfDDL6QdGhDn-TzrDpd8Hfw@mail.gmail.com>

> I believe that means 80% of hashrate would need to be running BIP91 (signaling bit 4) by ~June 30 (so BIP91 locks in ~July 13, activates ~July 27), not "a few days ago" as I claimed.  So, tight timing, but not impossible.

This is not needed, if segwit is locked in by aug 1 (with or without
bip91), no split will happen even if segwit is not active yet.
So the hashrate majority could avoid the split that way (or adopting bip148).

But it doesn't seem like they are planning to do this (with or without
bip91), the last thing I've heard, it's they will wait until
"immediately" before they signal sw (but there must be some language
barrier here, perhaps "immediately" and "inmediatamente" are false
friends). The reason why they will wait until "immediately" instead of
just starting to signal sw today, it's still unclear to me.

The other way to prevent the split is if bip148 users abort bip148
deployment, but unfortunately that seems increasingly unlikely.

From jtimon at jtimon.cc  Sun Jun 11 17:11:53 2017
From: jtimon at jtimon.cc (=?UTF-8?B?Sm9yZ2UgVGltw7Nu?=)
Date: Sun, 11 Jun 2017 19:11:53 +0200
Subject: [bitcoin-dev] The BIP148 chain split may be inevitable
In-Reply-To: <CAAUaCyiwnspvJ9HY41GK8tMsA4ezpFPR1Ka9upik6UwsYBASnQ@mail.gmail.com>
References: <CAAUaCygRaXNX5xWuka1xrrXwKv1tqevT9-cHd-5mh_AkHpg9gA@mail.gmail.com>
	<CAAUaCyh_uBcZ7ntbLtOeOAK-6nt2Rx-cxx27QaiXRKkije21AQ@mail.gmail.com>
	<CAAUaCyiwnspvJ9HY41GK8tMsA4ezpFPR1Ka9upik6UwsYBASnQ@mail.gmail.com>
Message-ID: <CABm2gDp8Dvi1eLOOU9E04OvVZR5U1=6bn9vf9k8=di66eg2EQA@mail.gmail.com>

On Sat, Jun 10, 2017 at 8:04 PM, Jacob Eliosoff via bitcoin-dev
<bitcoin-dev at lists.linuxfoundation.org> wrote:
> Just a quick follow-up on BIP91's prospects of avoiding a BIP148 chain
> split, because I may have left an overly pessimistic impression -
>
> In short: the timing isn't as dire as I suggested, BUT unless concrete
> progress on a plan starts taking shape, esp miner support, *the split is
> indeed coming.*
>
> THE GOOD NEWS: several refinements have been noted which could get BIP91 (or
> splitprotection, Segwit2x, etc) deployed faster:
> - Of course the 80% threshold could just be reduced, eg to splitprotection's
> 65%

This still doesn't prevent the split if 45% or more of the hashrate
keeps blocking segwit, so I don't see how this help.

> - BIP91 nodes could start signaling on bit 1 the moment bit 4 reaches
> lock-in, rather than waiting another period until it  "activates".

Miners could start signaling bit 1 today, before they use bip91 too
and signal bit 4 in addition.
But they aren't doing it, it seems they prefer to block segwit. I
don't see why changing using bit 4 or reducing the threshold would
change their mind.

> THE BAD NEWS: no one should underestimate the steps that would need to be
> completed by that deadline:
> 1. Coordinate on a solution (BIP91, splitprotection, Segwit2x, BIP148
> itself, ...)
> 2. Implement and test it
> 3. Convince >50% of miners to run it [2]
> 4. Miners upgrade to the new software and begin signaling
>
> In particular, #3: afaict a lot of convincing is still needed before miner
> support for any of these reaches anything like 50%.  (With the exception of
> Segwit2x, but it has the additional handicap that it probably needs to
> include deployable hard fork code, obviously ambitious in 1.5 months.)
>

Or you can replace this whole plan with the step 3, convincing miners
to stop blocking segwit, upgrade to segwit capable code if they
haven't already and signal bit 1 to activate it.
If you don't get that, there's going to be a split. Unless bip148 is
aborted in favor of bip149, which seems unlikely.

If we had 51%+ of the hashrate currently signaling segwit, I believe
there would be no problem convincing people to move from bip148 to
bip91, but we don't have that.

To me the lesson is not rushed deployments but bip8 and never commit
the mistake of giving miners the ability to block changes again, like
we did with csv and segwit, but using bip8 instead of bip9 from now
on.

> [1] See Saicere's comment:
> https://github.com/btc1/bitcoin/pull/11#discussion_r121086886, and related
> discussion at
> https://github.com/btc1/bitcoin/pull/11#issuecomment-307330011.
>
> [2] Note that >50% need to run the *solution*, eg BIP91; old BIP141 nodes
> signaling segwit support do *not* count, since they won't orphan non-bit-1
> blocks.  The impending split isn't between nodes that support segwit vs
> don't, but between those that reject non-segwit-supporting blocks vs don't.
>
>
> On Fri, Jun 9, 2017 at 1:23 AM, Jacob Eliosoff <jacob.eliosoff at gmail.com>
> wrote:
>>
>> Ah, two corrections:
>> 1. I meant to include an option c): of course >50% of hashpower running
>> BIP148 by Aug 1 avoids a split.
>> 2. More seriously, I misrepresented BIP148's logic: it doesn't require
>> segwit *activation*, just orphans non-segwit-*signaling* (bit 1) blocks from
>> Aug 1.
>>
>> I believe that means 80% of hashrate would need to be running BIP91
>> (signaling bit 4) by ~June 30 (so BIP91 locks in ~July 13, activates ~July
>> 27), not "a few days ago" as I claimed.  So, tight timing, but not
>> impossible.
>>
>> Sorry about the errors.
>>
>>
>> On Fri, Jun 9, 2017 at 12:40 AM, Jacob Eliosoff <jacob.eliosoff at gmail.com>
>> wrote:
>>>
>>> I've been trying to work out the expected interaction between James
>>> Hilliard's BIP91 [1] (or splitprotection [2], or Segwit2x [3], which both
>>> use variants of BIP91 activation) and the BIP148 UASF [4].  Some of this is
>>> subtle so CORRECTIONS WELCOME, but my conclusions are:
>>> 1. It's extremely unlikely BIP91-type logic can activate segwit in time
>>> to avoid a BIP148 chain split.
>>> 2. So, in practice all we can do is ensure the BIP148 split is as
>>> painless as possible.
>>>
>>> REASONING:  First, some dates.  BIP148, whose deadline is already
>>> deployed and thus unlikely to be postponed, starts orphaning non-segwit
>>> blocks on midnight (GMT) the morning of August 1.  Meanwhile, here are
>>> Bitcoin's rough expected next four difficulty adjustment dates (they could
>>> vary by ~1-3 days depending on block times, but it's unlikely to matter
>>> here):
>>> 1. June 17
>>> 2. June 30
>>> 3. July 13
>>> 4. July 27
>>>
>>> If Segwit activates on adj date #5 or later (August), it will be too late
>>> to avoid BIP148's split, which will have occurred the moment August began.
>>> So, working backwards, and assuming we want compatibility with old BIP141
>>> nodes:
>>>
>>> - Segwit MUST activate by adj #4 (~July 27)
>>> - Therefore segwit MUST be locked in by adj #3 (~July 13: this is
>>> inflexible, since this logic is in already-deployed BIP141 nodes)
>>> - Therefore, I *think* >50% of hashpower needs to be BIP91 miners,
>>> signaling bit 1 and orphaning non-BIP91 (ie, BIP91's bit 4 must activate),
>>> by adj #2 (June 30)?
>>> - Therefore, as currently designed, BIP91 bit 4 must be locked in by adj
>>> #1 (June 17)
>>> - Therefore, >=80% of hashrate must start signaling BIP91's bit 4 by a
>>> few days ago...
>>>
>>> There are ways parts of this could be sped up, eg, James' "rolling
>>> 100-block lock-in periods" [5], to get BIP91 signaling bit 1 sooner.  But to
>>> be compatible with old BIP141 nodes, >50% of hashrate must be activated
>>> BIP91 miners by ~June 30: there's no fudging that.
>>>
>>> So, it seems to me that to avoid the BIP148 split, one of two things
>>> would have to happen:
>>> a) 95% of hashrate start signaling bit 1 by ~June 30.  Given current stat
>>> is 32%, this would basically require magic.
>>> b) BIP91 is deployed and >50% (80% or whatever) of hashrate is
>>> *activated* BIP91 miners by ~June 30, ~3 weeks from now.  Again, much too
>>> soon.
>>>
>>> So, I think the BIP148 split is inevitable.  I actually expect that few
>>> parts of the ecosystem will join the fork, so disruption will be bearable.
>>> But anyway let me know any flaws in the reasoning above.
>>>
>>> [1] https://github.com/bitcoin/bips/blob/master/bip-0091.mediawiki
>>> [2]
>>> https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-June/014508.html
>>> [3] https://github.com/btc1/bitcoin/pull/11
>>> [4] https://github.com/bitcoin/bips/blob/master/bip-0148.mediawiki
>>> [5] https://github.com/btc1/bitcoin/pull/6#issuecomment-305917729
>>
>>
>
>
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>

From jtimon at jtimon.cc  Sun Jun 11 17:12:35 2017
From: jtimon at jtimon.cc (=?UTF-8?B?Sm9yZ2UgVGltw7Nu?=)
Date: Sun, 11 Jun 2017 19:12:35 +0200
Subject: [bitcoin-dev] The BIP148 chain split may be inevitable
In-Reply-To: <CABm2gDp8Dvi1eLOOU9E04OvVZR5U1=6bn9vf9k8=di66eg2EQA@mail.gmail.com>
References: <CAAUaCygRaXNX5xWuka1xrrXwKv1tqevT9-cHd-5mh_AkHpg9gA@mail.gmail.com>
	<CAAUaCyh_uBcZ7ntbLtOeOAK-6nt2Rx-cxx27QaiXRKkije21AQ@mail.gmail.com>
	<CAAUaCyiwnspvJ9HY41GK8tMsA4ezpFPR1Ka9upik6UwsYBASnQ@mail.gmail.com>
	<CABm2gDp8Dvi1eLOOU9E04OvVZR5U1=6bn9vf9k8=di66eg2EQA@mail.gmail.com>
Message-ID: <CABm2gDpy8XA3Nh+amYMb4GamOy+FdjwSGc19X6HtNJg2YkNH0w@mail.gmail.com>

oops s/45%/35%/

On Sun, Jun 11, 2017 at 7:11 PM, Jorge Tim?n <jtimon at jtimon.cc> wrote:
> On Sat, Jun 10, 2017 at 8:04 PM, Jacob Eliosoff via bitcoin-dev
> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>> Just a quick follow-up on BIP91's prospects of avoiding a BIP148 chain
>> split, because I may have left an overly pessimistic impression -
>>
>> In short: the timing isn't as dire as I suggested, BUT unless concrete
>> progress on a plan starts taking shape, esp miner support, *the split is
>> indeed coming.*
>>
>> THE GOOD NEWS: several refinements have been noted which could get BIP91 (or
>> splitprotection, Segwit2x, etc) deployed faster:
>> - Of course the 80% threshold could just be reduced, eg to splitprotection's
>> 65%
>
> This still doesn't prevent the split if 45% or more of the hashrate
> keeps blocking segwit, so I don't see how this help.
>
>> - BIP91 nodes could start signaling on bit 1 the moment bit 4 reaches
>> lock-in, rather than waiting another period until it  "activates".
>
> Miners could start signaling bit 1 today, before they use bip91 too
> and signal bit 4 in addition.
> But they aren't doing it, it seems they prefer to block segwit. I
> don't see why changing using bit 4 or reducing the threshold would
> change their mind.
>
>> THE BAD NEWS: no one should underestimate the steps that would need to be
>> completed by that deadline:
>> 1. Coordinate on a solution (BIP91, splitprotection, Segwit2x, BIP148
>> itself, ...)
>> 2. Implement and test it
>> 3. Convince >50% of miners to run it [2]
>> 4. Miners upgrade to the new software and begin signaling
>>
>> In particular, #3: afaict a lot of convincing is still needed before miner
>> support for any of these reaches anything like 50%.  (With the exception of
>> Segwit2x, but it has the additional handicap that it probably needs to
>> include deployable hard fork code, obviously ambitious in 1.5 months.)
>>
>
> Or you can replace this whole plan with the step 3, convincing miners
> to stop blocking segwit, upgrade to segwit capable code if they
> haven't already and signal bit 1 to activate it.
> If you don't get that, there's going to be a split. Unless bip148 is
> aborted in favor of bip149, which seems unlikely.
>
> If we had 51%+ of the hashrate currently signaling segwit, I believe
> there would be no problem convincing people to move from bip148 to
> bip91, but we don't have that.
>
> To me the lesson is not rushed deployments but bip8 and never commit
> the mistake of giving miners the ability to block changes again, like
> we did with csv and segwit, but using bip8 instead of bip9 from now
> on.
>
>> [1] See Saicere's comment:
>> https://github.com/btc1/bitcoin/pull/11#discussion_r121086886, and related
>> discussion at
>> https://github.com/btc1/bitcoin/pull/11#issuecomment-307330011.
>>
>> [2] Note that >50% need to run the *solution*, eg BIP91; old BIP141 nodes
>> signaling segwit support do *not* count, since they won't orphan non-bit-1
>> blocks.  The impending split isn't between nodes that support segwit vs
>> don't, but between those that reject non-segwit-supporting blocks vs don't.
>>
>>
>> On Fri, Jun 9, 2017 at 1:23 AM, Jacob Eliosoff <jacob.eliosoff at gmail.com>
>> wrote:
>>>
>>> Ah, two corrections:
>>> 1. I meant to include an option c): of course >50% of hashpower running
>>> BIP148 by Aug 1 avoids a split.
>>> 2. More seriously, I misrepresented BIP148's logic: it doesn't require
>>> segwit *activation*, just orphans non-segwit-*signaling* (bit 1) blocks from
>>> Aug 1.
>>>
>>> I believe that means 80% of hashrate would need to be running BIP91
>>> (signaling bit 4) by ~June 30 (so BIP91 locks in ~July 13, activates ~July
>>> 27), not "a few days ago" as I claimed.  So, tight timing, but not
>>> impossible.
>>>
>>> Sorry about the errors.
>>>
>>>
>>> On Fri, Jun 9, 2017 at 12:40 AM, Jacob Eliosoff <jacob.eliosoff at gmail.com>
>>> wrote:
>>>>
>>>> I've been trying to work out the expected interaction between James
>>>> Hilliard's BIP91 [1] (or splitprotection [2], or Segwit2x [3], which both
>>>> use variants of BIP91 activation) and the BIP148 UASF [4].  Some of this is
>>>> subtle so CORRECTIONS WELCOME, but my conclusions are:
>>>> 1. It's extremely unlikely BIP91-type logic can activate segwit in time
>>>> to avoid a BIP148 chain split.
>>>> 2. So, in practice all we can do is ensure the BIP148 split is as
>>>> painless as possible.
>>>>
>>>> REASONING:  First, some dates.  BIP148, whose deadline is already
>>>> deployed and thus unlikely to be postponed, starts orphaning non-segwit
>>>> blocks on midnight (GMT) the morning of August 1.  Meanwhile, here are
>>>> Bitcoin's rough expected next four difficulty adjustment dates (they could
>>>> vary by ~1-3 days depending on block times, but it's unlikely to matter
>>>> here):
>>>> 1. June 17
>>>> 2. June 30
>>>> 3. July 13
>>>> 4. July 27
>>>>
>>>> If Segwit activates on adj date #5 or later (August), it will be too late
>>>> to avoid BIP148's split, which will have occurred the moment August began.
>>>> So, working backwards, and assuming we want compatibility with old BIP141
>>>> nodes:
>>>>
>>>> - Segwit MUST activate by adj #4 (~July 27)
>>>> - Therefore segwit MUST be locked in by adj #3 (~July 13: this is
>>>> inflexible, since this logic is in already-deployed BIP141 nodes)
>>>> - Therefore, I *think* >50% of hashpower needs to be BIP91 miners,
>>>> signaling bit 1 and orphaning non-BIP91 (ie, BIP91's bit 4 must activate),
>>>> by adj #2 (June 30)?
>>>> - Therefore, as currently designed, BIP91 bit 4 must be locked in by adj
>>>> #1 (June 17)
>>>> - Therefore, >=80% of hashrate must start signaling BIP91's bit 4 by a
>>>> few days ago...
>>>>
>>>> There are ways parts of this could be sped up, eg, James' "rolling
>>>> 100-block lock-in periods" [5], to get BIP91 signaling bit 1 sooner.  But to
>>>> be compatible with old BIP141 nodes, >50% of hashrate must be activated
>>>> BIP91 miners by ~June 30: there's no fudging that.
>>>>
>>>> So, it seems to me that to avoid the BIP148 split, one of two things
>>>> would have to happen:
>>>> a) 95% of hashrate start signaling bit 1 by ~June 30.  Given current stat
>>>> is 32%, this would basically require magic.
>>>> b) BIP91 is deployed and >50% (80% or whatever) of hashrate is
>>>> *activated* BIP91 miners by ~June 30, ~3 weeks from now.  Again, much too
>>>> soon.
>>>>
>>>> So, I think the BIP148 split is inevitable.  I actually expect that few
>>>> parts of the ecosystem will join the fork, so disruption will be bearable.
>>>> But anyway let me know any flaws in the reasoning above.
>>>>
>>>> [1] https://github.com/bitcoin/bips/blob/master/bip-0091.mediawiki
>>>> [2]
>>>> https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-June/014508.html
>>>> [3] https://github.com/btc1/bitcoin/pull/11
>>>> [4] https://github.com/bitcoin/bips/blob/master/bip-0148.mediawiki
>>>> [5] https://github.com/btc1/bitcoin/pull/6#issuecomment-305917729
>>>
>>>
>>
>>
>> _______________________________________________
>> bitcoin-dev mailing list
>> bitcoin-dev at lists.linuxfoundation.org
>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>

From bitcoin-dev at rgrant.org  Sun Jun 11 19:31:00 2017
From: bitcoin-dev at rgrant.org (Ryan Grant)
Date: Sun, 11 Jun 2017 15:31:00 -0400
Subject: [bitcoin-dev] extended BIP9 activation of segwit,
	for legacy nodes
In-Reply-To: <CAMnpzfr5hLFqRm0_KWb6=N8YsD4dfQBtRBPFwfjz-EHA31d34A@mail.gmail.com>
References: <CAMnpzfr5hLFqRm0_KWb6=N8YsD4dfQBtRBPFwfjz-EHA31d34A@mail.gmail.com>
Message-ID: <CAMnpzfrx5QA0qqOjfRn=q0_HUtcDpbhAKxRLPitU02ycxN1+kQ@mail.gmail.com>

This[1] idea from April would assist in a BIP149-like segwit
activation on November 16th.

Its goal is to be incredibly easy to test and deploy, right now, even
before a decision on revisions to BIP149 is made, and well before such
"BIP149ish" testing is itself complete.

UASFs don't need time for most legacy nodes to upgrade - that's the
point of a soft fork.  UASFs simply need to have inevitability,
which is provided by some nodes more than others.  But for the node
less instrumental in that inevitability, and more relaxed about
scheduling upgrade work, being moved to a miner-protected consensus
ruleset is not as desirable a position as the opportunity to
participate fully.  As a courtesy, the plan for soft forks has
always been to allow legacy nodes time to upgrade to full
participation.  How much time should rollouts allow for this
courtesy?

Extended BIP9 activation of segwit (for legacy nodes) separates
concerns between intending to activate segwit and its method of
deployment, allowing "semi-legacy" nodes that have upgraded to
include this proposal to participate immediately in a successful
segwit activation, without needing any courtesy time to upgrade to
the particular deployment logic.

Code for deployment is included in the original email[1].  There's
nothing missing from the logic shown.  The whole intent of the
proposal is that other deployment specifics are left to be defined
by future proposals.  In the same block that THRESHOLD_ACTIVE is
reached for segwit, require Consensus::DEPLOYMENT_SEGWIT_ALT1 to
also reach THRESHOLD_ACTIVE, and the burden of the future proposal
is fulfilled.

If the idea proves broken or of no benefit, when actually
implementing and testing future deployments, then we can avoid using
DEPLOYMENT_SEGWIT_ALT1 until it expires, and zero nodes get hurt.

Let's look at how this affects options for how to deploy segwit...

/ BIP149ish UASF, without this proposal /

roadmap:
  - BIP149ish debated (handles BIP141 success, unlike BIP149)
  - BIP149ish tested
  - BIP149ish courtesy timeout debated
  - BIP148    fails
  - BIP149ish released
  - BIP141    fails
  - BIP149ish courtesy timeout expires
  - BIP149ish activates
  - segwit activates
  - legacy nodes must upgrade before recognizing BIP149 activation

If we try to restrict ourselves to only the original service bit, we
see a tension between activating soon and leaving legacy nodes on a
miner-protected consensus.  We also see a tension between *planning*
how long it will take to debate and test UASF logic, and setting
expectations for when a reasonable activation date is.

These seemingly small tensions complicate the solution, and push it
out of developer's visions of what is feasible.  It's not clear how
soon it can happen, so it doesn't get started in an urgent manner.
It doesn't get started in an urgent manner, so it's not clear how
soon it can happen.

/ BIP149ish UASF, with this proposal /

roadmap:
  - this proposal debated
  - this proposal tested
  - this proposal released (courtesy begins)
  - BIP149ish     debated  (handles BIP141 success, unlike BIP149)
  - BIP149ish     tested
  - BIP148        fails
  - BIP149ish     released
  - BIP141        fails
  - BIP149ish     activates
  - segwit activates
  - semi-legacy nodes *immediately* use segwit, via this proposal

We can remove the courtesy timeout problem, because the courtesy
begins as soon as this proposal goes live.  This simplifies debate on
how BIP149ish should deploy, and helps make reasonable a much quicker
segwit activation should BIP141 fail.

With a clear route to quick activation for semi-legacy nodes, the
UASF can be planned for activation in as short a window as the key
nodes can upgrade.  Not even all the key nodes need to upgrade: it's
still a soft fork, and UASFs simply need to have inevitability.

These differences can help us aim for activating segwit on November
16th, if BIP141 and BIP148 do not succeed earlier.  Since BIP149 as
originally conceived is slow as molasses, BIP149ish still needs
debate, BIP141 has steadfast enemies, and the community is slow to
adapt to BIP148's complicated commitment requirements, it is prudent
to take this intermediate step allowing quicker BIP149ish activation.

[1] https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-April/014160.html

From jose.femenias at gmail.com  Sun Jun 11 20:05:24 2017
From: jose.femenias at gmail.com (=?utf-8?Q?JOSE_FEMENIAS_CA=C3=91UELO?=)
Date: Sun, 11 Jun 2017 22:05:24 +0200
Subject: [bitcoin-dev] Bitcoin pointers
Message-ID: <FD96E80B-A6ED-436D-876D-423A3C3E7566@gmail.com>

Hi,

I?ve been doing some work lately to create a specification for bitcoin pointers. 

They can be used to point to transactions, inputs, outputs or some internal items within them.
The proposals strive for simplicity and user friendliness over compactness or other attributes.

There are three proposals, each of which builds upon the previous one, namely:

a) Canonical Pointers
The basic proposal.They look like this example: btc at 170.1/179-631-520
Here is a link to the Google Docs document ->  https://docs.google.com/document/d/1PBN4wKFYtgvDxV4DrWUdNe9Xqmb8GVxoIGDKRkY9Xr4/edit?usp=sharing <https://docs.google.com/document/d/1PBN4wKFYtgvDxV4DrWUdNe9Xqmb8GVxoIGDKRkY9Xr4/edit?usp=sharing>

b) Mnemonic Pointers 
They build on Canonical Pointers and the dictionary provided in bip39 to use words instead of numbers. 
The previous Canonical pointer can thus be expressed as btc at best.ability <mailto:btc at best.ability>/biology-exclude-donate
Here is a link to the Google Docs document ->  https://docs.google.com/document/d/1wLK2_UrRzK0eshkDntUIbVlIdswzuHmYNELOePDjtPY/edit?usp=sharing <https://docs.google.com/document/d/1wLK2_UrRzK0eshkDntUIbVlIdswzuHmYNELOePDjtPY/edit?usp=sharing>

c) Domain Pointers 
They build on the Domain Name Registration system to encode a pointer to a Canonical Pointer as in btc at example.com <mailto:btc at example.com>
Here is a link to the Google Docs document -> https://docs.google.com/document/d/1KY7rM090oKzGn8NAz4XFxQnfkyD5gs4V6vpbfdw92RM/edit?usp=sharing <https://docs.google.com/document/d/1KY7rM090oKzGn8NAz4XFxQnfkyD5gs4V6vpbfdw92RM/edit?usp=sharing>

I haven?t had any peer review yet, so it is very likely that some small or big problems can be found. 

I?d welcome any feedback from the community.

Best regards,


Jos? Femen?as Ca?uelo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170611/6b38b49e/attachment.html>

From dev at jonasschnelli.ch  Sun Jun 11 20:19:20 2017
From: dev at jonasschnelli.ch (Jonas Schnelli)
Date: Sun, 11 Jun 2017 22:19:20 +0200
Subject: [bitcoin-dev] Bitcoin pointers
In-Reply-To: <FD96E80B-A6ED-436D-876D-423A3C3E7566@gmail.com>
References: <FD96E80B-A6ED-436D-876D-423A3C3E7566@gmail.com>
Message-ID: <F096F6D8-4091-43F8-AE7F-90D52417A7FE@jonasschnelli.ch>

Hi Jos?

> a) Canonical Pointers
> The basic proposal.They look like this example: btc at 170.1/179-631-520
> Here is a link to the Google Docs document ->  https://docs.google.com/document/d/1PBN4wKFYtgvDxV4DrWUdNe9Xqmb8GVxoIGDKRkY9Xr4/edit?usp=sharing <https://docs.google.com/document/d/1PBN4wKFYtgvDxV4DrWUdNe9Xqmb8GVxoIGDKRkY9Xr4/edit?usp=sharing>
A similar/related proposal got posted last month : https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-May/014396.html <https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-May/014396.html>
The Bech32 encoded transaction position reference allows to solve similar use cases (tx pointers) with a strong error-detection/correction using just 14 chars (encoded state, including error correction / unencoded 40bits).

/jonas
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170611/80f97aa2/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 833 bytes
Desc: Message signed with OpenPGP
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170611/80f97aa2/attachment-0001.sig>

From soc1024 at illinois.edu  Mon Jun 12 14:46:23 2017
From: soc1024 at illinois.edu (Andrew Miller)
Date: Mon, 12 Jun 2017 09:46:23 -0500
Subject: [bitcoin-dev] BIP proposal - Dandelion: Privacy Preserving
	Transaction Propagation
Message-ID: <CAF7tpExcfbB5mvL0nNnSTJxU5eJOeFs2z3Gor9ZXWYxh1szSTg@mail.gmail.com>

Dear bitcoin-dev,
   We've put together a preliminary implementation and BIP for
Dandelion, and would love to get your feedback on it. Dandelion is a
privacy-enhancing modification to Bitcoin's transaction propagation
mechanism. Its goal is to obscure the original source IP of each
transaction.

  https://github.com/gfanti/bips/blob/master/bip-dandelion.mediawiki
  https://github.com/gfanti/bitcoin/tree/dandelion

   The main idea is that transaction propagation proceeds in two
phases: first the ?stem? phase, and then ?fluff? phase. During the
stem phase, each node relays the transaction to a *single* peer. After
a random number of hops along the stem, the transaction enters the
fluff phase, which behaves just like ordinary transaction
flooding/diffusion. Even when an attacker can identify the location of
the fluff phase, it is much more difficult to identify the source of
the stem. Our approach and some preliminary evaluation are explained
in more detail in the BIP. The research paper originally introducing
this idea was recently presented at SIGMETRICS'17.
https://arxiv.org/pdf/1701.04439.pdf

  Compared to the original paper, our current proposal includes
several new design ideas, especially:
 - Stronger attacker model: we defend against an attacker that
actively tries to learn which nodes were involved in the stem phase.
Our approach is called "Mempool Embargo", meaning a node that receives
a "stem phase" transaction behaves as though it never heard of it,
until it receives it again from someone else (or until a random timer
elapses).
 - Robustness. We think the privacy benefit shouldn't come at the
expense of propagation quality. Our implementation is designed so that
if some node drops the transaction (or when Dandelion is adopted only
partially), then the fallback behavior is ordinary Bitcoin
propagation.

  We'd especially like feedback on the implementation details related
to the two points above. The mempool embargo mechanism is tricky,
since it hard to rule out indirect behavior that reveals if a
transaction is in mempool. In the BIP we explain one counterexample,
but at least it requires the attacker to get its connections banned.
Are there other ways we haven't thought of? We think the alternative
approach (bypassing mempool entirely) seems even harder to get right,
and foregoes existing DoS protection.

  We're currently running in-situ benchmark experiments with this code
on testnet and will report on those in this thread if there's
interest.

  Some prior discussion can be found here:
  - https://botbot.me/freenode/bitcoin-wizards/2017-03-29/?msg=83181866&page=2
  - https://botbot.me/freenode/bitcoin-wizards/2017-01-18/?msg=79578754&page=2
  - https://github.com/sbaks0820/bitcoin-dandelion/issues/1 (notes
from gmaxwell that we've mostly incorporated in the current proposal)

Thanks!
-----
Giulia Fanti <gfanti at andrew.cmu.edu>
Andrew Miller <soc1024 at illinois.edu>
Surya Bakshi <sbakshi3 at illinois.edu>
Shaileshh Bojja Venkatakrishnan <bjjvnkt2 at illinois.edu>
Pramod Viswanath <pramodv at illinois.edu>

From nathan.cook at gmail.com  Mon Jun 12 16:27:14 2017
From: nathan.cook at gmail.com (Nathan Cook)
Date: Mon, 12 Jun 2017 19:27:14 +0300
Subject: [bitcoin-dev] Hypothetical 2 MB hardfork to follow BIP148
In-Reply-To: <CAD1TkXtut2LZdp5Qo9ep2FfMGFFYqdxtobLJgoC7UutyNujKKg@mail.gmail.com>
References: <201705232023.40588.luke@dashjr.org>
	<CAJowKgJK9zBkVAM1NyOsjU04gvwV3zGnk+1ebfpt6rnbiKy6Og@mail.gmail.com>
	<CABm2gDpet31gEcBY6NTxEG+xA4rvg8_c79L+J=mJySGbf7Ydbg@mail.gmail.com>
	<CAOG=w-uei5-c-Mpp_R6RrN29NTrSV+gpNd79FC3cB6QPG65sEw@mail.gmail.com>
	<CAH+Axy5yYQywpy0s9pBZt_fNoLPpWfra-cU9HrUwH71GDOchsQ@mail.gmail.com>
	<004E1123-8346-48B6-9BCB-94BAE00EC34B@me.com>
	<CAAUaCyjbObcb1mJVmeEDmgzNddQCY3QhrHV3fgNbin-ZyqgfeA@mail.gmail.com>
	<CAD1TkXtut2LZdp5Qo9ep2FfMGFFYqdxtobLJgoC7UutyNujKKg@mail.gmail.com>
Message-ID: <CAGNXQMRuR8BHFXSjxTWVsFaSs5cXfmSzVvbmds5Nqch4UnBMVQ@mail.gmail.com>

The problem with >100kb transactions isn't that there are a lot of
already-signed transactions out there, or even that there are good use
cases for them, but that such transactions and use cases could exist, and
there is no way of disallowing them without possibly costing someone a lot
of money. Slowly reducing the limit doesn't really solve this problem.

I propose to make them hard enough to confirm that no-one will use them
without a very good reason. Just require that any block containing an
outsized transaction be mined at a greater difficulty ? quadratically
greater. Such a block is more expensive *for the block's miner*, not just
for the other miners, or for other nodes. Anyone who really, really needs
to use a 400kb transaction can pay a miner to mine it.

Quadratic hashing isn't risky when it is inherently limited by a
corresponding reduction in the rate at which the "bad" blocks can be
generated. That said, there's nothing I can see which is actually good
about large, expensive to validate transactions, and so >1MB transactions
should remain invalid, as they are today.


Nathan Cook

On 2 June 2017 at 22:40, Jared Lee Richardson via bitcoin-dev <
bitcoin-dev at lists.linuxfoundation.org> wrote:

> > Maybe there's some hole in Jorge's logic and scrapping blockmaxsize has
> quadratic hashing risks, and maybe James' 10KB is too ambitious; but even
> if so, a simple 1MB tx size limit would clearly do the trick.  The broader
> point is that quadratic hashing is not a compelling reason to keep
> blockmaxsize post-HF: does someone have a better one?
>
> I think this is exactly the right direction to head.  There are
> arguments to be made for various maximum sizes... Maybe the limit
> could be set to 1mb initially, and at a distant future block
> height(years?) automatically drop to 500kb or 100kb?  That would give
> anyone with existing systems or pre-signed transactions several years
> to adjust to the change.  Notification could (?possibly?) be done with
> a non-default parameter that must be changed to continue to use 100kb
> - <1mb transactions, so no one running modern software could claim
> they were not informed when that future date hits.
>
> I don't see any real advantages to continuing to support transactions
> larger than 100kb excepting the need to update legacy use cases /
> already signed transactions.
>
> On Tue, May 30, 2017 at 8:07 PM, Jacob Eliosoff via bitcoin-dev
> <bitcoin-dev at lists.linuxfoundation.org> wrote:
> > Maybe there's some hole in Jorge's logic and scrapping blockmaxsize has
> > quadratic hashing risks, and maybe James' 10KB is too ambitious; but
> even if
> > so, a simple 1MB tx size limit would clearly do the trick.  The broader
> > point is that quadratic hashing is not a compelling reason to keep
> > blockmaxsize post-HF: does someone have a better one?
> >
> >
> >
> > On May 30, 2017 9:46 PM, "Jean-Paul Kogelman via bitcoin-dev"
> > <bitcoin-dev at lists.linuxfoundation.org> wrote:
> >>
> >> That would invalidate any pre-signed transactions that are currently out
> >> there. You can't just change the rules out from under people.
> >>
> >>
> >> On May 30, 2017, at 4:50 PM, James MacWhyte via bitcoin-dev
> >> <bitcoin-dev at lists.linuxfoundation.org> wrote:
> >>
> >>
> >>>
> >>>  The 1MB classic block size prevents quadratic hashing
> >>> problems from being any worse than they are today.
> >>>
> >>
> >> Add a transaction-size limit of, say, 10kb and the quadratic hashing
> >> problem is a non-issue. Donezo.
> >>
> >> _______________________________________________
> >> bitcoin-dev mailing list
> >> bitcoin-dev at lists.linuxfoundation.org
> >> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
> >>
> >>
> >> _______________________________________________
> >> bitcoin-dev mailing list
> >> bitcoin-dev at lists.linuxfoundation.org
> >> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
> >>
> >
> > _______________________________________________
> > bitcoin-dev mailing list
> > bitcoin-dev at lists.linuxfoundation.org
> > https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
> >
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170612/4a6e1479/attachment.html>

From greg at xiph.org  Tue Jun 13 01:00:50 2017
From: greg at xiph.org (Gregory Maxwell)
Date: Tue, 13 Jun 2017 01:00:50 +0000
Subject: [bitcoin-dev] BIP proposal - Dandelion: Privacy Preserving
 Transaction Propagation
In-Reply-To: <CAF7tpExcfbB5mvL0nNnSTJxU5eJOeFs2z3Gor9ZXWYxh1szSTg@mail.gmail.com>
References: <CAF7tpExcfbB5mvL0nNnSTJxU5eJOeFs2z3Gor9ZXWYxh1szSTg@mail.gmail.com>
Message-ID: <CAAS2fgRAnGMMxKPCaj1SL=z3O2wuGS8nyPrgtGhSpuGgAoVtKg@mail.gmail.com>

On Mon, Jun 12, 2017 at 2:46 PM, Andrew Miller via bitcoin-dev
<bitcoin-dev at lists.linuxfoundation.org> wrote:
> Dear bitcoin-dev,
>    We've put together a preliminary implementation and BIP for
> Dandelion, and would love to get your feedback on it. Dandelion is a
> privacy-enhancing modification to Bitcoin's transaction propagation
> mechanism. Its goal is to obscure the original source IP of each
> transaction.

I'm glad to see this out now, so I'm not longer invading the git repo
uninvited. :)

>  - Stronger attacker model: we defend against an attacker that
> actively tries to learn which nodes were involved in the stem phase.
> Our approach is called "Mempool Embargo", meaning a node that receives
> a "stem phase" transaction behaves as though it never heard of it,
> until it receives it again from someone else (or until a random timer
> elapsess).


The description in the BIP appears inadequate:


> That is, Alice will not include the embargoed transaction when responding to MEMPOOL requests, and will not respond to GETDATA requests from another node (Bob) unless Alice previously sent an INV to Bob. The embargo period ends as soon as Alice receives an INV advertising the transaction as being in fluff mode.

For example, it's not clear if I can query for the existence of a
transaction by sending a conflict.  If this doesn't seem problematic,
consider the case where I, communicating with you over some private
channel, send you a payment inside a payment protocol message. You
announce it to the network and I concurrently send a double spend.
Only nodes that were part of the stem will reject my double spend, so
I just learned a lot about your network location.

It's also appears clear that I can query by sending an inv and
noticing that no getdata arrives.  An example attack in the latter is
that when I get a stem transaction I rapidly INV interrogate the
entire network and by observing who does and doesn't getdata I will
likely learn the entire stem path upto permutation.

The extra network capacity used by getdata-ing a transaction you
already saw via dandelion would be pretty insignificant.

I believe the text should be simplified and clarified so just say:

"With the exception of her behavior towards the peer sending in the
stem transaction and the peer sending out the transaction Alice's
behavior should be indistinguishable from a node which has not seen
the transaction at all until she receives it via ordinary forwarding
or until after the timeout." -- then its up to the implementation to
achieve indistinguishably regardless of what other protocol features
it uses.

> Are there other ways we haven't thought of? We think the alternative
> approach (bypassing mempool entirely) seems even harder to get right,
> and foregoes existing DoS protection.

I think avoiding the is the most sensible way; and from a software
maintenance perspective I expect that anything less will end up
continually suffering from serious information leaks which are hard to
avoid accidentally introducing via other changes.

The primary functionality should be straightforward to implement,
needing just a flag to determine if a transaction would be accepted to
the mempool but for the flag, but which skips actually adding it.

Handling chains of unconfirmed stem transactions is made more
complicated by this and this deserves careful consideration. I'm not
sure if its possible to forward stem children of stem transactions
except via the same stem path as the parent without leaking
information, it seems unlikely.

This approach would mostly take additional complexity from the need to
limit the amplification of double spends. I believe this can be
resolved by maintaining a per-peer map of the not yet expired vin's
consumed by stem fowards sent out via that peer. E.g. vin->{timeout,
feerate}.  Then any new forward via that stem-peer is tested against
that map and suppressed if it it spends a non-timed-out input and
doesn't meet the feerate epsilon for replacement.

Use of the orphan map is not indistinguishable as it is used for block
propagation, and itself also a maintenance burden to make sure
unrelated code is not inadvertently leaking the stem transactions.

> After a random number of hops along the stem, the transaction enters the fluff phase,

The BIP is a bit under-specified on this transition, I think-- but I
know how it works from reading the prior implementation (I have not
yet read the new implementation).

The way it works (assuming I'm not confused and it hasn't changed) is
that when a new stem transaction comes in there is a chance that it is
treated as coming in as a normal transaction.

An alternative construction would be that when a stem transaction goes
out there is a random chance that the stem flag is not set (with
suitable adjustment to keep the same expected path length)

For some reason I believe this would be a superior construction, but I
am only able to articulate one clear benefit:  It allows non-dandelion
capable nodes to take on the role of the last stem hop, which I
believe would improve the anonymity set during the transition phase.

Unrelated:

Has any work been given to the fact that dandelion propagation
potentially making to measure properties of the inter-node connection
graph?  e.g.  Say I wish to partition node X by disconnecting all of
its outbound connections, to do that it would be useful to learn whom
is connected to X.  I forward a transaction to X, observe the first
node to fluff it,  then DOS attack that node to take it offline.  Will
I need to DOS attack fewer or more nodes  to get all of X's outbounds
if X supports rapid stem forwarding?

From heater at gmail.com  Tue Jun 13 02:23:41 2017
From: heater at gmail.com (Zheming Lin)
Date: Tue, 13 Jun 2017 10:23:41 +0800
Subject: [bitcoin-dev] Proposal: Demonstration of Phase in Full Network
 Upgrade Activated by Miners
Message-ID: <A6AE8145-8C8A-44C2-88D3-8574D895AF6B@gmail.com>

The BIP is described using Chinese and English. If any part is missing or need more specific, please reply. Forgive for my poor English.

This method will incorporate any upgrade that affects non-mining nodes. They should beware that the rule has been changed.

TLDR: Major miners activate and orphan the minor. That ensures all miners upgrades. Then invalid the tx from not upgrading nodes. Nodes must upgrade (with other protocol upgrade codes) in order to work. Then the final miner vote over protocol upgrade, with all nodes has the same upgraded codes.

<pre>
BIP: ???
Title: Demonstration of Phase in Full Network Upgrade Activated by Miners
Author: LIN Zheming
Status: Draft
Type: Standards Track
Created: 2017-06-12
</pre>

==Summary==

??????????????????????????????<br/>
This idea was not created by an individual but is a product of collaboration in the Chinese bitcoin community between different interest groups.<br/>

????????????????????????????????????????????????????????<br/>
This method is put forth to incentivize and to protect mining nodes and non-mining nodes during protocol upgrading. With this incentive mechanism, the non-mining nodes will not suffer monetary loss from chain splitting.<br/>

???????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????<br/>

After the activation condition is met, majority miners will set a new block versionbits after the first grace period(a difficulty change of 2016 blocks). The blocks with lower versionbits will be orphaned. In terms of the Nakamoto Consensus, the end of the first grace period will force all mining nodes upgraded to signal a new version of consensus. After the second grace period ( a difficulty change of 2016 blocks), mining nodes will only accept transactions with new versionbits. Transactions from nodes not upgrading will not be relayed nor included in blocks with new versionbits. This will protect funds of non-mining nodes from utilizing replay attack and will function as a notification for them to upgrade. Codes dealing with protocol upgrade could be included in the upgrade. After the non-mining node upgrades, mining nodes will vote to activate the protocol upgrade and this will achieve the broad/widespread deployment of the protocol upgrade.<br/>

???????????????????????????<br/>
The protocol upgrade depends on its activate condition independently even after the change deployed among nodes.<br/>

==Motivation==

????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????<br/>
In view of the fact that the original Bitcoin consensus did not consider the non-mining wallet nodes(as mentioned above), the result is that upgrading the consensus of these wallet nodes is passive and lazy. When there is disagreement in the direction of the upgrade, the miners have no mechanism to ensure that the chain being extended is the chain widely accepted by the wallet nodes. This also adversely affects the security of the wallet nodes.<br/>

??????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????<br/>

Apart from ensuring the asset security of wallet nodes, this method can be used to provide additional incentives to upgrade the protocol for the wallet nodes. Once the wallet nodes upgrade their protocol, the miners' nodes can be guaranteed to work - not only on the longest chain, but also on the longest chain used by other wallet nodes in the broader bitcoin sphere. Under the Nakamoto Consensus, there will be no persistent forks as protocol upgrades can be phased in.<br/>

==Specification==

1. ??????? versionbits ???????????BIP ??????????????? nVersion ?????<br/>
2. ??????? tx version ?????????????? tx version ? 1???? tx version ? 2 ???????????????? tx version ? 1 ??????<br/>

1. Mining nodes signal by setting a version bit. While this BIP is active, all blocks must set the chosen nVersion.<br/>
2. Mining nodes will use tx version to define current version transactions. Current tx version is 1, and tx version 2 will be allowed. After the second grace period, tx version 1 will be regarded as invalid.<br/>


==Deployment==
???????????????????????????????????<br/>

Protocol upgrading will phase in over three stages. We can have an optional fourth stage to integrate codes of protocol upgrade.<br/>

1. ??????????? versionbits ??????????????? 55% ????? 1109/2016 ??????????????????????<br/>
2. ???????????????? 2016 ?????????????? 2218/4032???????????????????????????????????????????????????????????????<br/>
3. ????????????????????? 4032 ????????????????????????????????????????????????????????<br/>
4. ????????????????????????????????????????????????????????????????????????????????????????????

1. Signal stage: Mining nodes signal using BIP9. The next stage will be activated after 55% (1109) of 2016 blocks has the signal.<br/>

2. Mining nodes upgrade stage: After a first grace period of 2016 blocks and total signalling blocks passed 2218 of 4032 blocks, miners broadcasting blocks with new versionbits in block headers will orphan blocks with old versionbits. At this stage all nodes can send transactions with new versionbits, and transactions with old versionbits will be compatible.<br/>

3. Non-mining nodes upgrade stage: after 4032 continuous blocks with new versionbits, mining nodes will start to refuse transactions with old versionbits. Only transactions with new versionbits can be relayed and included in blocks. Transactions with old versionbits can be safely purged from memory pools.<br/>

4. (Optional)Protocol Upgrade stage: The codes dealing with protocol upgrade can be integrated in the third stage. After the non-mining nodes upgrades to support newer version of transactions, the codes with protocol upgrade must be included and now we can use miner vote to activate and finish this upgrade.<br/>

??????????<br/>

At this point, the protocol upgrade have phased in.<br/>

==Benefits==

1. ?????????????????????????????99.9% ??????55% ????? 340 ?????????????????????????????????????????????????????? 51% ???????????????????????<br/>
2. ????????????????????????????????<br/>
3. ??????? block header ?????? SPV ????????????<br/>
4. ??????????????????????????????????????????????????????????????????????<br/>
5. ?????????????????????????????????????????????????????<br/>
6. ????????????????????????????????????????????????????????????????????????????????<br/>

1. The activation only requires majority miners signal. As described in the paper by Satoshi Nakamoto, 55% miners will be in the longest chain after 340 blocks, with 99.9% certainty. This will minimize the possibility of delaying network upgrades by controlling a small number of hashing power. We can foresee that after 51% signalling, all miners will upgrade within the first grace period. <br/>
2. During the first two grace periods, non-mining nodes will not be affected. They have enough time to upgrade their software. <br/>
3. Versionbits included in block header, not influencing the SPY mining. <br/>
4. After two grace periods, all nodes must be upgraded. Otherwise they cannot send transactions or get any confirmations. Compared with forming new consensus among nodes, the situation is not worse than before. <br/>
5. The ledger in non-mining wallet nodes is honored and reserved. Users of off-chain wallet services can decide whether or not to follow the service providers after they got the public notification from the service providers. <br/>
6. Protocol upgrades in the future can be bonded with the upgrades of nodes, and the upgrades activate through miners vote independently. There would be enough time for nodes to be upgraded in order to support new protocols. Even in case of failing in miner activation, the situation will not worsen and the status quo will remain. <br/>


==Risks==

1. ??????????????????????????????????????<br/>
2. ????????????????????????????????????????????????????????<br/>
3. ?????????????????????????????????????????????????????????????????<br/>
4. ???????????????????????????????????????????????????????????????????????????????????<br/>

1. The fluctuation of the hashing power will affect the result of the longest chain. Higher activating requirement means a lower risk of temporary fork. <br/>
2. Miners could simply signal to avoid being orphaned, but from the perspective of non-mining wallet nodes, they can't distinguish the false signal from the true signal. They must upgrade with the assumption that the signals are all true. After all the non-mining nodes have upgraded, the miners signalling false signal should follow. <br/>
3. Non-mining wallet nodes could false signal without supporting the new protocol but since the total number of nodes cannot be distinguished, genuine nodes should follow the proven result provided by miners vote. <br/>
4. Miners and non-mining nodes could conspire to fork using old protocol consensus. It can't be eliminated, just like in the past but through most passive non-mining nodes being upgraded, their benefit is reduced. <br/>


==Implementation==
___TBD___


From james.hilliard1 at gmail.com  Tue Jun 13 05:44:23 2017
From: james.hilliard1 at gmail.com (James Hilliard)
Date: Tue, 13 Jun 2017 00:44:23 -0500
Subject: [bitcoin-dev] Proposal: Demonstration of Phase in Full Network
 Upgrade Activated by Miners
In-Reply-To: <A6AE8145-8C8A-44C2-88D3-8574D895AF6B@gmail.com>
References: <A6AE8145-8C8A-44C2-88D3-8574D895AF6B@gmail.com>
Message-ID: <CADvTj4pu8LbETyduWj__U2txyvqZD9B8FFmLDPSiM4t+pTSuZQ@mail.gmail.com>

On Mon, Jun 12, 2017 at 9:23 PM, Zheming Lin via bitcoin-dev
<bitcoin-dev at lists.linuxfoundation.org> wrote:
> The BIP is described using Chinese and English. If any part is missing or need more specific, please reply. Forgive for my poor English.
>
> This method will incorporate any upgrade that affects non-mining nodes. They should beware that the rule has been changed.
>
> TLDR: Major miners activate and orphan the minor. That ensures all miners upgrades. Then invalid the tx from not upgrading nodes. Nodes must upgrade (with other protocol upgrade codes) in order to work. Then the final miner vote over protocol upgrade, with all nodes has the same upgraded codes.
>
> <pre>
> BIP: ???
> Title: Demonstration of Phase in Full Network Upgrade Activated by Miners
> Author: LIN Zheming
> Status: Draft
> Type: Standards Track
> Created: 2017-06-12
> </pre>
>
> ==Summary==
>
> ??????????????????????????????<br/>
> This idea was not created by an individual but is a product of collaboration in the Chinese bitcoin community between different interest groups.<br/>
>
> ????????????????????????????????????????????????????????<br/>
> This method is put forth to incentivize and to protect mining nodes and non-mining nodes during protocol upgrading. With this incentive mechanism, the non-mining nodes will not suffer monetary loss from chain splitting.<br/>
>
> ???????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????<br/>
>
> After the activation condition is met, majority miners will set a new block versionbits after the first grace period(a difficulty change of 2016 blocks). The blocks with lower versionbits will be orphaned. In terms of the Nakamoto Consensus, the end of the first grace period will force all mining nodes upgraded to signal a new version of consensus. After the second grace period ( a difficulty change of 2016 blocks), mining nodes will only accept transactions with new versionbits. Transactions from nodes not upgrading will not be relayed nor included in blocks with new versionbits. This will protect funds of non-mining nodes from utilizing replay attack and will function as a notification for them to upgrade. Codes dealing with protocol upgrade could be included in the upgrade. After the non-mining node upgrades, mining nodes will vote to activate the protocol upgrade and this will achieve the broad/widespread deployment of the protocol upgrade.<br/>
>
> ???????????????????????????<br/>
> The protocol upgrade depends on its activate condition independently even after the change deployed among nodes.<br/>
>
> ==Motivation==
>
> ????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????<br/>
> In view of the fact that the original Bitcoin consensus did not consider the non-mining wallet nodes(as mentioned above), the result is that upgrading the consensus of these wallet nodes is passive and lazy. When there is disagreement in the direction of the upgrade, the miners have no mechanism to ensure that the chain being extended is the chain widely accepted by the wallet nodes. This also adversely affects the security of the wallet nodes.<br/>
Wallet nodes being able to fully validate and choose whether or not to
accept a particular chain is an important part of bitcoins security
model.
>
> ??????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????<br/>
>
> Apart from ensuring the asset security of wallet nodes, this method can be used to provide additional incentives to upgrade the protocol for the wallet nodes. Once the wallet nodes upgrade their protocol, the miners' nodes can be guaranteed to work - not only on the longest chain, but also on the longest chain used by other wallet nodes in the broader bitcoin sphere. Under the Nakamoto Consensus, there will be no persistent forks as protocol upgrades can be phased in.<br/>
There is no way to guarantee a wallet node will accept a particular
block since that is always up to the user.
>
> ==Specification==
>
> 1. ??????? versionbits ???????????BIP ??????????????? nVersion ?????<br/>
> 2. ??????? tx version ?????????????? tx version ? 1???? tx version ? 2 ???????????????? tx version ? 1 ??????<br/>
>
> 1. Mining nodes signal by setting a version bit. While this BIP is active, all blocks must set the chosen nVersion.<br/>
> 2. Mining nodes will use tx version to define current version transactions. Current tx version is 1, and tx version 2 will be allowed. After the second grace period, tx version 1 will be regarded as invalid.<br/>
Sounds like this would cause issues with pre-signed time locked transactions.
>
>
> ==Deployment==
> ???????????????????????????????????<br/>
>
> Protocol upgrading will phase in over three stages. We can have an optional fourth stage to integrate codes of protocol upgrade.<br/>
>
> 1. ??????????? versionbits ??????????????? 55% ????? 1109/2016 ??????????????????????<br/>
> 2. ???????????????? 2016 ?????????????? 2218/4032???????????????????????????????????????????????????????????????<br/>
> 3. ????????????????????? 4032 ????????????????????????????????????????????????????????<br/>
> 4. ????????????????????????????????????????????????????????????????????????????????????????????
>
> 1. Signal stage: Mining nodes signal using BIP9. The next stage will be activated after 55% (1109) of 2016 blocks has the signal.<br/>
>
> 2. Mining nodes upgrade stage: After a first grace period of 2016 blocks and total signalling blocks passed 2218 of 4032 blocks, miners broadcasting blocks with new versionbits in block headers will orphan blocks with old versionbits. At this stage all nodes can send transactions with new versionbits, and transactions with old versionbits will be compatible.<br/>
>
> 3. Non-mining nodes upgrade stage: after 4032 continuous blocks with new versionbits, mining nodes will start to refuse transactions with old versionbits. Only transactions with new versionbits can be relayed and included in blocks. Transactions with old versionbits can be safely purged from memory pools.<br/>
>
> 4. (Optional)Protocol Upgrade stage: The codes dealing with protocol upgrade can be integrated in the third stage. After the non-mining nodes upgrades to support newer version of transactions, the codes with protocol upgrade must be included and now we can use miner vote to activate and finish this upgrade.<br/>
>
> ??????????<br/>
>
> At this point, the protocol upgrade have phased in.<br/>
>
> ==Benefits==
>
> 1. ?????????????????????????????99.9% ??????55% ????? 340 ?????????????????????????????????????????????????????? 51% ???????????????????????<br/>
> 2. ????????????????????????????????<br/>
> 3. ??????? block header ?????? SPV ????????????<br/>
> 4. ??????????????????????????????????????????????????????????????????????<br/>
> 5. ?????????????????????????????????????????????????????<br/>
> 6. ????????????????????????????????????????????????????????????????????????????????<br/>
>
> 1. The activation only requires majority miners signal. As described in the paper by Satoshi Nakamoto, 55% miners will be in the longest chain after 340 blocks, with 99.9% certainty. This will minimize the possibility of delaying network upgrades by controlling a small number of hashing power. We can foresee that after 51% signalling, all miners will upgrade within the first grace period. <br/>
Technically soft forks can be implemented at 55% hashpower already
without an orphaning period(like BIP16). Those that don't upgrade
would just be at risk of mining invalid blocks. One would not want to
use this method to try and activate a controversial hard fork since
it's trivial for miners to false signal. The orphaning period
effectively forces miners to make a decision but does not necessarily
force them to make a particular decision since they can simply choose
to reject the fork and false signal.
> 2. During the first two grace periods, non-mining nodes will not be affected. They have enough time to upgrade their software. <br/>
> 3. Versionbits included in block header, not influencing the SPY mining. <br/>
The widely deployed stratum based SPV mining does not really provide a
proper way to validate nversion of the previous block, it only lets
you see the nversion of the current stratum job since you don't get a
full bock header. There's always a risk here that miners build on top
of invalid blocks when SPV mining.
> 4. After two grace periods, all nodes must be upgraded. Otherwise they cannot send transactions or get any confirmations. Compared with forming new consensus among nodes, the situation is not worse than before. <br/>
Previous consensus changes have largely been done in backwards
compatible ways which lets users opt-in to new features. In general
backwards compatibility is considered a good thing, this seems to make
that worse.
> 5. The ledger in non-mining wallet nodes is honored and reserved. Users of off-chain wallet services can decide whether or not to follow the service providers after they got the public notification from the service providers. <br/>
> 6. Protocol upgrades in the future can be bonded with the upgrades of nodes, and the upgrades activate through miners vote independently. There would be enough time for nodes to be upgraded in order to support new protocols. Even in case of failing in miner activation, the situation will not worsen and the status quo will remain. <br/>
>
>
> ==Risks==
>
> 1. ??????????????????????????????????????<br/>
> 2. ????????????????????????????????????????????????????????<br/>
> 3. ?????????????????????????????????????????????????????????????????<br/>
> 4. ???????????????????????????????????????????????????????????????????????????????????<br/>
>
> 1. The fluctuation of the hashing power will affect the result of the longest chain. Higher activating requirement means a lower risk of temporary fork. <br/>
> 2. Miners could simply signal to avoid being orphaned, but from the perspective of non-mining wallet nodes, they can't distinguish the false signal from the true signal. They must upgrade with the assumption that the signals are all true. After all the non-mining nodes have upgraded, the miners signalling false signal should follow. <br/>
Miners can simply announce they are false signalling with coinbase
tags and other methods. This activation method would likely not be
viable for controversial changes.
> 3. Non-mining wallet nodes could false signal without supporting the new protocol but since the total number of nodes cannot be distinguished, genuine nodes should follow the proven result provided by miners vote. <br/>
Users would likely take into account markets and other factors when
deciding what to do, the total number of nodes doesn't really matter
much. Miner signalling is not necessarily indicative of economic and
user support.
> 4. Miners and non-mining nodes could conspire to fork using old protocol consensus. It can't be eliminated, just like in the past but through most passive non-mining nodes being upgraded, their benefit is reduced. <br/>
>
>
> ==Implementation==
> ___TBD___
>
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev

From james.hilliard1 at gmail.com  Tue Jun 13 07:19:24 2017
From: james.hilliard1 at gmail.com (James Hilliard)
Date: Tue, 13 Jun 2017 02:19:24 -0500
Subject: [bitcoin-dev] Proposal: Demonstration of Phase in Full Network
 Upgrade Activated by Miners
In-Reply-To: <2002E56E-45F8-4B4B-A7A5-CBEF739D5D8B@gmail.com>
References: <A6AE8145-8C8A-44C2-88D3-8574D895AF6B@gmail.com>
	<CADvTj4pu8LbETyduWj__U2txyvqZD9B8FFmLDPSiM4t+pTSuZQ@mail.gmail.com>
	<2002E56E-45F8-4B4B-A7A5-CBEF739D5D8B@gmail.com>
Message-ID: <CADvTj4o-Jv2=VZ-+KeSiWTR6av-fGgJuxxWnsckFY=L7Ff0yUA@mail.gmail.com>

On Tue, Jun 13, 2017 at 1:50 AM, Zheming Lin <heater at gmail.com> wrote:
> Hi James:
>
> Thank you very much for detailed feedback. Sorry for my understanding of
> English being poor. I?ll try to answer that.
>
>
> ? 2017?6?13??13:44?James Hilliard <james.hilliard1 at gmail.com> ???
>
> On Mon, Jun 12, 2017 at 9:23 PM, Zheming Lin via bitcoin-dev
> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>
> The BIP is described using Chinese and English. If any part is missing or
> need more specific, please reply. Forgive for my poor English.
>
> This method will incorporate any upgrade that affects non-mining nodes. They
> should beware that the rule has been changed.
>
> TLDR: Major miners activate and orphan the minor. That ensures all miners
> upgrades. Then invalid the tx from not upgrading nodes. Nodes must upgrade
> (with other protocol upgrade codes) in order to work. Then the final miner
> vote over protocol upgrade, with all nodes has the same upgraded codes.
>
> ==Motivation==
>
> ????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????<br/>
> In view of the fact that the original Bitcoin consensus did not consider the
> non-mining wallet nodes(as mentioned above), the result is that upgrading
> the consensus of these wallet nodes is passive and lazy. When there is
> disagreement in the direction of the upgrade, the miners have no mechanism
> to ensure that the chain being extended is the chain widely accepted by the
> wallet nodes. This also adversely affects the security of the wallet
> nodes.<br/>
>
> Wallet nodes being able to fully validate and choose whether or not to
> accept a particular chain is an important part of bitcoins security
> model.
>
>
> ????????????????????????????????????????????????????????????????????? BIP148
> ????
>
> I admitted that these nodes a very important. so we don?t want these nodes
> suffer financial loss by undetectable network change. These nodes always
> have choice like BIP148.
>
>
> ??????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????<br/>
>
> Apart from ensuring the asset security of wallet nodes, this method can be
> used to provide additional incentives to upgrade the protocol for the wallet
> nodes. Once the wallet nodes upgrade their protocol, the miners' nodes can
> be guaranteed to work - not only on the longest chain, but also on the
> longest chain used by other wallet nodes in the broader bitcoin sphere.
> Under the Nakamoto Consensus, there will be no persistent forks as protocol
> upgrades can be phased in.<br/>
>
> There is no way to guarantee a wallet node will accept a particular
> block since that is always up to the user.
>
>
> ???????????????????????????????????????
> We can not have any guarantee. but we can have incentives that they
> participate and be aware about the change happening.
> ???????????
> Users always have choice.
>
>
> ==Specification==
>
> 1. ??????? versionbits ???????????BIP ??????????????? nVersion ?????<br/>
> 2. ??????? tx version ?????????????? tx version ? 1???? tx version ? 2
> ???????????????? tx version ? 1 ??????<br/>
>
> 1. Mining nodes signal by setting a version bit. While this BIP is active,
> all blocks must set the chosen nVersion.<br/>
> 2. Mining nodes will use tx version to define current version transactions.
> Current tx version is 1, and tx version 2 will be allowed. After the second
> grace period, tx version 1 will be regarded as invalid.<br/>
>
> Sounds like this would cause issues with pre-signed time locked
> transactions.
>
>
> ????????????????????????????????????????????????????????????????
> They can be re-enable in the successful or unsuccessful activation of the
> fourth stage. Whether or not, what they need is to be prepared for the
> future coming. But they can?t be left behind or be cheated like nothing
> happened.
>
>
>
> ==Deployment==
> ???????????????????????????????????<br/>
>
> Protocol upgrading will phase in over three stages. We can have an optional
> fourth stage to integrate codes of protocol upgrade.<br/>
>
> 1. ??????????? versionbits ??????????????? 55% ????? 1109/2016
> ??????????????????????<br/>
> 2. ???????????????? 2016 ??????????????
> 2218/4032???????????????????????????????????????????????????????????????<br/>
> 3. ????????????????????? 4032
> ????????????????????????????????????????????????????????<br/>
> 4.
> ????????????????????????????????????????????????????????????????????????????????????????????
>
> 1. Signal stage: Mining nodes signal using BIP9. The next stage will be
> activated after 55% (1109) of 2016 blocks has the signal.<br/>
>
> 2. Mining nodes upgrade stage: After a first grace period of 2016 blocks and
> total signalling blocks passed 2218 of 4032 blocks, miners broadcasting
> blocks with new versionbits in block headers will orphan blocks with old
> versionbits. At this stage all nodes can send transactions with new
> versionbits, and transactions with old versionbits will be compatible.<br/>
>
> 3. Non-mining nodes upgrade stage: after 4032 continuous blocks with new
> versionbits, mining nodes will start to refuse transactions with old
> versionbits. Only transactions with new versionbits can be relayed and
> included in blocks. Transactions with old versionbits can be safely purged
> from memory pools.<br/>
>
> 4. (Optional)Protocol Upgrade stage: The codes dealing with protocol upgrade
> can be integrated in the third stage. After the non-mining nodes upgrades to
> support newer version of transactions, the codes with protocol upgrade must
> be included and now we can use miner vote to activate and finish this
> upgrade.<br/>
>
> ??????????<br/>
>
> At this point, the protocol upgrade have phased in.<br/>
>
> ==Benefits==
>
> 1. ?????????????????????????????99.9% ??????55% ????? 340
> ?????????????????????????????????????????????????????? 51%
> ???????????????????????<br/>
> 2. ????????????????????????????????<br/>
> 3. ??????? block header ?????? SPV ????????????<br/>
> 4.
> ??????????????????????????????????????????????????????????????????????<br/>
> 5. ?????????????????????????????????????????????????????<br/>
> 6.
> ????????????????????????????????????????????????????????????????????????????????<br/>
>
> 1. The activation only requires majority miners signal. As described in the
> paper by Satoshi Nakamoto, 55% miners will be in the longest chain after 340
> blocks, with 99.9% certainty. This will minimize the possibility of delaying
> network upgrades by controlling a small number of hashing power. We can
> foresee that after 51% signalling, all miners will upgrade within the first
> grace period. <br/>
>
> Technically soft forks can be implemented at 55% hashpower already
> without an orphaning period(like BIP16). Those that don't upgrade
> would just be at risk of mining invalid blocks. One would not want to
> use this method to try and activate a controversial hard fork since
> it's trivial for miners to false signal. The orphaning period
> effectively forces miners to make a decision but does not necessarily
> force them to make a particular decision since they can simply choose
> to reject the fork and false signal.
>
>
> ??????????????????????????????????????????????????????????????????????????????????
> False signal can?t be solved in my opinion. If the majority part just don?t
> agree with the change, why they cheat? If the majority part is honest as
> described in nakamoto consensus, I think that won?t be a problem. CPU power
> always decides.

Nakamoto consensus is used to determine the longest chain among
multiple valid chains, it's not enough to determine validity by
itself. For example in a hard fork if a minority of hashpower decided
not to fork then they would simply consider the forked chain invalid
and ignore it, even if that majority chain had significantly more
work.

>
>
> 2. During the first two grace periods, non-mining nodes will not be
> affected. They have enough time to upgrade their software. <br/>
> 3. Versionbits included in block header, not influencing the SPY mining.
> <br/>
>
> The widely deployed stratum based SPV mining does not really provide a
> proper way to validate nversion of the previous block, it only lets
> you see the nversion of the current stratum job since you don't get a
> full bock header. There's always a risk here that miners build on top
> of invalid blocks when SPV mining.
>
>
> ??????????????????????? SPY ??????????
> Maybe I?m wrong. Please give some advice that how to make it compatible with
> SPY mining.

It's just problematic in general and I'm not sure there's a good way
around it other than putting as many safety nets as possible in place
to limit the amount of time miners mine on invalid work. For example
when an invalid BU blocks was mined on the network more than 50% of
hashpower mined on top of it for a short period of time.

>
> 4. After two grace periods, all nodes must be upgraded. Otherwise they
> cannot send transactions or get any confirmations. Compared with forming new
> consensus among nodes, the situation is not worse than before. <br/>
>
> Previous consensus changes have largely been done in backwards
> compatible ways which lets users opt-in to new features. In general
> backwards compatibility is considered a good thing, this seems to make
> that worse.
>
>
> ????????????????????????????????????????????
> It would not force our nodes to do anything that changes the consensus. But
> they should be prepared for the **maybe** upcoming changes.
> ???????????????????????????????????
> Protocol upgrades could be done using miners vote. but the progress of
> voting should be acknowledged by all nodes.

I'm not seeing how it could be considered backwards compatible if
"they cannot send transactions or get any confirmations".

>
>
> 5. The ledger in non-mining wallet nodes is honored and reserved. Users of
> off-chain wallet services can decide whether or not to follow the service
> providers after they got the public notification from the service providers.
> <br/>
> 6. Protocol upgrades in the future can be bonded with the upgrades of nodes,
> and the upgrades activate through miners vote independently. There would be
> enough time for nodes to be upgraded in order to support new protocols. Even
> in case of failing in miner activation, the situation will not worsen and
> the status quo will remain. <br/>
>
>
> ==Risks==
>
> 1. ??????????????????????????????????????<br/>
> 2. ????????????????????????????????????????????????????????<br/>
> 3. ?????????????????????????????????????????????????????????????????<br/>
> 4.
> ???????????????????????????????????????????????????????????????????????????????????<br/>
>
> 1. The fluctuation of the hashing power will affect the result of the
> longest chain. Higher activating requirement means a lower risk of temporary
> fork. <br/>
> 2. Miners could simply signal to avoid being orphaned, but from the
> perspective of non-mining wallet nodes, they can't distinguish the false
> signal from the true signal. They must upgrade with the assumption that the
> signals are all true. After all the non-mining nodes have upgraded, the
> miners signalling false signal should follow. <br/>
>
> Miners can simply announce they are false signalling with coinbase
> tags and other methods. This activation method would likely not be
> viable for controversial changes.
>
>
> ?????????????????????
> False signal won?t be a problem if majority miners are honest.

I'm referring to a potential situation where 55% of miners want a
change and 45% don't, the 45% could false signal.

>
> 3. Non-mining wallet nodes could false signal without supporting the new
> protocol but since the total number of nodes cannot be distinguished,
> genuine nodes should follow the proven result provided by miners vote. <br/>
>
> Users would likely take into account markets and other factors when
> deciding what to do, the total number of nodes doesn't really matter
> much. Miner signalling is not necessarily indicative of economic and
> user support.
>
>
> ???????????????????????????????
> Miners should vote unbiasedly under the condition that most users are not
> affected by protocol upgrading.
>
>
> 4. Miners and non-mining nodes could conspire to fork using old protocol
> consensus. It can't be eliminated, just like in the past but through most
> passive non-mining nodes being upgraded, their benefit is reduced. <br/>
>
>
> ==Implementation==
> ___TBD___
>
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>
>

From james.hilliard1 at gmail.com  Tue Jun 13 08:37:43 2017
From: james.hilliard1 at gmail.com (James Hilliard)
Date: Tue, 13 Jun 2017 03:37:43 -0500
Subject: [bitcoin-dev] Proposal: Demonstration of Phase in Full Network
 Upgrade Activated by Miners
In-Reply-To: <65B4ED60-0351-4A8D-942A-56BC8C230E4A@gmail.com>
References: <A6AE8145-8C8A-44C2-88D3-8574D895AF6B@gmail.com>
	<CADvTj4pu8LbETyduWj__U2txyvqZD9B8FFmLDPSiM4t+pTSuZQ@mail.gmail.com>
	<2002E56E-45F8-4B4B-A7A5-CBEF739D5D8B@gmail.com>
	<CADvTj4o-Jv2=VZ-+KeSiWTR6av-fGgJuxxWnsckFY=L7Ff0yUA@mail.gmail.com>
	<65B4ED60-0351-4A8D-942A-56BC8C230E4A@gmail.com>
Message-ID: <CADvTj4pqiv2kKqqaGwMK8nysite65_85FCkDfKoswkR6KmOJPw@mail.gmail.com>

On Tue, Jun 13, 2017 at 3:13 AM, Zheming Lin <heater at gmail.com> wrote:
> Hi James:
>
> ? 2017?6?13??15:19?James Hilliard <james.hilliard1 at gmail.com> ???
>
> On Tue, Jun 13, 2017 at 1:50 AM, Zheming Lin <heater at gmail.com> wrote:
>
> Hi James:
>
> Thank you very much for detailed feedback. Sorry for my understanding of
> English being poor. I?ll try to answer that.
>
>
> ? 2017?6?13??13:44?James Hilliard <james.hilliard1 at gmail.com> ???
>
>
> 1. The activation only requires majority miners signal. As described in the
> paper by Satoshi Nakamoto, 55% miners will be in the longest chain after 340
> blocks, with 99.9% certainty. This will minimize the possibility of delaying
> network upgrades by controlling a small number of hashing power. We can
> foresee that after 51% signalling, all miners will upgrade within the first
> grace period. <br/>
>
> Technically soft forks can be implemented at 55% hashpower already
> without an orphaning period(like BIP16). Those that don't upgrade
> would just be at risk of mining invalid blocks. One would not want to
> use this method to try and activate a controversial hard fork since
> it's trivial for miners to false signal. The orphaning period
> effectively forces miners to make a decision but does not necessarily
> force them to make a particular decision since they can simply choose
> to reject the fork and false signal.
>
>
> ??????????????????????????????????????????????????????????????????????????????????
> False signal can?t be solved in my opinion. If the majority part just don?t
> agree with the change, why they cheat? If the majority part is honest as
> described in nakamoto consensus, I think that won?t be a problem. CPU power
> always decides.
>
>
> Nakamoto consensus is used to determine the longest chain among
> multiple valid chains, it's not enough to determine validity by
> itself. For example in a hard fork if a minority of hashpower decided
> not to fork then they would simply consider the forked chain invalid
> and ignore it, even if that majority chain had significantly more
> work.
>
>
> ?????????????????????????????????????????????
> The node should decide to follow the protocol upgrade or not. But they can?t
> just be passive and do nothing. The choice is always provided.
>
> ??????????????????????????????????
> If they don?t trust the choice of majority miners, they can use some alt
> coin that don?t including miners? part.

They generally don't have to switch to an altcoin when they get to
choose which blocks they accept ultimately. This is a key component of
Bitcoin's incentive model since it makes it so miners are unlikely to
do a hard fork if their blocks would not be accepted by nodes/users.
For example if 55% of miners wanted to hard fork and change the block
reward back to 50 BTC the minority side would not need to switch to an
altcoin, they would just need to ignore those 50 BTC block reward
blocks.

>
>
>
> 2. During the first two grace periods, non-mining nodes will not be
> affected. They have enough time to upgrade their software. <br/>
> 3. Versionbits included in block header, not influencing the SPY mining.
> <br/>
>
> The widely deployed stratum based SPV mining does not really provide a
> proper way to validate nversion of the previous block, it only lets
> you see the nversion of the current stratum job since you don't get a
> full bock header. There's always a risk here that miners build on top
> of invalid blocks when SPV mining.
>
>
> ??????????????????????? SPY ??????????
> Maybe I?m wrong. Please give some advice that how to make it compatible with
> SPY mining.
>
>
> It's just problematic in general and I'm not sure there's a good way
> around it other than putting as many safety nets as possible in place
> to limit the amount of time miners mine on invalid work. For example
> when an invalid BU blocks was mined on the network more than 50% of
> hashpower mined on top of it for a short period of time.
>
>
> ???????????????????? SPY ??????????????????
> We should introduce block validation in the code, but how to provide
> incentive to no-validating SPY miner is another problem.
>
>
>
> 4. After two grace periods, all nodes must be upgraded. Otherwise they
> cannot send transactions or get any confirmations. Compared with forming new
> consensus among nodes, the situation is not worse than before. <br/>
>
> Previous consensus changes have largely been done in backwards
> compatible ways which lets users opt-in to new features. In general
> backwards compatibility is considered a good thing, this seems to make
> that worse.
>
>
> ????????????????????????????????????????????
> It would not force our nodes to do anything that changes the consensus. But
> they should be prepared for the **maybe** upcoming changes.
> ???????????????????????????????????
> Protocol upgrades could be done using miners vote. but the progress of
> voting should be acknowledged by all nodes.
>
>
> I'm not seeing how it could be considered backwards compatible if
> "they cannot send transactions or get any confirmations?.
>
>
> ??????????????????????????????xxx????xxx???????????????
> I don?t see them as completely backwards compatible. since I don?t see that
> is important if we all agree with ?after block height xxx, then xxx?.
> ?????????????????????
> And we can validate from the genesis block till today.

By backwards compatible I mean being able to continue functioning
without updating the node, soft forks are generally backwards
compatible because you can still transact even if you don't upgrade
your node to support the soft fork, you just won't be able to use the
new soft fork features.

>
>
>
>
> 5. The ledger in non-mining wallet nodes is honored and reserved. Users of
> off-chain wallet services can decide whether or not to follow the service
> providers after they got the public notification from the service providers.
> <br/>
> 6. Protocol upgrades in the future can be bonded with the upgrades of nodes,
> and the upgrades activate through miners vote independently. There would be
> enough time for nodes to be upgraded in order to support new protocols. Even
> in case of failing in miner activation, the situation will not worsen and
> the status quo will remain. <br/>
>
>
> ==Risks==
>
> 1. ??????????????????????????????????????<br/>
> 2. ????????????????????????????????????????????????????????<br/>
> 3. ?????????????????????????????????????????????????????????????????<br/>
> 4.
> ???????????????????????????????????????????????????????????????????????????????????<br/>
>
> 1. The fluctuation of the hashing power will affect the result of the
> longest chain. Higher activating requirement means a lower risk of temporary
> fork. <br/>
> 2. Miners could simply signal to avoid being orphaned, but from the
> perspective of non-mining wallet nodes, they can't distinguish the false
> signal from the true signal. They must upgrade with the assumption that the
> signals are all true. After all the non-mining nodes have upgraded, the
> miners signalling false signal should follow. <br/>
>
> Miners can simply announce they are false signalling with coinbase
> tags and other methods. This activation method would likely not be
> viable for controversial changes.
>
>
> ?????????????????????
> False signal won?t be a problem if majority miners are honest.
>
>
> I'm referring to a potential situation where 55% of miners want a
> change and 45% don't, the 45% could false signal.
>
>
> ???45% ????????????????????????????????????????
> Of cause, there could be false signal from 45% and have conspiracy with some
> nodes. But that?s the problem we have today, and it don?t get any worse (nor
> any better).
>
>
>
> 3. Non-mining wallet nodes could false signal without supporting the new
> protocol but since the total number of nodes cannot be distinguished,
> genuine nodes should follow the proven result provided by miners vote. <br/>
>
> Users would likely take into account markets and other factors when
> deciding what to do, the total number of nodes doesn't really matter
> much. Miner signalling is not necessarily indicative of economic and
> user support.
>
>
> ???????????????????????????????
> Miners should vote unbiasedly under the condition that most users are not
> affected by protocol upgrading.
>
>
> 4. Miners and non-mining nodes could conspire to fork using old protocol
> consensus. It can't be eliminated, just like in the past but through most
> passive non-mining nodes being upgraded, their benefit is reduced. <br/>
>
>
> ==Implementation==
> ___TBD___
>
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>
>

From heater at gmail.com  Tue Jun 13 06:50:26 2017
From: heater at gmail.com (Zheming Lin)
Date: Tue, 13 Jun 2017 14:50:26 +0800
Subject: [bitcoin-dev] Proposal: Demonstration of Phase in Full Network
 Upgrade Activated by Miners
In-Reply-To: <CADvTj4pu8LbETyduWj__U2txyvqZD9B8FFmLDPSiM4t+pTSuZQ@mail.gmail.com>
References: <A6AE8145-8C8A-44C2-88D3-8574D895AF6B@gmail.com>
	<CADvTj4pu8LbETyduWj__U2txyvqZD9B8FFmLDPSiM4t+pTSuZQ@mail.gmail.com>
Message-ID: <2002E56E-45F8-4B4B-A7A5-CBEF739D5D8B@gmail.com>

Hi James:

Thank you very much for detailed feedback. Sorry for my understanding of English being poor. I?ll try to answer that.


> ? 2017?6?13??13:44?James Hilliard <james.hilliard1 at gmail.com> ???
> 
> On Mon, Jun 12, 2017 at 9:23 PM, Zheming Lin via bitcoin-dev
> <bitcoin-dev at lists.linuxfoundation.org <mailto:bitcoin-dev at lists.linuxfoundation.org>> wrote:
>> The BIP is described using Chinese and English. If any part is missing or need more specific, please reply. Forgive for my poor English.
>> 
>> This method will incorporate any upgrade that affects non-mining nodes. They should beware that the rule has been changed.
>> 
>> TLDR: Major miners activate and orphan the minor. That ensures all miners upgrades. Then invalid the tx from not upgrading nodes. Nodes must upgrade (with other protocol upgrade codes) in order to work. Then the final miner vote over protocol upgrade, with all nodes has the same upgraded codes.
>> 
>> ==Motivation==
>> 
>> ????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????<br/>
>> In view of the fact that the original Bitcoin consensus did not consider the non-mining wallet nodes(as mentioned above), the result is that upgrading the consensus of these wallet nodes is passive and lazy. When there is disagreement in the direction of the upgrade, the miners have no mechanism to ensure that the chain being extended is the chain widely accepted by the wallet nodes. This also adversely affects the security of the wallet nodes.<br/>
> Wallet nodes being able to fully validate and choose whether or not to
> accept a particular chain is an important part of bitcoins security
> model.

????????????????????????????????????????????????????????????????????? BIP148 ????

I admitted that these nodes a very important. so we don?t want these nodes suffer financial loss by undetectable network change. These nodes always have choice like BIP148.

>> 
>> ??????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????<br/>
>> 
>> Apart from ensuring the asset security of wallet nodes, this method can be used to provide additional incentives to upgrade the protocol for the wallet nodes. Once the wallet nodes upgrade their protocol, the miners' nodes can be guaranteed to work - not only on the longest chain, but also on the longest chain used by other wallet nodes in the broader bitcoin sphere. Under the Nakamoto Consensus, there will be no persistent forks as protocol upgrades can be phased in.<br/>
> There is no way to guarantee a wallet node will accept a particular
> block since that is always up to the user.

???????????????????????????????????????
We can not have any guarantee. but we can have incentives that they participate and be aware about the change happening.
???????????
Users always have choice.

>> 
>> ==Specification==
>> 
>> 1. ??????? versionbits ???????????BIP ??????????????? nVersion ?????<br/>
>> 2. ??????? tx version ?????????????? tx version ? 1???? tx version ? 2 ???????????????? tx version ? 1 ??????<br/>
>> 
>> 1. Mining nodes signal by setting a version bit. While this BIP is active, all blocks must set the chosen nVersion.<br/>
>> 2. Mining nodes will use tx version to define current version transactions. Current tx version is 1, and tx version 2 will be allowed. After the second grace period, tx version 1 will be regarded as invalid.<br/>
> Sounds like this would cause issues with pre-signed time locked transactions.

????????????????????????????????????????????????????????????????
They can be re-enable in the successful or unsuccessful activation of the fourth stage. Whether or not, what they need is to be prepared for the future coming. But they can?t be left behind or be cheated like nothing happened.

>> 
>> 
>> ==Deployment==
>> ???????????????????????????????????<br/>
>> 
>> Protocol upgrading will phase in over three stages. We can have an optional fourth stage to integrate codes of protocol upgrade.<br/>
>> 
>> 1. ??????????? versionbits ??????????????? 55% ????? 1109/2016 ??????????????????????<br/>
>> 2. ???????????????? 2016 ?????????????? 2218/4032???????????????????????????????????????????????????????????????<br/>
>> 3. ????????????????????? 4032 ????????????????????????????????????????????????????????<br/>
>> 4. ????????????????????????????????????????????????????????????????????????????????????????????
>> 
>> 1. Signal stage: Mining nodes signal using BIP9. The next stage will be activated after 55% (1109) of 2016 blocks has the signal.<br/>
>> 
>> 2. Mining nodes upgrade stage: After a first grace period of 2016 blocks and total signalling blocks passed 2218 of 4032 blocks, miners broadcasting blocks with new versionbits in block headers will orphan blocks with old versionbits. At this stage all nodes can send transactions with new versionbits, and transactions with old versionbits will be compatible.<br/>
>> 
>> 3. Non-mining nodes upgrade stage: after 4032 continuous blocks with new versionbits, mining nodes will start to refuse transactions with old versionbits. Only transactions with new versionbits can be relayed and included in blocks. Transactions with old versionbits can be safely purged from memory pools.<br/>
>> 
>> 4. (Optional)Protocol Upgrade stage: The codes dealing with protocol upgrade can be integrated in the third stage. After the non-mining nodes upgrades to support newer version of transactions, the codes with protocol upgrade must be included and now we can use miner vote to activate and finish this upgrade.<br/>
>> 
>> ??????????<br/>
>> 
>> At this point, the protocol upgrade have phased in.<br/>
>> 
>> ==Benefits==
>> 
>> 1. ?????????????????????????????99.9% ??????55% ????? 340 ?????????????????????????????????????????????????????? 51% ???????????????????????<br/>
>> 2. ????????????????????????????????<br/>
>> 3. ??????? block header ?????? SPV ????????????<br/>
>> 4. ??????????????????????????????????????????????????????????????????????<br/>
>> 5. ?????????????????????????????????????????????????????<br/>
>> 6. ????????????????????????????????????????????????????????????????????????????????<br/>
>> 
>> 1. The activation only requires majority miners signal. As described in the paper by Satoshi Nakamoto, 55% miners will be in the longest chain after 340 blocks, with 99.9% certainty. This will minimize the possibility of delaying network upgrades by controlling a small number of hashing power. We can foresee that after 51% signalling, all miners will upgrade within the first grace period. <br/>
> Technically soft forks can be implemented at 55% hashpower already
> without an orphaning period(like BIP16). Those that don't upgrade
> would just be at risk of mining invalid blocks. One would not want to
> use this method to try and activate a controversial hard fork since
> it's trivial for miners to false signal. The orphaning period
> effectively forces miners to make a decision but does not necessarily
> force them to make a particular decision since they can simply choose
> to reject the fork and false signal.

??????????????????????????????????????????????????????????????????????????????????
False signal can?t be solved in my opinion. If the majority part just don?t agree with the change, why they cheat? If the majority part is honest as described in nakamoto consensus, I think that won?t be a problem. CPU power always decides.


>> 2. During the first two grace periods, non-mining nodes will not be affected. They have enough time to upgrade their software. <br/>
>> 3. Versionbits included in block header, not influencing the SPY mining. <br/>
> The widely deployed stratum based SPV mining does not really provide a
> proper way to validate nversion of the previous block, it only lets
> you see the nversion of the current stratum job since you don't get a
> full bock header. There's always a risk here that miners build on top
> of invalid blocks when SPV mining.

??????????????????????? SPY ??????????
Maybe I?m wrong. Please give some advice that how to make it compatible with SPY mining.

>> 4. After two grace periods, all nodes must be upgraded. Otherwise they cannot send transactions or get any confirmations. Compared with forming new consensus among nodes, the situation is not worse than before. <br/>
> Previous consensus changes have largely been done in backwards
> compatible ways which lets users opt-in to new features. In general
> backwards compatibility is considered a good thing, this seems to make
> that worse.

????????????????????????????????????????????
It would not force our nodes to do anything that changes the consensus. But they should be prepared for the **maybe** upcoming changes.
???????????????????????????????????
Protocol upgrades could be done using miners vote. but the progress of voting should be acknowledged by all nodes.


>> 5. The ledger in non-mining wallet nodes is honored and reserved. Users of off-chain wallet services can decide whether or not to follow the service providers after they got the public notification from the service providers. <br/>
>> 6. Protocol upgrades in the future can be bonded with the upgrades of nodes, and the upgrades activate through miners vote independently. There would be enough time for nodes to be upgraded in order to support new protocols. Even in case of failing in miner activation, the situation will not worsen and the status quo will remain. <br/>
>> 
>> 
>> ==Risks==
>> 
>> 1. ??????????????????????????????????????<br/>
>> 2. ????????????????????????????????????????????????????????<br/>
>> 3. ?????????????????????????????????????????????????????????????????<br/>
>> 4. ???????????????????????????????????????????????????????????????????????????????????<br/>
>> 
>> 1. The fluctuation of the hashing power will affect the result of the longest chain. Higher activating requirement means a lower risk of temporary fork. <br/>
>> 2. Miners could simply signal to avoid being orphaned, but from the perspective of non-mining wallet nodes, they can't distinguish the false signal from the true signal. They must upgrade with the assumption that the signals are all true. After all the non-mining nodes have upgraded, the miners signalling false signal should follow. <br/>
> Miners can simply announce they are false signalling with coinbase
> tags and other methods. This activation method would likely not be
> viable for controversial changes.

?????????????????????
False signal won?t be a problem if majority miners are honest.

>> 3. Non-mining wallet nodes could false signal without supporting the new protocol but since the total number of nodes cannot be distinguished, genuine nodes should follow the proven result provided by miners vote. <br/>
> Users would likely take into account markets and other factors when
> deciding what to do, the total number of nodes doesn't really matter
> much. Miner signalling is not necessarily indicative of economic and
> user support.

???????????????????????????????
Miners should vote unbiasedly under the condition that most users are not affected by protocol upgrading.


>> 4. Miners and non-mining nodes could conspire to fork using old protocol consensus. It can't be eliminated, just like in the past but through most passive non-mining nodes being upgraded, their benefit is reduced. <br/>
>> 
>> 
>> ==Implementation==
>> ___TBD___
>> 
>> _______________________________________________
>> bitcoin-dev mailing list
>> bitcoin-dev at lists.linuxfoundation.org <mailto:bitcoin-dev at lists.linuxfoundation.org>
>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev <https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170613/edd5d2d6/attachment-0001.html>

From heater at gmail.com  Tue Jun 13 08:13:58 2017
From: heater at gmail.com (Zheming Lin)
Date: Tue, 13 Jun 2017 16:13:58 +0800
Subject: [bitcoin-dev] Proposal: Demonstration of Phase in Full Network
 Upgrade Activated by Miners
In-Reply-To: <CADvTj4o-Jv2=VZ-+KeSiWTR6av-fGgJuxxWnsckFY=L7Ff0yUA@mail.gmail.com>
References: <A6AE8145-8C8A-44C2-88D3-8574D895AF6B@gmail.com>
	<CADvTj4pu8LbETyduWj__U2txyvqZD9B8FFmLDPSiM4t+pTSuZQ@mail.gmail.com>
	<2002E56E-45F8-4B4B-A7A5-CBEF739D5D8B@gmail.com>
	<CADvTj4o-Jv2=VZ-+KeSiWTR6av-fGgJuxxWnsckFY=L7Ff0yUA@mail.gmail.com>
Message-ID: <65B4ED60-0351-4A8D-942A-56BC8C230E4A@gmail.com>

Hi James:

> ? 2017?6?13??15:19?James Hilliard <james.hilliard1 at gmail.com> ???
> 
> On Tue, Jun 13, 2017 at 1:50 AM, Zheming Lin <heater at gmail.com <mailto:heater at gmail.com>> wrote:
>> Hi James:
>> 
>> Thank you very much for detailed feedback. Sorry for my understanding of
>> English being poor. I?ll try to answer that.
>> 
>> 
>> ? 2017?6?13??13:44?James Hilliard <james.hilliard1 at gmail.com> ???
>> 
>> 
>> 1. The activation only requires majority miners signal. As described in the
>> paper by Satoshi Nakamoto, 55% miners will be in the longest chain after 340
>> blocks, with 99.9% certainty. This will minimize the possibility of delaying
>> network upgrades by controlling a small number of hashing power. We can
>> foresee that after 51% signalling, all miners will upgrade within the first
>> grace period. <br/>
>> 
>> Technically soft forks can be implemented at 55% hashpower already
>> without an orphaning period(like BIP16). Those that don't upgrade
>> would just be at risk of mining invalid blocks. One would not want to
>> use this method to try and activate a controversial hard fork since
>> it's trivial for miners to false signal. The orphaning period
>> effectively forces miners to make a decision but does not necessarily
>> force them to make a particular decision since they can simply choose
>> to reject the fork and false signal.
>> 
>> 
>> ??????????????????????????????????????????????????????????????????????????????????
>> False signal can?t be solved in my opinion. If the majority part just don?t
>> agree with the change, why they cheat? If the majority part is honest as
>> described in nakamoto consensus, I think that won?t be a problem. CPU power
>> always decides.
> 
> Nakamoto consensus is used to determine the longest chain among
> multiple valid chains, it's not enough to determine validity by
> itself. For example in a hard fork if a minority of hashpower decided
> not to fork then they would simply consider the forked chain invalid
> and ignore it, even if that majority chain had significantly more
> work.
> 

?????????????????????????????????????????????
The node should decide to follow the protocol upgrade or not. But they can?t just be passive and do nothing. The choice is always provided.

??????????????????????????????????
If they don?t trust the choice of majority miners, they can use some alt coin that don?t including miners? part.

>> 
>> 
>> 2. During the first two grace periods, non-mining nodes will not be
>> affected. They have enough time to upgrade their software. <br/>
>> 3. Versionbits included in block header, not influencing the SPY mining.
>> <br/>
>> 
>> The widely deployed stratum based SPV mining does not really provide a
>> proper way to validate nversion of the previous block, it only lets
>> you see the nversion of the current stratum job since you don't get a
>> full bock header. There's always a risk here that miners build on top
>> of invalid blocks when SPV mining.
>> 
>> 
>> ??????????????????????? SPY ??????????
>> Maybe I?m wrong. Please give some advice that how to make it compatible with
>> SPY mining.
> 
> It's just problematic in general and I'm not sure there's a good way
> around it other than putting as many safety nets as possible in place
> to limit the amount of time miners mine on invalid work. For example
> when an invalid BU blocks was mined on the network more than 50% of
> hashpower mined on top of it for a short period of time.
> 

???????????????????? SPY ??????????????????
We should introduce block validation in the code, but how to provide incentive to no-validating SPY miner is another problem.


>> 
>> 4. After two grace periods, all nodes must be upgraded. Otherwise they
>> cannot send transactions or get any confirmations. Compared with forming new
>> consensus among nodes, the situation is not worse than before. <br/>
>> 
>> Previous consensus changes have largely been done in backwards
>> compatible ways which lets users opt-in to new features. In general
>> backwards compatibility is considered a good thing, this seems to make
>> that worse.
>> 
>> 
>> ????????????????????????????????????????????
>> It would not force our nodes to do anything that changes the consensus. But
>> they should be prepared for the **maybe** upcoming changes.
>> ???????????????????????????????????
>> Protocol upgrades could be done using miners vote. but the progress of
>> voting should be acknowledged by all nodes.
> 
> I'm not seeing how it could be considered backwards compatible if
> "they cannot send transactions or get any confirmations?.

??????????????????????????????xxx????xxx???????????????
I don?t see them as completely backwards compatible. since I don?t see that is important if we all agree with ?after block height xxx, then xxx?.
?????????????????????
And we can validate from the genesis block till today.


>> 
>> 
>> 5. The ledger in non-mining wallet nodes is honored and reserved. Users of
>> off-chain wallet services can decide whether or not to follow the service
>> providers after they got the public notification from the service providers.
>> <br/>
>> 6. Protocol upgrades in the future can be bonded with the upgrades of nodes,
>> and the upgrades activate through miners vote independently. There would be
>> enough time for nodes to be upgraded in order to support new protocols. Even
>> in case of failing in miner activation, the situation will not worsen and
>> the status quo will remain. <br/>
>> 
>> 
>> ==Risks==
>> 
>> 1. ??????????????????????????????????????<br/>
>> 2. ????????????????????????????????????????????????????????<br/>
>> 3. ?????????????????????????????????????????????????????????????????<br/>
>> 4.
>> ???????????????????????????????????????????????????????????????????????????????????<br/>
>> 
>> 1. The fluctuation of the hashing power will affect the result of the
>> longest chain. Higher activating requirement means a lower risk of temporary
>> fork. <br/>
>> 2. Miners could simply signal to avoid being orphaned, but from the
>> perspective of non-mining wallet nodes, they can't distinguish the false
>> signal from the true signal. They must upgrade with the assumption that the
>> signals are all true. After all the non-mining nodes have upgraded, the
>> miners signalling false signal should follow. <br/>
>> 
>> Miners can simply announce they are false signalling with coinbase
>> tags and other methods. This activation method would likely not be
>> viable for controversial changes.
>> 
>> 
>> ?????????????????????
>> False signal won?t be a problem if majority miners are honest.
> 
> I'm referring to a potential situation where 55% of miners want a
> change and 45% don't, the 45% could false signal.
> 

???45% ????????????????????????????????????????
Of cause, there could be false signal from 45% and have conspiracy with some nodes. But that?s the problem we have today, and it don?t get any worse (nor any better).


>> 
>> 3. Non-mining wallet nodes could false signal without supporting the new
>> protocol but since the total number of nodes cannot be distinguished,
>> genuine nodes should follow the proven result provided by miners vote. <br/>
>> 
>> Users would likely take into account markets and other factors when
>> deciding what to do, the total number of nodes doesn't really matter
>> much. Miner signalling is not necessarily indicative of economic and
>> user support.
>> 
>> 
>> ???????????????????????????????
>> Miners should vote unbiasedly under the condition that most users are not
>> affected by protocol upgrading.
>> 
>> 
>> 4. Miners and non-mining nodes could conspire to fork using old protocol
>> consensus. It can't be eliminated, just like in the past but through most
>> passive non-mining nodes being upgraded, their benefit is reduced. <br/>
>> 
>> 
>> ==Implementation==
>> ___TBD___
>> 
>> _______________________________________________
>> bitcoin-dev mailing list
>> bitcoin-dev at lists.linuxfoundation.org
>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170613/5b7117d4/attachment-0001.html>

From heater at gmail.com  Tue Jun 13 08:24:41 2017
From: heater at gmail.com (Zheming Lin)
Date: Tue, 13 Jun 2017 16:24:41 +0800
Subject: [bitcoin-dev] Proposal: Demonstration of Phase in Full Network
 Upgrade Activated by Miners
In-Reply-To: <A6AE8145-8C8A-44C2-88D3-8574D895AF6B@gmail.com>
References: <A6AE8145-8C8A-44C2-88D3-8574D895AF6B@gmail.com>
Message-ID: <E84B5CB9-7288-4773-A9CA-E36072F4953B@gmail.com>

Hi all the developers:

I must clarify that despite the general ideas comes from discussions with others. The opinion in replies are only limited to my self.

The old TXs can be re-enable after the fourth stage and just like **nothing happened** with the grace periods. The code can be provided with the protocol upgrade voting. At the end of the vote, either success or failed, we can have old TXs work again. It?s like after a long time that the block jammed. I think nobody get harmed (Is there? I?m not so sure about that), that?s the purpose.

Thank you for your time and kindly replies. Your opinions are more than welcome.

LIN Zheming

> ? 2017?6?13??10:23?Zheming Lin <heater at gmail.com> ???
> 
> The BIP is described using Chinese and English. If any part is missing or need more specific, please reply. Forgive for my poor English.
> 
> This method will incorporate any upgrade that affects non-mining nodes. They should beware that the rule has been changed.
> 
> TLDR: Major miners activate and orphan the minor. That ensures all miners upgrades. Then invalid the tx from not upgrading nodes. Nodes must upgrade (with other protocol upgrade codes) in order to work. Then the final miner vote over protocol upgrade, with all nodes has the same upgraded codes.
> 
> <pre>
> BIP: ???
> Title: Demonstration of Phase in Full Network Upgrade Activated by Miners
> Author: LIN Zheming
> Status: Draft
> Type: Standards Track
> Created: 2017-06-12
> </pre>
> 
> ==Summary==
> 
> ??????????????????????????????<br/>
> This idea was not created by an individual but is a product of collaboration in the Chinese bitcoin community between different interest groups.<br/>
> 
> ????????????????????????????????????????????????????????<br/>
> This method is put forth to incentivize and to protect mining nodes and non-mining nodes during protocol upgrading. With this incentive mechanism, the non-mining nodes will not suffer monetary loss from chain splitting.<br/>
> 
> ???????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????<br/>
> 
> After the activation condition is met, majority miners will set a new block versionbits after the first grace period(a difficulty change of 2016 blocks). The blocks with lower versionbits will be orphaned. In terms of the Nakamoto Consensus, the end of the first grace period will force all mining nodes upgraded to signal a new version of consensus. After the second grace period ( a difficulty change of 2016 blocks), mining nodes will only accept transactions with new versionbits. Transactions from nodes not upgrading will not be relayed nor included in blocks with new versionbits. This will protect funds of non-mining nodes from utilizing replay attack and will function as a notification for them to upgrade. Codes dealing with protocol upgrade could be included in the upgrade. After the non-mining node upgrades, mining nodes will vote to activate the protocol upgrade and this will achieve the broad/widespread deployment of the protocol upgrade.<br/>
> 
> ???????????????????????????<br/>
> The protocol upgrade depends on its activate condition independently even after the change deployed among nodes.<br/>
> 
> ==Motivation==
> 
> ????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????<br/>
> In view of the fact that the original Bitcoin consensus did not consider the non-mining wallet nodes(as mentioned above), the result is that upgrading the consensus of these wallet nodes is passive and lazy. When there is disagreement in the direction of the upgrade, the miners have no mechanism to ensure that the chain being extended is the chain widely accepted by the wallet nodes. This also adversely affects the security of the wallet nodes.<br/>
> 
> ??????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????<br/>
> 
> Apart from ensuring the asset security of wallet nodes, this method can be used to provide additional incentives to upgrade the protocol for the wallet nodes. Once the wallet nodes upgrade their protocol, the miners' nodes can be guaranteed to work - not only on the longest chain, but also on the longest chain used by other wallet nodes in the broader bitcoin sphere. Under the Nakamoto Consensus, there will be no persistent forks as protocol upgrades can be phased in.<br/>
> 
> ==Specification==
> 
> 1. ??????? versionbits ???????????BIP ??????????????? nVersion ?????<br/>
> 2. ??????? tx version ?????????????? tx version ? 1???? tx version ? 2 ???????????????? tx version ? 1 ??????<br/>
> 
> 1. Mining nodes signal by setting a version bit. While this BIP is active, all blocks must set the chosen nVersion.<br/>
> 2. Mining nodes will use tx version to define current version transactions. Current tx version is 1, and tx version 2 will be allowed. After the second grace period, tx version 1 will be regarded as invalid.<br/>
> 
> 
> ==Deployment==
> ???????????????????????????????????<br/>
> 
> Protocol upgrading will phase in over three stages. We can have an optional fourth stage to integrate codes of protocol upgrade.<br/>
> 
> 1. ??????????? versionbits ??????????????? 55% ????? 1109/2016 ??????????????????????<br/>
> 2. ???????????????? 2016 ?????????????? 2218/4032???????????????????????????????????????????????????????????????<br/>
> 3. ????????????????????? 4032 ????????????????????????????????????????????????????????<br/>
> 4. ????????????????????????????????????????????????????????????????????????????????????????????
> 
> 1. Signal stage: Mining nodes signal using BIP9. The next stage will be activated after 55% (1109) of 2016 blocks has the signal.<br/>
> 
> 2. Mining nodes upgrade stage: After a first grace period of 2016 blocks and total signalling blocks passed 2218 of 4032 blocks, miners broadcasting blocks with new versionbits in block headers will orphan blocks with old versionbits. At this stage all nodes can send transactions with new versionbits, and transactions with old versionbits will be compatible.<br/>
> 
> 3. Non-mining nodes upgrade stage: after 4032 continuous blocks with new versionbits, mining nodes will start to refuse transactions with old versionbits. Only transactions with new versionbits can be relayed and included in blocks. Transactions with old versionbits can be safely purged from memory pools.<br/>
> 
> 4. (Optional)Protocol Upgrade stage: The codes dealing with protocol upgrade can be integrated in the third stage. After the non-mining nodes upgrades to support newer version of transactions, the codes with protocol upgrade must be included and now we can use miner vote to activate and finish this upgrade.<br/>
> 
> ??????????<br/>
> 
> At this point, the protocol upgrade have phased in.<br/>
> 
> ==Benefits==
> 
> 1. ?????????????????????????????99.9% ??????55% ????? 340 ?????????????????????????????????????????????????????? 51% ???????????????????????<br/>
> 2. ????????????????????????????????<br/>
> 3. ??????? block header ?????? SPV ????????????<br/>
> 4. ??????????????????????????????????????????????????????????????????????<br/>
> 5. ?????????????????????????????????????????????????????<br/>
> 6. ????????????????????????????????????????????????????????????????????????????????<br/>
> 
> 1. The activation only requires majority miners signal. As described in the paper by Satoshi Nakamoto, 55% miners will be in the longest chain after 340 blocks, with 99.9% certainty. This will minimize the possibility of delaying network upgrades by controlling a small number of hashing power. We can foresee that after 51% signalling, all miners will upgrade within the first grace period. <br/>
> 2. During the first two grace periods, non-mining nodes will not be affected. They have enough time to upgrade their software. <br/>
> 3. Versionbits included in block header, not influencing the SPY mining. <br/>
> 4. After two grace periods, all nodes must be upgraded. Otherwise they cannot send transactions or get any confirmations. Compared with forming new consensus among nodes, the situation is not worse than before. <br/>
> 5. The ledger in non-mining wallet nodes is honored and reserved. Users of off-chain wallet services can decide whether or not to follow the service providers after they got the public notification from the service providers. <br/>
> 6. Protocol upgrades in the future can be bonded with the upgrades of nodes, and the upgrades activate through miners vote independently. There would be enough time for nodes to be upgraded in order to support new protocols. Even in case of failing in miner activation, the situation will not worsen and the status quo will remain. <br/>
> 
> 
> ==Risks==
> 
> 1. ??????????????????????????????????????<br/>
> 2. ????????????????????????????????????????????????????????<br/>
> 3. ?????????????????????????????????????????????????????????????????<br/>
> 4. ???????????????????????????????????????????????????????????????????????????????????<br/>
> 
> 1. The fluctuation of the hashing power will affect the result of the longest chain. Higher activating requirement means a lower risk of temporary fork. <br/>
> 2. Miners could simply signal to avoid being orphaned, but from the perspective of non-mining wallet nodes, they can't distinguish the false signal from the true signal. They must upgrade with the assumption that the signals are all true. After all the non-mining nodes have upgraded, the miners signalling false signal should follow. <br/>
> 3. Non-mining wallet nodes could false signal without supporting the new protocol but since the total number of nodes cannot be distinguished, genuine nodes should follow the proven result provided by miners vote. <br/>
> 4. Miners and non-mining nodes could conspire to fork using old protocol consensus. It can't be eliminated, just like in the past but through most passive non-mining nodes being upgraded, their benefit is reduced. <br/>
> 
> 
> ==Implementation==
> ___TBD___
> 


From james.hilliard1 at gmail.com  Tue Jun 13 10:20:11 2017
From: james.hilliard1 at gmail.com (James Hilliard)
Date: Tue, 13 Jun 2017 05:20:11 -0500
Subject: [bitcoin-dev] Proposal: Demonstration of Phase in Full Network
 Upgrade Activated by Miners
In-Reply-To: <E84B5CB9-7288-4773-A9CA-E36072F4953B@gmail.com>
References: <A6AE8145-8C8A-44C2-88D3-8574D895AF6B@gmail.com>
	<E84B5CB9-7288-4773-A9CA-E36072F4953B@gmail.com>
Message-ID: <CADvTj4pGRQ6heHhs9d6ySq3=eW3QKeD6cwFckNeL3j8m_ohYCQ@mail.gmail.com>

On Tue, Jun 13, 2017 at 3:24 AM, Zheming Lin via bitcoin-dev
<bitcoin-dev at lists.linuxfoundation.org> wrote:
> Hi all the developers:
>
> I must clarify that despite the general ideas comes from discussions with others. The opinion in replies are only limited to my self.
>
> The old TXs can be re-enable after the fourth stage and just like **nothing happened** with the grace periods. The code can be provided with the protocol upgrade voting. At the end of the vote, either success or failed, we can have old TXs work again. It?s like after a long time that the block jammed. I think nobody get harmed (Is there? I?m not so sure about that), that?s the purpose.

I think that would cause problems with systems like lightning network
that rely on reliable confirmations of transactions as part of their
security models.

>
> Thank you for your time and kindly replies. Your opinions are more than welcome.
>
> LIN Zheming
>
>> ? 2017?6?13??10:23?Zheming Lin <heater at gmail.com> ???
>>
>> The BIP is described using Chinese and English. If any part is missing or need more specific, please reply. Forgive for my poor English.
>>
>> This method will incorporate any upgrade that affects non-mining nodes. They should beware that the rule has been changed.
>>
>> TLDR: Major miners activate and orphan the minor. That ensures all miners upgrades. Then invalid the tx from not upgrading nodes. Nodes must upgrade (with other protocol upgrade codes) in order to work. Then the final miner vote over protocol upgrade, with all nodes has the same upgraded codes.
>>
>> <pre>
>> BIP: ???
>> Title: Demonstration of Phase in Full Network Upgrade Activated by Miners
>> Author: LIN Zheming
>> Status: Draft
>> Type: Standards Track
>> Created: 2017-06-12
>> </pre>
>>
>> ==Summary==
>>
>> ??????????????????????????????<br/>
>> This idea was not created by an individual but is a product of collaboration in the Chinese bitcoin community between different interest groups.<br/>
>>
>> ????????????????????????????????????????????????????????<br/>
>> This method is put forth to incentivize and to protect mining nodes and non-mining nodes during protocol upgrading. With this incentive mechanism, the non-mining nodes will not suffer monetary loss from chain splitting.<br/>
>>
>> ???????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????<br/>
>>
>> After the activation condition is met, majority miners will set a new block versionbits after the first grace period(a difficulty change of 2016 blocks). The blocks with lower versionbits will be orphaned. In terms of the Nakamoto Consensus, the end of the first grace period will force all mining nodes upgraded to signal a new version of consensus. After the second grace period ( a difficulty change of 2016 blocks), mining nodes will only accept transactions with new versionbits. Transactions from nodes not upgrading will not be relayed nor included in blocks with new versionbits. This will protect funds of non-mining nodes from utilizing replay attack and will function as a notification for them to upgrade. Codes dealing with protocol upgrade could be included in the upgrade. After the non-mining node upgrades, mining nodes will vote to activate the protocol upgrade and this will achieve the broad/widespread deployment of the protocol upgrade.<br/>
>>
>> ???????????????????????????<br/>
>> The protocol upgrade depends on its activate condition independently even after the change deployed among nodes.<br/>
>>
>> ==Motivation==
>>
>> ????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????<br/>
>> In view of the fact that the original Bitcoin consensus did not consider the non-mining wallet nodes(as mentioned above), the result is that upgrading the consensus of these wallet nodes is passive and lazy. When there is disagreement in the direction of the upgrade, the miners have no mechanism to ensure that the chain being extended is the chain widely accepted by the wallet nodes. This also adversely affects the security of the wallet nodes.<br/>
>>
>> ??????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????<br/>
>>
>> Apart from ensuring the asset security of wallet nodes, this method can be used to provide additional incentives to upgrade the protocol for the wallet nodes. Once the wallet nodes upgrade their protocol, the miners' nodes can be guaranteed to work - not only on the longest chain, but also on the longest chain used by other wallet nodes in the broader bitcoin sphere. Under the Nakamoto Consensus, there will be no persistent forks as protocol upgrades can be phased in.<br/>
>>
>> ==Specification==
>>
>> 1. ??????? versionbits ???????????BIP ??????????????? nVersion ?????<br/>
>> 2. ??????? tx version ?????????????? tx version ? 1???? tx version ? 2 ???????????????? tx version ? 1 ??????<br/>
>>
>> 1. Mining nodes signal by setting a version bit. While this BIP is active, all blocks must set the chosen nVersion.<br/>
>> 2. Mining nodes will use tx version to define current version transactions. Current tx version is 1, and tx version 2 will be allowed. After the second grace period, tx version 1 will be regarded as invalid.<br/>
>>
>>
>> ==Deployment==
>> ???????????????????????????????????<br/>
>>
>> Protocol upgrading will phase in over three stages. We can have an optional fourth stage to integrate codes of protocol upgrade.<br/>
>>
>> 1. ??????????? versionbits ??????????????? 55% ????? 1109/2016 ??????????????????????<br/>
>> 2. ???????????????? 2016 ?????????????? 2218/4032???????????????????????????????????????????????????????????????<br/>
>> 3. ????????????????????? 4032 ????????????????????????????????????????????????????????<br/>
>> 4. ????????????????????????????????????????????????????????????????????????????????????????????
>>
>> 1. Signal stage: Mining nodes signal using BIP9. The next stage will be activated after 55% (1109) of 2016 blocks has the signal.<br/>
>>
>> 2. Mining nodes upgrade stage: After a first grace period of 2016 blocks and total signalling blocks passed 2218 of 4032 blocks, miners broadcasting blocks with new versionbits in block headers will orphan blocks with old versionbits. At this stage all nodes can send transactions with new versionbits, and transactions with old versionbits will be compatible.<br/>
>>
>> 3. Non-mining nodes upgrade stage: after 4032 continuous blocks with new versionbits, mining nodes will start to refuse transactions with old versionbits. Only transactions with new versionbits can be relayed and included in blocks. Transactions with old versionbits can be safely purged from memory pools.<br/>
>>
>> 4. (Optional)Protocol Upgrade stage: The codes dealing with protocol upgrade can be integrated in the third stage. After the non-mining nodes upgrades to support newer version of transactions, the codes with protocol upgrade must be included and now we can use miner vote to activate and finish this upgrade.<br/>
>>
>> ??????????<br/>
>>
>> At this point, the protocol upgrade have phased in.<br/>
>>
>> ==Benefits==
>>
>> 1. ?????????????????????????????99.9% ??????55% ????? 340 ?????????????????????????????????????????????????????? 51% ???????????????????????<br/>
>> 2. ????????????????????????????????<br/>
>> 3. ??????? block header ?????? SPV ????????????<br/>
>> 4. ??????????????????????????????????????????????????????????????????????<br/>
>> 5. ?????????????????????????????????????????????????????<br/>
>> 6. ????????????????????????????????????????????????????????????????????????????????<br/>
>>
>> 1. The activation only requires majority miners signal. As described in the paper by Satoshi Nakamoto, 55% miners will be in the longest chain after 340 blocks, with 99.9% certainty. This will minimize the possibility of delaying network upgrades by controlling a small number of hashing power. We can foresee that after 51% signalling, all miners will upgrade within the first grace period. <br/>
>> 2. During the first two grace periods, non-mining nodes will not be affected. They have enough time to upgrade their software. <br/>
>> 3. Versionbits included in block header, not influencing the SPY mining. <br/>
>> 4. After two grace periods, all nodes must be upgraded. Otherwise they cannot send transactions or get any confirmations. Compared with forming new consensus among nodes, the situation is not worse than before. <br/>
>> 5. The ledger in non-mining wallet nodes is honored and reserved. Users of off-chain wallet services can decide whether or not to follow the service providers after they got the public notification from the service providers. <br/>
>> 6. Protocol upgrades in the future can be bonded with the upgrades of nodes, and the upgrades activate through miners vote independently. There would be enough time for nodes to be upgraded in order to support new protocols. Even in case of failing in miner activation, the situation will not worsen and the status quo will remain. <br/>
>>
>>
>> ==Risks==
>>
>> 1. ??????????????????????????????????????<br/>
>> 2. ????????????????????????????????????????????????????????<br/>
>> 3. ?????????????????????????????????????????????????????????????????<br/>
>> 4. ???????????????????????????????????????????????????????????????????????????????????<br/>
>>
>> 1. The fluctuation of the hashing power will affect the result of the longest chain. Higher activating requirement means a lower risk of temporary fork. <br/>
>> 2. Miners could simply signal to avoid being orphaned, but from the perspective of non-mining wallet nodes, they can't distinguish the false signal from the true signal. They must upgrade with the assumption that the signals are all true. After all the non-mining nodes have upgraded, the miners signalling false signal should follow. <br/>
>> 3. Non-mining wallet nodes could false signal without supporting the new protocol but since the total number of nodes cannot be distinguished, genuine nodes should follow the proven result provided by miners vote. <br/>
>> 4. Miners and non-mining nodes could conspire to fork using old protocol consensus. It can't be eliminated, just like in the past but through most passive non-mining nodes being upgraded, their benefit is reduced. <br/>
>>
>>
>> ==Implementation==
>> ___TBD___
>>
>
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev

From greg at xiph.org  Tue Jun 13 18:11:39 2017
From: greg at xiph.org (Gregory Maxwell)
Date: Tue, 13 Jun 2017 18:11:39 +0000
Subject: [bitcoin-dev] Proposal: Demonstration of Phase in Full Network
 Upgrade Activated by Miners
In-Reply-To: <A6AE8145-8C8A-44C2-88D3-8574D895AF6B@gmail.com>
References: <A6AE8145-8C8A-44C2-88D3-8574D895AF6B@gmail.com>
Message-ID: <CAAS2fgT=0k0NJWsO_TtBRTi2VqZtzuT1d1Sk+KZ2+2PUcA71tg@mail.gmail.com>

On Tue, Jun 13, 2017 at 2:23 AM, Zheming Lin via bitcoin-dev
<bitcoin-dev at lists.linuxfoundation.org> wrote:
> The BIP is described using Chinese and English. If any part is missing or need more specific, please reply. Forgive for my poor English.

Your English is much better than my Chinese.  Thank you for taking the
time to write this.

I am still reading and trying to completely understand your proposal
but I wanted to make one observation:

> ????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????<br/>
> In view of the fact that the original Bitcoin consensus did not consider the non-mining wallet nodes(as mentioned above), the result is that upgrading the consensus of these wallet nodes is passive and lazy.

This is not true. Non-mining wallet nodes were considered, and their
upgrade practices are not usually slower than miners.

Even in the very first version of the software it did not mine unless
the user went into the settings and explicitly turned it on or used a
command-line option.  By default, every installation of Bitcoin was a
non-mining wallet node.

The enforcement of the system's rules by users broadly, and not just
miners, is specifically described in the white paper (section 8,
paragraph 2, it especially clear in the last sentence).  This is
critical for the security of Bitcoin especially with the current
degree of centralization in pools.  Without it, Bitcoin's security
would look a lot more like the Ripple system.

Frequently it is the miners that are "passive and lazy" in upgrading.
In some cases when new versions have had major improvements specific
to mining (such as for 0.8) miners upgraded much faster than other
nodes. But often, it is the other way around and miners adopt new
versions much slower than other nodes. If you look at block
construction today you will see that many miners are running highly
outdated node software which is more than one or even two years old.
(and as a result, they lose out on a considerable amount of
transaction fees.)

In fact, many miners have the most severe form of passive behavior:
they do not run a node at all but simply sell their hash power to
pools (which themselves are often slow to upgrade).  By comparison,
http://luke.dashjr.org/programs/bitcoin/files/charts/branches.html 95%
of reachable nodes are running software now from the last year and a
half.

I do not, however, believe that it is a problem that anyone is slow to upgrade.

Reliability cannot be maintained in infrastructure if it is rapidly
changing.  A normal deployment process for major systems
infrastructure outside of Bitcoin usually takes months because time
must be given to test and find bugs.

Miners depend on their income from mining and interruptions can be
very costly.  Many pools are also involved with altcoins which are
constantly breaking and they have their attention directed elsewhere
and cannot quickly spare the time required to upgrade their software.
These delays are the natural consequence of a decentralized system
where no one has the power to force other people to adopt their
priorities.

If you look at the deployment processes of major internet protocols,
HTTP2, new versions of SSH, BGP,  or IP itself you will find that
upgrades often happen slower than the entire life of Bitcoin so far--
and none of these protocols have the difficult consistency challenges
of Bitcoin or as much risk of irreparable financial loss if things go
wrong.

Because many people in the Bitcoin community appears to expect
upgrades much faster than even centralized ISP backbones upgrade their
router software I think they have unrealistic expectations with how
fast upgrading can occur while preserving stability, security, and
decentralization and unrealistic expectations of how fast upgrading
will occur so long as no one has the ability to force other people to
run their upgrades.

I look forward to competing my understanding of your proposal.

Cheers,

From jaredr26 at gmail.com  Tue Jun 13 19:35:13 2017
From: jaredr26 at gmail.com (Jared Lee Richardson)
Date: Tue, 13 Jun 2017 12:35:13 -0700
Subject: [bitcoin-dev] Proposal: Demonstration of Phase in Full Network
 Upgrade Activated by Miners
In-Reply-To: <CADvTj4pu8LbETyduWj__U2txyvqZD9B8FFmLDPSiM4t+pTSuZQ@mail.gmail.com>
References: <A6AE8145-8C8A-44C2-88D3-8574D895AF6B@gmail.com>
	<CADvTj4pu8LbETyduWj__U2txyvqZD9B8FFmLDPSiM4t+pTSuZQ@mail.gmail.com>
Message-ID: <CAD1TkXvkNKiVUqYudFVEgPv5vT8K8JTBt8ZM+qn5su+JpdMqxw@mail.gmail.com>

> Wallet nodes being able to fully validate and choose whether or not to
accept a particular chain is an important part of bitcoins security
model.

What you're describing is effectively the same as BU.

Nodes follow chains, they do not decide the victor.  The average user
follows the default of the software, which is to follow the longest valid
chain.  Forcing the average user to decide which software to run is far
more valuable than allowing "the software" to decide things, when in fact
all it will do is decide the previous default.

> One would not want to
> use this method to try and activate a controversial hard fork since
> it's trivial for miners to false signal. The orphaning period
> effectively forces miners to make a decision but does not necessarily
> force them to make a particular decision

This is true and a good point.  A false signal from miners could trick the
honest miners into forking off prematurely with a minority.

>  it only lets
> you see the nversion of the current stratum job since you don't get a
> full bock header. There's always a risk here that miners build on top
> of invalid blocks when SPV mining.

This is the job of the stratum server and the pool operator.  These are
distinct responsibilities; Miners should choose a pool operator in line
with their desires.  Solo mining is basically dead, as it will never again
be practical(and has not been for at least 2 years) for the same hardware
that does the mining to also do full node operation.

If the pool operator/stratum server also does not do validation, then any
number of problems could occur.




On Mon, Jun 12, 2017 at 10:44 PM, James Hilliard via bitcoin-dev <
bitcoin-dev at lists.linuxfoundation.org> wrote:

> On Mon, Jun 12, 2017 at 9:23 PM, Zheming Lin via bitcoin-dev
> <bitcoin-dev at lists.linuxfoundation.org> wrote:
> > The BIP is described using Chinese and English. If any part is missing
> or need more specific, please reply. Forgive for my poor English.
> >
> > This method will incorporate any upgrade that affects non-mining nodes.
> They should beware that the rule has been changed.
> >
> > TLDR: Major miners activate and orphan the minor. That ensures all
> miners upgrades. Then invalid the tx from not upgrading nodes. Nodes must
> upgrade (with other protocol upgrade codes) in order to work. Then the
> final miner vote over protocol upgrade, with all nodes has the same
> upgraded codes.
> >
> > <pre>
> > BIP: ???
> > Title: Demonstration of Phase in Full Network Upgrade Activated by Miners
> > Author: LIN Zheming
> > Status: Draft
> > Type: Standards Track
> > Created: 2017-06-12
> > </pre>
> >
> > ==Summary==
> >
> > ??????????????????????????????<br/>
> > This idea was not created by an individual but is a product of
> collaboration in the Chinese bitcoin community between different interest
> groups.<br/>
> >
> > ????????????????????????????????????????????????????????<br/>
> > This method is put forth to incentivize and to protect mining nodes and
> non-mining nodes during protocol upgrading. With this incentive mechanism,
> the non-mining nodes will not suffer monetary loss from chain
> splitting.<br/>
> >
> > ???????????????????????????????????????????????????????
> ????????????????????????????????????????????????????????????????????????
> ???????????????????????????????????????????????????????????????
> ?????????????????????????????????????????????????????<br/>
> >
> > After the activation condition is met, majority miners will set a new
> block versionbits after the first grace period(a difficulty change of 2016
> blocks). The blocks with lower versionbits will be orphaned. In terms of
> the Nakamoto Consensus, the end of the first grace period will force all
> mining nodes upgraded to signal a new version of consensus. After the
> second grace period ( a difficulty change of 2016 blocks), mining nodes
> will only accept transactions with new versionbits. Transactions from nodes
> not upgrading will not be relayed nor included in blocks with new
> versionbits. This will protect funds of non-mining nodes from utilizing
> replay attack and will function as a notification for them to upgrade.
> Codes dealing with protocol upgrade could be included in the upgrade. After
> the non-mining node upgrades, mining nodes will vote to activate the
> protocol upgrade and this will achieve the broad/widespread deployment of
> the protocol upgrade.<br/>
> >
> > ???????????????????????????<br/>
> > The protocol upgrade depends on its activate condition independently
> even after the change deployed among nodes.<br/>
> >
> > ==Motivation==
> >
> > ???????????????????????????????????????????????
> ??????????????????????????????????????????????????????????
> ???????????????<br/>
> > In view of the fact that the original Bitcoin consensus did not consider
> the non-mining wallet nodes(as mentioned above), the result is that
> upgrading the consensus of these wallet nodes is passive and lazy. When
> there is disagreement in the direction of the upgrade, the miners have no
> mechanism to ensure that the chain being extended is the chain widely
> accepted by the wallet nodes. This also adversely affects the security of
> the wallet nodes.<br/>
> Wallet nodes being able to fully validate and choose whether or not to
> accept a particular chain is an important part of bitcoins security
> model.
> >
> > ?????????????????????????????????????????????????????????????????????
> ?????????????????????????????????????????????????????<br/>
> >
> > Apart from ensuring the asset security of wallet nodes, this method can
> be used to provide additional incentives to upgrade the protocol for the
> wallet nodes. Once the wallet nodes upgrade their protocol, the miners'
> nodes can be guaranteed to work - not only on the longest chain, but also
> on the longest chain used by other wallet nodes in the broader bitcoin
> sphere. Under the Nakamoto Consensus, there will be no persistent forks as
> protocol upgrades can be phased in.<br/>
> There is no way to guarantee a wallet node will accept a particular
> block since that is always up to the user.
> >
> > ==Specification==
> >
> > 1. ??????? versionbits ???????????BIP ??????????????? nVersion ?????<br/>
> > 2. ??????? tx version ?????????????? tx version ? 1???? tx version ? 2
> ???????????????? tx version ? 1 ??????<br/>
> >
> > 1. Mining nodes signal by setting a version bit. While this BIP is
> active, all blocks must set the chosen nVersion.<br/>
> > 2. Mining nodes will use tx version to define current version
> transactions. Current tx version is 1, and tx version 2 will be allowed.
> After the second grace period, tx version 1 will be regarded as
> invalid.<br/>
> Sounds like this would cause issues with pre-signed time locked
> transactions.
> >
> >
> > ==Deployment==
> > ???????????????????????????????????<br/>
> >
> > Protocol upgrading will phase in over three stages. We can have an
> optional fourth stage to integrate codes of protocol upgrade.<br/>
> >
> > 1. ??????????? versionbits ??????????????? 55% ????? 1109/2016
> ??????????????????????<br/>
> > 2. ???????????????? 2016 ?????????????? 2218/4032?????????????????
> ??????????????????????????????????????????????<br/>
> > 3. ????????????????????? 4032 ????????????????????????????
> ????????????????????????????<br/>
> > 4. ?????????????????????????????????????????????????????????????????
> ???????????????????????????
> >
> > 1. Signal stage: Mining nodes signal using BIP9. The next stage will be
> activated after 55% (1109) of 2016 blocks has the signal.<br/>
> >
> > 2. Mining nodes upgrade stage: After a first grace period of 2016 blocks
> and total signalling blocks passed 2218 of 4032 blocks, miners broadcasting
> blocks with new versionbits in block headers will orphan blocks with old
> versionbits. At this stage all nodes can send transactions with new
> versionbits, and transactions with old versionbits will be compatible.<br/>
> >
> > 3. Non-mining nodes upgrade stage: after 4032 continuous blocks with new
> versionbits, mining nodes will start to refuse transactions with old
> versionbits. Only transactions with new versionbits can be relayed and
> included in blocks. Transactions with old versionbits can be safely purged
> from memory pools.<br/>
> >
> > 4. (Optional)Protocol Upgrade stage: The codes dealing with protocol
> upgrade can be integrated in the third stage. After the non-mining nodes
> upgrades to support newer version of transactions, the codes with protocol
> upgrade must be included and now we can use miner vote to activate and
> finish this upgrade.<br/>
> >
> > ??????????<br/>
> >
> > At this point, the protocol upgrade have phased in.<br/>
> >
> > ==Benefits==
> >
> > 1. ?????????????????????????????99.9% ??????55% ????? 340 ????????????
> ?????????????????????????????????????????? 51%
> ???????????????????????<br/>
> > 2. ????????????????????????????????<br/>
> > 3. ??????? block header ?????? SPV ????????????<br/>
> > 4. ???????????????????????????????????????????
> ???????????????????????????<br/>
> > 5. ?????????????????????????????????????????????????????<br/>
> > 6. ???????????????????????????????????????????????????????????????
> ?????????????????<br/>
> >
> > 1. The activation only requires majority miners signal. As described in
> the paper by Satoshi Nakamoto, 55% miners will be in the longest chain
> after 340 blocks, with 99.9% certainty. This will minimize the possibility
> of delaying network upgrades by controlling a small number of hashing
> power. We can foresee that after 51% signalling, all miners will upgrade
> within the first grace period. <br/>
> Technically soft forks can be implemented at 55% hashpower already
> without an orphaning period(like BIP16). Those that don't upgrade
> would just be at risk of mining invalid blocks. One would not want to
> use this method to try and activate a controversial hard fork since
> it's trivial for miners to false signal. The orphaning period
> effectively forces miners to make a decision but does not necessarily
> force them to make a particular decision since they can simply choose
> to reject the fork and false signal.
> > 2. During the first two grace periods, non-mining nodes will not be
> affected. They have enough time to upgrade their software. <br/>
> > 3. Versionbits included in block header, not influencing the SPY mining.
> <br/>
> The widely deployed stratum based SPV mining does not really provide a
> proper way to validate nversion of the previous block, it only lets
> you see the nversion of the current stratum job since you don't get a
> full bock header. There's always a risk here that miners build on top
> of invalid blocks when SPV mining.
> > 4. After two grace periods, all nodes must be upgraded. Otherwise they
> cannot send transactions or get any confirmations. Compared with forming
> new consensus among nodes, the situation is not worse than before. <br/>
> Previous consensus changes have largely been done in backwards
> compatible ways which lets users opt-in to new features. In general
> backwards compatibility is considered a good thing, this seems to make
> that worse.
> > 5. The ledger in non-mining wallet nodes is honored and reserved. Users
> of off-chain wallet services can decide whether or not to follow the
> service providers after they got the public notification from the service
> providers. <br/>
> > 6. Protocol upgrades in the future can be bonded with the upgrades of
> nodes, and the upgrades activate through miners vote independently. There
> would be enough time for nodes to be upgraded in order to support new
> protocols. Even in case of failing in miner activation, the situation will
> not worsen and the status quo will remain. <br/>
> >
> >
> > ==Risks==
> >
> > 1. ??????????????????????????????????????<br/>
> > 2. ????????????????????????????????????????????????????????<br/>
> > 3. ???????????????????????????????????????????
> ??????????????????????<br/>
> > 4. ??????????????????????????????????????????????????
> ?????????????????????????????????<br/>
> >
> > 1. The fluctuation of the hashing power will affect the result of the
> longest chain. Higher activating requirement means a lower risk of
> temporary fork. <br/>
> > 2. Miners could simply signal to avoid being orphaned, but from the
> perspective of non-mining wallet nodes, they can't distinguish the false
> signal from the true signal. They must upgrade with the assumption that the
> signals are all true. After all the non-mining nodes have upgraded, the
> miners signalling false signal should follow. <br/>
> Miners can simply announce they are false signalling with coinbase
> tags and other methods. This activation method would likely not be
> viable for controversial changes.
> > 3. Non-mining wallet nodes could false signal without supporting the new
> protocol but since the total number of nodes cannot be distinguished,
> genuine nodes should follow the proven result provided by miners vote. <br/>
> Users would likely take into account markets and other factors when
> deciding what to do, the total number of nodes doesn't really matter
> much. Miner signalling is not necessarily indicative of economic and
> user support.
> > 4. Miners and non-mining nodes could conspire to fork using old protocol
> consensus. It can't be eliminated, just like in the past but through most
> passive non-mining nodes being upgraded, their benefit is reduced. <br/>
> >
> >
> > ==Implementation==
> > ___TBD___
> >
> > _______________________________________________
> > bitcoin-dev mailing list
> > bitcoin-dev at lists.linuxfoundation.org
> > https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170613/1f587ffa/attachment-0001.html>

From james.hilliard1 at gmail.com  Wed Jun 14 00:23:06 2017
From: james.hilliard1 at gmail.com (James Hilliard)
Date: Tue, 13 Jun 2017 19:23:06 -0500
Subject: [bitcoin-dev] Proposal: Demonstration of Phase in Full Network
 Upgrade Activated by Miners
In-Reply-To: <CAD1TkXvkNKiVUqYudFVEgPv5vT8K8JTBt8ZM+qn5su+JpdMqxw@mail.gmail.com>
References: <A6AE8145-8C8A-44C2-88D3-8574D895AF6B@gmail.com>
	<CADvTj4pu8LbETyduWj__U2txyvqZD9B8FFmLDPSiM4t+pTSuZQ@mail.gmail.com>
	<CAD1TkXvkNKiVUqYudFVEgPv5vT8K8JTBt8ZM+qn5su+JpdMqxw@mail.gmail.com>
Message-ID: <CADvTj4pbhU_USTBCuAk2pB3=dma-7=shOqdPLXdL1vCETLyq9g@mail.gmail.com>

On Tue, Jun 13, 2017 at 2:35 PM, Jared Lee Richardson
<jaredr26 at gmail.com> wrote:
>> Wallet nodes being able to fully validate and choose whether or not to
> accept a particular chain is an important part of bitcoins security
> model.
>
> What you're describing is effectively the same as BU.

BU by default uses an "Accept Depth" parameter which effectively lets
miners decide block size rules and allows for resource requirements
that are too high for many users to validate. The block size settings
there are effectively placebo controls.

>
> Nodes follow chains, they do not decide the victor.  The average user
> follows the default of the software, which is to follow the longest valid
> chain.  Forcing the average user to decide which software to run is far more
> valuable than allowing "the software" to decide things, when in fact all it
> will do is decide the previous default.

That's largely true that they typically don't decide the victor in
soft forks unless they are the ones to activate the rules
changes(satoshi did this a few times in the early days), however they
make it very difficult for a hard fork to be activated without
consent. Yes, I'm not advocating for having runtime consensus settings
for nodes either, I'm advocating that resource requirements be low
enough that full validation remains possible for a large percentage of
the economy.

>
>> One would not want to
>> use this method to try and activate a controversial hard fork since
>> it's trivial for miners to false signal. The orphaning period
>> effectively forces miners to make a decision but does not necessarily
>> force them to make a particular decision
>
> This is true and a good point.  A false signal from miners could trick the
> honest miners into forking off prematurely with a minority.

More likely the false signal would be used during the orphaning period
to prevent blocks from being orphaned for miners that don't want to
follow the fork.

>
>>  it only lets
>> you see the nversion of the current stratum job since you don't get a
>> full bock header. There's always a risk here that miners build on top
>> of invalid blocks when SPV mining.
>
> This is the job of the stratum server and the pool operator.  These are
> distinct responsibilities; Miners should choose a pool operator in line with
> their desires.  Solo mining is basically dead, as it will never again be
> practical(and has not been for at least 2 years) for the same hardware that
> does the mining to also do full node operation.
>
> If the pool operator/stratum server also does not do validation, then any
> number of problems could occur.

Yes, there is a good amount of risk with validationless mining right
now here since it's well known that over half of mining pools use
validationless mining to some degree. This may not be too bad though
due to fallbacks but the risk is probably fairly implementation
specific.

>
>
>
>
> On Mon, Jun 12, 2017 at 10:44 PM, James Hilliard via bitcoin-dev
> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>
>> On Mon, Jun 12, 2017 at 9:23 PM, Zheming Lin via bitcoin-dev
>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>> > The BIP is described using Chinese and English. If any part is missing
>> > or need more specific, please reply. Forgive for my poor English.
>> >
>> > This method will incorporate any upgrade that affects non-mining nodes.
>> > They should beware that the rule has been changed.
>> >
>> > TLDR: Major miners activate and orphan the minor. That ensures all
>> > miners upgrades. Then invalid the tx from not upgrading nodes. Nodes must
>> > upgrade (with other protocol upgrade codes) in order to work. Then the final
>> > miner vote over protocol upgrade, with all nodes has the same upgraded
>> > codes.
>> >
>> > <pre>
>> > BIP: ???
>> > Title: Demonstration of Phase in Full Network Upgrade Activated by
>> > Miners
>> > Author: LIN Zheming
>> > Status: Draft
>> > Type: Standards Track
>> > Created: 2017-06-12
>> > </pre>
>> >
>> > ==Summary==
>> >
>> > ??????????????????????????????<br/>
>> > This idea was not created by an individual but is a product of
>> > collaboration in the Chinese bitcoin community between different interest
>> > groups.<br/>
>> >
>> > ????????????????????????????????????????????????????????<br/>
>> > This method is put forth to incentivize and to protect mining nodes and
>> > non-mining nodes during protocol upgrading. With this incentive mechanism,
>> > the non-mining nodes will not suffer monetary loss from chain
>> > splitting.<br/>
>> >
>> >
>> > ???????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????<br/>
>> >
>> > After the activation condition is met, majority miners will set a new
>> > block versionbits after the first grace period(a difficulty change of 2016
>> > blocks). The blocks with lower versionbits will be orphaned. In terms of the
>> > Nakamoto Consensus, the end of the first grace period will force all mining
>> > nodes upgraded to signal a new version of consensus. After the second grace
>> > period ( a difficulty change of 2016 blocks), mining nodes will only accept
>> > transactions with new versionbits. Transactions from nodes not upgrading
>> > will not be relayed nor included in blocks with new versionbits. This will
>> > protect funds of non-mining nodes from utilizing replay attack and will
>> > function as a notification for them to upgrade. Codes dealing with protocol
>> > upgrade could be included in the upgrade. After the non-mining node
>> > upgrades, mining nodes will vote to activate the protocol upgrade and this
>> > will achieve the broad/widespread deployment of the protocol upgrade.<br/>
>> >
>> > ???????????????????????????<br/>
>> > The protocol upgrade depends on its activate condition independently
>> > even after the change deployed among nodes.<br/>
>> >
>> > ==Motivation==
>> >
>> >
>> > ????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????<br/>
>> > In view of the fact that the original Bitcoin consensus did not consider
>> > the non-mining wallet nodes(as mentioned above), the result is that
>> > upgrading the consensus of these wallet nodes is passive and lazy. When
>> > there is disagreement in the direction of the upgrade, the miners have no
>> > mechanism to ensure that the chain being extended is the chain widely
>> > accepted by the wallet nodes. This also adversely affects the security of
>> > the wallet nodes.<br/>
>> Wallet nodes being able to fully validate and choose whether or not to
>> accept a particular chain is an important part of bitcoins security
>> model.
>> >
>> >
>> > ??????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????<br/>
>> >
>> > Apart from ensuring the asset security of wallet nodes, this method can
>> > be used to provide additional incentives to upgrade the protocol for the
>> > wallet nodes. Once the wallet nodes upgrade their protocol, the miners'
>> > nodes can be guaranteed to work - not only on the longest chain, but also on
>> > the longest chain used by other wallet nodes in the broader bitcoin sphere.
>> > Under the Nakamoto Consensus, there will be no persistent forks as protocol
>> > upgrades can be phased in.<br/>
>> There is no way to guarantee a wallet node will accept a particular
>> block since that is always up to the user.
>> >
>> > ==Specification==
>> >
>> > 1. ??????? versionbits ???????????BIP ??????????????? nVersion
>> > ?????<br/>
>> > 2. ??????? tx version ?????????????? tx version ? 1???? tx version ? 2
>> > ???????????????? tx version ? 1 ??????<br/>
>> >
>> > 1. Mining nodes signal by setting a version bit. While this BIP is
>> > active, all blocks must set the chosen nVersion.<br/>
>> > 2. Mining nodes will use tx version to define current version
>> > transactions. Current tx version is 1, and tx version 2 will be allowed.
>> > After the second grace period, tx version 1 will be regarded as
>> > invalid.<br/>
>> Sounds like this would cause issues with pre-signed time locked
>> transactions.
>> >
>> >
>> > ==Deployment==
>> > ???????????????????????????????????<br/>
>> >
>> > Protocol upgrading will phase in over three stages. We can have an
>> > optional fourth stage to integrate codes of protocol upgrade.<br/>
>> >
>> > 1. ??????????? versionbits ??????????????? 55% ????? 1109/2016
>> > ??????????????????????<br/>
>> > 2. ???????????????? 2016 ??????????????
>> > 2218/4032???????????????????????????????????????????????????????????????<br/>
>> > 3. ????????????????????? 4032
>> > ????????????????????????????????????????????????????????<br/>
>> > 4.
>> > ????????????????????????????????????????????????????????????????????????????????????????????
>> >
>> > 1. Signal stage: Mining nodes signal using BIP9. The next stage will be
>> > activated after 55% (1109) of 2016 blocks has the signal.<br/>
>> >
>> > 2. Mining nodes upgrade stage: After a first grace period of 2016 blocks
>> > and total signalling blocks passed 2218 of 4032 blocks, miners broadcasting
>> > blocks with new versionbits in block headers will orphan blocks with old
>> > versionbits. At this stage all nodes can send transactions with new
>> > versionbits, and transactions with old versionbits will be compatible.<br/>
>> >
>> > 3. Non-mining nodes upgrade stage: after 4032 continuous blocks with new
>> > versionbits, mining nodes will start to refuse transactions with old
>> > versionbits. Only transactions with new versionbits can be relayed and
>> > included in blocks. Transactions with old versionbits can be safely purged
>> > from memory pools.<br/>
>> >
>> > 4. (Optional)Protocol Upgrade stage: The codes dealing with protocol
>> > upgrade can be integrated in the third stage. After the non-mining nodes
>> > upgrades to support newer version of transactions, the codes with protocol
>> > upgrade must be included and now we can use miner vote to activate and
>> > finish this upgrade.<br/>
>> >
>> > ??????????<br/>
>> >
>> > At this point, the protocol upgrade have phased in.<br/>
>> >
>> > ==Benefits==
>> >
>> > 1. ?????????????????????????????99.9% ??????55% ????? 340
>> > ?????????????????????????????????????????????????????? 51%
>> > ???????????????????????<br/>
>> > 2. ????????????????????????????????<br/>
>> > 3. ??????? block header ?????? SPV ????????????<br/>
>> > 4.
>> > ??????????????????????????????????????????????????????????????????????<br/>
>> > 5. ?????????????????????????????????????????????????????<br/>
>> > 6.
>> > ????????????????????????????????????????????????????????????????????????????????<br/>
>> >
>> > 1. The activation only requires majority miners signal. As described in
>> > the paper by Satoshi Nakamoto, 55% miners will be in the longest chain after
>> > 340 blocks, with 99.9% certainty. This will minimize the possibility of
>> > delaying network upgrades by controlling a small number of hashing power. We
>> > can foresee that after 51% signalling, all miners will upgrade within the
>> > first grace period. <br/>
>> Technically soft forks can be implemented at 55% hashpower already
>> without an orphaning period(like BIP16). Those that don't upgrade
>> would just be at risk of mining invalid blocks. One would not want to
>> use this method to try and activate a controversial hard fork since
>> it's trivial for miners to false signal. The orphaning period
>> effectively forces miners to make a decision but does not necessarily
>> force them to make a particular decision since they can simply choose
>> to reject the fork and false signal.
>> > 2. During the first two grace periods, non-mining nodes will not be
>> > affected. They have enough time to upgrade their software. <br/>
>> > 3. Versionbits included in block header, not influencing the SPY mining.
>> > <br/>
>> The widely deployed stratum based SPV mining does not really provide a
>> proper way to validate nversion of the previous block, it only lets
>> you see the nversion of the current stratum job since you don't get a
>> full bock header. There's always a risk here that miners build on top
>> of invalid blocks when SPV mining.
>> > 4. After two grace periods, all nodes must be upgraded. Otherwise they
>> > cannot send transactions or get any confirmations. Compared with forming new
>> > consensus among nodes, the situation is not worse than before. <br/>
>> Previous consensus changes have largely been done in backwards
>> compatible ways which lets users opt-in to new features. In general
>> backwards compatibility is considered a good thing, this seems to make
>> that worse.
>> > 5. The ledger in non-mining wallet nodes is honored and reserved. Users
>> > of off-chain wallet services can decide whether or not to follow the service
>> > providers after they got the public notification from the service providers.
>> > <br/>
>> > 6. Protocol upgrades in the future can be bonded with the upgrades of
>> > nodes, and the upgrades activate through miners vote independently. There
>> > would be enough time for nodes to be upgraded in order to support new
>> > protocols. Even in case of failing in miner activation, the situation will
>> > not worsen and the status quo will remain. <br/>
>> >
>> >
>> > ==Risks==
>> >
>> > 1. ??????????????????????????????????????<br/>
>> > 2. ????????????????????????????????????????????????????????<br/>
>> > 3.
>> > ?????????????????????????????????????????????????????????????????<br/>
>> > 4.
>> > ???????????????????????????????????????????????????????????????????????????????????<br/>
>> >
>> > 1. The fluctuation of the hashing power will affect the result of the
>> > longest chain. Higher activating requirement means a lower risk of temporary
>> > fork. <br/>
>> > 2. Miners could simply signal to avoid being orphaned, but from the
>> > perspective of non-mining wallet nodes, they can't distinguish the false
>> > signal from the true signal. They must upgrade with the assumption that the
>> > signals are all true. After all the non-mining nodes have upgraded, the
>> > miners signalling false signal should follow. <br/>
>> Miners can simply announce they are false signalling with coinbase
>> tags and other methods. This activation method would likely not be
>> viable for controversial changes.
>> > 3. Non-mining wallet nodes could false signal without supporting the new
>> > protocol but since the total number of nodes cannot be distinguished,
>> > genuine nodes should follow the proven result provided by miners vote. <br/>
>> Users would likely take into account markets and other factors when
>> deciding what to do, the total number of nodes doesn't really matter
>> much. Miner signalling is not necessarily indicative of economic and
>> user support.
>> > 4. Miners and non-mining nodes could conspire to fork using old protocol
>> > consensus. It can't be eliminated, just like in the past but through most
>> > passive non-mining nodes being upgraded, their benefit is reduced. <br/>
>> >
>> >
>> > ==Implementation==
>> > ___TBD___
>> >
>> > _______________________________________________
>> > bitcoin-dev mailing list
>> > bitcoin-dev at lists.linuxfoundation.org
>> > https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>> _______________________________________________
>> bitcoin-dev mailing list
>> bitcoin-dev at lists.linuxfoundation.org
>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>
>

From jaredr26 at gmail.com  Wed Jun 14 01:08:49 2017
From: jaredr26 at gmail.com (Jared Lee Richardson)
Date: Tue, 13 Jun 2017 18:08:49 -0700
Subject: [bitcoin-dev] Proposal: Demonstration of Phase in Full Network
 Upgrade Activated by Miners
In-Reply-To: <CADvTj4pbhU_USTBCuAk2pB3=dma-7=shOqdPLXdL1vCETLyq9g@mail.gmail.com>
References: <A6AE8145-8C8A-44C2-88D3-8574D895AF6B@gmail.com>
	<CADvTj4pu8LbETyduWj__U2txyvqZD9B8FFmLDPSiM4t+pTSuZQ@mail.gmail.com>
	<CAD1TkXvkNKiVUqYudFVEgPv5vT8K8JTBt8ZM+qn5su+JpdMqxw@mail.gmail.com>
	<CADvTj4pbhU_USTBCuAk2pB3=dma-7=shOqdPLXdL1vCETLyq9g@mail.gmail.com>
Message-ID: <CAD1TkXs2rHa3rQ0H2igh=kVJpTSA_yqfEJsD3gSGctmo5rT94Q@mail.gmail.com>

> and allows for resource requirements
> that are too high for many users to validate. The block size settings
> there are effectively placebo controls.

Right, but that's my point.  Any level of control the fullnodes believe
they have is effectively a placebo, unless the opposition to the miners is
essentially unanimous (and maybe not even then, if the chainsplit doesn't
have any miners to get to the next difficulty change or gets attacked
repeatedly).

> I'm advocating that resource requirements be low
> enough that full validation remains possible for a large percentage of
> the economy.

We're derailed from the main thread at this point, but just wanted to state
that I agree in part.  The part I don't agree with is when a single
transaction begins to cost more than a month's worth of full validation,
which has already happened at least once last week, the full validation is
on its way to becoming worthless.  The two costs have to be balanced for
the coin to have utility for its users.

I agree with the rest.

Jared

On Tue, Jun 13, 2017 at 5:23 PM, James Hilliard <james.hilliard1 at gmail.com>
wrote:

> On Tue, Jun 13, 2017 at 2:35 PM, Jared Lee Richardson
> <jaredr26 at gmail.com> wrote:
> >> Wallet nodes being able to fully validate and choose whether or not to
> > accept a particular chain is an important part of bitcoins security
> > model.
> >
> > What you're describing is effectively the same as BU.
>
> BU by default uses an "Accept Depth" parameter which effectively lets
> miners decide block size rules and allows for resource requirements
> that are too high for many users to validate. The block size settings
> there are effectively placebo controls.
>
> >
> > Nodes follow chains, they do not decide the victor.  The average user
> > follows the default of the software, which is to follow the longest valid
> > chain.  Forcing the average user to decide which software to run is far
> more
> > valuable than allowing "the software" to decide things, when in fact all
> it
> > will do is decide the previous default.
>
> That's largely true that they typically don't decide the victor in
> soft forks unless they are the ones to activate the rules
> changes(satoshi did this a few times in the early days), however they
> make it very difficult for a hard fork to be activated without
> consent. Yes, I'm not advocating for having runtime consensus settings
> for nodes either, I'm advocating that resource requirements be low
> enough that full validation remains possible for a large percentage of
> the economy.
>
> >
> >> One would not want to
> >> use this method to try and activate a controversial hard fork since
> >> it's trivial for miners to false signal. The orphaning period
> >> effectively forces miners to make a decision but does not necessarily
> >> force them to make a particular decision
> >
> > This is true and a good point.  A false signal from miners could trick
> the
> > honest miners into forking off prematurely with a minority.
>
> More likely the false signal would be used during the orphaning period
> to prevent blocks from being orphaned for miners that don't want to
> follow the fork.
>
> >
> >>  it only lets
> >> you see the nversion of the current stratum job since you don't get a
> >> full bock header. There's always a risk here that miners build on top
> >> of invalid blocks when SPV mining.
> >
> > This is the job of the stratum server and the pool operator.  These are
> > distinct responsibilities; Miners should choose a pool operator in line
> with
> > their desires.  Solo mining is basically dead, as it will never again be
> > practical(and has not been for at least 2 years) for the same hardware
> that
> > does the mining to also do full node operation.
> >
> > If the pool operator/stratum server also does not do validation, then any
> > number of problems could occur.
>
> Yes, there is a good amount of risk with validationless mining right
> now here since it's well known that over half of mining pools use
> validationless mining to some degree. This may not be too bad though
> due to fallbacks but the risk is probably fairly implementation
> specific.
>
> >
> >
> >
> >
> > On Mon, Jun 12, 2017 at 10:44 PM, James Hilliard via bitcoin-dev
> > <bitcoin-dev at lists.linuxfoundation.org> wrote:
> >>
> >> On Mon, Jun 12, 2017 at 9:23 PM, Zheming Lin via bitcoin-dev
> >> <bitcoin-dev at lists.linuxfoundation.org> wrote:
> >> > The BIP is described using Chinese and English. If any part is missing
> >> > or need more specific, please reply. Forgive for my poor English.
> >> >
> >> > This method will incorporate any upgrade that affects non-mining
> nodes.
> >> > They should beware that the rule has been changed.
> >> >
> >> > TLDR: Major miners activate and orphan the minor. That ensures all
> >> > miners upgrades. Then invalid the tx from not upgrading nodes. Nodes
> must
> >> > upgrade (with other protocol upgrade codes) in order to work. Then
> the final
> >> > miner vote over protocol upgrade, with all nodes has the same upgraded
> >> > codes.
> >> >
> >> > <pre>
> >> > BIP: ???
> >> > Title: Demonstration of Phase in Full Network Upgrade Activated by
> >> > Miners
> >> > Author: LIN Zheming
> >> > Status: Draft
> >> > Type: Standards Track
> >> > Created: 2017-06-12
> >> > </pre>
> >> >
> >> > ==Summary==
> >> >
> >> > ??????????????????????????????<br/>
> >> > This idea was not created by an individual but is a product of
> >> > collaboration in the Chinese bitcoin community between different
> interest
> >> > groups.<br/>
> >> >
> >> > ????????????????????????????????????????????????????????<br/>
> >> > This method is put forth to incentivize and to protect mining nodes
> and
> >> > non-mining nodes during protocol upgrading. With this incentive
> mechanism,
> >> > the non-mining nodes will not suffer monetary loss from chain
> >> > splitting.<br/>
> >> >
> >> >
> >> > ???????????????????????????????????????????????????????
> ????????????????????????????????????????????????????????????????????????
> ???????????????????????????????????????????????????????????????
> ?????????????????????????????????????????????????????<br/>
> >> >
> >> > After the activation condition is met, majority miners will set a new
> >> > block versionbits after the first grace period(a difficulty change of
> 2016
> >> > blocks). The blocks with lower versionbits will be orphaned. In terms
> of the
> >> > Nakamoto Consensus, the end of the first grace period will force all
> mining
> >> > nodes upgraded to signal a new version of consensus. After the second
> grace
> >> > period ( a difficulty change of 2016 blocks), mining nodes will only
> accept
> >> > transactions with new versionbits. Transactions from nodes not
> upgrading
> >> > will not be relayed nor included in blocks with new versionbits. This
> will
> >> > protect funds of non-mining nodes from utilizing replay attack and
> will
> >> > function as a notification for them to upgrade. Codes dealing with
> protocol
> >> > upgrade could be included in the upgrade. After the non-mining node
> >> > upgrades, mining nodes will vote to activate the protocol upgrade and
> this
> >> > will achieve the broad/widespread deployment of the protocol
> upgrade.<br/>
> >> >
> >> > ???????????????????????????<br/>
> >> > The protocol upgrade depends on its activate condition independently
> >> > even after the change deployed among nodes.<br/>
> >> >
> >> > ==Motivation==
> >> >
> >> >
> >> > ???????????????????????????????????????????????
> ??????????????????????????????????????????????????????????
> ???????????????<br/>
> >> > In view of the fact that the original Bitcoin consensus did not
> consider
> >> > the non-mining wallet nodes(as mentioned above), the result is that
> >> > upgrading the consensus of these wallet nodes is passive and lazy.
> When
> >> > there is disagreement in the direction of the upgrade, the miners
> have no
> >> > mechanism to ensure that the chain being extended is the chain widely
> >> > accepted by the wallet nodes. This also adversely affects the
> security of
> >> > the wallet nodes.<br/>
> >> Wallet nodes being able to fully validate and choose whether or not to
> >> accept a particular chain is an important part of bitcoins security
> >> model.
> >> >
> >> >
> >> > ?????????????????????????????????????????????????????????????????????
> ?????????????????????????????????????????????????????<br/>
> >> >
> >> > Apart from ensuring the asset security of wallet nodes, this method
> can
> >> > be used to provide additional incentives to upgrade the protocol for
> the
> >> > wallet nodes. Once the wallet nodes upgrade their protocol, the
> miners'
> >> > nodes can be guaranteed to work - not only on the longest chain, but
> also on
> >> > the longest chain used by other wallet nodes in the broader bitcoin
> sphere.
> >> > Under the Nakamoto Consensus, there will be no persistent forks as
> protocol
> >> > upgrades can be phased in.<br/>
> >> There is no way to guarantee a wallet node will accept a particular
> >> block since that is always up to the user.
> >> >
> >> > ==Specification==
> >> >
> >> > 1. ??????? versionbits ???????????BIP ??????????????? nVersion
> >> > ?????<br/>
> >> > 2. ??????? tx version ?????????????? tx version ? 1???? tx version ? 2
> >> > ???????????????? tx version ? 1 ??????<br/>
> >> >
> >> > 1. Mining nodes signal by setting a version bit. While this BIP is
> >> > active, all blocks must set the chosen nVersion.<br/>
> >> > 2. Mining nodes will use tx version to define current version
> >> > transactions. Current tx version is 1, and tx version 2 will be
> allowed.
> >> > After the second grace period, tx version 1 will be regarded as
> >> > invalid.<br/>
> >> Sounds like this would cause issues with pre-signed time locked
> >> transactions.
> >> >
> >> >
> >> > ==Deployment==
> >> > ???????????????????????????????????<br/>
> >> >
> >> > Protocol upgrading will phase in over three stages. We can have an
> >> > optional fourth stage to integrate codes of protocol upgrade.<br/>
> >> >
> >> > 1. ??????????? versionbits ??????????????? 55% ????? 1109/2016
> >> > ??????????????????????<br/>
> >> > 2. ???????????????? 2016 ??????????????
> >> > 2218/4032??????????????????????????????????????
> ?????????????????????????<br/>
> >> > 3. ????????????????????? 4032
> >> > ????????????????????????????????????????????????????????<br/>
> >> > 4.
> >> > ?????????????????????????????????????????????????????????????????
> ???????????????????????????
> >> >
> >> > 1. Signal stage: Mining nodes signal using BIP9. The next stage will
> be
> >> > activated after 55% (1109) of 2016 blocks has the signal.<br/>
> >> >
> >> > 2. Mining nodes upgrade stage: After a first grace period of 2016
> blocks
> >> > and total signalling blocks passed 2218 of 4032 blocks, miners
> broadcasting
> >> > blocks with new versionbits in block headers will orphan blocks with
> old
> >> > versionbits. At this stage all nodes can send transactions with new
> >> > versionbits, and transactions with old versionbits will be
> compatible.<br/>
> >> >
> >> > 3. Non-mining nodes upgrade stage: after 4032 continuous blocks with
> new
> >> > versionbits, mining nodes will start to refuse transactions with old
> >> > versionbits. Only transactions with new versionbits can be relayed and
> >> > included in blocks. Transactions with old versionbits can be safely
> purged
> >> > from memory pools.<br/>
> >> >
> >> > 4. (Optional)Protocol Upgrade stage: The codes dealing with protocol
> >> > upgrade can be integrated in the third stage. After the non-mining
> nodes
> >> > upgrades to support newer version of transactions, the codes with
> protocol
> >> > upgrade must be included and now we can use miner vote to activate and
> >> > finish this upgrade.<br/>
> >> >
> >> > ??????????<br/>
> >> >
> >> > At this point, the protocol upgrade have phased in.<br/>
> >> >
> >> > ==Benefits==
> >> >
> >> > 1. ?????????????????????????????99.9% ??????55% ????? 340
> >> > ?????????????????????????????????????????????????????? 51%
> >> > ???????????????????????<br/>
> >> > 2. ????????????????????????????????<br/>
> >> > 3. ??????? block header ?????? SPV ????????????<br/>
> >> > 4.
> >> > ???????????????????????????????????????????
> ???????????????????????????<br/>
> >> > 5. ?????????????????????????????????????????????????????<br/>
> >> > 6.
> >> > ???????????????????????????????????????????????????????????????
> ?????????????????<br/>
> >> >
> >> > 1. The activation only requires majority miners signal. As described
> in
> >> > the paper by Satoshi Nakamoto, 55% miners will be in the longest
> chain after
> >> > 340 blocks, with 99.9% certainty. This will minimize the possibility
> of
> >> > delaying network upgrades by controlling a small number of hashing
> power. We
> >> > can foresee that after 51% signalling, all miners will upgrade within
> the
> >> > first grace period. <br/>
> >> Technically soft forks can be implemented at 55% hashpower already
> >> without an orphaning period(like BIP16). Those that don't upgrade
> >> would just be at risk of mining invalid blocks. One would not want to
> >> use this method to try and activate a controversial hard fork since
> >> it's trivial for miners to false signal. The orphaning period
> >> effectively forces miners to make a decision but does not necessarily
> >> force them to make a particular decision since they can simply choose
> >> to reject the fork and false signal.
> >> > 2. During the first two grace periods, non-mining nodes will not be
> >> > affected. They have enough time to upgrade their software. <br/>
> >> > 3. Versionbits included in block header, not influencing the SPY
> mining.
> >> > <br/>
> >> The widely deployed stratum based SPV mining does not really provide a
> >> proper way to validate nversion of the previous block, it only lets
> >> you see the nversion of the current stratum job since you don't get a
> >> full bock header. There's always a risk here that miners build on top
> >> of invalid blocks when SPV mining.
> >> > 4. After two grace periods, all nodes must be upgraded. Otherwise they
> >> > cannot send transactions or get any confirmations. Compared with
> forming new
> >> > consensus among nodes, the situation is not worse than before. <br/>
> >> Previous consensus changes have largely been done in backwards
> >> compatible ways which lets users opt-in to new features. In general
> >> backwards compatibility is considered a good thing, this seems to make
> >> that worse.
> >> > 5. The ledger in non-mining wallet nodes is honored and reserved.
> Users
> >> > of off-chain wallet services can decide whether or not to follow the
> service
> >> > providers after they got the public notification from the service
> providers.
> >> > <br/>
> >> > 6. Protocol upgrades in the future can be bonded with the upgrades of
> >> > nodes, and the upgrades activate through miners vote independently.
> There
> >> > would be enough time for nodes to be upgraded in order to support new
> >> > protocols. Even in case of failing in miner activation, the situation
> will
> >> > not worsen and the status quo will remain. <br/>
> >> >
> >> >
> >> > ==Risks==
> >> >
> >> > 1. ??????????????????????????????????????<br/>
> >> > 2. ????????????????????????????????????????????????????????<br/>
> >> > 3.
> >> > ???????????????????????????????????????????
> ??????????????????????<br/>
> >> > 4.
> >> > ??????????????????????????????????????????????????
> ?????????????????????????????????<br/>
> >> >
> >> > 1. The fluctuation of the hashing power will affect the result of the
> >> > longest chain. Higher activating requirement means a lower risk of
> temporary
> >> > fork. <br/>
> >> > 2. Miners could simply signal to avoid being orphaned, but from the
> >> > perspective of non-mining wallet nodes, they can't distinguish the
> false
> >> > signal from the true signal. They must upgrade with the assumption
> that the
> >> > signals are all true. After all the non-mining nodes have upgraded,
> the
> >> > miners signalling false signal should follow. <br/>
> >> Miners can simply announce they are false signalling with coinbase
> >> tags and other methods. This activation method would likely not be
> >> viable for controversial changes.
> >> > 3. Non-mining wallet nodes could false signal without supporting the
> new
> >> > protocol but since the total number of nodes cannot be distinguished,
> >> > genuine nodes should follow the proven result provided by miners
> vote. <br/>
> >> Users would likely take into account markets and other factors when
> >> deciding what to do, the total number of nodes doesn't really matter
> >> much. Miner signalling is not necessarily indicative of economic and
> >> user support.
> >> > 4. Miners and non-mining nodes could conspire to fork using old
> protocol
> >> > consensus. It can't be eliminated, just like in the past but through
> most
> >> > passive non-mining nodes being upgraded, their benefit is reduced.
> <br/>
> >> >
> >> >
> >> > ==Implementation==
> >> > ___TBD___
> >> >
> >> > _______________________________________________
> >> > bitcoin-dev mailing list
> >> > bitcoin-dev at lists.linuxfoundation.org
> >> > https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
> >> _______________________________________________
> >> bitcoin-dev mailing list
> >> bitcoin-dev at lists.linuxfoundation.org
> >> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170613/825eb1cb/attachment-0001.html>

From heater at gmail.com  Wed Jun 14 16:39:42 2017
From: heater at gmail.com (Zheming Lin)
Date: Thu, 15 Jun 2017 00:39:42 +0800
Subject: [bitcoin-dev] Proposal: Demonstration of Phase in Full Network
 Upgrade Activated by Miners
In-Reply-To: <CAAS2fgT=0k0NJWsO_TtBRTi2VqZtzuT1d1Sk+KZ2+2PUcA71tg@mail.gmail.com>
References: <A6AE8145-8C8A-44C2-88D3-8574D895AF6B@gmail.com>
	<CAAS2fgT=0k0NJWsO_TtBRTi2VqZtzuT1d1Sk+KZ2+2PUcA71tg@mail.gmail.com>
Message-ID: <A5275580-0EA3-4021-8E4E-55E214BCEECB@gmail.com>



> ? 2017?6?14??02:11?Gregory Maxwell <greg at xiph.org> ???
> 
> On Tue, Jun 13, 2017 at 2:23 AM, Zheming Lin via bitcoin-dev
> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>> The BIP is described using Chinese and English. If any part is missing or need more specific, please reply. Forgive for my poor English.
> 
> Your English is much better than my Chinese.  Thank you for taking the
> time to write this.
> 
> I am still reading and trying to completely understand your proposal
> but I wanted to make one observation:
> 
>> ????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????<br/>
>> In view of the fact that the original Bitcoin consensus did not consider the non-mining wallet nodes(as mentioned above), the result is that upgrading the consensus of these wallet nodes is passive and lazy.
> 
> This is not true. Non-mining wallet nodes were considered, and their
> upgrade practices are not usually slower than miners.
> 

???????????????????????????????????????????????????????????????
I mean lazy and passive ones I addressed. Not the one actively chose whichever solution they like. Users always have their solution. There?s no way to force a union if they are not together.

> Even in the very first version of the software it did not mine unless
> the user went into the settings and explicitly turned it on or used a
> command-line option.  By default, every installation of Bitcoin was a
> non-mining wallet node.
> 

?????????????????????????????????????????????
From the definition of Satishi Nakamoto, Section 5, each node mines. If that?s the disagreement between us, there?s no more I can convince you. 

> The enforcement of the system's rules by users broadly, and not just
> miners, is specifically described in the white paper (section 8,
> paragraph 2, it especially clear in the last sentence).  This is
> critical for the security of Bitcoin especially with the current
> degree of centralization in pools.  Without it, Bitcoin's security
> would look a lot more like the Ripple system.
> 

???????????????????????? BIP ???????????????????????????????????????????????????????
Yes, users always have choice that they can abandon the nodes. This BIP does?t go against them. I mean only the one(especially wallets) that?s passive, they need to know there?s a choice and pick one.

?? BIP ?????????????????????????????????????????????????????????
This BIP can be applied to almost any upgrade, including Segwit, Segwit2x, 2m, ec, 8m? but the upgrade is not the key point.

????????????????
Did the users have any real choice?

????????????????????????????????????????????
I don?t see the reason they trust the majority miners(as they do today) but refuse the vote for upcoming protocol upgrade.

??????????????????????????????????????????
This choice for wallet users right now, is wether to follow the 51% majority miners. If they don?t, they can have their fork that get rid of miners.

???????????????????????????????
If they do trust the majority miners, they stay and follow the vote for upcoming protocol upgrade.

??????????????????????????????????????????????????????????
So the questions is: Do the bitcoin developers, users, holders, service provides, even miners, (still) have faith in the majority of miners as designed in the white paper?


> Frequently it is the miners that are "passive and lazy" in upgrading.
> In some cases when new versions have had major improvements specific
> to mining (such as for 0.8) miners upgraded much faster than other
> nodes. But often, it is the other way around and miners adopt new
> versions much slower than other nodes. If you look at block
> construction today you will see that many miners are running highly
> outdated node software which is more than one or even two years old.
> (and as a result, they lose out on a considerable amount of
> transaction fees.)
> 

??????????????????????BIP????????????????????????????????????????????
I personally take that as VETO to current version. This BIP also address this situation. Did you notice that miners should be upgraded first? Did that solve the problem you mentioned above?

???????????????????????????????????????????????????????????????????????????????
If we can use this method to at least make miners upgraded to the same consensus version and start to vote for the upcoming changes, that would solve the problem for the passive behavior. Unless the vote miners wish to hold, is not in the wishlist of someone.

> In fact, many miners have the most severe form of passive behavior:
> they do not run a node at all but simply sell their hash power to
> pools (which themselves are often slow to upgrade).  By comparison,
> http://luke.dashjr.org/programs/bitcoin/files/charts/branches.html 95%
> of reachable nodes are running software now from the last year and a
> half.
> 
> I do not, however, believe that it is a problem that anyone is slow to upgrade.
> 
> Reliability cannot be maintained in infrastructure if it is rapidly
> changing.  A normal deployment process for major systems
> infrastructure outside of Bitcoin usually takes months because time
> must be given to test and find bugs.
> 
> Miners depend on their income from mining and interruptions can be
> very costly.  Many pools are also involved with altcoins which are
> constantly breaking and they have their attention directed elsewhere
> and cannot quickly spare the time required to upgrade their software.
> These delays are the natural consequence of a decentralized system
> where no one has the power to force other people to adopt their
> priorities.
> 
> If you look at the deployment processes of major internet protocols,
> HTTP2, new versions of SSH, BGP,  or IP itself you will find that
> upgrades often happen slower than the entire life of Bitcoin so far--
> and none of these protocols have the difficult consistency challenges
> of Bitcoin or as much risk of irreparable financial loss if things go
> wrong.
> 
> Because many people in the Bitcoin community appears to expect
> upgrades much faster than even centralized ISP backbones upgrade their
> router software I think they have unrealistic expectations with how
> fast upgrading can occur while preserving stability, security, and
> decentralization and unrealistic expectations of how fast upgrading
> will occur so long as no one has the ability to force other people to
> run their upgrades.
> 
> I look forward to competing my understanding of your proposal.
> 
> Cheers,

I think the divergency is from the different definition of bitcoin. If no common understanding, let?s get one from the white paper, together.

Regards

LIN Zheming

From jameson.lopp at gmail.com  Wed Jun 14 17:20:32 2017
From: jameson.lopp at gmail.com (Jameson Lopp)
Date: Wed, 14 Jun 2017 10:20:32 -0700
Subject: [bitcoin-dev] Proposal: Demonstration of Phase in Full Network
 Upgrade Activated by Miners
In-Reply-To: <A5275580-0EA3-4021-8E4E-55E214BCEECB@gmail.com>
References: <A6AE8145-8C8A-44C2-88D3-8574D895AF6B@gmail.com>
	<CAAS2fgT=0k0NJWsO_TtBRTi2VqZtzuT1d1Sk+KZ2+2PUcA71tg@mail.gmail.com>
	<A5275580-0EA3-4021-8E4E-55E214BCEECB@gmail.com>
Message-ID: <CADL_X_fdZG50HHb3iOePrzuOwU55tAqP80u3--xXEDWBKL7=jg@mail.gmail.com>

On Wed, Jun 14, 2017 at 9:39 AM, Zheming Lin via bitcoin-dev <
bitcoin-dev at lists.linuxfoundation.org> wrote:

>
>
> > ? 2017?6?14??02:11?Gregory Maxwell <greg at xiph.org> ???
> >
> > On Tue, Jun 13, 2017 at 2:23 AM, Zheming Lin via bitcoin-dev
> > <bitcoin-dev at lists.linuxfoundation.org> wrote:
> >> The BIP is described using Chinese and English. If any part is missing
> or need more specific, please reply. Forgive for my poor English.
> >
> > Your English is much better than my Chinese.  Thank you for taking the
> > time to write this.
> >
> > I am still reading and trying to completely understand your proposal
> > but I wanted to make one observation:
> >
> >> ???????????????????????????????????????????????
> ??????????????????????????????????????????????????????????
> ???????????????<br/>
> >> In view of the fact that the original Bitcoin consensus did not
> consider the non-mining wallet nodes(as mentioned above), the result is
> that upgrading the consensus of these wallet nodes is passive and lazy.
> >
> > This is not true. Non-mining wallet nodes were considered, and their
> > upgrade practices are not usually slower than miners.
> >
>
> ???????????????????????????????????????????????????????????????
> I mean lazy and passive ones I addressed. Not the one actively chose
> whichever solution they like. Users always have their solution. There?s no
> way to force a union if they are not together.
>
> > Even in the very first version of the software it did not mine unless
> > the user went into the settings and explicitly turned it on or used a
> > command-line option.  By default, every installation of Bitcoin was a
> > non-mining wallet node.
> >
>
> ?????????????????????????????????????????????
> From the definition of Satishi Nakamoto, Section 5, each node mines. If
> that?s the disagreement between us, there?s no more I can convince you.
>
> > The enforcement of the system's rules by users broadly, and not just
> > miners, is specifically described in the white paper (section 8,
> > paragraph 2, it especially clear in the last sentence).  This is
> > critical for the security of Bitcoin especially with the current
> > degree of centralization in pools.  Without it, Bitcoin's security
> > would look a lot more like the Ripple system.
> >
>
> ???????????????????????? BIP ?????????????????????????
> ??????????????????????????????
> Yes, users always have choice that they can abandon the nodes. This BIP
> does?t go against them. I mean only the one(especially wallets) that?s
> passive, they need to know there?s a choice and pick one.
>
> ?? BIP ?????????????????????????????????????????????????????????
> This BIP can be applied to almost any upgrade, including Segwit, Segwit2x,
> 2m, ec, 8m? but the upgrade is not the key point.
>
> ????????????????
> Did the users have any real choice?
>
> ????????????????????????????????????????????
> I don?t see the reason they trust the majority miners(as they do today)
> but refuse the vote for upcoming protocol upgrade.
>

To be clear, Bitcoin is not a democracy - if you find yourself using the
term "voting" then you may be misunderstanding how consensus forms. Once a
feature has been vetted and the code is deployed, miners may signal that
they are ready to enforce new rules. If for some reason miners are too
"passive or lazy" or wish to "veto" the activation of the new rules, users
may choose to circumvent said veto by refusing to accept blocks that do not
show readiness for enforcing the new rules.


>
> ??????????????????????????????????????????
> This choice for wallet users right now, is wether to follow the 51%
> majority miners. If they don?t, they can have their fork that get rid of
> miners.
>
> ???????????????????????????????
> If they do trust the majority miners, they stay and follow the vote for
> upcoming protocol upgrade.
>
> ??????????????????????????????????????????????????????????
> So the questions is: Do the bitcoin developers, users, holders, service
> provides, even miners, (still) have faith in the majority of miners as
> designed in the white paper?
>
>
There is a fundamental misconception regarding this point - the white paper
refers to majority hashpower needing to be honest with regard to
determining the correct chain within the context of many possible /valid/
chain forks. It is not referring to using hashpower to determine the
correct chain amongst an infinitely variable number of currently invalid
chain forks. Bitcoin ecosystem participants should not have faith in miners
(or any other entity) when it comes to choosing the consensus rules they
wish to enforce.


> > Frequently it is the miners that are "passive and lazy" in upgrading.
> > In some cases when new versions have had major improvements specific
> > to mining (such as for 0.8) miners upgraded much faster than other
> > nodes. But often, it is the other way around and miners adopt new
> > versions much slower than other nodes. If you look at block
> > construction today you will see that many miners are running highly
> > outdated node software which is more than one or even two years old.
> > (and as a result, they lose out on a considerable amount of
> > transaction fees.)
> >
>
> ??????????????????????BIP????????????????????????????????????????????
> I personally take that as VETO to current version. This BIP also address
> this situation. Did you notice that miners should be upgraded first? Did
> that solve the problem you mentioned above?
>
> ??????????????????????????????????????????????????????
> ?????????????????????????
> If we can use this method to at least make miners upgraded to the same
> consensus version and start to vote for the upcoming changes, that would
> solve the problem for the passive behavior. Unless the vote miners wish to
> hold, is not in the wishlist of someone.
>
> > In fact, many miners have the most severe form of passive behavior:
> > they do not run a node at all but simply sell their hash power to
> > pools (which themselves are often slow to upgrade).  By comparison,
> > http://luke.dashjr.org/programs/bitcoin/files/charts/branches.html 95%
> > of reachable nodes are running software now from the last year and a
> > half.
> >
> > I do not, however, believe that it is a problem that anyone is slow to
> upgrade.
> >
> > Reliability cannot be maintained in infrastructure if it is rapidly
> > changing.  A normal deployment process for major systems
> > infrastructure outside of Bitcoin usually takes months because time
> > must be given to test and find bugs.
> >
> > Miners depend on their income from mining and interruptions can be
> > very costly.  Many pools are also involved with altcoins which are
> > constantly breaking and they have their attention directed elsewhere
> > and cannot quickly spare the time required to upgrade their software.
> > These delays are the natural consequence of a decentralized system
> > where no one has the power to force other people to adopt their
> > priorities.
> >
> > If you look at the deployment processes of major internet protocols,
> > HTTP2, new versions of SSH, BGP,  or IP itself you will find that
> > upgrades often happen slower than the entire life of Bitcoin so far--
> > and none of these protocols have the difficult consistency challenges
> > of Bitcoin or as much risk of irreparable financial loss if things go
> > wrong.
> >
> > Because many people in the Bitcoin community appears to expect
> > upgrades much faster than even centralized ISP backbones upgrade their
> > router software I think they have unrealistic expectations with how
> > fast upgrading can occur while preserving stability, security, and
> > decentralization and unrealistic expectations of how fast upgrading
> > will occur so long as no one has the ability to force other people to
> > run their upgrades.
> >
> > I look forward to competing my understanding of your proposal.
> >
> > Cheers,
>
> I think the divergency is from the different definition of bitcoin. If no
> common understanding, let?s get one from the white paper, together.
>
> Regards
>
> LIN Zheming
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170614/d3d09d0c/attachment-0001.html>

From jameson.lopp at gmail.com  Wed Jun 14 18:55:04 2017
From: jameson.lopp at gmail.com (Jameson Lopp)
Date: Wed, 14 Jun 2017 11:55:04 -0700
Subject: [bitcoin-dev] Proposal: Demonstration of Phase in Full Network
 Upgrade Activated by Miners
In-Reply-To: <31040BE1-64ED-4D05-BCBE-E80BC7B9A182@gmail.com>
References: <A6AE8145-8C8A-44C2-88D3-8574D895AF6B@gmail.com>
	<CAAS2fgT=0k0NJWsO_TtBRTi2VqZtzuT1d1Sk+KZ2+2PUcA71tg@mail.gmail.com>
	<A5275580-0EA3-4021-8E4E-55E214BCEECB@gmail.com>
	<CADL_X_fdZG50HHb3iOePrzuOwU55tAqP80u3--xXEDWBKL7=jg@mail.gmail.com>
	<31040BE1-64ED-4D05-BCBE-E80BC7B9A182@gmail.com>
Message-ID: <CADL_X_e0wuKTUbAiYyuDuk74+DQ98j1kkmBPz5c5RjU4R7RB3Q@mail.gmail.com>

On Wed, Jun 14, 2017 at 11:29 AM, Zheming Lin <heater at gmail.com> wrote:

> Hi Jameson:
>
> ? 2017?6?15??01:20?Jameson Lopp <jameson.lopp at gmail.com> ???
>
>
>
> On Wed, Jun 14, 2017 at 9:39 AM, Zheming Lin via bitcoin-dev <bitcoin-dev@
> lists.linuxfoundation.org> wrote:
>
>>
>>
>> > ? 2017?6?14??02:11?Gregory Maxwell <greg at xiph.org> ???
>> >
>> > On Tue, Jun 13, 2017 at 2:23 AM, Zheming Lin via bitcoin-dev
>> > <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>
>> > The enforcement of the system's rules by users broadly, and not just
>> > miners, is specifically described in the white paper (section 8,
>> > paragraph 2, it especially clear in the last sentence).  This is
>> > critical for the security of Bitcoin especially with the current
>> > degree of centralization in pools.  Without it, Bitcoin's security
>> > would look a lot more like the Ripple system.
>> >
>>
>> ???????????????????????? BIP ??????????????????????????????
>> ?????????????????????????
>> Yes, users always have choice that they can abandon the nodes. This BIP
>> does?t go against them. I mean only the one(especially wallets) that?s
>> passive, they need to know there?s a choice and pick one.
>>
>> ?? BIP ?????????????????????????????????????????????????????????
>> This BIP can be applied to almost any upgrade, including Segwit,
>> Segwit2x, 2m, ec, 8m? but the upgrade is not the key point.
>>
>> ????????????????
>> Did the users have any real choice?
>>
>> ????????????????????????????????????????????
>> I don?t see the reason they trust the majority miners(as they do today)
>> but refuse the vote for upcoming protocol upgrade.
>>
>
> To be clear, Bitcoin is not a democracy - if you find yourself using the
> term "voting" then you may be misunderstanding how consensus forms. Once a
> feature has been vetted and the code is deployed, miners may signal that
> they are ready to enforce new rules. If for some reason miners are too
> "passive or lazy" or wish to "veto" the activation of the new rules, users
> may choose to circumvent said veto by refusing to accept blocks that do not
> show readiness for enforcing the new rules.
>
>
> How does the users show their opinion? They can fork away and leave. But
> what remains will be united. Are you afraid of the united users or the fork?
>
> I agree with you that the ?vote? is not accurate. Could you kindly suggest
> an other word for that?
>
> I think users should have choice to follow the miners or not. Do you agree
> with this or not?
>
> Regarding consensus changes, users can voice their opinion on any number
of communication platforms. Though if you're looking for a way for users to
signal their intentions at the protocol level, every proposal for doing
that to date has been arguably flawed. Measuring meatspace consensus is
pretty tricky if not completely impossible, especially given the fact that
the vast majority of Bitcoin users do not voice any opinions on the matter
of consensus rules.

Most attempts at measuring user consensus would probably be best described
as signaling rather than voting given that the act of doing so has no
actual power to affect consensus. Every user who runs a fully validating
node is free to enforce the rules with which the agree regardless of what
rules other entities are enforcing.

>
>
>>
>> ??????????????????????????????????????????
>> This choice for wallet users right now, is wether to follow the 51%
>> majority miners. If they don?t, they can have their fork that get rid of
>> miners.
>>
>> ???????????????????????????????
>> If they do trust the majority miners, they stay and follow the vote for
>> upcoming protocol upgrade.
>>
>> ??????????????????????????????????????????????????????????
>> So the questions is: Do the bitcoin developers, users, holders, service
>> provides, even miners, (still) have faith in the majority of miners as
>> designed in the white paper?
>>
>>
> There is a fundamental misconception regarding this point - the white
> paper refers to majority hashpower needing to be honest with regard to
> determining the correct chain within the context of many possible /valid/
> chain forks. It is not referring to using hashpower to determine the
> correct chain amongst an infinitely variable number of currently invalid
> chain forks. Bitcoin ecosystem participants should not have faith in miners
> (or any other entity) when it comes to choosing the consensus rules they
> wish to enforce.
>
>
> Arrrgh. I think in the BIP, the miners just invalids tx version 1
> temporarily. That?s a ?soft fork? right? If they dislike the idea, they can
> leave as always.
>
> From my understanding, if the only change miners make is to stop
confirming transactions that have a version less than X then it should be a
soft fork, yes.

>
> Regards
>
> LIN Zheming
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170614/5ce81220/attachment.html>

From heater at gmail.com  Wed Jun 14 18:29:35 2017
From: heater at gmail.com (Zheming Lin)
Date: Thu, 15 Jun 2017 02:29:35 +0800
Subject: [bitcoin-dev] Proposal: Demonstration of Phase in Full Network
 Upgrade Activated by Miners
In-Reply-To: <CADL_X_fdZG50HHb3iOePrzuOwU55tAqP80u3--xXEDWBKL7=jg@mail.gmail.com>
References: <A6AE8145-8C8A-44C2-88D3-8574D895AF6B@gmail.com>
	<CAAS2fgT=0k0NJWsO_TtBRTi2VqZtzuT1d1Sk+KZ2+2PUcA71tg@mail.gmail.com>
	<A5275580-0EA3-4021-8E4E-55E214BCEECB@gmail.com>
	<CADL_X_fdZG50HHb3iOePrzuOwU55tAqP80u3--xXEDWBKL7=jg@mail.gmail.com>
Message-ID: <31040BE1-64ED-4D05-BCBE-E80BC7B9A182@gmail.com>

Hi Jameson:

> ? 2017?6?15??01:20?Jameson Lopp <jameson.lopp at gmail.com <mailto:jameson.lopp at gmail.com>> ???
> 
> 
> 
> On Wed, Jun 14, 2017 at 9:39 AM, Zheming Lin via bitcoin-dev <bitcoin-dev at lists.linuxfoundation.org <mailto:bitcoin-dev at lists.linuxfoundation.org>> wrote:
> 
> 
> > ? 2017?6?14??02:11?Gregory Maxwell <greg at xiph.org <mailto:greg at xiph.org>> ???
> >
> > On Tue, Jun 13, 2017 at 2:23 AM, Zheming Lin via bitcoin-dev
> > <bitcoin-dev at lists.linuxfoundation.org <mailto:bitcoin-dev at lists.linuxfoundation.org>> wrote:
> 
> > The enforcement of the system's rules by users broadly, and not just
> > miners, is specifically described in the white paper (section 8,
> > paragraph 2, it especially clear in the last sentence).  This is
> > critical for the security of Bitcoin especially with the current
> > degree of centralization in pools.  Without it, Bitcoin's security
> > would look a lot more like the Ripple system.
> >
> 
> ???????????????????????? BIP ???????????????????????????????????????????????????????
> Yes, users always have choice that they can abandon the nodes. This BIP does?t go against them. I mean only the one(especially wallets) that?s passive, they need to know there?s a choice and pick one.
> 
> ?? BIP ?????????????????????????????????????????????????????????
> This BIP can be applied to almost any upgrade, including Segwit, Segwit2x, 2m, ec, 8m? but the upgrade is not the key point.
> 
> ????????????????
> Did the users have any real choice?
> 
> ????????????????????????????????????????????
> I don?t see the reason they trust the majority miners(as they do today) but refuse the vote for upcoming protocol upgrade.
> 
> To be clear, Bitcoin is not a democracy - if you find yourself using the term "voting" then you may be misunderstanding how consensus forms. Once a feature has been vetted and the code is deployed, miners may signal that they are ready to enforce new rules. If for some reason miners are too "passive or lazy" or wish to "veto" the activation of the new rules, users may choose to circumvent said veto by refusing to accept blocks that do not show readiness for enforcing the new rules.

How does the users show their opinion? They can fork away and leave. But what remains will be united. Are you afraid of the united users or the fork?

I agree with you that the ?vote? is not accurate. Could you kindly suggest an other word for that?

I think users should have choice to follow the miners or not. Do you agree with this or not?

>  
> 
> ??????????????????????????????????????????
> This choice for wallet users right now, is wether to follow the 51% majority miners. If they don?t, they can have their fork that get rid of miners.
> 
> ???????????????????????????????
> If they do trust the majority miners, they stay and follow the vote for upcoming protocol upgrade.
> 
> ??????????????????????????????????????????????????????????
> So the questions is: Do the bitcoin developers, users, holders, service provides, even miners, (still) have faith in the majority of miners as designed in the white paper?
> 
>  
> There is a fundamental misconception regarding this point - the white paper refers to majority hashpower needing to be honest with regard to determining the correct chain within the context of many possible /valid/ chain forks. It is not referring to using hashpower to determine the correct chain amongst an infinitely variable number of currently invalid chain forks. Bitcoin ecosystem participants should not have faith in miners (or any other entity) when it comes to choosing the consensus rules they wish to enforce.
> 

Arrrgh. I think in the BIP, the miners just invalids tx version 1 temporarily. That?s a ?soft fork? right? If they dislike the idea, they can leave as always.


Regards

LIN Zheming

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170615/eb46818c/attachment-0001.html>

From heater at gmail.com  Wed Jun 14 18:30:32 2017
From: heater at gmail.com (Zheming Lin)
Date: Thu, 15 Jun 2017 02:30:32 +0800
Subject: [bitcoin-dev] Proposal: Demonstration of Phase in Full Network
 Upgrade Activated by Miners
In-Reply-To: <CADL_X_fdZG50HHb3iOePrzuOwU55tAqP80u3--xXEDWBKL7=jg@mail.gmail.com>
References: <A6AE8145-8C8A-44C2-88D3-8574D895AF6B@gmail.com>
	<CAAS2fgT=0k0NJWsO_TtBRTi2VqZtzuT1d1Sk+KZ2+2PUcA71tg@mail.gmail.com>
	<A5275580-0EA3-4021-8E4E-55E214BCEECB@gmail.com>
	<CADL_X_fdZG50HHb3iOePrzuOwU55tAqP80u3--xXEDWBKL7=jg@mail.gmail.com>
Message-ID: <2A0FAB07-AD31-4C33-9604-A7611028B3DA@gmail.com>

Hi Jameson:

> ? 2017?6?15??01:20?Jameson Lopp <jameson.lopp at gmail.com <mailto:jameson.lopp at gmail.com>> ???
> 
> 
> 
> On Wed, Jun 14, 2017 at 9:39 AM, Zheming Lin via bitcoin-dev <bitcoin-dev at lists.linuxfoundation.org <mailto:bitcoin-dev at lists.linuxfoundation.org>> wrote:
> 
> 
> > ? 2017?6?14??02:11?Gregory Maxwell <greg at xiph.org <mailto:greg at xiph.org>> ???
> >
> > On Tue, Jun 13, 2017 at 2:23 AM, Zheming Lin via bitcoin-dev
> > <bitcoin-dev at lists.linuxfoundation.org <mailto:bitcoin-dev at lists.linuxfoundation.org>> wrote:
> 
> > The enforcement of the system's rules by users broadly, and not just
> > miners, is specifically described in the white paper (section 8,
> > paragraph 2, it especially clear in the last sentence).  This is
> > critical for the security of Bitcoin especially with the current
> > degree of centralization in pools.  Without it, Bitcoin's security
> > would look a lot more like the Ripple system.
> >
> 
> ???????????????????????? BIP ???????????????????????????????????????????????????????
> Yes, users always have choice that they can abandon the nodes. This BIP does?t go against them. I mean only the one(especially wallets) that?s passive, they need to know there?s a choice and pick one.
> 
> ?? BIP ?????????????????????????????????????????????????????????
> This BIP can be applied to almost any upgrade, including Segwit, Segwit2x, 2m, ec, 8m? but the upgrade is not the key point.
> 
> ????????????????
> Did the users have any real choice?
> 
> ????????????????????????????????????????????
> I don?t see the reason they trust the majority miners(as they do today) but refuse the vote for upcoming protocol upgrade.
> 
> To be clear, Bitcoin is not a democracy - if you find yourself using the term "voting" then you may be misunderstanding how consensus forms. Once a feature has been vetted and the code is deployed, miners may signal that they are ready to enforce new rules. If for some reason miners are too "passive or lazy" or wish to "veto" the activation of the new rules, users may choose to circumvent said veto by refusing to accept blocks that do not show readiness for enforcing the new rules.

How does the users show their opinion? They can fork away and leave. But what remains will be united. Are you afraid of the united users or the fork?

I agree with you that the ?vote? is not accurate. Could you kindly suggest an other word for that?

I think users should have choice to follow the miners or not. Do you agree with this or not?

>  
> 
> ??????????????????????????????????????????
> This choice for wallet users right now, is wether to follow the 51% majority miners. If they don?t, they can have their fork that get rid of miners.
> 
> ???????????????????????????????
> If they do trust the majority miners, they stay and follow the vote for upcoming protocol upgrade.
> 
> ??????????????????????????????????????????????????????????
> So the questions is: Do the bitcoin developers, users, holders, service provides, even miners, (still) have faith in the majority of miners as designed in the white paper?
> 
>  
> There is a fundamental misconception regarding this point - the white paper refers to majority hashpower needing to be honest with regard to determining the correct chain within the context of many possible /valid/ chain forks. It is not referring to using hashpower to determine the correct chain amongst an infinitely variable number of currently invalid chain forks. Bitcoin ecosystem participants should not have faith in miners (or any other entity) when it comes to choosing the consensus rules they wish to enforce.
> 

Arrrgh. I think in the BIP, the miners just invalids tx version 1 temporarily. That?s a ?soft fork? right? If they dislike the idea, they can leave as always.


Regards

LIN Zheming

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170615/68cc0bfb/attachment.html>

From heater at gmail.com  Wed Jun 14 19:04:21 2017
From: heater at gmail.com (Zheming Lin)
Date: Thu, 15 Jun 2017 03:04:21 +0800
Subject: [bitcoin-dev] Proposal: Demonstration of Phase in Full Network
 Upgrade Activated by Miners
In-Reply-To: <CADL_X_e0wuKTUbAiYyuDuk74+DQ98j1kkmBPz5c5RjU4R7RB3Q@mail.gmail.com>
References: <A6AE8145-8C8A-44C2-88D3-8574D895AF6B@gmail.com>
	<CAAS2fgT=0k0NJWsO_TtBRTi2VqZtzuT1d1Sk+KZ2+2PUcA71tg@mail.gmail.com>
	<A5275580-0EA3-4021-8E4E-55E214BCEECB@gmail.com>
	<CADL_X_fdZG50HHb3iOePrzuOwU55tAqP80u3--xXEDWBKL7=jg@mail.gmail.com>
	<31040BE1-64ED-4D05-BCBE-E80BC7B9A182@gmail.com>
	<CADL_X_e0wuKTUbAiYyuDuk74+DQ98j1kkmBPz5c5RjU4R7RB3Q@mail.gmail.com>
Message-ID: <FED03D2A-D9EE-4C65-80D9-60124386085C@gmail.com>

Hi Jameson:

> ? 2017?6?15??02:55?Jameson Lopp <jameson.lopp at gmail.com> ???
> 
> 
> 
> On Wed, Jun 14, 2017 at 11:29 AM, Zheming Lin <heater at gmail.com <mailto:heater at gmail.com>> wrote:
> Hi Jameson:
> 
>> ? 2017?6?15??01:20?Jameson Lopp <jameson.lopp at gmail.com <mailto:jameson.lopp at gmail.com>> ???
>> 
>> 
>> 
>> On Wed, Jun 14, 2017 at 9:39 AM, Zheming Lin via bitcoin-dev <bitcoin-dev at lists.linuxfoundation.org <mailto:bitcoin-dev at lists.linuxfoundation.org>> wrote:
>> 
>> 
>> > ? 2017?6?14??02:11?Gregory Maxwell <greg at xiph.org <mailto:greg at xiph.org>> ???
>> >
>> > On Tue, Jun 13, 2017 at 2:23 AM, Zheming Lin via bitcoin-dev
>> > <bitcoin-dev at lists.linuxfoundation.org <mailto:bitcoin-dev at lists.linuxfoundation.org>> wrote:
>> 
>> > The enforcement of the system's rules by users broadly, and not just
>> > miners, is specifically described in the white paper (section 8,
>> > paragraph 2, it especially clear in the last sentence).  This is
>> > critical for the security of Bitcoin especially with the current
>> > degree of centralization in pools.  Without it, Bitcoin's security
>> > would look a lot more like the Ripple system.
>> >
>> 
>> ???????????????????????? BIP ???????????????????????????????????????????????????????
>> Yes, users always have choice that they can abandon the nodes. This BIP does?t go against them. I mean only the one(especially wallets) that?s passive, they need to know there?s a choice and pick one.
>> 
>> ?? BIP ?????????????????????????????????????????????????????????
>> This BIP can be applied to almost any upgrade, including Segwit, Segwit2x, 2m, ec, 8m? but the upgrade is not the key point.
>> 
>> ????????????????
>> Did the users have any real choice?
>> 
>> ????????????????????????????????????????????
>> I don?t see the reason they trust the majority miners(as they do today) but refuse the vote for upcoming protocol upgrade.
>> 
>> To be clear, Bitcoin is not a democracy - if you find yourself using the term "voting" then you may be misunderstanding how consensus forms. Once a feature has been vetted and the code is deployed, miners may signal that they are ready to enforce new rules. If for some reason miners are too "passive or lazy" or wish to "veto" the activation of the new rules, users may choose to circumvent said veto by refusing to accept blocks that do not show readiness for enforcing the new rules.
> 
> How does the users show their opinion? They can fork away and leave. But what remains will be united. Are you afraid of the united users or the fork?
> 
> I agree with you that the ?vote? is not accurate. Could you kindly suggest an other word for that?
> 
> I think users should have choice to follow the miners or not. Do you agree with this or not?
> 
> Regarding consensus changes, users can voice their opinion on any number of communication platforms. Though if you're looking for a way for users to signal their intentions at the protocol level, every proposal for doing that to date has been arguably flawed. Measuring meatspace consensus is pretty tricky if not completely impossible, especially given the fact that the vast majority of Bitcoin users do not voice any opinions on the matter of consensus rules.
> 

?Sybil attack?. The genuine node will leave the chain if it doesn?t like the change. That?s what restrain the majority miners acting foolishly.

If the users like the idea, they follow. If they don?t the fork away(and not afraid of replay attack). I think it?s a way to move forward together. 

Would you support the idea that we put the choice to the users to decide?

> Most attempts at measuring user consensus would probably be best described as signaling rather than voting given that the act of doing so has no actual power to affect consensus. Every user who runs a fully validating node is free to enforce the rules with which the agree regardless of what rules other entities are enforcing. 
>>  
>> 
>> ??????????????????????????????????????????
>> This choice for wallet users right now, is wether to follow the 51% majority miners. If they don?t, they can have their fork that get rid of miners.
>> 
>> ???????????????????????????????
>> If they do trust the majority miners, they stay and follow the vote for upcoming protocol upgrade.
>> 
>> ??????????????????????????????????????????????????????????
>> So the questions is: Do the bitcoin developers, users, holders, service provides, even miners, (still) have faith in the majority of miners as designed in the white paper?
>> 
>>  
>> There is a fundamental misconception regarding this point - the white paper refers to majority hashpower needing to be honest with regard to determining the correct chain within the context of many possible /valid/ chain forks. It is not referring to using hashpower to determine the correct chain amongst an infinitely variable number of currently invalid chain forks. Bitcoin ecosystem participants should not have faith in miners (or any other entity) when it comes to choosing the consensus rules they wish to enforce.
>> 
> 
> Arrrgh. I think in the BIP, the miners just invalids tx version 1 temporarily. That?s a ?soft fork? right? If they dislike the idea, they can leave as always.
> 
> From my understanding, if the only change miners make is to stop confirming transactions that have a version less than X then it should be a soft fork, yes. 

And if we add a version 2 valid, does that still be a ?soft fork??


Regards,

LIN Zheming
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170615/6653504e/attachment-0001.html>

From jameson.lopp at gmail.com  Wed Jun 14 20:11:07 2017
From: jameson.lopp at gmail.com (Jameson Lopp)
Date: Wed, 14 Jun 2017 13:11:07 -0700
Subject: [bitcoin-dev] Proposal: Demonstration of Phase in Full Network
 Upgrade Activated by Miners
In-Reply-To: <FED03D2A-D9EE-4C65-80D9-60124386085C@gmail.com>
References: <A6AE8145-8C8A-44C2-88D3-8574D895AF6B@gmail.com>
	<CAAS2fgT=0k0NJWsO_TtBRTi2VqZtzuT1d1Sk+KZ2+2PUcA71tg@mail.gmail.com>
	<A5275580-0EA3-4021-8E4E-55E214BCEECB@gmail.com>
	<CADL_X_fdZG50HHb3iOePrzuOwU55tAqP80u3--xXEDWBKL7=jg@mail.gmail.com>
	<31040BE1-64ED-4D05-BCBE-E80BC7B9A182@gmail.com>
	<CADL_X_e0wuKTUbAiYyuDuk74+DQ98j1kkmBPz5c5RjU4R7RB3Q@mail.gmail.com>
	<FED03D2A-D9EE-4C65-80D9-60124386085C@gmail.com>
Message-ID: <CADL_X_ea7Mx6ainXMhKG4mHhED5ApmE_9noqBkXV+P4hdy57cA@mail.gmail.com>

On Wed, Jun 14, 2017 at 12:04 PM, Zheming Lin <heater at gmail.com> wrote:

> Hi Jameson:
>
> ? 2017?6?15??02:55?Jameson Lopp <jameson.lopp at gmail.com> ???
>
>
>
> On Wed, Jun 14, 2017 at 11:29 AM, Zheming Lin <heater at gmail.com> wrote:
>
>> Hi Jameson:
>>
>> ? 2017?6?15??01:20?Jameson Lopp <jameson.lopp at gmail.com> ???
>>
>>
>>
>> On Wed, Jun 14, 2017 at 9:39 AM, Zheming Lin via bitcoin-dev <
>> bitcoin-dev at lists.linuxfoundation.org> wrote:
>>
>>>
>>>
>>> > ? 2017?6?14??02:11?Gregory Maxwell <greg at xiph.org> ???
>>> >
>>> > On Tue, Jun 13, 2017 at 2:23 AM, Zheming Lin via bitcoin-dev
>>> > <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>>
>>> > The enforcement of the system's rules by users broadly, and not just
>>> > miners, is specifically described in the white paper (section 8,
>>> > paragraph 2, it especially clear in the last sentence).  This is
>>> > critical for the security of Bitcoin especially with the current
>>> > degree of centralization in pools.  Without it, Bitcoin's security
>>> > would look a lot more like the Ripple system.
>>> >
>>>
>>> ???????????????????????? BIP ??????????????????????????????
>>> ?????????????????????????
>>> Yes, users always have choice that they can abandon the nodes. This BIP
>>> does?t go against them. I mean only the one(especially wallets) that?s
>>> passive, they need to know there?s a choice and pick one.
>>>
>>> ?? BIP ?????????????????????????????????????????????????????????
>>> This BIP can be applied to almost any upgrade, including Segwit,
>>> Segwit2x, 2m, ec, 8m? but the upgrade is not the key point.
>>>
>>> ????????????????
>>> Did the users have any real choice?
>>>
>>> ????????????????????????????????????????????
>>> I don?t see the reason they trust the majority miners(as they do today)
>>> but refuse the vote for upcoming protocol upgrade.
>>>
>>
>> To be clear, Bitcoin is not a democracy - if you find yourself using the
>> term "voting" then you may be misunderstanding how consensus forms. Once a
>> feature has been vetted and the code is deployed, miners may signal that
>> they are ready to enforce new rules. If for some reason miners are too
>> "passive or lazy" or wish to "veto" the activation of the new rules, users
>> may choose to circumvent said veto by refusing to accept blocks that do not
>> show readiness for enforcing the new rules.
>>
>>
>> How does the users show their opinion? They can fork away and leave. But
>> what remains will be united. Are you afraid of the united users or the fork?
>>
>> I agree with you that the ?vote? is not accurate. Could you kindly
>> suggest an other word for that?
>>
>> I think users should have choice to follow the miners or not. Do you
>> agree with this or not?
>>
>> Regarding consensus changes, users can voice their opinion on any number
> of communication platforms. Though if you're looking for a way for users to
> signal their intentions at the protocol level, every proposal for doing
> that to date has been arguably flawed. Measuring meatspace consensus is
> pretty tricky if not completely impossible, especially given the fact that
> the vast majority of Bitcoin users do not voice any opinions on the matter
> of consensus rules.
>
>
> ?Sybil attack?. The genuine node will leave the chain if it doesn?t like
> the change. That?s what restrain the majority miners acting foolishly.
>
> If the users like the idea, they follow. If they don?t the fork away(and
> not afraid of replay attack). I think it?s a way to move forward together.
>
> Would you support the idea that we put the choice to the users to decide?
>
> The concept of "sybil attacks" doesn't really apply to enforcing
network-wide consensus changes. Even if someone spooled up 100 times more
nodes than currently exist and they all "signal" for some consensus rule
change, that doesn't compel the rest of the "genuine" nodes to change the
rules they enforce.

The users always have a choice with regard to what consensus rules to
enforce and what software to run. Everyone is welcome to propose changes
and write software that they make available to users.

> Most attempts at measuring user consensus would probably be best described
> as signaling rather than voting given that the act of doing so has no
> actual power to affect consensus. Every user who runs a fully validating
> node is free to enforce the rules with which the agree regardless of what
> rules other entities are enforcing.
>
>>
>>
>>>
>>> ??????????????????????????????????????????
>>> This choice for wallet users right now, is wether to follow the 51%
>>> majority miners. If they don?t, they can have their fork that get rid of
>>> miners.
>>>
>>> ???????????????????????????????
>>> If they do trust the majority miners, they stay and follow the vote for
>>> upcoming protocol upgrade.
>>>
>>> ??????????????????????????????????????????????????????????
>>> So the questions is: Do the bitcoin developers, users, holders, service
>>> provides, even miners, (still) have faith in the majority of miners as
>>> designed in the white paper?
>>>
>>>
>> There is a fundamental misconception regarding this point - the white
>> paper refers to majority hashpower needing to be honest with regard to
>> determining the correct chain within the context of many possible /valid/
>> chain forks. It is not referring to using hashpower to determine the
>> correct chain amongst an infinitely variable number of currently invalid
>> chain forks. Bitcoin ecosystem participants should not have faith in miners
>> (or any other entity) when it comes to choosing the consensus rules they
>> wish to enforce.
>>
>>
>> Arrrgh. I think in the BIP, the miners just invalids tx version 1
>> temporarily. That?s a ?soft fork? right? If they dislike the idea, they can
>> leave as always.
>>
>> From my understanding, if the only change miners make is to stop
> confirming transactions that have a version less than X then it should be a
> soft fork, yes.
>
>
> And if we add a version 2 valid, does that still be a ?soft fork??
>
> As far as I know - if you're only restricting the validation rules then it
should be a non-breaking change.

>
> Regards,
>
> LIN Zheming
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170614/69baca3b/attachment.html>

From eric at voskuil.org  Thu Jun 15 05:04:30 2017
From: eric at voskuil.org (Eric Voskuil)
Date: Thu, 15 Jun 2017 08:04:30 +0300
Subject: [bitcoin-dev] Proposal: Demonstration of Phase in Full Network
	Upgrade Activated by Miners
In-Reply-To: <CADL_X_e0wuKTUbAiYyuDuk74+DQ98j1kkmBPz5c5RjU4R7RB3Q@mail.gmail.com>
References: <A6AE8145-8C8A-44C2-88D3-8574D895AF6B@gmail.com>
	<CAAS2fgT=0k0NJWsO_TtBRTi2VqZtzuT1d1Sk+KZ2+2PUcA71tg@mail.gmail.com>
	<A5275580-0EA3-4021-8E4E-55E214BCEECB@gmail.com>
	<CADL_X_fdZG50HHb3iOePrzuOwU55tAqP80u3--xXEDWBKL7=jg@mail.gmail.com>
	<31040BE1-64ED-4D05-BCBE-E80BC7B9A182@gmail.com>
	<CADL_X_e0wuKTUbAiYyuDuk74+DQ98j1kkmBPz5c5RjU4R7RB3Q@mail.gmail.com>
Message-ID: <95BB8EA8-31F6-4131-B557-A35342FA17A1@voskuil.org>



> On Jun 14, 2017, at 9:55 PM, Jameson Lopp via bitcoin-dev <bitcoin-dev at lists.linuxfoundation.org> wrote:
> 
> 
> 
>> On Wed, Jun 14, 2017 at 11:29 AM, Zheming Lin <heater at gmail.com> wrote:
>> Hi Jameson:
>> 
>>> ? 2017?6?15??01:20?Jameson Lopp <jameson.lopp at gmail.com> ???
>>> 
>>> 
>>> 
>>> On Wed, Jun 14, 2017 at 9:39 AM, Zheming Lin via bitcoin-dev <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>>> 
>>>> 
>>>> > ? 2017?6?14??02:11?Gregory Maxwell <greg at xiph.org> ???
>>>> >
>>>> > On Tue, Jun 13, 2017 at 2:23 AM, Zheming Lin via bitcoin-dev
>>>> > <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>>> 
>>>> > The enforcement of the system's rules by users broadly, and not just
>>>> > miners, is specifically described in the white paper (section 8,
>>>> > paragraph 2, it especially clear in the last sentence).  This is
>>>> > critical for the security of Bitcoin especially with the current
>>>> > degree of centralization in pools.  Without it, Bitcoin's security
>>>> > would look a lot more like the Ripple system.
>>>> >
>>>> 
>>>> ???????????????????????? BIP ???????????????????????????????????????????????????????
>>>> Yes, users always have choice that they can abandon the nodes. This BIP does?t go against them. I mean only the one(especially wallets) that?s passive, they need to know there?s a choice and pick one.
>>>> 
>>>> ?? BIP ?????????????????????????????????????????????????????????
>>>> This BIP can be applied to almost any upgrade, including Segwit, Segwit2x, 2m, ec, 8m? but the upgrade is not the key point.
>>>> 
>>>> ????????????????
>>>> Did the users have any real choice?
>>>> 
>>>> ????????????????????????????????????????????
>>>> I don?t see the reason they trust the majority miners(as they do today) but refuse the vote for upcoming protocol upgrade.
>>> 
>>> To be clear, Bitcoin is not a democracy - if you find yourself using the term "voting" then you may be misunderstanding how consensus forms. Once a feature has been vetted and the code is deployed, miners may signal that they are ready to enforce new rules. If for some reason miners are too "passive or lazy" or wish to "veto" the activation of the new rules, users may choose to circumvent said veto by refusing to accept blocks that do not show readiness for enforcing the new rules.
>> 
>> How does the users show their opinion? They can fork away and leave. But what remains will be united. Are you afraid of the united users or the fork?
>> 
>> I agree with you that the ?vote? is not accurate. Could you kindly suggest an other word for that?
>> 
>> I think users should have choice to follow the miners or not. Do you agree with this or not?
>> 
> Regarding consensus changes, users can voice their opinion on any number of communication platforms. Though if you're looking for a way for users to signal their intentions at the protocol level, every proposal for doing that to date has been arguably flawed.

There is exactly one way to express one's opinion on consensus at the protocol level - participation. The method is neither flawed nor inequitable in the context of Bitcoin.

The only "problem" with it is that people are not satisfied with having a voice limited to their participation. People are used to political systems in which they vote using their existence as power, not their participation, and they expect some subset of existing human bodies to control all others. This is the concept of some ruling over others, which gives the rulers a more powerful voice than either their proportional existence or individual participation would allow.

Bitcoin exists in defiance of political models. It is a market, not a state. The only choice you have is to participate or leave. If you are satisfied with others participating in your stead, you have left the consensus - you have no say.

Most people who think they are participating in Bitcoin have either never participated or long ago left the consensus. Having surrendered it, these people now grope for a way to have their say. You can always reclaim your say on consensus, but you cannot take it away from others.

To have your say regarding hard forks, you must validate Bitcoin received in exchange for something else of economic value. To have your say regarding soft forks you must mine. Everyone has these options. Hard forks cannot control miners' selection of transactions and miners cannot control the economy's determination of what is valid. If one wants a say in either one must participate in the respective operation.

e

> Measuring meatspace consensus is pretty tricky if not completely impossible, especially given the fact that the vast majority of Bitcoin users do not voice any opinions on the matter of consensus rules.
> 
> Most attempts at measuring user consensus would probably be best described as signaling rather than voting given that the act of doing so has no actual power to affect consensus. Every user who runs a fully validating node is free to enforce the rules with which the agree regardless of what rules other entities are enforcing. 
>>>  
>>>> 
>>>> ??????????????????????????????????????????
>>>> This choice for wallet users right now, is wether to follow the 51% majority miners. If they don?t, they can have their fork that get rid of miners.
>>>> 
>>>> ???????????????????????????????
>>>> If they do trust the majority miners, they stay and follow the vote for upcoming protocol upgrade.
>>>> 
>>>> ??????????????????????????????????????????????????????????
>>>> So the questions is: Do the bitcoin developers, users, holders, service provides, even miners, (still) have faith in the majority of miners as designed in the white paper?
>>>> 
>>>  
>>> There is a fundamental misconception regarding this point - the white paper refers to majority hashpower needing to be honest with regard to determining the correct chain within the context of many possible /valid/ chain forks. It is not referring to using hashpower to determine the correct chain amongst an infinitely variable number of currently invalid chain forks. Bitcoin ecosystem participants should not have faith in miners (or any other entity) when it comes to choosing the consensus rules they wish to enforce.
>>> 
>> 
>> Arrrgh. I think in the BIP, the miners just invalids tx version 1 temporarily. That?s a ?soft fork? right? If they dislike the idea, they can leave as always.
>> 
> From my understanding, if the only change miners make is to stop confirming transactions that have a version less than X then it should be a soft fork, yes. 
>> 
>> Regards
>> 
>> LIN Zheming
>> 
> 
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170615/17cff7df/attachment-0001.html>

From erik at q32.com  Thu Jun 15 18:38:57 2017
From: erik at q32.com (Erik Aronesty)
Date: Thu, 15 Jun 2017 14:38:57 -0400
Subject: [bitcoin-dev] Proposal: Demonstration of Phase in Full Network
 Upgrade Activated by Miners
In-Reply-To: <95BB8EA8-31F6-4131-B557-A35342FA17A1@voskuil.org>
References: <A6AE8145-8C8A-44C2-88D3-8574D895AF6B@gmail.com>
	<CAAS2fgT=0k0NJWsO_TtBRTi2VqZtzuT1d1Sk+KZ2+2PUcA71tg@mail.gmail.com>
	<A5275580-0EA3-4021-8E4E-55E214BCEECB@gmail.com>
	<CADL_X_fdZG50HHb3iOePrzuOwU55tAqP80u3--xXEDWBKL7=jg@mail.gmail.com>
	<31040BE1-64ED-4D05-BCBE-E80BC7B9A182@gmail.com>
	<CADL_X_e0wuKTUbAiYyuDuk74+DQ98j1kkmBPz5c5RjU4R7RB3Q@mail.gmail.com>
	<95BB8EA8-31F6-4131-B557-A35342FA17A1@voskuil.org>
Message-ID: <CAJowKgJE6+1nKFYngTRhS_X2z_tmLoxY__J_Aph6UHmAnR8tcQ@mail.gmail.com>

> How does the users show their opinion? They can fork away and leave. But
what remains will be united. Are you afraid of the united users or the fork?

I had proposed earlier and maintain that "UTXO bits" can be used to allow
coordinated user participation activation thresholds akin to other
hashpower thresholds.

https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-May/014251.html

While I'm not certain that my implementation was correct (or was just too
complicated and concerned with compression at the expense of readability),
I am fairly certain that this mechanism - or a similar one - would be a
reasonable way for users to coordinate changes independently of miners and
with very high consensus levels.


On Thu, Jun 15, 2017 at 1:04 AM, Eric Voskuil via bitcoin-dev <
bitcoin-dev at lists.linuxfoundation.org> wrote:

>
>
> On Jun 14, 2017, at 9:55 PM, Jameson Lopp via bitcoin-dev <
> bitcoin-dev at lists.linuxfoundation.org> wrote:
>
>
>
> On Wed, Jun 14, 2017 at 11:29 AM, Zheming Lin <heater at gmail.com> wrote:
>
>> Hi Jameson:
>>
>> ? 2017?6?15??01:20?Jameson Lopp <jameson.lopp at gmail.com> ???
>>
>>
>>
>> On Wed, Jun 14, 2017 at 9:39 AM, Zheming Lin via bitcoin-dev <
>> bitcoin-dev at lists.linuxfoundation.org> wrote:
>>
>>>
>>>
>>> > ? 2017?6?14??02:11?Gregory Maxwell <greg at xiph.org> ???
>>> >
>>> > On Tue, Jun 13, 2017 at 2:23 AM, Zheming Lin via bitcoin-dev
>>> > <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>>
>>> > The enforcement of the system's rules by users broadly, and not just
>>> > miners, is specifically described in the white paper (section 8,
>>> > paragraph 2, it especially clear in the last sentence).  This is
>>> > critical for the security of Bitcoin especially with the current
>>> > degree of centralization in pools.  Without it, Bitcoin's security
>>> > would look a lot more like the Ripple system.
>>> >
>>>
>>> ???????????????????????? BIP ??????????????????????????????
>>> ?????????????????????????
>>> Yes, users always have choice that they can abandon the nodes. This BIP
>>> does?t go against them. I mean only the one(especially wallets) that?s
>>> passive, they need to know there?s a choice and pick one.
>>>
>>> ?? BIP ?????????????????????????????????????????????????????????
>>> This BIP can be applied to almost any upgrade, including Segwit,
>>> Segwit2x, 2m, ec, 8m? but the upgrade is not the key point.
>>>
>>> ????????????????
>>> Did the users have any real choice?
>>>
>>> ????????????????????????????????????????????
>>> I don?t see the reason they trust the majority miners(as they do today)
>>> but refuse the vote for upcoming protocol upgrade.
>>>
>>
>> To be clear, Bitcoin is not a democracy - if you find yourself using the
>> term "voting" then you may be misunderstanding how consensus forms. Once a
>> feature has been vetted and the code is deployed, miners may signal that
>> they are ready to enforce new rules. If for some reason miners are too
>> "passive or lazy" or wish to "veto" the activation of the new rules, users
>> may choose to circumvent said veto by refusing to accept blocks that do not
>> show readiness for enforcing the new rules.
>>
>>
>> How does the users show their opinion? They can fork away and leave. But
>> what remains will be united. Are you afraid of the united users or the fork?
>>
>> I agree with you that the ?vote? is not accurate. Could you kindly
>> suggest an other word for that?
>>
>> I think users should have choice to follow the miners or not. Do you
>> agree with this or not?
>>
>> Regarding consensus changes, users can voice their opinion on any number
> of communication platforms. Though if you're looking for a way for users to
> signal their intentions at the protocol level, every proposal for doing
> that to date has been arguably flawed.
>
>
> There is exactly one way to express one's opinion on consensus at the
> protocol level - participation. The method is neither flawed nor
> inequitable in the context of Bitcoin.
>
> The only "problem" with it is that people are not satisfied with having a
> voice limited to their participation. People are used to political systems
> in which they vote using their existence as power, not their participation,
> and they expect some subset of existing human bodies to control all others.
> This is the concept of some ruling over others, which gives the rulers a
> more powerful voice than either their proportional existence or individual
> participation would allow.
>
> Bitcoin exists in defiance of political models. It is a market, not a
> state. The only choice you have is to participate or leave. If you are
> satisfied with others participating in your stead, you have left the
> consensus - you have no say.
>
> Most people who think they are participating in Bitcoin have either never
> participated or long ago left the consensus. Having surrendered it, these
> people now grope for a way to have their say. You can always reclaim your
> say on consensus, but you cannot take it away from others.
>
> To have your say regarding hard forks, you must validate Bitcoin received
> in exchange for something else of economic value. To have your say
> regarding soft forks you must mine. Everyone has these options. Hard forks
> cannot control miners' selection of transactions and miners cannot control
> the economy's determination of what is valid. If one wants a say in either
> one must participate in the respective operation.
>
> e
>
> Measuring meatspace consensus is pretty tricky if not completely
> impossible, especially given the fact that the vast majority of Bitcoin
> users do not voice any opinions on the matter of consensus rules.
>
> Most attempts at measuring user consensus would probably be best described
> as signaling rather than voting given that the act of doing so has no
> actual power to affect consensus. Every user who runs a fully validating
> node is free to enforce the rules with which the agree regardless of what
> rules other entities are enforcing.
>
>>
>>
>>>
>>> ??????????????????????????????????????????
>>> This choice for wallet users right now, is wether to follow the 51%
>>> majority miners. If they don?t, they can have their fork that get rid of
>>> miners.
>>>
>>> ???????????????????????????????
>>> If they do trust the majority miners, they stay and follow the vote for
>>> upcoming protocol upgrade.
>>>
>>> ??????????????????????????????????????????????????????????
>>> So the questions is: Do the bitcoin developers, users, holders, service
>>> provides, even miners, (still) have faith in the majority of miners as
>>> designed in the white paper?
>>>
>>>
>> There is a fundamental misconception regarding this point - the white
>> paper refers to majority hashpower needing to be honest with regard to
>> determining the correct chain within the context of many possible /valid/
>> chain forks. It is not referring to using hashpower to determine the
>> correct chain amongst an infinitely variable number of currently invalid
>> chain forks. Bitcoin ecosystem participants should not have faith in miners
>> (or any other entity) when it comes to choosing the consensus rules they
>> wish to enforce.
>>
>>
>> Arrrgh. I think in the BIP, the miners just invalids tx version 1
>> temporarily. That?s a ?soft fork? right? If they dislike the idea, they can
>> leave as always.
>>
>> From my understanding, if the only change miners make is to stop
> confirming transactions that have a version less than X then it should be a
> soft fork, yes.
>
>>
>> Regards
>>
>> LIN Zheming
>>
>>
>>
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>
>
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170615/33b83dd0/attachment-0001.html>

From heater at gmail.com  Fri Jun 16 14:39:26 2017
From: heater at gmail.com (Zheming Lin)
Date: Fri, 16 Jun 2017 22:39:26 +0800
Subject: [bitcoin-dev] Proposal: Demonstration of Phase in Full Network
 Upgrade Activated by Miners
In-Reply-To: <CADL_X_ea7Mx6ainXMhKG4mHhED5ApmE_9noqBkXV+P4hdy57cA@mail.gmail.com>
References: <A6AE8145-8C8A-44C2-88D3-8574D895AF6B@gmail.com>
	<CAAS2fgT=0k0NJWsO_TtBRTi2VqZtzuT1d1Sk+KZ2+2PUcA71tg@mail.gmail.com>
	<A5275580-0EA3-4021-8E4E-55E214BCEECB@gmail.com>
	<CADL_X_fdZG50HHb3iOePrzuOwU55tAqP80u3--xXEDWBKL7=jg@mail.gmail.com>
	<31040BE1-64ED-4D05-BCBE-E80BC7B9A182@gmail.com>
	<CADL_X_e0wuKTUbAiYyuDuk74+DQ98j1kkmBPz5c5RjU4R7RB3Q@mail.gmail.com>
	<FED03D2A-D9EE-4C65-80D9-60124386085C@gmail.com>
	<CADL_X_ea7Mx6ainXMhKG4mHhED5ApmE_9noqBkXV+P4hdy57cA@mail.gmail.com>
Message-ID: <E1AE7FA5-CF43-4A5F-A31B-CAB1EE4D40D1@gmail.com>

Will there be a  ?Do nothing? soft fork, showing that the community can still moving forward?

So all the nodes get to upgrade to use tx version 2, and that avoid a chain split.

Are you support that or against that, why?

Regards,
LIN Zheming

> ? 2017?6?15????4:11?Jameson Lopp <jameson.lopp at gmail.com> ???
> 
> 
> 
> On Wed, Jun 14, 2017 at 12:04 PM, Zheming Lin <heater at gmail.com <mailto:heater at gmail.com>> wrote:
> Hi Jameson:
> 
>> ? 2017?6?15??02:55?Jameson Lopp <jameson.lopp at gmail.com <mailto:jameson.lopp at gmail.com>> ???
>> 
>> 
>> 
>> On Wed, Jun 14, 2017 at 11:29 AM, Zheming Lin <heater at gmail.com <mailto:heater at gmail.com>> wrote:
>> Hi Jameson:
>> 
>>> ? 2017?6?15??01:20?Jameson Lopp <jameson.lopp at gmail.com <mailto:jameson.lopp at gmail.com>> ???
>>> 
>>> 
>>> 
>>> On Wed, Jun 14, 2017 at 9:39 AM, Zheming Lin via bitcoin-dev <bitcoin-dev at lists.linuxfoundation.org <mailto:bitcoin-dev at lists.linuxfoundation.org>> wrote:
>>> 
>>> 
>>> > ? 2017?6?14??02:11?Gregory Maxwell <greg at xiph.org <mailto:greg at xiph.org>> ???
>>> >
>>> > On Tue, Jun 13, 2017 at 2:23 AM, Zheming Lin via bitcoin-dev
>>> > <bitcoin-dev at lists.linuxfoundation.org <mailto:bitcoin-dev at lists.linuxfoundation.org>> wrote:
>>> 
>>> > The enforcement of the system's rules by users broadly, and not just
>>> > miners, is specifically described in the white paper (section 8,
>>> > paragraph 2, it especially clear in the last sentence).  This is
>>> > critical for the security of Bitcoin especially with the current
>>> > degree of centralization in pools.  Without it, Bitcoin's security
>>> > would look a lot more like the Ripple system.
>>> >
>>> 
>>> ???????????????????????? BIP ???????????????????????????????????????????????????????
>>> Yes, users always have choice that they can abandon the nodes. This BIP does?t go against them. I mean only the one(especially wallets) that?s passive, they need to know there?s a choice and pick one.
>>> 
>>> ?? BIP ?????????????????????????????????????????????????????????
>>> This BIP can be applied to almost any upgrade, including Segwit, Segwit2x, 2m, ec, 8m? but the upgrade is not the key point.
>>> 
>>> ????????????????
>>> Did the users have any real choice?
>>> 
>>> ????????????????????????????????????????????
>>> I don?t see the reason they trust the majority miners(as they do today) but refuse the vote for upcoming protocol upgrade.
>>> 
>>> To be clear, Bitcoin is not a democracy - if you find yourself using the term "voting" then you may be misunderstanding how consensus forms. Once a feature has been vetted and the code is deployed, miners may signal that they are ready to enforce new rules. If for some reason miners are too "passive or lazy" or wish to "veto" the activation of the new rules, users may choose to circumvent said veto by refusing to accept blocks that do not show readiness for enforcing the new rules.
>> 
>> How does the users show their opinion? They can fork away and leave. But what remains will be united. Are you afraid of the united users or the fork?
>> 
>> I agree with you that the ?vote? is not accurate. Could you kindly suggest an other word for that?
>> 
>> I think users should have choice to follow the miners or not. Do you agree with this or not?
>> 
>> Regarding consensus changes, users can voice their opinion on any number of communication platforms. Though if you're looking for a way for users to signal their intentions at the protocol level, every proposal for doing that to date has been arguably flawed. Measuring meatspace consensus is pretty tricky if not completely impossible, especially given the fact that the vast majority of Bitcoin users do not voice any opinions on the matter of consensus rules.
>> 
> 
> ?Sybil attack?. The genuine node will leave the chain if it doesn?t like the change. That?s what restrain the majority miners acting foolishly.
> 
> If the users like the idea, they follow. If they don?t the fork away(and not afraid of replay attack). I think it?s a way to move forward together. 
> 
> Would you support the idea that we put the choice to the users to decide?
> 
> The concept of "sybil attacks" doesn't really apply to enforcing network-wide consensus changes. Even if someone spooled up 100 times more nodes than currently exist and they all "signal" for some consensus rule change, that doesn't compel the rest of the "genuine" nodes to change the rules they enforce. 
> 
> The users always have a choice with regard to what consensus rules to enforce and what software to run. Everyone is welcome to propose changes and write software that they make available to users.
>> Most attempts at measuring user consensus would probably be best described as signaling rather than voting given that the act of doing so has no actual power to affect consensus. Every user who runs a fully validating node is free to enforce the rules with which the agree regardless of what rules other entities are enforcing. 
>>>  
>>> 
>>> ??????????????????????????????????????????
>>> This choice for wallet users right now, is wether to follow the 51% majority miners. If they don?t, they can have their fork that get rid of miners.
>>> 
>>> ???????????????????????????????
>>> If they do trust the majority miners, they stay and follow the vote for upcoming protocol upgrade.
>>> 
>>> ??????????????????????????????????????????????????????????
>>> So the questions is: Do the bitcoin developers, users, holders, service provides, even miners, (still) have faith in the majority of miners as designed in the white paper?
>>> 
>>>  
>>> There is a fundamental misconception regarding this point - the white paper refers to majority hashpower needing to be honest with regard to determining the correct chain within the context of many possible /valid/ chain forks. It is not referring to using hashpower to determine the correct chain amongst an infinitely variable number of currently invalid chain forks. Bitcoin ecosystem participants should not have faith in miners (or any other entity) when it comes to choosing the consensus rules they wish to enforce.
>>> 
>> 
>> Arrrgh. I think in the BIP, the miners just invalids tx version 1 temporarily. That?s a ?soft fork? right? If they dislike the idea, they can leave as always.
>> 
>> From my understanding, if the only change miners make is to stop confirming transactions that have a version less than X then it should be a soft fork, yes. 
> 
> And if we add a version 2 valid, does that still be a ?soft fork??
> 
> As far as I know - if you're only restricting the validation rules then it should be a non-breaking change. 
> 
> Regards,
> 
> LIN Zheming

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170616/d80e014f/attachment-0001.html>

From eric at voskuil.org  Fri Jun 16 03:09:33 2017
From: eric at voskuil.org (Eric Voskuil)
Date: Fri, 16 Jun 2017 06:09:33 +0300
Subject: [bitcoin-dev] Proposal: Demonstration of Phase in Full Network
	Upgrade Activated by Miners
In-Reply-To: <CAJowKgJE6+1nKFYngTRhS_X2z_tmLoxY__J_Aph6UHmAnR8tcQ@mail.gmail.com>
References: <A6AE8145-8C8A-44C2-88D3-8574D895AF6B@gmail.com>
	<CAAS2fgT=0k0NJWsO_TtBRTi2VqZtzuT1d1Sk+KZ2+2PUcA71tg@mail.gmail.com>
	<A5275580-0EA3-4021-8E4E-55E214BCEECB@gmail.com>
	<CADL_X_fdZG50HHb3iOePrzuOwU55tAqP80u3--xXEDWBKL7=jg@mail.gmail.com>
	<31040BE1-64ED-4D05-BCBE-E80BC7B9A182@gmail.com>
	<CADL_X_e0wuKTUbAiYyuDuk74+DQ98j1kkmBPz5c5RjU4R7RB3Q@mail.gmail.com>
	<95BB8EA8-31F6-4131-B557-A35342FA17A1@voskuil.org>
	<CAJowKgJE6+1nKFYngTRhS_X2z_tmLoxY__J_Aph6UHmAnR8tcQ@mail.gmail.com>
Message-ID: <8999832B-BD81-415A-9CA5-0DE397A1A904@voskuil.org>

Seems functional as a way for the economy to signal, but signaling is only an expression of intent to participate, not actual participation. One can signal and then not participate, as we see with hash rate signaling.

Today we see people complaining about miner control, because hash rate is centralized. Tomorrow we are likely to see people complaining about economic control, as its centralization continues.

So imagine a few web wallets/APIs signaling based on their ownership of the major fraction of value. Can potential splitters safely rely on these signals? The wallets have a voice because they participate.

Consider also that user activated soft forks are not followed by unmodified nodes (on the presumption of minority hash rate support that necessitated the economic activation). In other words, they exhibit the categorical behavior of hard forks (incompatibility). So to the extent that the economy has control, it is only over the ability to hard fork (split the chain).

e

> On Jun 15, 2017, at 9:38 PM, Erik Aronesty <erik at q32.com> wrote:
> 
> > How does the users show their opinion? They can fork away and leave. But what remains will be united. Are you afraid of the united users or the fork?
> 
> I had proposed earlier and maintain that "UTXO bits" can be used to allow coordinated user participation activation thresholds akin to other hashpower thresholds.   
> 
> https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-May/014251.html
> 
> While I'm not certain that my implementation was correct (or was just too complicated and concerned with compression at the expense of readability), I am fairly certain that this mechanism - or a similar one - would be a reasonable way for users to coordinate changes independently of miners and with very high consensus levels.
> 
> 
>> On Thu, Jun 15, 2017 at 1:04 AM, Eric Voskuil via bitcoin-dev <bitcoin-dev at lists.linuxfoundation.org> wrote:
>> 
>> 
>>> On Jun 14, 2017, at 9:55 PM, Jameson Lopp via bitcoin-dev <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>> 
>>> 
>>> 
>>>> On Wed, Jun 14, 2017 at 11:29 AM, Zheming Lin <heater at gmail.com> wrote:
>>>> Hi Jameson:
>>>> 
>>>>> ? 2017?6?15??01:20?Jameson Lopp <jameson.lopp at gmail.com> ???
>>>>> 
>>>>> 
>>>>> 
>>>>> On Wed, Jun 14, 2017 at 9:39 AM, Zheming Lin via bitcoin-dev <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>>>>> 
>>>>>> 
>>>>>> > ? 2017?6?14??02:11?Gregory Maxwell <greg at xiph.org> ???
>>>>>> >
>>>>>> > On Tue, Jun 13, 2017 at 2:23 AM, Zheming Lin via bitcoin-dev
>>>>>> > <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>>>>> 
>>>>>> > The enforcement of the system's rules by users broadly, and not just
>>>>>> > miners, is specifically described in the white paper (section 8,
>>>>>> > paragraph 2, it especially clear in the last sentence).  This is
>>>>>> > critical for the security of Bitcoin especially with the current
>>>>>> > degree of centralization in pools.  Without it, Bitcoin's security
>>>>>> > would look a lot more like the Ripple system.
>>>>>> >
>>>>>> 
>>>>>> ???????????????????????? BIP ???????????????????????????????????????????????????????
>>>>>> Yes, users always have choice that they can abandon the nodes. This BIP does?t go against them. I mean only the one(especially wallets) that?s passive, they need to know there?s a choice and pick one.
>>>>>> 
>>>>>> ?? BIP ?????????????????????????????????????????????????????????
>>>>>> This BIP can be applied to almost any upgrade, including Segwit, Segwit2x, 2m, ec, 8m? but the upgrade is not the key point.
>>>>>> 
>>>>>> ????????????????
>>>>>> Did the users have any real choice?
>>>>>> 
>>>>>> ????????????????????????????????????????????
>>>>>> I don?t see the reason they trust the majority miners(as they do today) but refuse the vote for upcoming protocol upgrade.
>>>>> 
>>>>> To be clear, Bitcoin is not a democracy - if you find yourself using the term "voting" then you may be misunderstanding how consensus forms. Once a feature has been vetted and the code is deployed, miners may signal that they are ready to enforce new rules. If for some reason miners are too "passive or lazy" or wish to "veto" the activation of the new rules, users may choose to circumvent said veto by refusing to accept blocks that do not show readiness for enforcing the new rules.
>>>> 
>>>> How does the users show their opinion? They can fork away and leave. But what remains will be united. Are you afraid of the united users or the fork?
>>>> 
>>>> I agree with you that the ?vote? is not accurate. Could you kindly suggest an other word for that?
>>>> 
>>>> I think users should have choice to follow the miners or not. Do you agree with this or not?
>>>> 
>>> Regarding consensus changes, users can voice their opinion on any number of communication platforms. Though if you're looking for a way for users to signal their intentions at the protocol level, every proposal for doing that to date has been arguably flawed.
>> 
>> There is exactly one way to express one's opinion on consensus at the protocol level - participation. The method is neither flawed nor inequitable in the context of Bitcoin.
>> 
>> The only "problem" with it is that people are not satisfied with having a voice limited to their participation. People are used to political systems in which they vote using their existence as power, not their participation, and they expect some subset of existing human bodies to control all others. This is the concept of some ruling over others, which gives the rulers a more powerful voice than either their proportional existence or individual participation would allow.
>> 
>> Bitcoin exists in defiance of political models. It is a market, not a state. The only choice you have is to participate or leave. If you are satisfied with others participating in your stead, you have left the consensus - you have no say.
>> 
>> Most people who think they are participating in Bitcoin have either never participated or long ago left the consensus. Having surrendered it, these people now grope for a way to have their say. You can always reclaim your say on consensus, but you cannot take it away from others.
>> 
>> To have your say regarding hard forks, you must validate Bitcoin received in exchange for something else of economic value. To have your say regarding soft forks you must mine. Everyone has these options. Hard forks cannot control miners' selection of transactions and miners cannot control the economy's determination of what is valid. If one wants a say in either one must participate in the respective operation.
>> 
>> e
>> 
>>> Measuring meatspace consensus is pretty tricky if not completely impossible, especially given the fact that the vast majority of Bitcoin users do not voice any opinions on the matter of consensus rules.
>>> 
>>> Most attempts at measuring user consensus would probably be best described as signaling rather than voting given that the act of doing so has no actual power to affect consensus. Every user who runs a fully validating node is free to enforce the rules with which the agree regardless of what rules other entities are enforcing. 
>>>>>  
>>>>>> 
>>>>>> ??????????????????????????????????????????
>>>>>> This choice for wallet users right now, is wether to follow the 51% majority miners. If they don?t, they can have their fork that get rid of miners.
>>>>>> 
>>>>>> ???????????????????????????????
>>>>>> If they do trust the majority miners, they stay and follow the vote for upcoming protocol upgrade.
>>>>>> 
>>>>>> ??????????????????????????????????????????????????????????
>>>>>> So the questions is: Do the bitcoin developers, users, holders, service provides, even miners, (still) have faith in the majority of miners as designed in the white paper?
>>>>>> 
>>>>>  
>>>>> There is a fundamental misconception regarding this point - the white paper refers to majority hashpower needing to be honest with regard to determining the correct chain within the context of many possible /valid/ chain forks. It is not referring to using hashpower to determine the correct chain amongst an infinitely variable number of currently invalid chain forks. Bitcoin ecosystem participants should not have faith in miners (or any other entity) when it comes to choosing the consensus rules they wish to enforce.
>>>>> 
>>>> 
>>>> Arrrgh. I think in the BIP, the miners just invalids tx version 1 temporarily. That?s a ?soft fork? right? If they dislike the idea, they can leave as always.
>>>> 
>>> From my understanding, if the only change miners make is to stop confirming transactions that have a version less than X then it should be a soft fork, yes. 
>>>> 
>>>> Regards
>>>> 
>>>> LIN Zheming
>>>> 
>>> 
>>> _______________________________________________
>>> bitcoin-dev mailing list
>>> bitcoin-dev at lists.linuxfoundation.org
>>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>> 
>> _______________________________________________
>> bitcoin-dev mailing list
>> bitcoin-dev at lists.linuxfoundation.org
>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>> 
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170616/32363171/attachment-0001.html>

From laanwj at gmail.com  Sat Jun 17 11:40:22 2017
From: laanwj at gmail.com (Wladimir J. van der Laan)
Date: Sat, 17 Jun 2017 13:40:22 +0200
Subject: [bitcoin-dev] Bitcoin Core 0.14.2 released
Message-ID: <20170617114022.GA28021@amethyst.visucore.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

Bitcoin Core version 0.14.2 is now available from:

  <https://bitcoin.org/bin/bitcoin-core-0.14.2/>

Or by torrent:

  magnet:?xt=urn:btih:b4fc7820df95b8b39603ad246c241272ec403619&dn=bitcoin-core-0.14.2&tr=udp%3A%2F%2Ftracker.openbittorrent.com%3A80%2Fannounce&tr=udp%3A%2F%2Ftracker.publicbt.com%3A80%2Fannounce&tr=udp%3A%2F%2Ftracker.ccc.de%3A80%2Fannounce&tr=udp%3A%2F%2Ftracker.coppersurfer.tk%3A6969&tr=udp%3A%2F%2Ftracker.leechers-paradise.org%3A6969&tr=udp%3A%2F%2Ftracker.openbittorrent.com%3A80%2Fannounce

This is a new minor version release, including various bugfixes and
performance improvements, as well as updated translations.

Please report bugs using the issue tracker at github:

  <https://github.com/bitcoin/bitcoin/issues>

To receive security and update notifications, please subscribe to:

  <https://bitcoincore.org/en/list/announcements/join/>

Compatibility
==============

Bitcoin Core is extensively tested on multiple operating systems using
the Linux kernel, macOS 10.8+, and Windows Vista and later.

Microsoft ended support for Windows XP on [April 8th, 2014](https://www.microsoft.com/en-us/WindowsForBusiness/end-of-xp-support),
No attempt is made to prevent installing or running the software on Windows XP, you
can still do so at your own risk but be aware that there are known instabilities and issues.
Please do not report issues about Windows XP to the issue tracker.

Bitcoin Core should also work on most other Unix-like systems but is not
frequently tested on them.

Notable changes
===============

miniupnp CVE-2017-8798
- ----------------------------

Bundled miniupnpc was updated to 2.0.20170509. This fixes an integer signedness error
(present in MiniUPnPc v1.4.20101221 through v2.0) that allows remote attackers
(within the LAN) to cause a denial of service or possibly have unspecified
other impact.

This only affects users that have explicitly enabled UPnP through the GUI
setting or through the `-upnp` option, as since the last UPnP vulnerability
(in Bitcoin Core 0.10.3) it has been disabled by default.

If you use this option, it is recommended to upgrade to this version as soon as
possible.

Known Bugs
==========

Since 0.14.0 the approximate transaction fee shown in Bitcoin-Qt when using coin
control and smart fee estimation does not reflect any change in target from the
smart fee slider. It will only present an approximate fee calculated using the
default target. The fee calculated using the correct target is still applied to
the transaction and shown in the final send confirmation dialog.

0.14.2 Change log
=================

Detailed release notes follow. This overview includes changes that affect
behavior, not code moves, refactors and string updates. For convenience in locating
the code changes and accompanying discussion, both the pull request and
git merge commit are mentioned.

### RPC and other APIs
- - #10410 `321419b` Fix importwallet edge case rescan bug (ryanofsky)

### P2P protocol and network code
- - #10424 `37a8fc5` Populate services in GetLocalAddress (morcos)
- - #10441 `9e3ad50` Only enforce expected services for half of outgoing connections (theuni)

### Build system
- - #10414 `ffb0c4b` miniupnpc 2.0.20170509 (fanquake)
- - #10228 `ae479bc` Regenerate bitcoin-config.h as necessary (theuni)

### Miscellaneous
- - #10245 `44a17f2` Minor fix in build documentation for FreeBSD 11 (shigeya)
- - #10215 `0aee4a1` Check interruptNet during dnsseed lookups (TheBlueMatt)

### GUI
- - #10231 `1e936d7` Reduce a significant cs_main lock freeze (jonasschnelli)

### Wallet
- - #10294 `1847642` Unset change position when there is no change (instagibbs)

Credits
=======

Thanks to everyone who directly contributed to this release:

- - Alex Morcos
- - Cory Fields
- - fanquake
- - Gregory Sanders
- - Jonas Schnelli
- - Matt Corallo
- - Russell Yanofsky
- - Shigeya Suzuki
- - Wladimir J. van der Laan

As well as everyone that helped translating on [Transifex](https://www.transifex.com/projects/p/bitcoin/).


-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2

iQEcBAEBCgAGBQJZRRTMAAoJEB5K7WKYbNJdqk0IANF5Q49ID3B77b0CwSKzjTxk
Ktp0qgvtig0ZMnzVlgjULUsRW8EbecWCQwmgRo8uUoCGmNS2u7u+s28kIIkicELE
BpWcW4eC6NdCCjB1CSnmX/tno4gFwOZutVj/XUXJCBEuBbo6fIK0cVDas5vw8UVa
gXL5ytwXeCws3z9f3iiD1Nl0k+J+dRb0sJ2u0A1+XqoMFfInMUFiP/fa9XWaimKo
62jD07IJDKtH4PEKG8v+FLZounRP7t1lhU0AiQ0Uj67mBmllwWD0KeZi0f4SokMX
aezEH+2UIW3Ph/QbG+ktZYUzbDALnRIHEBP4GQUuWiUPZKo3vAS3yhvh1nvYUW4=
=VBdE
-----END PGP SIGNATURE-----

From martin.habovstiak at gmail.com  Sat Jun 17 05:37:46 2017
From: martin.habovstiak at gmail.com (=?UTF-8?Q?Martin_Habov=C5=A1tiak?=)
Date: Sat, 17 Jun 2017 07:37:46 +0200
Subject: [bitcoin-dev] User coordination of soft fork activation
Message-ID: <CALkkCJbfKO_O8sb0qQBLzcSOy6FRw-LTrs_zq8B3+6NdUrDTbQ@mail.gmail.com>

Hello!

I'd appreciate if anyone would like to review my proposal on improving
UASFs, here's the link:
https://gist.github.com/Kixunil/a99c45e79d74bf73328d4192100aa6c6

Abstract:

This document proposes a novel way to improve coordination of users who
wish to activate a new soft fork in Bitcoin. The main idea is to use smart
contracts to incentivize users to actually enforce the soft fork with lower
risk of support being too low. At the same time the contract is in effect
only if significant part of economy agrees to it. The contract also signals
the intent to miners and other users in a way that would be otherwise
expensive for sybil attackers. This proposal also suggests an interesting
way to pay developers for the development of the soft fork code.

FYI the document is timestamped in
transaction 05d5eabcf77964a1e5a704175ef2e54f1fe243ed7aad0a80ede47845173bd2e5
in block 0000000000000000002f4b63ee720958da187405bb807466177be8da2c6ad3b6.

Have a nice day!

Martin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170617/672ec878/attachment.html>

From chris at suredbits.com  Sun Jun 18 14:36:24 2017
From: chris at suredbits.com (Chris Stewart)
Date: Sun, 18 Jun 2017 09:36:24 -0500
Subject: [bitcoin-dev] Drivechain -- Request for Discussion
In-Reply-To: <CAE-z3OXY2YiQ5fzxZBw4FooRsUzXricHmpv_+t+HbTf0MxP0kg@mail.gmail.com>
References: <24f2b447-a237-45eb-ef9f-1a62533fad5c@gmail.com>
	<dhstGQudLBiwjDlaRrmMfy-ixwvXcwMr1CzCkPKh285RLICGZixkbdwpTDc2Sgz8eYIqSem8lwxW6QeJCD7aFfwQjLDnZ2NmOw0Zzd-KgSs=@protonmail.com>
	<CA+XQW1jZpJ9wnEg47fouyywL09=_vU8dMP3owkkuNqRvzTZUDg@mail.gmail.com>
	<CAE-z3OUYuAXE2+h60A=r4UyGU4CSQuF98oFgHnD7iaj-=Z=yOw@mail.gmail.com>
	<CA+XQW1hRhcxJBoOJ57YG0t5y5j1Qm3RO4wr2eXV5V-UzDaiPPw@mail.gmail.com>
	<CAE-z3OVWXN58X-+nAFTm61G1=v_1xrniyrBy8x=VRG4N149aXQ@mail.gmail.com>
	<141a0cd1-9d4f-c137-a349-17248f9cafd4@gmail.com>
	<CAE-z3OXY2YiQ5fzxZBw4FooRsUzXricHmpv_+t+HbTf0MxP0kg@mail.gmail.com>
Message-ID: <CAGL6+mFu-W9BXs+ipDQod33XZn85Rj=cDzhanVDY5wLzRbkFTQ@mail.gmail.com>

>OP_RETURN <sidechain_id> <critical hash>

I think it is redundant here to have the <sidechain id>, we can implicitly
assume what the sidechain_id is since we have a fixed set of drivechains.
I.e. mining reward is index 0, mimblewimble sidechain is index 1, etc.
CryptAxe has specific indexes defined already in his implementation:
https://github.com/drivechain-project/bitcoin/blob/mainchainBMM/src/sidechain.h#L26-L30
.

I think it would be wise to include a version byte to allow us to upgrade
this commitment structure in the future. Similar to how witness program's
are now versioned.

><block height> <sidechain_id> <critical hash> OP_BRIBE_VERIFY

If <block height> is an argument that OP_BRIBE_VERIFY takes, doesn't that
mean the mainchain miner has to validate this *is* the actual block height
on the sidechain? Does that take the 'blindness' away from BMM?

Overall, I think we need to work on the commitment structure to the
coinbase tx. If I understand the current implementation correctly we can
have up to 256 OP_RETURNs embedded in the coinbase tx signifying new blocks
mined on drivechains.. this seems less than ideal. It might be prudent to
make these outputs ANYONECANSPEND, and then have miners spending these
outputs to themselves for every block mined.. maybe this doesn't have a
benefit over using OP_RETURNs though?

The structure could be something like:
<version> <critical hash>

and then in a subsequent block the miner spends that output to themselves.
I will admit I'm not super familiar with how OP_RETURNs work with the UTXO
set -- maybe this scheme doesn't have any benefit.

-Chris

On Wed, May 24, 2017 at 3:50 AM, Tier Nolan via bitcoin-dev <
bitcoin-dev at lists.linuxfoundation.org> wrote:

> On Tue, May 23, 2017 at 3:22 PM, Paul Sztorc <truthcoin at gmail.com> wrote:
>
>>
>> If you haven't seen http://www.truthcoin.info/blog/drivechain/ , that is
>> probably the most human-readable description.
>>
>
> I guess I was looking for the detail you get in the code, but without
> having to read the code.
>
> My quick reading gives that the sidechain codes (critical hashes) are
> added when a coinbase is processed.
>
> Any coinbase output that has the form "OP_RETURN <32 byte push>" counts as
> a potential critical hash.
>
> When the block is processed, the key value pair (hash, block_height) is
> added to a hash map.
>
> The OP_BRIBE opcode checks that the given hash is in the hash map and
> replaces the top element on the stack with the pass/fail result.
>
> It doesn't even check that the height matches the current block, though
> there is a comment that that is a TODO.
>
> I agree with ZmnSCPxj, when updating a nop, you can't change the stack.
> It has to fail the script or do nothing.
>
> OP_BRIBE_VERIFY would cause the script to fail if the hash wasn't in the
> coinbase, or cause a script failure otherwise.
>
> Another concern is that you could have multiple bribes for the same chain
> in a single coinbase.  That isn't fair and arguably what the sidechain
> miner is paying for is to get his hash exclusively into the block.
>
> I would suggest that the output is
>
> OP_RETURN <sidechain_id> <critical hash>
>
> Then add the rule that only the first hash with a particular sidechain id
> actually counts.
>
> This forces the miner to only accept the bribe from 1 miner for each
> sidechain for each block.  If he tries to accept 2, then only the first one
> counts.
>
> OP_BRIBE_VERIFY could then operate as follows
>
> <block height> <sidechain_id> <critical hash> OP_BRIBE_VERIFY
>
> This causes the script to fail if
>   <block height> does not match the block height, or
>   <critical hash> is not the hash for the sidechain with <sidechain_id>, or
>   there is no hash for that sidechain in the block's coinbase
>
> If you want reduce the number of drops, you could serialize the info into
> a single push.
>
> This has the advantage that a sidechain miner only has to pay if his block
> is accepted in the next bitcoin block.  Since he is the only miner for that
> sidechain that gets into the main bitcoin block, he is pretty much
> guaranteed to form the longest chain.
>
> Without that rule, sidechain miners could end up having to pay even though
> it doesn't make their chain the longest.
>
> How are these transactions propagated over the network?  For relaying, you
> could have the rule that the opcode passes as long as <block height> is
> near the current block height.  Maybe require that they are in the future.
> They should be removed from the memory pool once the block height has
> arrived, so losing miners can re-spend those outputs.
>
> This opcode can be validated without needing to look at other blocks,
> which is good for validating historical blocks.
>
> I am still looking at the deposit/withdrawal code.
>
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170618/03f7a3c8/attachment.html>

From contact at taoeffect.com  Sun Jun 18 21:30:51 2017
From: contact at taoeffect.com (Tao Effect)
Date: Sun, 18 Jun 2017 14:30:51 -0700
Subject: [bitcoin-dev] Drivechain RfD -- Follow Up
In-Reply-To: <83671224-f6ff-16a9-81c0-20ab578aec9d@gmail.com>
References: <24f2b447-a237-45eb-ef9f-1a62533fad5c@gmail.com>
	<83671224-f6ff-16a9-81c0-20ab578aec9d@gmail.com>
Message-ID: <AAC86547-7904-4475-9966-138130019567@taoeffect.com>

In Drivechain, 51% of miners have total control and ownership over all of the sidechain coins. The vision of Drivechain is to have many blockchains "plugged in" to the main chain.

Today, well over 51% of miners are under the jurisdiction of a single government.

Thus the effect of Drivechain appears to be the creation of a new kind of digital border imposed onto the network where everyone hands over ownership of their Bitcoins to a /single/ mining cartel when they wish to interact with /any/ sidechain.

Drivechain would be a reasonable idea if that weren't the case, but since it is, Drivechain now introduces a very real possible future where Bitcoins can be confiscated by the Chinese government in exactly the same manner that the Chinese government today confiscates financial assets in other financial networks within China.

One argument is that the psuedo-anonymity granted by Bitcoin addresses could theoretically make this less likely to happen, and while that is true, it is also true that every day Bitcoin becomes less and less psuedo-anonymous as governments invest in blockchain analysis tech [1].

How many high-profile confiscations ? now via the Bitcoin-blockchain itself (no longer being able to blame a 3rd-party exchange) ? is Bitcoin willing to tolerate and open itself up to?

In a world before Drivechain: the worst that a 51% coalition can do is prevent you from spending your coins (censorship).

In a world with Drivechain three things become true:

1. The Bitcoin network centralizes more, because more power (both financial power and power in terms of capability/control) is granted to miners. This is likely to have secondary consequences on the main-chain network as well (in terms of its price and ability to evolve).

2. A 51% coalition ? and/or the government behind it ? is now able to financially profit by confiscating coins. No longer is it just censorship, "asset forfeiture" ? theft ? becomes a real possibility for day-to-day Bitcoin users.

3. Drivechain limits user's existing choice when it comes to who is acting as custodian of their Bitcoins, from any trustworthy exchange, down to a single mining cartel under the control of a single set of laws.

The argument given to this is that a UASF could be initiated to wrest control away from this cartel. I do not believe this addresses the concern at all.

A UASF is a very big deal and extremely difficult to pull off correctly. Even when you have users behind you, it *requires* significant support from the miners themselves [2]. Therefore, I do not believe a UASF is a realistic possibility for recovery.

I would only support Drivechain if all of these issue were addressed.

Kind regards,
Greg Slepak

[1] EU Commits ?5 Million to Fund Blockchain Surveillance Research ? http://www.coindesk.com/eu-commits-e5-million-fund-blockchain-surveillance-research/ <http://www.coindesk.com/eu-commits-e5-million-fund-blockchain-surveillance-research/>

[2] https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-June/014497.html <https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-June/014497.html>

--
Please do not email me anything that you are not comfortable also sharing with the NSA.

> On Jun 10, 2017, at 10:04 AM, Paul Sztorc via bitcoin-dev <bitcoin-dev at lists.linuxfoundation.org <mailto:bitcoin-dev at lists.linuxfoundation.org>> wrote:
> 
> Hi everyone,
> 
> It has been 3 weeks -- responses so far have been really helpful. People
> jumped right in, and identified unfinished or missing parts much faster
> than I thought they would (ie, ~two days). Very impressive.
> 
> Currently, we are working on the sidechain side of blind merged mining.
> As you know, most of the Bitcoin cryptosystem is about finding the
> longest chain, and displaying information about this chain. CryptAxe is
> editing the sidechain code to handle reorganizations in a new way (an
> even bigger departure than Namecoin's, imho).
> 
> I believe that I have responded to all the on-list objections that were
> raised. I will 1st summarize the on-list objections, and 2nd summarize
> the off-list discussion (focusing on three key themes).
> 
> 
> On-List Objection Summary
> ---------------------------
> 
> In general, they were:
> 
> * Peter complained about the resources required for the BMM 'crisis
> audit', I pointed out that it is actually optional (and, therefore,
> free), and that it doesn't affect miners relative to each other, and
> that it can be done in an ultra-cheap semi-trusted way with high
> reliability.
> * Peter also asked about miner incentives, I replied that it is profit
> maximizing to BMM sidechains, because the equation (Tx Fees - Zero Cost)
> is always positive.
> * ZmnSCPxj asked a long series of clarifying questions, and I responded.
> * Tier Nolan complained about my equivocation of the "Bitcoin: no block
> subsidy" case and the "sidechain" case. He cites the asymmetry I point
> out below (in #2). I replied, and I give an answer below.
> * ZmnSCPxj pointed out an error in our OP Code (that we will fix).
> * ZmnSCPxj also asked a number of new questions, I responded. Then he
> responded again, in general he seemed to raise many of the points
> addressed in #1 (below).
> * ZmnSCPxj wanted reorg proofs, to punish reorgers, but I pointed out
> that if 51% can reorg, they can also filter out the reorg proof. We are
> at their mercy in all cases (for better or worse).
> * ZmnSCPxj also brought up the fact that a block size limit is necessary
> for a fee market, I pointed out that this limit does not need to be
> imposed on miners by nodes...miners would be willing-and-able to
> self-impose such a limit, as it maximizes their revenues.
> * ZmnSCPxj also protested the need to soft fork in each individual
> sidechain, I pointed out my strong disagreement ("Unrestrained smart
> contract execution will be the death of most of the interesting
> applications...[could] destabilize Bitcoin itself") and introduced my
> prion metaphor.
> * ZmnSCPxj and Tier Nolan both identified the problem solved by our
> 'ratchet' concept. I explained it to ZmnSCPxj in my reply. We had not
> coded it at the time, but there is code for it now [1]. Tier proposed a
> rachet design, but I think ours is better (Tier did not find ours at
> all, because it is buried in obscure notes, because I didn't think
> anyone would make it this far so quickly).
> * Tier also advised us on how to fix the problem that ZmnSCPxj had
> identified with our NOP earlier.
> * Tier also had a number of suggestions about the real-time negotiation
> of the OP Bribe amount between nodes and miners. I'm afraid I mostly
> ignored these for now, as we aren't there yet.
> * Peter complained that ACKing the sidechain could be exploited for
> political reasons, and I responded that in such a case, miners are free
> to simply avoid ACKing, or to acquiesce to political pressure. Neither
> affect the mainchain.
> * Peter complained that sidechains might provide some miners with the
> opportunity to create a pretext to kick other miners off the network. I
> replied that it would not, and I also brought up the fact that my
> Bitcoin security model was indifferent to which people happened to be
> mining at any given time. I continue to believe that "mining
> centralization" does not have a useful definition.
> * Peter questioned whether or not sidechains would be useful. I stated
> my belief that they would be useful, and linked to my site
> (drivechain.info/projects <http://drivechain.info/projects>) which contains a number of sidechain
> use-cases, and cited my personal anecdotal experiences.
> * Peter wanted to involve miners "as little as possible", I pointed out
> that I felt that I had indeed done this minimization. My view is that
> Peter felt erroneously that it was possible to involve miners less,
> because he neglected [1] that a 51% miner group is already involved
> maximally, as they can create most messages and filter any message, and
> [2] that there are cases where we need miners to filter out harmful
> interactions among multiple chains (just as they filter out harmful
> interactions among multiple txns [ie, "double spends"]). Peter has not
> yet responded to this rebuttal.
> * Peter also suggested client-side validation as "safer", and I pointed
> out that sidechains+BMM _is_ client-side validation. I asked Peter for
> CS-V code, so that we can compare the safety and other features.
> * Sergio reminded us of his version of drivechain. Sergio and I disagree
> over the emphasis on frequency/speed of withdrawals. Also Sergio
> emphasizes a hybrid model, which does not interest me.
> 
> If I missed any objections, I hope someone will point them out.
> 
> 
> Off-List / Three Points of Ongoing Confusion
> ---------------------------------------------
> 
> Off list, I have repeated the a similar conversation perhaps 6-10 times
> over the past week. There is a cluster of remaining objections which
> centers around three topics -- speed, theft, and antifragility. I will
> reply here, and add the answers to my FAQ (drivechain.info/faq <http://drivechain.info/faq>).
> 
> 1. Speed
> 
> This objection is voiced after I point out that side-to-main transfers
> ("withdrawals") will probably take a long time, for example 5 months
> each ( these are customizable parameters, and open for debate -- but if
> withdrawals are every x=3 months, and only x=1 withdrawal can make
> forward progress [on the mainchain] at a time, and only x=1 prospective
> withdrawal can be assembled [by the sidechain] at a time, then we can
> expect total withdrawal time to average 4.5 months [(.5)*3+3] ). The
> response is something like "won't such a system be too slow, and
> therefore unusable?".
> 
> Imho, replies of this kind disregard the effect of atomic cross-chain
> swaps, which are instant.
> 
> ( In addition, while side-to-main transfers are slow, main-to-side
> transfers are quite fast, x~=10 confirmations. I would go as far as to
> say that, just as the Lightning Network is enabled by SegWit and CSV,
> Drivechain is enabled by the atomic swaps and of Counterparty-like
> embedded consensus. )
> 
> Thanks to atomic swaps, someone can act as an investment banker or
> custodian, and purchase side:BTC at a (tiny, competitive discount) and
> then transfer those side-to-main at a minimal inconvenience (comparable
> to that of someone who buys a bank CD). Through market activities, the
> _entire system_ becomes exactly as patient as its most-patient members.
> As icing on the cake, people who aren't planning on using their BTC
> anytime soon (ie "the patient") can even get a tiny investment yield, in
> return for providing this service.
> 
> 
> 2. Security
> 
> This objection usually says something like "Aren't you worried that 51%
> [hashrate] will steal the coins, given that mining is so centralized
> these days?"
> 
> The logic of drivechain is to take a known fact -- that miners do not
> steal from exchanges (by coordinating to doublespend deposits to those
> exchanges) -- and generalize it to a new situation -- that [hopefully]
> miners will not steal from sidechains (by coordinating to make 'invalid'
> withdrawals from them).
> 
> My generalization is slightly problematic, because "a large mainchain
> reorg today" would hit the entire Bitcoin system and de-confirm *all* of
> the network's transactions, whereas a sidechain-theft would hit only a
> small portion of the system. This asymmetry is a problem because of the
> 1:1 peg, which is explicitly symmetrical -- the thief makes off coins
> that are worth _just as much_ as those coins that he did _not_ attack.
> The side:BTC are therefore relatively more vulnerable to theft, which
> harms the generalization.
> 
> As I've just explained, to correct this relative deficiency, we add
> extra inconvenience for any sidechain thievery, which is in this case
> the long long withdrawal time of several months. (Which is also the main
> distinction between DC and extension blocks).
> 
> I cannot realistically imagine an erroneous withdrawal persisting for
> several weeks, let alone several months. First, over a timeframe of this
> duration, there can be no pretense of 'we made an innocent mistake', nor
> one that 'it is too inconvenient for us to fix this problem'. This
> requires the attacker to be part of an explicitly malicious conspiracy.
> Even in the conspiring case, I do not understand how miners would
> coordinate the distribution of the eventual "theft" payout, ~3 months
> from now -- if new hashrate comes online between now and then, does it
> get a portion? -- if today's hashrate closes down, does it get a reduced
> portion? -- who decides? I don't think that an algorithm can decide
> (without creating a new mechanism, which -I believe- would have to be
> powered by ongoing sustainable theft [which is impossible]), because the
> withdrawal (ie the "theft") has to be initiated, with a known
> destination, *before* it accumulates 3 months worth of acknowledgement.
> 
> Even if hashrate were controlled exclusively by one person, such a theft
> would obliterate the sidechain-tx-fee revenue from all sidechains, for a
> start. It would also greatly reduce the market price of [mainchain] BTC,
> I feel, as it ends the sidechain experiment more-or-less permanently.
> 
> And even _that_ dire situation can be defeated by UASF-style maneuvers,
> such as checkpointing. Even the threat of such maneuvers can be
> persuasive enough for them never to be needed (especially over long
> timeframes, which make these maneuvers convenient).
> 
> A slightly more realistic worst-case scenario is that a monopolist
> imposes large fees on side-to-main transfers (which he contrives so that
> only he can provide). Unless the monopoly is permanent, market forces
> (atomic swaps) will still lower the fee to ultra-competitive levels,
> making this mostly pointless.
> 
> 
> 3. Antifragility
> 
> There is an absolutely crucial distinction of "layers", which is often
> overlooked. Which is a shame, because its importance really cannot be
> understated.
> 
> Taleb's concept of antifragility is explicitly fractal -- it has layers,
> and an upper layer can only be antifragile if it is composed of
> individual members of a lower layer who are each *fragile*. In one of my
> videos I give the example of NYC food providers -- it is _because_ the
> competition is so brutal, and because each individual NYC
> restaurant/supermarket/food-truck is so likely to fail, (and because
> there is no safety net to catch them if they do fail), that the
> consumer's experience is so positive (in NYC, you can find almost any
> kind of food, at any hour of the day, at any price, despite the fact
> that a staggering ~15 million people will be eating there each day).
> 
> By this, I mean there is an absolutely crucial distinction between:
> 
> 1. A problem with a sidechain that negatively impacts its parent chain.
> 2. A problem with a sidechain that only impacts the sidechain users.
> 
> The first type of problem is unacceptable, but the second type of
> problem is actually _desirable_.
> 
> If we wanted to have the best BTC currency unit possible, we would want
> everyone to try all kinds of things out, _especially_ the things that we
> think are terrible. We'd want lots of things to be tried, and for the
> losers to "fail fast".
> 
> In practice I highly doubt the sidechain ecosystem would be anywhere
> near as dynamic as NYC or Silicon Valley. But certain questions, such as
> "What if a sidechain breaks / has DAO-like problems?"; "What if the
> sidechain has only a few nodes? Who will run them?"; "Who will maintain
> these projects?"; -- really just miss the point, I think.
> 
> Ultimately, users can vote with their feet -- if the benefits of a
> sidechain outweigh its risks, some users will send some BTC there. It is
> a strict improvement over the current situation, where users would need
> to use an Altcoin to achieve as much. Users who aren't comfortable with
> the risks of new chains / new features, can simply decline to use them.
> 
> 
> Another Objection
> ------------------
> 
> Finally, two people raised an objection which I will call the "too
> popular" objection or "too big to fail (tbtf)". Something like "what if
> a *majority* of BTC is moved to one sidechain, and then that sidechain
> has some kind of problem?".
> 
> One simple step would be to cap the quantity of BTC that can be moved to
> each sidechain, (at x=10% ? aka 210,000).
> 
> Other than that, I would point out that Bitcoin has always been the
> "money of principle", and that we survived the MtGox announcement (in
> which ~850,000/12,400,000 = 6.85% of the total BTC were assumed to be
> stolen).
> 
> I look forward to the continued feedback! Thank you all very much!
> 
> Paul
> 
> [1]
> https://github.com/drivechain-project/bitcoin/commit/c4beef5c2aa8e52d2c1e11de7c044528bbde6c60 <https://github.com/drivechain-project/bitcoin/commit/c4beef5c2aa8e52d2c1e11de7c044528bbde6c60>
> 
> 
> On 5/22/2017 2:17 AM, Paul Sztorc wrote:
>> Dear list,
>> 
>> I've been working on "drivechain", a sidechain enabling technology, for
>> some time.
>> 
>> * The technical info site is here: www.drivechain.info
>> * The changes to Bitcoin are here:
>> https://github.com/drivechain-project/bitcoin/tree/mainchainBMM
>> * A Blank sidechain template is here:
>> https://github.com/drivechain-project/bitcoin/tree/sidechainBMM
>> 
>> As many of you know, I've been seeking feedback in person, at various
>> conferences and meetups over the past year, most prominently Scaling
>> Milan. And I intend to continue to seek feedback at Consensus2017 this
>> week, so if you are in NYC please just walk up and start talking to me!
>> 
>> But I also wanted to ask the list for feedback. Initially, I was
>> hesitant because I try not to consume reviewers' scarce time until the
>> author has put in a serious effort. However, I may have waiting too
>> long, as today it is actually quite close to a working release.
>> 
>> 
>> Scaling Implications
>> ---------------------
>> 
>> This upgrade would have significant scaling implications. Since it is
>> the case that sidechains can be added by soft fork, and since each of
>> these chains will have its own blockspace, this theoretically removes
>> the blocksize limit from "the Bitcoin system" (if one includes
>> sidechains as part of such a system). People who want a LargeBlock
>> bitcoin can just move their BTC over to such a network [1], and their
>> txns will have no longer have an impact on "Bitcoin Core". Thus, even
>> though this upgrade does not actually increase "scalability" per se, it
>> may in fact put an end to the scalability debate...forever.
>> 
>> This work includes the relatively new concept of "Blind Merged Mining"
>> [2] which I developed in January to allow SHA256^2 miners to merge-mine
>> these "drivechains", even if these miners aren't running the actual
>> sidechain software. The goal is to prevent sidechains from affecting the
>> levelness of the mining "playing field". BMM is conceptually similar to
>> ZooKeeV [3] which Peter Todd sketched out in mid-2013. BMM is not
>> required for drivechain, but it would address some of the last remaining
>> concerns.
>> 
>> 
>> Total Transaction Fees in the Far Future
>> -----------------------------------------
>> 
>> Some people feel that a maximum blocksize limit is needed to ensure that
>> future total equilibrium transaction fees are non-negligible. I
>> presented [4] on why I don't agree, 8 months ago. The reviewers I spoke
>> to over the last year have stopped bringing this complaint up, but I am
>> not sure everyone feels that way.
>> 
>> 
>> Juxtaposition with a recent "Scaling Compromise"
>> -------------------------------------------------
>> 
>> Recently, a scalability proposal began to circulate on social media. As
>> far as I could tell, it goes something like "immediately activate
>> SegWit, and then HF to double the nonwitness blockspace to 2MB within 12
>> months". But such a proposal is quite meager, compared to a "LargeBlock
>> Drivechain". The drivechain is better on both fronts, as it would not
>> require a hardfork, and could *almost immediately* add _any_ amount of
>> extra blockspace (specifically, I might expect a BIP101-like LargeBlock
>> chain that has an 8 MB maxblocksize, which doubles every two years).
>> 
>> In other words, I don't know why anyone would support that proposal over
>> mine. The only reasons would be either ignorance (ie, unfamiliarity with
>> drivechain) or because there are still nagging unspoken complaints about
>> drivechain which I apparently need to hear and address.
>> 
>> 
>> Other Thoughts
>> ---------------
>> 
>> Unfortunately, anyone who worked on the "first generation" of sidechain
>> technology (the skiplist) or the "second generation" (federated /
>> Liquid), will find that this is very different.
>> 
>> I will admit that I am very pessimistic about any conversation that
>> involves scalability. It is often said that "talking politics lowers
>> your IQ by 25 points". Bitcoin scalability conversations seem to drain
>> 50 points. (Instead of conversing, I think people should quietly work on
>> whatever they are passionate about until their problem either is solved,
>> or it goes away for some other reason, or until we all agree to just
>> stop talking about it.)
>> 
>> Cheers,
>> Paul
>> 
>> [1] http://www.drivechain.info/faq/#can-sidechains-really-help-with-scaling
>> [2] http://www.truthcoin.info/blog/blind-merged-mining/
>> [3] https://s3.amazonaws.com/peter.todd/bitcoin-wizards-13-10-17.log
>> [4]
>> https://www.youtube.com/watch?v=YErLEuOi3xU&list=PLw8-6ARlyVciNjgS_NFhAu-qt7HPf_dtg&index=4
>> 
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170618/afbca0d1/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 801 bytes
Desc: Message signed with OpenPGP
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170618/afbca0d1/attachment-0001.sig>

From cryptaxe at gmail.com  Sun Jun 18 21:27:52 2017
From: cryptaxe at gmail.com (CryptAxe)
Date: Sun, 18 Jun 2017 14:27:52 -0700
Subject: [bitcoin-dev] Drivechain -- Request for Discussion
In-Reply-To: <CAGL6+mFu-W9BXs+ipDQod33XZn85Rj=cDzhanVDY5wLzRbkFTQ@mail.gmail.com>
References: <24f2b447-a237-45eb-ef9f-1a62533fad5c@gmail.com>
	<dhstGQudLBiwjDlaRrmMfy-ixwvXcwMr1CzCkPKh285RLICGZixkbdwpTDc2Sgz8eYIqSem8lwxW6QeJCD7aFfwQjLDnZ2NmOw0Zzd-KgSs=@protonmail.com>
	<CA+XQW1jZpJ9wnEg47fouyywL09=_vU8dMP3owkkuNqRvzTZUDg@mail.gmail.com>
	<CAE-z3OUYuAXE2+h60A=r4UyGU4CSQuF98oFgHnD7iaj-=Z=yOw@mail.gmail.com>
	<CA+XQW1hRhcxJBoOJ57YG0t5y5j1Qm3RO4wr2eXV5V-UzDaiPPw@mail.gmail.com>
	<CAE-z3OVWXN58X-+nAFTm61G1=v_1xrniyrBy8x=VRG4N149aXQ@mail.gmail.com>
	<141a0cd1-9d4f-c137-a349-17248f9cafd4@gmail.com>
	<CAE-z3OXY2YiQ5fzxZBw4FooRsUzXricHmpv_+t+HbTf0MxP0kg@mail.gmail.com>
	<CAGL6+mFu-W9BXs+ipDQod33XZn85Rj=cDzhanVDY5wLzRbkFTQ@mail.gmail.com>
Message-ID: <a60d1d58-59cd-e304-3b49-ba29ddf4de45@gmail.com>

> >OP_RETURN <sidechain_id> <critical hash>
>
> I think it is redundant here to have the <sidechain id>, we can
> implicitly assume what the sidechain_id is since we have a fixed set
> of drivechains. I.e. mining reward is index 0, mimblewimble sidechain
> is index 1, etc. CryptAxe has specific indexes defined already in his
> implementation: 
> https://github.com/drivechain-project/bitcoin/blob/mainchainBMM/src/sidechain.h#L26-L30.
>

Since the sidechain has the sidechain BMM headers that they want the LD
(bribe) data for, I think that they could specifically request LD data
relevant only to that sidechain by providing a list of hashes to the
mainchain, and the mainchain can return a list of boolean values telling
the sidechain if the LD data exists. That way the data never even has to
go over the network, just a verification that it exists on the mainchain
and we can drop the sidechain_id from the script.


> I think it would be wise to include a version byte to allow us to
> upgrade this commitment structure in the future. Similar to how
> witness program's are now versioned.

Agreed, we need that.


>
> ><block height> <sidechain_id> <critical hash> OP_BRIBE_VERIFY
>
> If <block height> is an argument that OP_BRIBE_VERIFY takes, doesn't
> that mean the mainchain miner has to validate this *is* the actual
> block height on the sidechain? Does that take the 'blindness' away
> from BMM?

No, OP_BRIBE (the old version) didn't care about the block height. Where
the blockheight was relevant is when bribe data is added to LD. In order
to be added to LD, the bribe needed to either be a fork (block height
less than the sidechain tip height) or extending the current side-chain
(block height = sidechain tip height + 1). The goal of this was to allow
for reorgs, and also make it so that people cannot skip forward (which
would never be valid so it's a waste of time and space) so that the
sidechain makes progress. With the new design that we have been talking
about, I think that we will need to drop this requirement from the
mainchain, and have the sidechain handle filtering out invalid LD data /
only requesting the verification of LD data that they know to be valid
as far as chain order goes.


>
> Overall, I think we need to work on the commitment structure to the
> coinbase tx.

Agreed. It might be helpful if you outlined the idea you had on IRC to
the mailing list.


> If I understand the current implementation correctly we can have up to
> 256 OP_RETURNs embedded in the coinbase tx signifying new blocks mined
> on drivechains.. this seems less than ideal. It might be prudent to
> make these outputs ANYONECANSPEND, and then have miners spending these
> outputs to themselves for every block mined.. maybe this doesn't have
> a benefit over using OP_RETURNs though?
>
> The structure could be something like:
> <version> <critical hash>
>
> and then in a subsequent block the miner spends that output to
> themselves. I will admit I'm not super familiar with how OP_RETURNs
> work with the UTXO set -- maybe this scheme doesn't have any benefit.
>
> -Chris

I might be wrong but I thought that OP_RETURN outputs do not go into the
UTXO set. Anyone else want to chime in?






From andreas at schildbach.de  Mon Jun 19 11:58:18 2017
From: andreas at schildbach.de (Andreas Schildbach)
Date: Mon, 19 Jun 2017 13:58:18 +0200
Subject: [bitcoin-dev] BIP Proposal: Compact Client Side Filtering for
	Light Clients
In-Reply-To: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
References: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
Message-ID: <oi8e8k$g56$1@blaine.gmane.org>

I'm not sure if this has been brought up elsewhere in this thread.

This proposal doesn't seem to be a complete replacement of BIP37: It
doesn't provide a filter for unconfirmed transactions like BIP37 does.

That means that most light clients will continue to use BIP37 even if
they may use this BIP as a supplement. Otherwise users would not get
timely notification of incoming payments any more.


On 06/01/2017 09:01 PM, Olaoluwa Osuntokun via bitcoin-dev wrote:
> Hi y'all, 
> 
> Alex Akselrod and I would like to propose a new light client BIP for
> consideration: 
>    * https://github.com/Roasbeef/bips/blob/master/gcs_light_client.mediawiki
> [...]


From bfd at cock.lu  Mon Jun 19 12:26:46 2017
From: bfd at cock.lu (bfd at cock.lu)
Date: Mon, 19 Jun 2017 13:26:46 +0100
Subject: [bitcoin-dev] BIP Proposal: Compact Client Side Filtering for
 Light Clients
In-Reply-To: <oi8e8k$g56$1@blaine.gmane.org>
References: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
	<oi8e8k$g56$1@blaine.gmane.org>
Message-ID: <537fb7106e0387c77537f0b1279cbeca@cock.lu>

Several times. It's been debated if unconfirmed transactions are 
necessary, methods of doing more private filtering have been suggested, 
along with simply not filtering unconfirmed transactions at all. My 
collected data suggests that there is very little use of BIP37 at 
present, based on incoming connections to nodes I know end up in the DNS 
seed responses (no "SPV" clients do their own peer management).


On 2017-06-19 12:58, Andreas Schildbach via bitcoin-dev wrote:
> I'm not sure if this has been brought up elsewhere in this thread.
> 
> This proposal doesn't seem to be a complete replacement of BIP37: It
> doesn't provide a filter for unconfirmed transactions like BIP37 does.
> 
> That means that most light clients will continue to use BIP37 even if
> they may use this BIP as a supplement. Otherwise users would not get
> timely notification of incoming payments any more.
> 
> 
> On 06/01/2017 09:01 PM, Olaoluwa Osuntokun via bitcoin-dev wrote:
>> Hi y'all,
>> 
>> Alex Akselrod and I would like to propose a new light client BIP for
>> consideration:
>>    * 
>> https://github.com/Roasbeef/bips/blob/master/gcs_light_client.mediawiki
>> [...]
> 
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev

From tomz at freedommail.ch  Mon Jun 19 15:15:10 2017
From: tomz at freedommail.ch (Tom Zander)
Date: Mon, 19 Jun 2017 17:15:10 +0200
Subject: [bitcoin-dev] BIP Proposal: Compact Client Side Filtering for
	Light Clients
In-Reply-To: <537fb7106e0387c77537f0b1279cbeca@cock.lu>
References: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
	<oi8e8k$g56$1@blaine.gmane.org>
	<537fb7106e0387c77537f0b1279cbeca@cock.lu>
Message-ID: <55482016.LADLl5KXAH@strawberry>

On Monday, 19 June 2017 14:26:46 CEST bfd--- via bitcoin-dev wrote:
>  It's been debated if [filtering of] unconfirmed transactions are
> necessary,

Why would it not be needed? Any SPV client (when used as a payment-receiver) 
requires this from a simple usability point of view.

-- 
Tom Zander
Blog: https://zander.github.io
Vlog: https://vimeo.com/channels/tomscryptochannel

From andreas at schildbach.de  Mon Jun 19 15:43:14 2017
From: andreas at schildbach.de (Andreas Schildbach)
Date: Mon, 19 Jun 2017 17:43:14 +0200
Subject: [bitcoin-dev] BIP Proposal: Compact Client Side Filtering for
	Light Clients
In-Reply-To: <537fb7106e0387c77537f0b1279cbeca@cock.lu>
References: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
	<oi8e8k$g56$1@blaine.gmane.org>
	<537fb7106e0387c77537f0b1279cbeca@cock.lu>
Message-ID: <oi8red$vbn$1@blaine.gmane.org>

Just to give you a number: based on the statistics of the Bitcoin Wallet
app there are at least 2 million wallets depending on BIP37. Not all
would need instant notification but based on the daily support enquiries
instant notificaton is the most asked property of Bitcoin.


On 06/19/2017 02:26 PM, bfd--- via bitcoin-dev wrote:
> Several times. It's been debated if unconfirmed transactions are
> necessary, methods of doing more private filtering have been suggested,
> along with simply not filtering unconfirmed transactions at all. My
> collected data suggests that there is very little use of BIP37 at
> present, based on incoming connections to nodes I know end up in the DNS
> seed responses (no "SPV" clients do their own peer management).
> 
> 
> On 2017-06-19 12:58, Andreas Schildbach via bitcoin-dev wrote:
>> I'm not sure if this has been brought up elsewhere in this thread.
>>
>> This proposal doesn't seem to be a complete replacement of BIP37: It
>> doesn't provide a filter for unconfirmed transactions like BIP37 does.
>>
>> That means that most light clients will continue to use BIP37 even if
>> they may use this BIP as a supplement. Otherwise users would not get
>> timely notification of incoming payments any more.
>>
>>
>> On 06/01/2017 09:01 PM, Olaoluwa Osuntokun via bitcoin-dev wrote:
>>> Hi y'all,
>>>
>>> Alex Akselrod and I would like to propose a new light client BIP for
>>> consideration:
>>>    *
>>> https://github.com/Roasbeef/bips/blob/master/gcs_light_client.mediawiki
>>> [...]
>>
>> _______________________________________________
>> bitcoin-dev mailing list
>> bitcoin-dev at lists.linuxfoundation.org
>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev



From chris at suredbits.com  Mon Jun 19 15:41:01 2017
From: chris at suredbits.com (Chris Stewart)
Date: Mon, 19 Jun 2017 10:41:01 -0500
Subject: [bitcoin-dev] Drivechain -- Request for Discussion
In-Reply-To: <CAGL6+mGZZ=wG8P_DNj3PXVf==mLjJwA_bESh0_UdH2iVBY7GQA@mail.gmail.com>
References: <24f2b447-a237-45eb-ef9f-1a62533fad5c@gmail.com>
	<dhstGQudLBiwjDlaRrmMfy-ixwvXcwMr1CzCkPKh285RLICGZixkbdwpTDc2Sgz8eYIqSem8lwxW6QeJCD7aFfwQjLDnZ2NmOw0Zzd-KgSs=@protonmail.com>
	<CA+XQW1jZpJ9wnEg47fouyywL09=_vU8dMP3owkkuNqRvzTZUDg@mail.gmail.com>
	<CAE-z3OUYuAXE2+h60A=r4UyGU4CSQuF98oFgHnD7iaj-=Z=yOw@mail.gmail.com>
	<CA+XQW1hRhcxJBoOJ57YG0t5y5j1Qm3RO4wr2eXV5V-UzDaiPPw@mail.gmail.com>
	<CAE-z3OVWXN58X-+nAFTm61G1=v_1xrniyrBy8x=VRG4N149aXQ@mail.gmail.com>
	<141a0cd1-9d4f-c137-a349-17248f9cafd4@gmail.com>
	<CAE-z3OXY2YiQ5fzxZBw4FooRsUzXricHmpv_+t+HbTf0MxP0kg@mail.gmail.com>
	<CAGL6+mFu-W9BXs+ipDQod33XZn85Rj=cDzhanVDY5wLzRbkFTQ@mail.gmail.com>
	<a60d1d58-59cd-e304-3b49-ba29ddf4de45@gmail.com>
	<CAGL6+mGZZ=wG8P_DNj3PXVf==mLjJwA_bESh0_UdH2iVBY7GQA@mail.gmail.com>
Message-ID: <CAGL6+mGJYAVDcpPq6AyDE1iqfFUNt+0LVaAm+ic-yO3FmtKS+g@mail.gmail.com>

>
> Since the sidechain has the sidechain BMM headers that they want the LD
> (bribe) data for, I think that they could specifically request LD data
> relevant only to that sidechain by providing a list of hashes to the
> mainchain, and the mainchain can return a list of boolean values telling
> the sidechain if the LD data exists. That way the data never even has to
> go over the network, just a verification that it exists on the mainchain
> and
>

Since you seem to be talking about the initial block download process for
the drivechain. It seems that we might as well request the set of *valid*
blocks from a bitcoin peer first, since at the end of the day they are in
control of the mining process on the sidechain. Here is what I envision:

   1. Request all hashes for sidechain from a bitcoin peer
   2. Request all sidechain block header's for the hashes the bitcoin peer
   gave us
   3. Order the set of sidechain block headers by looking at hashPrevBlock.
   4. Request full sidechain blocks and start validating against the
   consensus rule set of the sidechain


we can drop the sidechain_id from the script.

I agree the 'sidechain_id' is unneeded in the coinbase tx output. We should
just fix these based on index. This should be reflected in my latest commit
if we are talking about the same thing:
https://github.com/Christewart/bitcoin/blob/c355e39fbe2ea48856ea86b25cb8a97710feb032/src/script/script.cpp#L254


and have the sidechain handle filtering out invalid LD data /
> only requesting the verification of LD data that they know to be valid
> as far as chain order goes.
>

 I agree, the whole point of BMM is to have bitcoin miners indifferent to
what happens in the sidechain (although Paul argues in a wonky way they do
care sort of). If there is an invalid (in the sense the block it represents
does *not* follow the sidechain's consensus rule set) OP_BRIBEVERIFY that
pays *more* money than a valid OP_BRIBEVERIFY output, we need to assume
that a 'blind' bitcoin miner will choose the one that pays them the most
money.

>I might be wrong but I thought that OP_RETURN outputs do not go into the
UTXO set. Anyone else want to chime in?

I'm fairly certain you are right. It just feels like we should be able to
exploit the fact that *only* miners can claim these OP_BRIBEVERIFY outputs.
I'll have to think about this more, maybe some one else can come up with
something clever that exploits that fact.

On Mon, Jun 19, 2017 at 10:24 AM, Chris Stewart <stewart.chris1234 at gmail.com
> wrote:

> Since the sidechain has the sidechain BMM headers that they want the LD
>> (bribe) data for, I think that they could specifically request LD data
>> relevant only to that sidechain by providing a list of hashes to the
>> mainchain, and the mainchain can return a list of boolean values telling
>> the sidechain if the LD data exists. That way the data never even has to
>> go over the network, just a verification that it exists on the mainchain
>> and
>>
>
> Since you seem to be talking about the initial block download process for
> the drivechain. It seems that we might as well request the set of *valid*
> blocks from a bitcoin peer first, since at the end of the day they are in
> control of the mining process on the sidechain. Here is what I envision:
>
>    1. Request all hashes for sidechain from a bitcoin peer
>    2. Request all sidechain block header's for the hashes the bitcoin
>    peer gave us
>    3. Order the set of sidechain block headers by looking at
>    hashPrevBlock.
>    4. Request full sidechain blocks and start validating against the
>    consensus rule set of the sidechain
>
>
> we can drop the sidechain_id from the script.
>
> I agree the 'sidechain_id' is unneeded in the coinbase tx output. We
> should just fix these based on index. This should be reflected in my latest
> commit if we are talking about the same thing: https://github.com/
> Christewart/bitcoin/blob/c355e39fbe2ea48856ea86b25cb8a9
> 7710feb032/src/script/script.cpp#L254
>
>
> and have the sidechain handle filtering out invalid LD data /
>> only requesting the verification of LD data that they know to be valid
>> as far as chain order goes.
>>
>
>  I agree, the whole point of BMM is to have bitcoin miners indifferent to
> what happens in the sidechain (although Paul argues in a wonky way they do
> care sort of). If there is an invalid (in the sense the block it represents
> does *not* follow the sidechain's consensus rule set) OP_BRIBEVERIFY that
> pays *more* money than a valid OP_BRIBEVERIFY output, we need to assume
> that a 'blind' bitcoin miner will choose the one that pays them the most
> money.
>
> >I might be wrong but I thought that OP_RETURN outputs do not go into the
> UTXO set. Anyone else want to chime in?
>
> I'm fairly certain you are right. It just feels like we should be able to
> exploit the fact that *only* miners can claim these OP_BRIBEVERIFY outputs.
> I'll have to think about this more, maybe some one else can come up with
> something clever that exploits that fact.
>
> On Sun, Jun 18, 2017 at 4:27 PM, CryptAxe via bitcoin-dev <
> bitcoin-dev at lists.linuxfoundation.org> wrote:
>
>> > >OP_RETURN <sidechain_id> <critical hash>
>> >
>> > I think it is redundant here to have the <sidechain id>, we can
>> > implicitly assume what the sidechain_id is since we have a fixed set
>> > of drivechains. I.e. mining reward is index 0, mimblewimble sidechain
>> > is index 1, etc. CryptAxe has specific indexes defined already in his
>> > implementation:
>> > https://github.com/drivechain-project/bitcoin/blob/mainchain
>> BMM/src/sidechain.h#L26-L30.
>> >
>>
>> Since the sidechain has the sidechain BMM headers that they want the LD
>> (bribe) data for, I think that they could specifically request LD data
>> relevant only to that sidechain by providing a list of hashes to the
>> mainchain, and the mainchain can return a list of boolean values telling
>> the sidechain if the LD data exists. That way the data never even has to
>> go over the network, just a verification that it exists on the mainchain
>> and we can drop the sidechain_id from the script.
>>
>>
>> > I think it would be wise to include a version byte to allow us to
>> > upgrade this commitment structure in the future. Similar to how
>> > witness program's are now versioned.
>>
>> Agreed, we need that.
>>
>>
>> >
>> > ><block height> <sidechain_id> <critical hash> OP_BRIBE_VERIFY
>> >
>> > If <block height> is an argument that OP_BRIBE_VERIFY takes, doesn't
>> > that mean the mainchain miner has to validate this *is* the actual
>> > block height on the sidechain? Does that take the 'blindness' away
>> > from BMM?
>>
>> No, OP_BRIBE (the old version) didn't care about the block height. Where
>> the blockheight was relevant is when bribe data is added to LD. In order
>> to be added to LD, the bribe needed to either be a fork (block height
>> less than the sidechain tip height) or extending the current side-chain
>> (block height = sidechain tip height + 1). The goal of this was to allow
>> for reorgs, and also make it so that people cannot skip forward (which
>> would never be valid so it's a waste of time and space) so that the
>> sidechain makes progress. With the new design that we have been talking
>> about, I think that we will need to drop this requirement from the
>> mainchain, and have the sidechain handle filtering out invalid LD data /
>> only requesting the verification of LD data that they know to be valid
>> as far as chain order goes.
>>
>>
>> >
>> > Overall, I think we need to work on the commitment structure to the
>> > coinbase tx.
>>
>> Agreed. It might be helpful if you outlined the idea you had on IRC to
>> the mailing list.
>>
>>
>> > If I understand the current implementation correctly we can have up to
>> > 256 OP_RETURNs embedded in the coinbase tx signifying new blocks mined
>> > on drivechains.. this seems less than ideal. It might be prudent to
>> > make these outputs ANYONECANSPEND, and then have miners spending these
>> > outputs to themselves for every block mined.. maybe this doesn't have
>> > a benefit over using OP_RETURNs though?
>> >
>> > The structure could be something like:
>> > <version> <critical hash>
>> >
>> > and then in a subsequent block the miner spends that output to
>> > themselves. I will admit I'm not super familiar with how OP_RETURNs
>> > work with the UTXO set -- maybe this scheme doesn't have any benefit.
>> >
>> > -Chris
>>
>> I might be wrong but I thought that OP_RETURN outputs do not go into the
>> UTXO set. Anyone else want to chime in?
>>
>>
>>
>>
>>
>> _______________________________________________
>> bitcoin-dev mailing list
>> bitcoin-dev at lists.linuxfoundation.org
>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170619/c36b46e7/attachment-0001.html>

From dev at jonasschnelli.ch  Mon Jun 19 15:49:59 2017
From: dev at jonasschnelli.ch (Jonas Schnelli)
Date: Mon, 19 Jun 2017 17:49:59 +0200
Subject: [bitcoin-dev] BIP Proposal: Compact Client Side Filtering for
 Light Clients
In-Reply-To: <55482016.LADLl5KXAH@strawberry>
References: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
	<oi8e8k$g56$1@blaine.gmane.org>
	<537fb7106e0387c77537f0b1279cbeca@cock.lu>
	<55482016.LADLl5KXAH@strawberry>
Message-ID: <4052F361-966C-4817-9779-146D4B43D1FE@jonasschnelli.ch>

Hi

> On Monday, 19 June 2017 14:26:46 CEST bfd--- via bitcoin-dev wrote:
>> It's been debated if [filtering of] unconfirmed transactions are
>> necessary,
> 
> Why would it not be needed? Any SPV client (when used as a payment-receiver)
> requires this from a simple usability point of view.


I think many users would be willing ...
a) ? to trade higher privacy (using client side filtering) for not having the ?incoming transaction? feature
b) ? if they want 0-conf ? to fetch all inved transactions
/jonas
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 833 bytes
Desc: Message signed with OpenPGP
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170619/d413208e/attachment.sig>

From andreas at schildbach.de  Mon Jun 19 15:59:57 2017
From: andreas at schildbach.de (Andreas Schildbach)
Date: Mon, 19 Jun 2017 17:59:57 +0200
Subject: [bitcoin-dev] BIP Proposal: Compact Client Side Filtering for
	Light Clients
In-Reply-To: <4052F361-966C-4817-9779-146D4B43D1FE@jonasschnelli.ch>
References: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
	<oi8e8k$g56$1@blaine.gmane.org>
	<537fb7106e0387c77537f0b1279cbeca@cock.lu>
	<55482016.LADLl5KXAH@strawberry>
	<4052F361-966C-4817-9779-146D4B43D1FE@jonasschnelli.ch>
Message-ID: <oi8sdn$ksl$1@blaine.gmane.org>

On 06/19/2017 05:49 PM, Jonas Schnelli via bitcoin-dev wrote:

>>> It's been debated if [filtering of] unconfirmed transactions are
>>> necessary,
>>
>> Why would it not be needed? Any SPV client (when used as a payment-receiver)
>> requires this from a simple usability point of view.
> 
> 
> I think many users would be willing ...
> a) ? to trade higher privacy (using client side filtering) for not having the ?incoming transaction? feature
> b) ? if they want 0-conf ? to fetch all inved transactions

Another number: I'm answering dozens of support inquiries about
delayed/missing transactions per day. Over the 7 years of Bitcoin
Wallet's existence, I estimate about 50000 inquiries.

On the other hand, I remember only 1 (one) inquiry about the privacy
problems of BIP37 (or privacy at all).

>From a regular user's point of view, privacy is non-issue. Sure,
everyone would take it for free, but certainly not if it a) delays
incoming payments or b) quickly eats up your traffic quota.


From truthcoin at gmail.com  Mon Jun 19 16:04:33 2017
From: truthcoin at gmail.com (Paul Sztorc)
Date: Mon, 19 Jun 2017 12:04:33 -0400
Subject: [bitcoin-dev] Drivechain RfD -- Follow Up
In-Reply-To: <AAC86547-7904-4475-9966-138130019567@taoeffect.com>
References: <24f2b447-a237-45eb-ef9f-1a62533fad5c@gmail.com>
	<83671224-f6ff-16a9-81c0-20ab578aec9d@gmail.com>
	<AAC86547-7904-4475-9966-138130019567@taoeffect.com>
Message-ID: <6764b8af-bb4c-615d-5af5-462127bbbe36@gmail.com>

Hi Greg,

Responses below:

On 6/18/2017 5:30 PM, Tao Effect wrote:
> In Drivechain, 51% of miners have total control and ownership over all
> of the sidechain coins.

It would not be accurate to say that miners have "total" control. Miners
do control the destination of withdrawals, but they do not control the
withdrawal-duration nor the withdrawal-frequency.

So, if miners wish to 'steal' from a sidechain, they _can_ initiate a
theft, but they can not change the fact that their malfeasance will be
[a] obvious, and [b] on display for a long period of time.

We might draw a comparison between:

1. Classic Theft   -- A majority hashrate reorganizes the main Bitcoin
chain to double-spend funds (or coordinate with someone who is
double-spending). This is prevented/discouraged by waiting for many
confirmations.
2. Channel Theft -- A majority hashrate assists a Lightning-Network
thief, by censoring the punitive audit txn (possibly by exploiting some
excuse regarding fullness of blocks, or possibly induced to do so by the
thief provably splitting the proceeds with miners). This is
prevented/discouraged by using lengthy custodial periods, paying high
fees with your attacker's money, and using fungibility/non-communication
to interact with miners as little as possible (so as to frame LN-theft
as undermining the entire LN system, and not merely a single tragedy).
3. Drivechain Theft -- A majority hashrate initiates an unrepresentative
withdrawal from some sidechain. This is prevented/discouraged by only
using 'popular' sidechains (those that [a] increase the usefulness
("market price") of bitcoin, and [b] generate tx fees for miners). It is
also discouraged by the fact that egregious theft would probably end the
sidechain experiment, meaning that all present and future sidechains
would be forever unavailable (and unable to buoy the price or the tx
revenues).

I do not think that any of the three stands out as being categorically
worse than the others, especially when we consider the heterogeneity of
use-cases and preferences. As Luke-Jr has been pointing out on social
media recently, the very group which is more associated with miners (and
explicitly more willing to trust them, ie Bitcoin Unlimited et al),
happens to be the same group that would be expected to make use of a
LargeBlock drivechain. Some can argue that one type of security is more
"cryptographic" than others, but I think this is misguided (how many
'bits' of security does each have?) -- imho, all three security models
are 'game theoretic' (neither computer scientific, nor cryptographic).

More importantly, before a miner has any "control" over the sidechain
coins, users must voluntarily agree to subject themselves to these new
rules. This is similar to how an arbitrary piece of (open source)
software can have "total" control over your computer...if you choose to
install it.

> Thus the effect of Drivechain appears to be the creation of a new kind
> of digital border imposed onto the network ...

I'm not sure it would "create a border", given that sidechains are
currently not accessible at all. If anything drivechain cuts a door into
an existing impassible border.

>  ... where everyone hands over ownership of their Bitcoins to a
> /single/ mining cartel when they wish to interact with /any/ sidechain.

The qualifier "/any/ sidechain" would seem to imply that there is a way
to do sidechains that does not involve handing over some control to 51%
hashrate...I think this is false (even in the fabled case of ZK-SNARKS).
The first thing I do in the drivechain spec (
truthcoin.info/blog/drivechain ) is explain why.

> Drivechain would be a reasonable idea if that weren't the case, but
> since it is, Drivechain now introduces a very real possible future
> where Bitcoins can be confiscated by the Chinese government in exactly
> the same manner that the Chinese government today confiscates
> financial assets in other financial networks within China.

Yes, but money could also be confiscated from _any_ Bitcoin users
(Chinese or otherwise) using any of the three methods I mentioned above.
And confiscation could strike Chinese Bitcoin users if they decided to
sell their Bitcoin for Chinese Yuan, which they then deposited in a
Chinese bank. Or if they sold their Bitcoin for an Altcoin controlled by
the Chinese govt in some other way.

It is not up to the members of this list to decide, USSR style, what
other people are allowed to do with their own money.

The exceptions to this rule would be (ie, "bitcoin-dev should care about
what users are doing when..."):

1. [Unreasonable use of Reviewer Time]  The user's use-case is either
nonexistent (ie "no one wants that"), or totally unachievable ("we can't
do that") thus rendering the conversation a complete waste of time /
reviewer attention.
2. [Harmful Interference] The user's use-case would impose harm on some
existing use-case(s).

No reasonable person will claim the first, given today's scaling debate
(not to mention today's 'bitcoin dominance index'). Therefore, critics
must claim the second (as, for example, Peter Todd has been doing on
this list).

Which is why I narrowly focus on inter-chain harms [1], leading
ultimately to a focus on the mining ecosystem [2,3] and the development
of Blind Merged Mining [4].

[1]
https://www.youtube.com/watch?v=0goYH2sDw0w&list=PLw8-6ARlyVciNjgS_NFhAu-qt7HPf_dtg&index=1
[2] http://www.truthcoin.info/blog/mirage-miner-centralization/
[3] http://www.truthcoin.info/blog/mining-threat-equilibrium/
[4] http://www.truthcoin.info/blog/blind-merged-mining/
[5] http://www.truthcoin.info/blog/measuring-decentralization/

> 1. The Bitcoin network centralizes more, because more power (both
> financial power and power in terms of capability/control) is granted
> to miners.

I think that one has some duty to very clearly define something (like
"mining centralization" [2] or "centralization" [5]) before complaining
about it. I feel that people will occasionally use selfless complaints
to accomplish a selfish goal...especially when the artificial selfless
part is hard to discuss by virtue of its being poorly defined
(especially vague or abstract items like "the company", "our country",
etc). For example, those who take it upon themselves to "defend" "the
Bitcoin community" may have exactly that in mind as their primary
goal...but they may also end up with more visibility (and with it: more
influence, more job offers, more conference invites, more friends, etc)
and they may also end up with a megaphone for which to broadcast their
other views, or just a defend-able excuse for bragging loudly about how
great cypherpunks are and/or how devoted they-in-particular are to the
cypherpunk tribe, et cetera. To avoid this problem in my own technical
discourse, I try to avoid abstractions like "centralization" until I
have defined them [2,5].

You have defined centralization above, but the definition is itself
vague to the point where I do not think even you actually endorse it.
For example, you would need to say that Bitcoin centralizes whenever the
exchange rate increases (as this grants additional financial power to
miners) or when any new user joins Bitcoin, or when tx fee revenues
increase for any reason. You might also be forced to say that LN
centralizes Bitcoin (as LN grants new capability/control to miners), and
probably even that Bitcoin becomes more centralized when developers
release new software (as this grants new capability to miners,
specifically the ability to deny upgrades). This probably isn't what you
meant, but since you did not clearly explain what you meant we have no
way of knowing for sure.

It seems to me that you reject the premise that BMM [4] addresses these
issues. This is probably because BMM only addresses miner's interactions
with each other, and it does not address miner abilities as a group in
relation to other groups (for example, vs. users, developers,
investors). But, as I consistently emphasize, these groups of people are
free to ignore any sidechains that they do not like. In law there is a
saying 'volenti non fit injuria' which I would translate as "he who
volunteers cannot claim later to have been injured". This is a legal
theory, because otherwise everyone would be arbitrarily liable for
choices beyond their control (ie, responsible for decisions of other
unrelated people), which would be nonsense.

> 3. Drivechain limits user's existing choice when it comes to who is
> acting as custodian of their Bitcoins, from any trustworthy exchange,
> down to a single mining cartel under the control of a single set of laws.

Currently no (P2P) sidechains exist, and therefore the set of choices
today would seem to be more "limited" than in a post-sidechain future.
(The set of options may decrease later, for ecological reasons, if and
only if 'exchanges' are a strictly inferior option to 'sidechains' for
some reason...I don't see why this would be the case. I also don't
understand the emphasis on "exchanges" [SCs are much more like Altcoins,
than exchanges] in the first place, nor the dubious qualifier
"trustworthy".)

--Paul


From dev at jonasschnelli.ch  Mon Jun 19 16:10:13 2017
From: dev at jonasschnelli.ch (Jonas Schnelli)
Date: Mon, 19 Jun 2017 18:10:13 +0200
Subject: [bitcoin-dev] BIP Proposal: Compact Client Side Filtering for
 Light Clients
In-Reply-To: <oi8red$vbn$1@blaine.gmane.org>
References: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
	<oi8e8k$g56$1@blaine.gmane.org>
	<537fb7106e0387c77537f0b1279cbeca@cock.lu>
	<oi8red$vbn$1@blaine.gmane.org>
Message-ID: <6AC0929C-5E59-4BC1-A209-8CDC9C639B82@jonasschnelli.ch>



> Just to give you a number: based on the statistics of the Bitcoin Wallet
> app there are at least 2 million wallets depending on BIP37. Not all
> would need instant notification but based on the daily support enquiries
> instant notificaton is the most asked property of Bitcoin.

Yes. Users probably like this feature and client side filtering is not a drop-in replacement for BIP37.

We should also consider:
BIP37 works, because node-operators are willing to offer that service for free (which maybe change over time).
BIP37 consumes plenty of horsepower (disk/cpu) from nodes. Filtering a couple of days of blocks (assume 1000+) eats lots of resources for something, that has no direct long-term value for Bitcoin (the filters data is unique and will be "thrown away? [can?t be used by other peers]). Same applies for mempool (filtering mempool of a couple of hundred of mb each time the HD gap limit has been exceeded or the app gets sent to the foreground again).

Purely relying on the availability of BIP37 seems fragile to me and start to explore other ways is very reasonable.

/jonas
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 833 bytes
Desc: Message signed with OpenPGP
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170619/a2dd2bbf/attachment.sig>

From tomz at freedommail.ch  Mon Jun 19 16:07:45 2017
From: tomz at freedommail.ch (Tom Zander)
Date: Mon, 19 Jun 2017 18:07:45 +0200
Subject: [bitcoin-dev] BIP Proposal: Compact Client Side Filtering for
	Light Clients
In-Reply-To: <4052F361-966C-4817-9779-146D4B43D1FE@jonasschnelli.ch>
References: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
	<55482016.LADLl5KXAH@strawberry>
	<4052F361-966C-4817-9779-146D4B43D1FE@jonasschnelli.ch>
Message-ID: <2778650.T23JsbTI1Y@strawberry>

On Monday, 19 June 2017 17:49:59 CEST Jonas Schnelli wrote:
> Hi
> 
> > On Monday, 19 June 2017 14:26:46 CEST bfd--- via bitcoin-dev wrote:
> >> It's been debated if [filtering of] unconfirmed transactions are
> >> necessary,
> > 
> > Why would it not be needed? Any SPV client (when used as a
> > payment-receiver) requires this from a simple usability point of view.
> 
> I think many users would be willing ...
> a) ? to trade higher privacy (using client side filtering) for not having
> the ?incoming transaction? feature b) ? if they want 0-conf ? to fetch
> all inved transactions

You seem to misunderstand the usecase.
If you send me a transaction, both of use are using our phones, then I need 
to be able to have immediate feedback on the transaction being broadcast on 
the network.
This is not about zero-conf, this is simple seeing what is happening while 
it is happening.

Additionally, when the transaction that is meant for my wallet is broadcast, 
I want my SPV wallet to parse and check the actual transaction.
It is not just to see that *something* was actually send, but also to be 
able to see how much is being paid to me. Maybe If the transaction is marked 
as RBF-able, etc.

Really basic usability: provide information to your users when you can, 
should they want to, and by default on.
-- 
Tom Zander
Blog: https://zander.github.io
Vlog: https://vimeo.com/channels/tomscryptochannel

From dev at jonasschnelli.ch  Mon Jun 19 16:22:03 2017
From: dev at jonasschnelli.ch (Jonas Schnelli)
Date: Mon, 19 Jun 2017 18:22:03 +0200
Subject: [bitcoin-dev] BIP Proposal: Compact Client Side Filtering for
 Light Clients
In-Reply-To: <oi8sdn$ksl$1@blaine.gmane.org>
References: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
	<oi8e8k$g56$1@blaine.gmane.org>
	<537fb7106e0387c77537f0b1279cbeca@cock.lu>
	<55482016.LADLl5KXAH@strawberry>
	<4052F361-966C-4817-9779-146D4B43D1FE@jonasschnelli.ch>
	<oi8sdn$ksl$1@blaine.gmane.org>
Message-ID: <B27FF856-9281-479C-BFE2-D594F46C5C44@jonasschnelli.ch>

> 
> On the other hand, I remember only 1 (one) inquiry about the privacy
> problems of BIP37 (or privacy at all).

IMO privacy its something developers should make sure users have it.
Also, I think, todays SPV wallets should make users more aware of the possible privacy implications.

Do users know, if they pay for a good in a shop while consuming the shops WIFI, that the shop-owner as well as the ISP can use that data to combine it with the user profile (and ~ALL FUTURE purchases you do with the same wallet IN ANY LOCATION online or in-person)?

Do users know, that ISPs (cellular; including Google) can completely link the used Bitcoin wallet (again: all purchase including future ones) with the to the ISP well known user profile including credit-card data and may sell the Bitcoin data to any other data mining company?

If you use BIP37, you basically give your transaction history (_ALL TRANSACTIONS_ including transactions in future) to everyone.


> 
> From a regular user's point of view, privacy is non-issue. Sure,
> everyone would take it for free, but certainly not if it a) delays
> incoming payments or b) quickly eats up your traffic quota.

This may be true because they are not aware of the ramification and I don?t think client side filtering is a drop-in replacement for todays, smartphone SPV-model.


/jonas
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 833 bytes
Desc: Message signed with OpenPGP
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170619/fda0aec0/attachment-0001.sig>

From dev at jonasschnelli.ch  Mon Jun 19 16:30:18 2017
From: dev at jonasschnelli.ch (Jonas Schnelli)
Date: Mon, 19 Jun 2017 18:30:18 +0200
Subject: [bitcoin-dev] BIP Proposal: Compact Client Side Filtering for
 Light Clients
In-Reply-To: <2778650.T23JsbTI1Y@strawberry>
References: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
	<55482016.LADLl5KXAH@strawberry>
	<4052F361-966C-4817-9779-146D4B43D1FE@jonasschnelli.ch>
	<2778650.T23JsbTI1Y@strawberry>
Message-ID: <4FDEA4E2-F96D-4A2B-BE6C-04808CFEC74B@jonasschnelli.ch>

>> 
>> I think many users would be willing ...
>> a) ? to trade higher privacy (using client side filtering) for not having
>> the ?incoming transaction? feature b) ? if they want 0-conf ? to fetch
>> all inved transactions
> 
> You seem to misunderstand the usecase.
> If you send me a transaction, both of use are using our phones, then I need
> to be able to have immediate feedback on the transaction being broadcast on
> the network.
> This is not about zero-conf, this is simple seeing what is happening while
> it is happening.
> 
> Additionally, when the transaction that is meant for my wallet is broadcast,
> I want my SPV wallet to parse and check the actual transaction.
> It is not just to see that *something* was actually send, but also to be
> able to see how much is being paid to me. Maybe If the transaction is marked
> as RBF-able, etc.
> 
> Really basic usability: provide information to your users when you can,
> should they want to, and by default on.

I see this use case.
But I did receive bank wire transfers for the last decades without _immediately_ knowing that someone sent funds to me.
I personally would ALWAYS trade the higher bandwidth consumption (300MB mempool filtering) or slower notification time (maybe ~1h) for preserving privacy.
I agree, there are use cases where you want immediate notification, those use cases could probably be solved by not trowing away privacy (?parsing? all transactions and running in the background).

/jonas
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 833 bytes
Desc: Message signed with OpenPGP
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170619/beccad65/attachment.sig>

From rx at awsomnet.org  Mon Jun 19 16:36:41 2017
From: rx at awsomnet.org (adiabat)
Date: Mon, 19 Jun 2017 12:36:41 -0400
Subject: [bitcoin-dev] BIP Proposal: Compact Client Side Filtering for
 Light Clients
In-Reply-To: <B27FF856-9281-479C-BFE2-D594F46C5C44@jonasschnelli.ch>
References: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
	<oi8e8k$g56$1@blaine.gmane.org>
	<537fb7106e0387c77537f0b1279cbeca@cock.lu>
	<55482016.LADLl5KXAH@strawberry>
	<4052F361-966C-4817-9779-146D4B43D1FE@jonasschnelli.ch>
	<oi8sdn$ksl$1@blaine.gmane.org>
	<B27FF856-9281-479C-BFE2-D594F46C5C44@jonasschnelli.ch>
Message-ID: <CAKEeUhha8FMYqO79veAyZyg0Cc6S-_1a4=k4=6WdC7+Juk1A1Q@mail.gmail.com>

This has been brought up several times in the past, and I agree with
Jonas' comments about users being unaware of the privacy losses due to
BIP37.  One thing also mentioned before but not int he current thread
is that the entire concept of SPV is not applicable to unconfirmed
transactions.  SPV uses the fact that miners have committed to a
transaction with work to give the user an assurance that the
transaction is valid; if the transaction were invalid, it would be
costly for the miner to include it in a block with valid work.

Transactions in the mempool have no such assurance, and are costlessly
forgeable by anyone, including your ISP.  I wasn't involved in any
debate over BIP37 when it was being written up, so I don't know how
mempool filtering got in, but it never made any sense to me.  The fact
that lots of lite clients are using this is a problem as it gives
false assurance to users that there is a valid but yet-to-be-confirmed
transaction sending them money.

-Tadge

From tomz at freedommail.ch  Mon Jun 19 16:38:55 2017
From: tomz at freedommail.ch (Tom Zander)
Date: Mon, 19 Jun 2017 18:38:55 +0200
Subject: [bitcoin-dev] BIP Proposal: Compact Client Side Filtering for
	Light Clients
In-Reply-To: <4FDEA4E2-F96D-4A2B-BE6C-04808CFEC74B@jonasschnelli.ch>
References: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
	<2778650.T23JsbTI1Y@strawberry>
	<4FDEA4E2-F96D-4A2B-BE6C-04808CFEC74B@jonasschnelli.ch>
Message-ID: <1536368.e5g6sdTPab@strawberry>

On Monday, 19 June 2017 18:30:18 CEST Jonas Schnelli wrote:
> I personally would ALWAYS [snip]

I mentioned that it was a usability point for a reason, and your personal 
behavior makes me want to quote one of the main UX guidelines; 
  ?You are not your user?

http://uxmyths.com/post/715988395/myth-you-are-like-your-users
older;
http://52weeksofux.com/post/385981879/you-are-not-your-user

I think we should defer to actual real numbers and user reseach, as has been 
quoted by Andreas. You disagreeing based on your own experience and behavior 
is worse than useless. As the above links show.

Don?t fall in that trap :)
-- 
Tom Zander
Blog: https://zander.github.io
Vlog: https://vimeo.com/channels/tomscryptochannel

From 1240902 at gmail.com  Mon Jun 19 18:01:45 2017
From: 1240902 at gmail.com (Wang Chun)
Date: Tue, 20 Jun 2017 02:01:45 +0800
Subject: [bitcoin-dev] An alternative way to protect the network from 51%
	attacks threat
Message-ID: <CAFzgq-woP3kWC9wYm=YxA_W=jMoL0AegTtUhTX3kEdMaB3m1rA@mail.gmail.com>

There has been proposal to change the PoW in case of potential 51% attacks
from malicious miners during a fork. But such a change in PoW renders
multi-billion-dollar of ASIC into worthless. which hurts economy so much
and the average innocent mining users. I would propose, instead of PoW
change, we could change the system to the same double sha256 PoW but mix it
with PoS features. Such a PoW+PoS system has several advantages:
* It protects existing multi-billion dollar investments from innocent
mining users,
* A malicious miner cannot launch attacks and rewrite the blockchain with
51% or even more hashrate,
* If we insert 4 PoS blocks between 2 PoW blocks, we'll have 2-minute block
time span, that solves the long confirmation time problem,
* We'll suddenly have 5 times of block space, that solves the scaling
problem,
* The PoS blocks only mine transaction fees, so the 21M cap remains,
* With careful design, the PoW+PoS transition _might_ be able to deploy
with a soft fork.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170620/8b2e692c/attachment.html>

From pete at petertodd.org  Mon Jun 19 18:31:54 2017
From: pete at petertodd.org (Peter Todd)
Date: Mon, 19 Jun 2017 14:31:54 -0400
Subject: [bitcoin-dev] An alternative way to protect the network from
 51% attacks threat
In-Reply-To: <CAFzgq-woP3kWC9wYm=YxA_W=jMoL0AegTtUhTX3kEdMaB3m1rA@mail.gmail.com>
References: <CAFzgq-woP3kWC9wYm=YxA_W=jMoL0AegTtUhTX3kEdMaB3m1rA@mail.gmail.com>
Message-ID: <20170619183154.GB7003@fedora-23-dvm>

On Tue, Jun 20, 2017 at 02:01:45AM +0800, Wang Chun via bitcoin-dev wrote:
> There has been proposal to change the PoW in case of potential 51% attacks
> from malicious miners during a fork. But such a change in PoW renders
> multi-billion-dollar of ASIC into worthless. which hurts economy so much
> and the average innocent mining users. I would propose, instead of PoW
> change, we could change the system to the same double sha256 PoW but mix it
> with PoS features. Such a PoW+PoS system has several advantages:


You have to specify what you mean by "PoS" - there's dozens of variations.
Equally, existing pure PoS schemes probably don't make sense as a "bolt-on"
add-on, as once you introduce PoW to it you should design something that uses
the capabilities of both systems.

FWIW, I've heard that the Ethereum guys are leaning towards abandoning pure PoS
and are now trying to design a PoW + staking system instead.

> * It protects existing multi-billion dollar investments from innocent
> mining users,

To be clear, you mean such a scheme would protect the multi-billion dollar
investments non-malicious miners have made in SHA256^2 hardware by ensuring it
remains useful, right?

> * A malicious miner cannot launch attacks and rewrite the blockchain with
> 51% or even more hashrate,
> * If we insert 4 PoS blocks between 2 PoW blocks, we'll have 2-minute block
> time span, that solves the long confirmation time problem,

Note that if those PoS blocks are *pure* PoS, you'll create a significant risk
of double-spend attacks, as there's zero inherent cost to creating a pure-PoS
block. Such blocks can't be relied on for confirmations; even "slasher" schemes
have significant problems with sybil attacks.

> * We'll suddenly have 5 times of block space, that solves the scaling
> problem,

The scaling problem is one of scalability; PoS does nothing to improve
scalability (though many in the ETH community have been making dishonest
statements to the contrary).

> * The PoS blocks only mine transaction fees, so the 21M cap remains,
> * With careful design, the PoW+PoS transition _might_ be able to deploy
> with a soft fork.

As a sidechain yes, but in what you propose above the extra blocks wouldn't
contain transactions that non-PoS-aware nodes could understand in a
backwards-compatible way.


All the above aside, I don't think it's inherently wrong to look at adding PoS
block *approval* mechanisms, where a block isn't considered valid without some
kind of coin owner approval. While pure-PoS is fundamentally broken in a
decentralized setting, it may be possible to mitigate the reasons it's broken
with PoW and get a system that has a stronger security model than PoW alone.

FWIW there's some early discussions by myself and others about this type of
approach on the #bitcoin-wizards IRC channels, IIRC from around 2014 or so.

-- 
https://petertodd.org 'peter'[:-1]@petertodd.org
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 455 bytes
Desc: Digital signature
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170619/9c314d95/attachment.sig>

From luke at dashjr.org  Mon Jun 19 19:26:22 2017
From: luke at dashjr.org (Luke Dashjr)
Date: Mon, 19 Jun 2017 19:26:22 +0000
Subject: [bitcoin-dev] BIP148 temporary service bit (1 << 27)
Message-ID: <201706191926.25006.luke@dashjr.org>

To ease the transition to BIP148 and to minimise risks in the event miners 
choose to perform a chain split attack, at least Bitcoin Knots will be using 
the temporary service bit (1 << 27) to indicate BIP148 support.

Once the transition is complete, this will no longer be necessary, and the bit 
will be (manually) returned for reuse.

I encourage other software implementing BIP148 (both full and light nodes) to 
set and use this service bit to avoid network partitioning risks.

Luke

From tomz at freedommail.ch  Mon Jun 19 19:46:57 2017
From: tomz at freedommail.ch (Tom Zander)
Date: Mon, 19 Jun 2017 21:46:57 +0200
Subject: [bitcoin-dev] BIP148 temporary service bit (1 << 27)
In-Reply-To: <201706191926.25006.luke@dashjr.org>
References: <201706191926.25006.luke@dashjr.org>
Message-ID: <3654399.ZkJ0Jlgova@cherry>

On Monday, 19 June 2017 21:26:22 CEST Luke Dashjr via bitcoin-dev wrote:
> To ease the transition to BIP148 and to minimise risks in the event miners
> choose to perform a chain split attack, at least Bitcoin Knots will be
> using the temporary service bit (1 << 27) to indicate BIP148 support.
> 
> Once the transition is complete, this will no longer be necessary, and the
> bit will be (manually) returned for reuse.
> 
> I encourage other software implementing BIP148 (both full and light nodes)
> to set and use this service bit to avoid network partitioning risks.

I'm curious what you action on the finding (or not) of a peer with this bit 
set (or not).
Can you link to the github commit where you implemented this?
-- 
Tom Zander
Blog: https://zander.github.io
Vlog: https://vimeo.com/channels/tomscryptochannel

From mark at friedenbach.org  Mon Jun 19 20:24:25 2017
From: mark at friedenbach.org (Mark Friedenbach)
Date: Mon, 19 Jun 2017 13:24:25 -0700
Subject: [bitcoin-dev] BIP148 temporary service bit (1 << 27)
In-Reply-To: <3654399.ZkJ0Jlgova@cherry>
References: <201706191926.25006.luke@dashjr.org> <3654399.ZkJ0Jlgova@cherry>
Message-ID: <DAC56472-EF04-45FF-887B-2481B259E662@friedenbach.org>

It is essential that BIP-148 nodes connect to at least two other BIP-148 nodes to prevent a network partition in August 1st. The temporary service but is how such nodes are able to detect each other.

> On Jun 19, 2017, at 12:46 PM, Tom Zander via bitcoin-dev <bitcoin-dev at lists.linuxfoundation.org> wrote:
> 
>> On Monday, 19 June 2017 21:26:22 CEST Luke Dashjr via bitcoin-dev wrote:
>> To ease the transition to BIP148 and to minimise risks in the event miners
>> choose to perform a chain split attack, at least Bitcoin Knots will be
>> using the temporary service bit (1 << 27) to indicate BIP148 support.
>> 
>> Once the transition is complete, this will no longer be necessary, and the
>> bit will be (manually) returned for reuse.
>> 
>> I encourage other software implementing BIP148 (both full and light nodes)
>> to set and use this service bit to avoid network partitioning risks.
> 
> I'm curious what you action on the finding (or not) of a peer with this bit 
> set (or not).
> Can you link to the github commit where you implemented this?
> -- 
> Tom Zander
> Blog: https://zander.github.io
> Vlog: https://vimeo.com/channels/tomscryptochannel
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev

From ethan.scruples at gmail.com  Mon Jun 19 20:32:23 2017
From: ethan.scruples at gmail.com (Moral Agent)
Date: Mon, 19 Jun 2017 16:32:23 -0400
Subject: [bitcoin-dev] An alternative way to protect the network from
 51% attacks threat
In-Reply-To: <CAFzgq-woP3kWC9wYm=YxA_W=jMoL0AegTtUhTX3kEdMaB3m1rA@mail.gmail.com>
References: <CAFzgq-woP3kWC9wYm=YxA_W=jMoL0AegTtUhTX3kEdMaB3m1rA@mail.gmail.com>
Message-ID: <CACiOHGxVCq-csKyegRHRrC0QsSvdMfYXyBEJYxAS89WsLgZ0YA@mail.gmail.com>

Here is the text of a post to reddit from Feb 2017, discussing a similar
idea, and wondering if it could reduce the incentive to delay broadcast of
solved blocks:

# How an anchored Proof of Stake Sidechain can help the Bitcoin main chain

# Steps:

1. Soft fork Bitcoin to enable side chains

2. Create a side chain that is secured with Proof of Stake. Call blocks on
this chain "POS-blocks." The original chain is made of "POW-blocks."

3. Side chain mints one POS-block after each POW-block on the main chain,
and contains the hash of the POW-block, and the hash of the previous
POS-block. See diagram [here.](https://s32.postimg.org/916n9zxlx/Pos_Sf1.png
)

4. Side chain Minters must make a deposit in order to mint. If they mint an
invalid POS-block, they lose the deposit.

5. Side chain blocks are small enough to broadcast and validate quickly
(e.g. 100 - 300 KB).

6. Soft fork a new rule into Bitcoin that encourages POW-blocks to include
the hash of the prior POS-block. Specifically, penalize POW-blocks which do
not point to the prior POS-block by doubling the difficulty necessary for
them to be valid. Call POW-blocks which do not point to the prior POS-block
but are valid because of their very high POW "hard blocks."

In the following diagram POW2 and POW4 are valid because they point to the
prior POS-block and also satisfy the difficulty requirement. POW3 does not
point to the prior POS-bock, but is valid anyway because it contains proof
of work at twice the normal difficulty.

https://s27.postimg.org/6hc0b8ejn/Pos_Sf2.png

# Advantages:

1. Allow people who do not control ASICs to influence which transactions
happen.

2. Allow people who do not control ASICs to influence which chain gets
extended.

3. Reduce the incentive to selfish mine. Once a miner discovers a block,
they should broadcast it immediately in the hopes that a Minter will build
on it, because that is the most likely way their block will not go stale.
Miners will also immediately start trying to build a hard block. (Maybe
statistics could tell us what is the proper range for the Hardness
Multiplier. I guessed 2 would be good.)

4. Reduces the effective block interval while reducing the incidence of
stale blocks, empty blocks and SPV mining. After a POW-block is mined, it
is immediately broadcast to the network, seeking a qualified Minter to
extend it. Minters have a deposit, which they will lose if they mint an
invalid block. Pointing to the hash of an invalid POW-block would produce
an invalid minted block, so Minters have a strong incentive to completely
validate the POW-block before they mint on top of it. After validating,
they mint a block and broadcast it. While the Minter is validating the
previous POW-block, competing miners also have time to fully validate the
previous POW-block. By the time the Miners receive the POS-block, they know
what transactions they can and cannot include in their own block, because
the Minter only processes transactions on the side chain. There is less
reason to mine empty blocks, because there is adequate time to update the
mempool before mining the next soft block begins, and because hard blocks
take a long time to produce. The risks involved with mining on an
un-validated POS-block can be made small by the fact that there is a
deposit that will be destroyed if the POS-block is invalid. POS-blocks can
be validated quickly because they are small.

Here is a gantt chart of the schedule described above:

https://s22.postimg.org/hvnkyac5d/Pos_Sf3.png

5. Unlike a pure POS system, a cabal of early Stake holders cannot cheaply
hatch an alternate history. Much less imperative for nodes to go to a
trusted peer and ask whether the chain they are being fed is legitimate.

6. After step 6 above, the side chain would have essentially the same
security characteristics as the main chain, and could be used
interchangeably.

7. No hard fork required, and this soft fork could be deployed even if the
miners do not consent to it. Some hybrid POS system would be my
recommendation as preferable to simply changing POW algorithms in the face
of miners abusing their power.

8. Users can opt into the POS sidechain, and it can fully prove itself in
production before there is any attempt to anchor the main chain back to it.
Even if consensus cannot be obtained to execute step 6, the mere existence
of such a chain could deter tomfoolery on the part of POW miners, lest they
galvanize the community into throwing the switch.

Original reddit post here:

https://www.reddit.com/r/Bitcoin/comments/5vy4qc/how_an_anchored_proof_of_stake_sidechain_can_help/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170619/a77f0079/attachment.html>

From andreas at schildbach.de  Mon Jun 19 20:49:17 2017
From: andreas at schildbach.de (Andreas Schildbach)
Date: Mon, 19 Jun 2017 22:49:17 +0200
Subject: [bitcoin-dev] BIP Proposal: Compact Client Side Filtering for
	Light Clients
In-Reply-To: <CAKEeUhha8FMYqO79veAyZyg0Cc6S-_1a4=k4=6WdC7+Juk1A1Q@mail.gmail.com>
References: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
	<oi8e8k$g56$1@blaine.gmane.org>
	<537fb7106e0387c77537f0b1279cbeca@cock.lu>
	<55482016.LADLl5KXAH@strawberry>
	<4052F361-966C-4817-9779-146D4B43D1FE@jonasschnelli.ch>
	<oi8sdn$ksl$1@blaine.gmane.org>
	<B27FF856-9281-479C-BFE2-D594F46C5C44@jonasschnelli.ch>
	<CAKEeUhha8FMYqO79veAyZyg0Cc6S-_1a4=k4=6WdC7+Juk1A1Q@mail.gmail.com>
Message-ID: <oi9dc8$iv3$1@blaine.gmane.org>

Most SPV wallets make it quite clear that unconfirmed transactions are
just that.


On 06/19/2017 06:36 PM, adiabat via bitcoin-dev wrote:
> This has been brought up several times in the past, and I agree with
> Jonas' comments about users being unaware of the privacy losses due to
> BIP37.  One thing also mentioned before but not int he current thread
> is that the entire concept of SPV is not applicable to unconfirmed
> transactions.  SPV uses the fact that miners have committed to a
> transaction with work to give the user an assurance that the
> transaction is valid; if the transaction were invalid, it would be
> costly for the miner to include it in a block with valid work.
> 
> Transactions in the mempool have no such assurance, and are costlessly
> forgeable by anyone, including your ISP.  I wasn't involved in any
> debate over BIP37 when it was being written up, so I don't know how
> mempool filtering got in, but it never made any sense to me.  The fact
> that lots of lite clients are using this is a problem as it gives
> false assurance to users that there is a valid but yet-to-be-confirmed
> transaction sending them money.
> 
> -Tadge
> 



From greg at xiph.org  Mon Jun 19 22:41:49 2017
From: greg at xiph.org (Gregory Maxwell)
Date: Mon, 19 Jun 2017 22:41:49 +0000
Subject: [bitcoin-dev] BIP Proposal: Compact Client Side Filtering for
 Light Clients
In-Reply-To: <537fb7106e0387c77537f0b1279cbeca@cock.lu>
References: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
	<oi8e8k$g56$1@blaine.gmane.org>
	<537fb7106e0387c77537f0b1279cbeca@cock.lu>
Message-ID: <CAAS2fgQ4nfYrRasm7jwx4B86fNKb6NvpHy-Dt=3bfiaNt10snA@mail.gmail.com>

On Mon, Jun 19, 2017 at 12:26 PM, bfd--- via bitcoin-dev
<bitcoin-dev at lists.linuxfoundation.org> wrote:
> Several times. It's been debated if unconfirmed transactions are necessary,
> methods of doing more private filtering have been suggested, along with
> simply not filtering unconfirmed transactions at all. My collected data
> suggests that there is very little use of BIP37 at present, based on
> incoming connections to nodes I know end up in the DNS seed responses (no
> "SPV" clients do their own peer management).

Sending just the output addresses of each transaction would use about
1 kilobit/s of data. Sending the entire transactions would use
~14kbit/sec data.  These don't seem to be a unsustainable tremendous
amount of data to use while an application is running.

Doubly so for SPV wallets which are highly vulnerable to unconfirmed
transactions, and many which last I heard testing reports on became
pretty severely corrupted once given a fake transaction.

Can someone make a case why saving no more than those figures would
justify the near total loss of privacy that filtering gives?

"Because they already do it" isn't a good argument when talking about
a new protocol feature; things which already do BIP37 will presumably
continue to already do BIP37.

From eric at voskuil.org  Tue Jun 20 07:03:43 2017
From: eric at voskuil.org (Eric Voskuil)
Date: Tue, 20 Jun 2017 09:03:43 +0200
Subject: [bitcoin-dev] BIP Proposal: Compact Client Side Filtering for
	Light Clients
In-Reply-To: <B27FF856-9281-479C-BFE2-D594F46C5C44@jonasschnelli.ch>
References: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
	<oi8e8k$g56$1@blaine.gmane.org>
	<537fb7106e0387c77537f0b1279cbeca@cock.lu>
	<55482016.LADLl5KXAH@strawberry>
	<4052F361-966C-4817-9779-146D4B43D1FE@jonasschnelli.ch>
	<oi8sdn$ksl$1@blaine.gmane.org>
	<B27FF856-9281-479C-BFE2-D594F46C5C44@jonasschnelli.ch>
Message-ID: <5E00D8BD-234F-449C-AF52-F7EB4B814306@voskuil.org>

The reason that BIP37 presents a long list of problems is that it is a client-server scenario wedged into a peer-to-peer network. The only possible excuse for this design was implementation shortcut.

As this thread and others demonstrate, reproducing this design flaw will not eliminate the problems. The fact that there are many wallets dependent upon it is an unfortunate consequence of the original sin, but is not likely to last. There is no rationale for node operators to support wallets apart from their own. As a node implementer interested in privacy, security and scalability, I would never waste the time to code BIP37, or and client-server feature into the P2P protocol, especially one that delegates some aspect of validation.

Other nodes (servers) provide independent, securable, client-server interfaces. Many of these are made available as community servers for use at no charge. They could also provide mechanisms for operator payment without polluting the P2P network.

However as a community we should be working toward full node wallets. A secured personal node/server can support remote mobile wallets with security, privacy and no wasted bandwidth. And if we avoid counterproductive increases in blockchain growth rate, full nodes will eventually be able to run on mobile platforms with no difficulty whatsoever. A wallet that delegates full validation to node operators is just another centralization pressure that we do not need.

e

On Jun 19, 2017, at 6:22 PM, Jonas Schnelli via bitcoin-dev <bitcoin-dev at lists.linuxfoundation.org> wrote:

>> 
>> On the other hand, I remember only 1 (one) inquiry about the privacy
>> problems of BIP37 (or privacy at all).
> 
> IMO privacy its something developers should make sure users have it.
> Also, I think, todays SPV wallets should make users more aware of the possible privacy implications.
> 
> Do users know, if they pay for a good in a shop while consuming the shops WIFI, that the shop-owner as well as the ISP can use that data to combine it with the user profile (and ~ALL FUTURE purchases you do with the same wallet IN ANY LOCATION online or in-person)?
> 
> Do users know, that ISPs (cellular; including Google) can completely link the used Bitcoin wallet (again: all purchase including future ones) with the to the ISP well known user profile including credit-card data and may sell the Bitcoin data to any other data mining company?
> 
> If you use BIP37, you basically give your transaction history (_ALL TRANSACTIONS_ including transactions in future) to everyone.
> 
> 
>> 
>> From a regular user's point of view, privacy is non-issue. Sure,
>> everyone would take it for free, but certainly not if it a) delays
>> incoming payments or b) quickly eats up your traffic quota.
> 
> This may be true because they are not aware of the ramification and I don?t think client side filtering is a drop-in replacement for todays, smartphone SPV-model.
> 
> 
> /jonas
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev

From truthcoin at gmail.com  Tue Jun 20 11:54:52 2017
From: truthcoin at gmail.com (Paul Sztorc)
Date: Tue, 20 Jun 2017 07:54:52 -0400
Subject: [bitcoin-dev] Drivechain RfD -- Follow Up
In-Reply-To: <CAJowKgLJW=kJhcN4B7TbWXLb7U51tzYU3PFOy1m8JqKXqFsU4A@mail.gmail.com>
References: <24f2b447-a237-45eb-ef9f-1a62533fad5c@gmail.com>
	<83671224-f6ff-16a9-81c0-20ab578aec9d@gmail.com>
	<AAC86547-7904-4475-9966-138130019567@taoeffect.com>
	<6764b8af-bb4c-615d-5af5-462127bbbe36@gmail.com>
	<CAJowKgLJW=kJhcN4B7TbWXLb7U51tzYU3PFOy1m8JqKXqFsU4A@mail.gmail.com>
Message-ID: <33d98418-10f0-3854-a954-14985d53e04b@gmail.com>

Hi Erik,

As you know:

1. If a sidechain is merged mined it basically grows out of the existing
Bitcoin mining network. If it has a different PoW algorithm it is a new
mining network.
2. The security (ie, hashrate) of any mining network would be determined
by the total economic value of the block. In Bitcoin this is
(subsidy+tx_fees)*price, but since a sidechain cannot issue new tokens
it would only be (tx_fees)*price.

Unfortunately the two have a nasty correlation which can lead to a
disastrous self-fulfilling prophecy: users will avoid a network that is
too insecure; and if users avoid using a network, they will stop paying
txn fees and so the quantity (tx_fees)*price falls toward zero, erasing
the network's security. So it is quite problematic and I recommend just
biting the bullet and going with merged mining instead.

And, the point may be moot. Bitcoin miners may decide that, given their
expertise in seeking out cheap sources of power/cooling, they might as
well mine both/all chains. So your suggestion may not achieve your
desired result (and would, meanwhile, consume more of the economy's
resources -- some of these would not contribute even to a higher hashrate).

Paul



On 6/19/2017 1:11 PM, Erik Aronesty wrote:
> It would be nice to be able to enforce that a drivechain *not* have
> the same POW as bitcoin.
>
> I suspect this is the only way to be sure that a drivechain doesn't
> destabilize the main chain and push more power to miners that already
> have too much power.
>
>
> On Mon, Jun 19, 2017 at 12:04 PM, Paul Sztorc via bitcoin-dev
> <bitcoin-dev at lists.linuxfoundation.org
> <mailto:bitcoin-dev at lists.linuxfoundation.org>> wrote:
>
>     Hi Greg,
>
>     Responses below:
>
>     On 6/18/2017 5:30 PM, Tao Effect wrote:
>     > In Drivechain, 51% of miners have total control and ownership
>     over all
>     > of the sidechain coins.
>
>     It would not be accurate to say that miners have "total" control.
>     Miners
>     do control the destination of withdrawals, but they do not control the
>     withdrawal-duration nor the withdrawal-frequency.
>
>     So, if miners wish to 'steal' from a sidechain, they _can_ initiate a
>     theft, but they can not change the fact that their malfeasance will be
>     [a] obvious, and [b] on display for a long period of time.
>
>     We might draw a comparison between:
>
>     1. Classic Theft   -- A majority hashrate reorganizes the main Bitcoin
>     chain to double-spend funds (or coordinate with someone who is
>     double-spending). This is prevented/discouraged by waiting for many
>     confirmations.
>     2. Channel Theft -- A majority hashrate assists a Lightning-Network
>     thief, by censoring the punitive audit txn (possibly by exploiting
>     some
>     excuse regarding fullness of blocks, or possibly induced to do so
>     by the
>     thief provably splitting the proceeds with miners). This is
>     prevented/discouraged by using lengthy custodial periods, paying high
>     fees with your attacker's money, and using
>     fungibility/non-communication
>     to interact with miners as little as possible (so as to frame LN-theft
>     as undermining the entire LN system, and not merely a single tragedy).
>     3. Drivechain Theft -- A majority hashrate initiates an
>     unrepresentative
>     withdrawal from some sidechain. This is prevented/discouraged by only
>     using 'popular' sidechains (those that [a] increase the usefulness
>     ("market price") of bitcoin, and [b] generate tx fees for miners).
>     It is
>     also discouraged by the fact that egregious theft would probably
>     end the
>     sidechain experiment, meaning that all present and future sidechains
>     would be forever unavailable (and unable to buoy the price or the tx
>     revenues).
>
>     I do not think that any of the three stands out as being categorically
>     worse than the others, especially when we consider the
>     heterogeneity of
>     use-cases and preferences. As Luke-Jr has been pointing out on social
>     media recently, the very group which is more associated with
>     miners (and
>     explicitly more willing to trust them, ie Bitcoin Unlimited et al),
>     happens to be the same group that would be expected to make use of a
>     LargeBlock drivechain. Some can argue that one type of security is
>     more
>     "cryptographic" than others, but I think this is misguided (how many
>     'bits' of security does each have?) -- imho, all three security models
>     are 'game theoretic' (neither computer scientific, nor cryptographic).
>
>     More importantly, before a miner has any "control" over the sidechain
>     coins, users must voluntarily agree to subject themselves to these new
>     rules. This is similar to how an arbitrary piece of (open source)
>     software can have "total" control over your computer...if you
>     choose to
>     install it.
>
>     > Thus the effect of Drivechain appears to be the creation of a
>     new kind
>     > of digital border imposed onto the network ...
>
>     I'm not sure it would "create a border", given that sidechains are
>     currently not accessible at all. If anything drivechain cuts a
>     door into
>     an existing impassible border.
>
>     >  ... where everyone hands over ownership of their Bitcoins to a
>     > /single/ mining cartel when they wish to interact with /any/ sidechain.
>
>     The qualifier "/any/ sidechain" would seem to imply that there is
>     a way
>     to do sidechains that does not involve handing over some control
>     to 51%
>     hashrate...I think this is false (even in the fabled case of
>     ZK-SNARKS).
>     The first thing I do in the drivechain spec (
>     truthcoin.info/blog/drivechain
>     <http://truthcoin.info/blog/drivechain> ) is explain why.
>
>     > Drivechain would be a reasonable idea if that weren't the case, but
>     > since it is, Drivechain now introduces a very real possible future
>     > where Bitcoins can be confiscated by the Chinese government in
>     exactly
>     > the same manner that the Chinese government today confiscates
>     > financial assets in other financial networks within China.
>
>     Yes, but money could also be confiscated from _any_ Bitcoin users
>     (Chinese or otherwise) using any of the three methods I mentioned
>     above.
>     And confiscation could strike Chinese Bitcoin users if they decided to
>     sell their Bitcoin for Chinese Yuan, which they then deposited in a
>     Chinese bank. Or if they sold their Bitcoin for an Altcoin
>     controlled by
>     the Chinese govt in some other way.
>
>     It is not up to the members of this list to decide, USSR style, what
>     other people are allowed to do with their own money.
>
>     The exceptions to this rule would be (ie, "bitcoin-dev should care
>     about
>     what users are doing when..."):
>
>     1. [Unreasonable use of Reviewer Time]  The user's use-case is either
>     nonexistent (ie "no one wants that"), or totally unachievable ("we
>     can't
>     do that") thus rendering the conversation a complete waste of time /
>     reviewer attention.
>     2. [Harmful Interference] The user's use-case would impose harm on
>     some
>     existing use-case(s).
>
>     No reasonable person will claim the first, given today's scaling
>     debate
>     (not to mention today's 'bitcoin dominance index'). Therefore, critics
>     must claim the second (as, for example, Peter Todd has been doing on
>     this list).
>
>     Which is why I narrowly focus on inter-chain harms [1], leading
>     ultimately to a focus on the mining ecosystem [2,3] and the
>     development
>     of Blind Merged Mining [4].
>
>     [1]
>     https://www.youtube.com/watch?v=0goYH2sDw0w&list=PLw8-6ARlyVciNjgS_NFhAu-qt7HPf_dtg&index=1
>     <https://www.youtube.com/watch?v=0goYH2sDw0w&list=PLw8-6ARlyVciNjgS_NFhAu-qt7HPf_dtg&index=1>
>     [2] http://www.truthcoin.info/blog/mirage-miner-centralization/
>     <http://www.truthcoin.info/blog/mirage-miner-centralization/>
>     [3] http://www.truthcoin.info/blog/mining-threat-equilibrium/
>     <http://www.truthcoin.info/blog/mining-threat-equilibrium/>
>     [4] http://www.truthcoin.info/blog/blind-merged-mining/
>     <http://www.truthcoin.info/blog/blind-merged-mining/>
>     [5] http://www.truthcoin.info/blog/measuring-decentralization/
>     <http://www.truthcoin.info/blog/measuring-decentralization/>
>
>     > 1. The Bitcoin network centralizes more, because more power (both
>     > financial power and power in terms of capability/control) is granted
>     > to miners.
>
>     I think that one has some duty to very clearly define something (like
>     "mining centralization" [2] or "centralization" [5]) before
>     complaining
>     about it. I feel that people will occasionally use selfless complaints
>     to accomplish a selfish goal...especially when the artificial selfless
>     part is hard to discuss by virtue of its being poorly defined
>     (especially vague or abstract items like "the company", "our country",
>     etc). For example, those who take it upon themselves to "defend" "the
>     Bitcoin community" may have exactly that in mind as their primary
>     goal...but they may also end up with more visibility (and with it:
>     more
>     influence, more job offers, more conference invites, more friends,
>     etc)
>     and they may also end up with a megaphone for which to broadcast their
>     other views, or just a defend-able excuse for bragging loudly
>     about how
>     great cypherpunks are and/or how devoted they-in-particular are to the
>     cypherpunk tribe, et cetera. To avoid this problem in my own technical
>     discourse, I try to avoid abstractions like "centralization" until I
>     have defined them [2,5].
>
>     You have defined centralization above, but the definition is itself
>     vague to the point where I do not think even you actually endorse it.
>     For example, you would need to say that Bitcoin centralizes
>     whenever the
>     exchange rate increases (as this grants additional financial power to
>     miners) or when any new user joins Bitcoin, or when tx fee revenues
>     increase for any reason. You might also be forced to say that LN
>     centralizes Bitcoin (as LN grants new capability/control to
>     miners), and
>     probably even that Bitcoin becomes more centralized when developers
>     release new software (as this grants new capability to miners,
>     specifically the ability to deny upgrades). This probably isn't
>     what you
>     meant, but since you did not clearly explain what you meant we have no
>     way of knowing for sure.
>
>     It seems to me that you reject the premise that BMM [4] addresses
>     these
>     issues. This is probably because BMM only addresses miner's
>     interactions
>     with each other, and it does not address miner abilities as a group in
>     relation to other groups (for example, vs. users, developers,
>     investors). But, as I consistently emphasize, these groups of
>     people are
>     free to ignore any sidechains that they do not like. In law there is a
>     saying 'volenti non fit injuria' which I would translate as "he who
>     volunteers cannot claim later to have been injured". This is a legal
>     theory, because otherwise everyone would be arbitrarily liable for
>     choices beyond their control (ie, responsible for decisions of other
>     unrelated people), which would be nonsense.
>
>     > 3. Drivechain limits user's existing choice when it comes to who is
>     > acting as custodian of their Bitcoins, from any trustworthy
>     exchange,
>     > down to a single mining cartel under the control of a single set
>     of laws.
>
>     Currently no (P2P) sidechains exist, and therefore the set of choices
>     today would seem to be more "limited" than in a post-sidechain future.
>     (The set of options may decrease later, for ecological reasons, if and
>     only if 'exchanges' are a strictly inferior option to 'sidechains' for
>     some reason...I don't see why this would be the case. I also don't
>     understand the emphasis on "exchanges" [SCs are much more like
>     Altcoins,
>     than exchanges] in the first place, nor the dubious qualifier
>     "trustworthy".)
>
>     --Paul
>
>     _______________________________________________
>     bitcoin-dev mailing list
>     bitcoin-dev at lists.linuxfoundation.org
>     <mailto:bitcoin-dev at lists.linuxfoundation.org>
>     https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>     <https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev>
>
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170620/36c542b5/attachment-0001.html>

From tomz at freedommail.ch  Tue Jun 20 09:52:00 2017
From: tomz at freedommail.ch (Tom Zander)
Date: Tue, 20 Jun 2017 11:52:00 +0200
Subject: [bitcoin-dev] BIP Proposal: Compact Client Side Filtering for
	Light Clients
In-Reply-To: <CAAS2fgQ4nfYrRasm7jwx4B86fNKb6NvpHy-Dt=3bfiaNt10snA@mail.gmail.com>
References: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
	<537fb7106e0387c77537f0b1279cbeca@cock.lu>
	<CAAS2fgQ4nfYrRasm7jwx4B86fNKb6NvpHy-Dt=3bfiaNt10snA@mail.gmail.com>
Message-ID: <29376397.dRe9PMdyPS@strawberry>

On Tuesday, 20 June 2017 00:41:49 CEST Gregory Maxwell via bitcoin-dev 
wrote:
> Can someone make a case why saving no more than those figures would
> justify the near total loss of privacy that filtering gives?

First, your figures are wrong and also fall out of the sky with no 
justification. Can?t debunk something that is pure garbage.

Second, stating that a bloom filter is a "total loss of privacy" is equally 
baseless and doesn?t need debunking.

> "Because they already do it" isn't a good argument when talking about
> a new protocol feature; things which already do BIP37 will presumably
> continue to already do BIP37.

I think you just made the case for completely rejecting this proposal based 
on the fact that nobody will use it, BIP37 already exists.

Not sure if I agree with that, improvements are always useful and we should 
be able to come up with replacements.
But arguing against a feature you don?t like, especiallyh one used by 
millions every day, is a sad way to stiffle innovation, Greg.
-- 
Tom Zander
Blog: https://zander.github.io
Vlog: https://vimeo.com/channels/tomscryptochannel

From bfd at cock.lu  Tue Jun 20 13:08:03 2017
From: bfd at cock.lu (bfd at cock.lu)
Date: Tue, 20 Jun 2017 16:08:03 +0300
Subject: [bitcoin-dev] BIP Proposal: Compact Client Side Filtering for
 Light Clients
In-Reply-To: <29376397.dRe9PMdyPS@strawberry>
References: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
	<537fb7106e0387c77537f0b1279cbeca@cock.lu>
	<CAAS2fgQ4nfYrRasm7jwx4B86fNKb6NvpHy-Dt=3bfiaNt10snA@mail.gmail.com>
	<29376397.dRe9PMdyPS@strawberry>
Message-ID: <3d4e50fe9f582066d1d6de0565132b5b@cock.lu>

On 2017-06-20 12:52, Tom Zander via bitcoin-dev wrote:
> Second, stating that a bloom filter is a "total loss of privacy" is 
> equally
> baseless and doesn?t need debunking.
> 

"On the Privacy Provisions of Bloom Filters in Lightweight Bitcoin 
Clients"

> We show analytically and empirically that the reliance on Bloom filters 
> within existing SPV clients leaks considerable information about the 
> addresses of Bitcoin users. Our results show that an SPV client who 
> uses a modest number of Bitcoin addresses (e.g., < 20) risks revealing 
> almost all of his addresses.

https://eprint.iacr.org/2014/763.pdf

From erik at q32.com  Tue Jun 20 13:38:59 2017
From: erik at q32.com (Erik Aronesty)
Date: Tue, 20 Jun 2017 09:38:59 -0400
Subject: [bitcoin-dev] Drivechain RfD -- Follow Up
In-Reply-To: <33d98418-10f0-3854-a954-14985d53e04b@gmail.com>
References: <24f2b447-a237-45eb-ef9f-1a62533fad5c@gmail.com>
	<83671224-f6ff-16a9-81c0-20ab578aec9d@gmail.com>
	<AAC86547-7904-4475-9966-138130019567@taoeffect.com>
	<6764b8af-bb4c-615d-5af5-462127bbbe36@gmail.com>
	<CAJowKgLJW=kJhcN4B7TbWXLb7U51tzYU3PFOy1m8JqKXqFsU4A@mail.gmail.com>
	<33d98418-10f0-3854-a954-14985d53e04b@gmail.com>
Message-ID: <CAJowKgKT2rn3N3L+79JEY_uNfKDewcmgkiEB2mJYx1mg+YjGCQ@mail.gmail.com>

- a proof-of-burn sidechain is the ultimate two-way peg.   you have to burn
bitcoin *or* side-chain tokens to mine the side chain.   the size of the
burn is the degree of security.    i actually wrote code to do randomized
blind burns where you have a poisson distribution (non-deterministic
selected burn).    there is no way to game it... it's very similar to
algorand - but it uses burns instead of staking

- you can then have a secure sidechain that issues a mining reward in
sidechain tokens, which can be aggrregated and redeemed for bitcoins.   the
result of this is that any bitcoins held in the sidechain depreciate in
value at a rate of X% per year.   this deflation rate pays for increased
security

- logically this functions like an alt coin, with high inflation and cheap
transactions.   but the altcoin is pegged to bitcoin's price because of the
pool of unredeemed bitcoins held within the side chain.



On Tue, Jun 20, 2017 at 7:54 AM, Paul Sztorc <truthcoin at gmail.com> wrote:

> Hi Erik,
>
> As you know:
>
> 1. If a sidechain is merged mined it basically grows out of the existing
> Bitcoin mining network. If it has a different PoW algorithm it is a new
> mining network.
> 2. The security (ie, hashrate) of any mining network would be determined
> by the total economic value of the block. In Bitcoin this is
> (subsidy+tx_fees)*price, but since a sidechain cannot issue new tokens it
> would only be (tx_fees)*price.
>
> Unfortunately the two have a nasty correlation which can lead to a
> disastrous self-fulfilling prophecy: users will avoid a network that is too
> insecure; and if users avoid using a network, they will stop paying txn
> fees and so the quantity (tx_fees)*price falls toward zero, erasing the
> network's security. So it is quite problematic and I recommend just biting
> the bullet and going with merged mining instead.
>
> And, the point may be moot. Bitcoin miners may decide that, given their
> expertise in seeking out cheap sources of power/cooling, they might as well
> mine both/all chains. So your suggestion may not achieve your desired
> result (and would, meanwhile, consume more of the economy's resources --
> some of these would not contribute even to a higher hashrate).
>
> Paul
>
>
>
>
> On 6/19/2017 1:11 PM, Erik Aronesty wrote:
>
> It would be nice to be able to enforce that a drivechain *not* have the
> same POW as bitcoin.
>
> I suspect this is the only way to be sure that a drivechain doesn't
> destabilize the main chain and push more power to miners that already have
> too much power.
>
>
> On Mon, Jun 19, 2017 at 12:04 PM, Paul Sztorc via bitcoin-dev <
> bitcoin-dev at lists.linuxfoundation.org> wrote:
>
>> Hi Greg,
>>
>> Responses below:
>>
>> On 6/18/2017 5:30 PM, Tao Effect wrote:
>> > In Drivechain, 51% of miners have total control and ownership over all
>> > of the sidechain coins.
>>
>> It would not be accurate to say that miners have "total" control. Miners
>> do control the destination of withdrawals, but they do not control the
>> withdrawal-duration nor the withdrawal-frequency.
>>
>> So, if miners wish to 'steal' from a sidechain, they _can_ initiate a
>> theft, but they can not change the fact that their malfeasance will be
>> [a] obvious, and [b] on display for a long period of time.
>>
>> We might draw a comparison between:
>>
>> 1. Classic Theft   -- A majority hashrate reorganizes the main Bitcoin
>> chain to double-spend funds (or coordinate with someone who is
>> double-spending). This is prevented/discouraged by waiting for many
>> confirmations.
>> 2. Channel Theft -- A majority hashrate assists a Lightning-Network
>> thief, by censoring the punitive audit txn (possibly by exploiting some
>> excuse regarding fullness of blocks, or possibly induced to do so by the
>> thief provably splitting the proceeds with miners). This is
>> prevented/discouraged by using lengthy custodial periods, paying high
>> fees with your attacker's money, and using fungibility/non-communication
>> to interact with miners as little as possible (so as to frame LN-theft
>> as undermining the entire LN system, and not merely a single tragedy).
>> 3. Drivechain Theft -- A majority hashrate initiates an unrepresentative
>> withdrawal from some sidechain. This is prevented/discouraged by only
>> using 'popular' sidechains (those that [a] increase the usefulness
>> ("market price") of bitcoin, and [b] generate tx fees for miners). It is
>> also discouraged by the fact that egregious theft would probably end the
>> sidechain experiment, meaning that all present and future sidechains
>> would be forever unavailable (and unable to buoy the price or the tx
>> revenues).
>>
>> I do not think that any of the three stands out as being categorically
>> worse than the others, especially when we consider the heterogeneity of
>> use-cases and preferences. As Luke-Jr has been pointing out on social
>> media recently, the very group which is more associated with miners (and
>> explicitly more willing to trust them, ie Bitcoin Unlimited et al),
>> happens to be the same group that would be expected to make use of a
>> LargeBlock drivechain. Some can argue that one type of security is more
>> "cryptographic" than others, but I think this is misguided (how many
>> 'bits' of security does each have?) -- imho, all three security models
>> are 'game theoretic' (neither computer scientific, nor cryptographic).
>>
>> More importantly, before a miner has any "control" over the sidechain
>> coins, users must voluntarily agree to subject themselves to these new
>> rules. This is similar to how an arbitrary piece of (open source)
>> software can have "total" control over your computer...if you choose to
>> install it.
>>
>> > Thus the effect of Drivechain appears to be the creation of a new kind
>> > of digital border imposed onto the network ...
>>
>> I'm not sure it would "create a border", given that sidechains are
>> currently not accessible at all. If anything drivechain cuts a door into
>> an existing impassible border.
>>
>> >  ... where everyone hands over ownership of their Bitcoins to a
>> > /single/ mining cartel when they wish to interact with /any/ sidechain.
>>
>> The qualifier "/any/ sidechain" would seem to imply that there is a way
>> to do sidechains that does not involve handing over some control to 51%
>> hashrate...I think this is false (even in the fabled case of ZK-SNARKS).
>> The first thing I do in the drivechain spec (
>> truthcoin.info/blog/drivechain ) is explain why.
>>
>> > Drivechain would be a reasonable idea if that weren't the case, but
>> > since it is, Drivechain now introduces a very real possible future
>> > where Bitcoins can be confiscated by the Chinese government in exactly
>> > the same manner that the Chinese government today confiscates
>> > financial assets in other financial networks within China.
>>
>> Yes, but money could also be confiscated from _any_ Bitcoin users
>> (Chinese or otherwise) using any of the three methods I mentioned above.
>> And confiscation could strike Chinese Bitcoin users if they decided to
>> sell their Bitcoin for Chinese Yuan, which they then deposited in a
>> Chinese bank. Or if they sold their Bitcoin for an Altcoin controlled by
>> the Chinese govt in some other way.
>>
>> It is not up to the members of this list to decide, USSR style, what
>> other people are allowed to do with their own money.
>>
>> The exceptions to this rule would be (ie, "bitcoin-dev should care about
>> what users are doing when..."):
>>
>> 1. [Unreasonable use of Reviewer Time]  The user's use-case is either
>> nonexistent (ie "no one wants that"), or totally unachievable ("we can't
>> do that") thus rendering the conversation a complete waste of time /
>> reviewer attention.
>> 2. [Harmful Interference] The user's use-case would impose harm on some
>> existing use-case(s).
>>
>> No reasonable person will claim the first, given today's scaling debate
>> (not to mention today's 'bitcoin dominance index'). Therefore, critics
>> must claim the second (as, for example, Peter Todd has been doing on
>> this list).
>>
>> Which is why I narrowly focus on inter-chain harms [1], leading
>> ultimately to a focus on the mining ecosystem [2,3] and the development
>> of Blind Merged Mining [4].
>>
>> [1]
>> https://www.youtube.com/watch?v=0goYH2sDw0w&list=PLw8-6ARlyV
>> ciNjgS_NFhAu-qt7HPf_dtg&index=1
>> [2] http://www.truthcoin.info/blog/mirage-miner-centralization/
>> [3] http://www.truthcoin.info/blog/mining-threat-equilibrium/
>> [4] http://www.truthcoin.info/blog/blind-merged-mining/
>> [5] http://www.truthcoin.info/blog/measuring-decentralization/
>>
>> > 1. The Bitcoin network centralizes more, because more power (both
>> > financial power and power in terms of capability/control) is granted
>> > to miners.
>>
>> I think that one has some duty to very clearly define something (like
>> "mining centralization" [2] or "centralization" [5]) before complaining
>> about it. I feel that people will occasionally use selfless complaints
>> to accomplish a selfish goal...especially when the artificial selfless
>> part is hard to discuss by virtue of its being poorly defined
>> (especially vague or abstract items like "the company", "our country",
>> etc). For example, those who take it upon themselves to "defend" "the
>> Bitcoin community" may have exactly that in mind as their primary
>> goal...but they may also end up with more visibility (and with it: more
>> influence, more job offers, more conference invites, more friends, etc)
>> and they may also end up with a megaphone for which to broadcast their
>> other views, or just a defend-able excuse for bragging loudly about how
>> great cypherpunks are and/or how devoted they-in-particular are to the
>> cypherpunk tribe, et cetera. To avoid this problem in my own technical
>> discourse, I try to avoid abstractions like "centralization" until I
>> have defined them [2,5].
>>
>> You have defined centralization above, but the definition is itself
>> vague to the point where I do not think even you actually endorse it.
>> For example, you would need to say that Bitcoin centralizes whenever the
>> exchange rate increases (as this grants additional financial power to
>> miners) or when any new user joins Bitcoin, or when tx fee revenues
>> increase for any reason. You might also be forced to say that LN
>> centralizes Bitcoin (as LN grants new capability/control to miners), and
>> probably even that Bitcoin becomes more centralized when developers
>> release new software (as this grants new capability to miners,
>> specifically the ability to deny upgrades). This probably isn't what you
>> meant, but since you did not clearly explain what you meant we have no
>> way of knowing for sure.
>>
>> It seems to me that you reject the premise that BMM [4] addresses these
>> issues. This is probably because BMM only addresses miner's interactions
>> with each other, and it does not address miner abilities as a group in
>> relation to other groups (for example, vs. users, developers,
>> investors). But, as I consistently emphasize, these groups of people are
>> free to ignore any sidechains that they do not like. In law there is a
>> saying 'volenti non fit injuria' which I would translate as "he who
>> volunteers cannot claim later to have been injured". This is a legal
>> theory, because otherwise everyone would be arbitrarily liable for
>> choices beyond their control (ie, responsible for decisions of other
>> unrelated people), which would be nonsense.
>>
>> > 3. Drivechain limits user's existing choice when it comes to who is
>> > acting as custodian of their Bitcoins, from any trustworthy exchange,
>> > down to a single mining cartel under the control of a single set of
>> laws.
>>
>> Currently no (P2P) sidechains exist, and therefore the set of choices
>> today would seem to be more "limited" than in a post-sidechain future.
>> (The set of options may decrease later, for ecological reasons, if and
>> only if 'exchanges' are a strictly inferior option to 'sidechains' for
>> some reason...I don't see why this would be the case. I also don't
>> understand the emphasis on "exchanges" [SCs are much more like Altcoins,
>> than exchanges] in the first place, nor the dubious qualifier
>> "trustworthy".)
>>
>> --Paul
>>
>> _______________________________________________
>> bitcoin-dev mailing list
>> bitcoin-dev at lists.linuxfoundation.org
>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170620/84bfa3ee/attachment-0001.html>

From erik at q32.com  Tue Jun 20 15:44:36 2017
From: erik at q32.com (Erik Aronesty)
Date: Tue, 20 Jun 2017 11:44:36 -0400
Subject: [bitcoin-dev] Miners forced to run non-core code in order to get
	segwit activated
Message-ID: <CAJowKgLtu-HUDuakk4DDU53nyChbQk_zY=f5OO2j1Za95PdL7w@mail.gmail.com>

Are we going to merge BIP91 or a -BIP148 option to core for inclusion in
the next release or so?

Because a large percentage of miners are indifferent, right now miners have
to choose between BIP148 and Segwit2x if they want to activate Segwit.

Should we be forcing miners to choose to run non-core code in order to
activate a popular feature?

- Erik
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170620/330d7f48/attachment.html>

From hampus.sjoberg at gmail.com  Tue Jun 20 16:49:38 2017
From: hampus.sjoberg at gmail.com (=?UTF-8?Q?Hampus_Sj=C3=B6berg?=)
Date: Tue, 20 Jun 2017 18:49:38 +0200
Subject: [bitcoin-dev] Miners forced to run non-core code in order to
 get segwit activated
In-Reply-To: <CAJowKgLtu-HUDuakk4DDU53nyChbQk_zY=f5OO2j1Za95PdL7w@mail.gmail.com>
References: <CAJowKgLtu-HUDuakk4DDU53nyChbQk_zY=f5OO2j1Za95PdL7w@mail.gmail.com>
Message-ID: <CAFMkqK_OtZ=S5LFqERCYwSQCkbxdnWJq+wN-YM3CVkKWJx2SBA@mail.gmail.com>

I don't think it's a huge deal if the miners need to run a non-Core node
once the BIP91 deployment of Segwit2x happens. The shift will most likely
be temporary.

I agree that the "-bip148"-option should be merged, though.

2017-06-20 17:44 GMT+02:00 Erik Aronesty via bitcoin-dev <
bitcoin-dev at lists.linuxfoundation.org>:

> Are we going to merge BIP91 or a -BIP148 option to core for inclusion in
> the next release or so?
>
> Because a large percentage of miners are indifferent, right now miners
> have to choose between BIP148 and Segwit2x if they want to activate Segwit.
>
>
> Should we be forcing miners to choose to run non-core code in order to
> activate a popular feature?
>
> - Erik
>
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170620/dcdeace9/attachment.html>

From adam.back at gmail.com  Tue Jun 20 17:20:53 2017
From: adam.back at gmail.com (Adam Back)
Date: Tue, 20 Jun 2017 18:20:53 +0100
Subject: [bitcoin-dev] BIP Proposal: Compact Client Side Filtering for
 Light Clients
In-Reply-To: <3d4e50fe9f582066d1d6de0565132b5b@cock.lu>
References: <CAO3Pvs8ccTkgrecJG6KFbBW+9moHF-FTU+4qNfayeE3hM9uRrg@mail.gmail.com>
	<537fb7106e0387c77537f0b1279cbeca@cock.lu>
	<CAAS2fgQ4nfYrRasm7jwx4B86fNKb6NvpHy-Dt=3bfiaNt10snA@mail.gmail.com>
	<29376397.dRe9PMdyPS@strawberry>
	<3d4e50fe9f582066d1d6de0565132b5b@cock.lu>
Message-ID: <CALqxMTE7Qv33uWn3eWbQVOg4gGwep=WRquS-bJDvTyagnA1bZQ@mail.gmail.com>

Also Jonas Nick gave a fairly comprehensive presentation on privacy
leaks in bitcoin protocol including SPV and bloom query problem
specifics:

https://www.youtube.com/watch?v=HScK4pkDNds

Adam


On 20 June 2017 at 14:08, bfd--- via bitcoin-dev
<bitcoin-dev at lists.linuxfoundation.org> wrote:
> On 2017-06-20 12:52, Tom Zander via bitcoin-dev wrote:
>>
>> Second, stating that a bloom filter is a "total loss of privacy" is
>> equally
>> baseless and doesn?t need debunking.
>>
>
> "On the Privacy Provisions of Bloom Filters in Lightweight Bitcoin Clients"
>
>> We show analytically and empirically that the reliance on Bloom filters
>> within existing SPV clients leaks considerable information about the
>> addresses of Bitcoin users. Our results show that an SPV client who uses a
>> modest number of Bitcoin addresses (e.g., < 20) risks revealing almost all
>> of his addresses.
>
>
> https://eprint.iacr.org/2014/763.pdf
>
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev

From mark at friedenbach.org  Tue Jun 20 17:22:18 2017
From: mark at friedenbach.org (Mark Friedenbach)
Date: Tue, 20 Jun 2017 10:22:18 -0700
Subject: [bitcoin-dev] Miners forced to run non-core code in order to
 get segwit activated
In-Reply-To: <CAFMkqK_OtZ=S5LFqERCYwSQCkbxdnWJq+wN-YM3CVkKWJx2SBA@mail.gmail.com>
References: <CAJowKgLtu-HUDuakk4DDU53nyChbQk_zY=f5OO2j1Za95PdL7w@mail.gmail.com>
	<CAFMkqK_OtZ=S5LFqERCYwSQCkbxdnWJq+wN-YM3CVkKWJx2SBA@mail.gmail.com>
Message-ID: <CAOG=w-tp5w9Jr40v0ZmY26BPwG2Q0vycBtLj7pZ_qg67vVO3-w@mail.gmail.com>

I think it is very na?ve to assume that any shift would be temporary.
We have a hard enough time getting miners to proactively upgrade to
recent versions of the reference bitcoin daemon. If miners interpret
the situation as being forced to run non-reference software in order
to prevent a chain split because a lack of support from Bitcoin Core,
that could be a one-way street.

On Tue, Jun 20, 2017 at 9:49 AM, Hampus Sj?berg via bitcoin-dev
<bitcoin-dev at lists.linuxfoundation.org> wrote:
> I don't think it's a huge deal if the miners need to run a non-Core node
> once the BIP91 deployment of Segwit2x happens. The shift will most likely be
> temporary.
>
> I agree that the "-bip148"-option should be merged, though.
>
> 2017-06-20 17:44 GMT+02:00 Erik Aronesty via bitcoin-dev
> <bitcoin-dev at lists.linuxfoundation.org>:
>>
>> Are we going to merge BIP91 or a -BIP148 option to core for inclusion in
>> the next release or so?
>>
>> Because a large percentage of miners are indifferent, right now miners
>> have to choose between BIP148 and Segwit2x if they want to activate Segwit.
>>
>> Should we be forcing miners to choose to run non-core code in order to
>> activate a popular feature?
>>
>> - Erik
>>
>> _______________________________________________
>> bitcoin-dev mailing list
>> bitcoin-dev at lists.linuxfoundation.org
>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>
>
>
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>

From greg at xiph.org  Tue Jun 20 21:49:50 2017
From: greg at xiph.org (Gregory Maxwell)
Date: Tue, 20 Jun 2017 21:49:50 +0000
Subject: [bitcoin-dev] Miners forced to run non-core code in order to
 get segwit activated
In-Reply-To: <CAJowKgLtu-HUDuakk4DDU53nyChbQk_zY=f5OO2j1Za95PdL7w@mail.gmail.com>
References: <CAJowKgLtu-HUDuakk4DDU53nyChbQk_zY=f5OO2j1Za95PdL7w@mail.gmail.com>
Message-ID: <CAAS2fgSZ_X3G7j3-S6tAGPe2TOTT2umBB8a0RHpD-wAHN9aPgw@mail.gmail.com>

On Tue, Jun 20, 2017 at 3:44 PM, Erik Aronesty via bitcoin-dev
<bitcoin-dev at lists.linuxfoundation.org> wrote:
> Because a large percentage of miners are indifferent, right now miners have
> to choose between BIP148 and Segwit2x if they want to activate Segwit.

Miners can simply continuing signaling segwit, which will leave them
at least soft-fork compatible with BIP148 and BIP91 (and god knows
what "segwit2x" is since they keep changing the actual definition and
do not have a specification; but last I saw the near-term behavior the
same as BIP91 but with a radically reduced activation window, so the
story would be the same there in the near term).

Ironically, it looks like most of the segwit2x signaling miners are
faking it (because they're not signaling segwit which it requires).
It'll be unfortunate if some aren't faking it and start orphaning
their own blocks because they are failing to signal segwit.

I don't think the rejection of segwit2x from Bitcoin's developers
could be any more resolute than what we've already seen:
https://en.bitcoin.it/wiki/Segwit_support

On Tue, Jun 20, 2017 at 5:22 PM, Mark Friedenbach via bitcoin-dev
<bitcoin-dev at lists.linuxfoundation.org> wrote:
> I think it is very na?ve to assume that any shift would be temporary.
> We have a hard enough time getting miners to proactively upgrade to
> recent versions of the reference bitcoin daemon. If miners interpret
> the situation as being forced to run non-reference software in order
> to prevent a chain split because a lack of support from Bitcoin Core,
> that could be a one-way street.

I think this is somewhat naive and sounds a lot like the repeat of the
previously debunked "XT" and "Classic" hysteria.

There is a reason that segwit2x is pretty much unanimously rejected by
the technical community.  And just like with XT/Classic/Unlimited
you'll continue to see a strong correlation with people who are
unwilling and unable to keep updating the software at an acceptable
level of quality-- esp. because the very founding on their fork is
predicated on discarding those properties.

If miners want to go off and create an altcoin-- welp, thats something
they can always do,  and nothing about that will force anyone to go
along with it.

As far as prevent a chain split goes, all those things
(148/91/segwit2x(per today)) effectively guarantee a chainsplit-- so I
don't think that holds.

From rjmarti2 at millersville.edu  Tue Jun 20 19:49:57 2017
From: rjmarti2 at millersville.edu (Ryan J Martin)
Date: Tue, 20 Jun 2017 19:49:57 +0000
Subject: [bitcoin-dev] Miners forced to run non-core code in order to
 get segwit activated
Message-ID: <09fd0e96-6a9f-4f6c-bd50-ecdb0af34868@email.android.com>

I concur with Mark's reply. Just to underscore this: Miners arent going to bother to signaling or changing a setting unless they have to. Anything that requires time--especially if requiring a restart/any time not mining or risks a crash---reduces income. So why would they change any settings unless they have to?

-Ryan J. Martin


On Jun 20, 2017 1:26 PM, Mark Friedenbach via bitcoin-dev <bitcoin-dev at lists.linuxfoundation.org> wrote:
I think it is very na?ve to assume that any shift would be temporary.
We have a hard enough time getting miners to proactively upgrade to
recent versions of the reference bitcoin daemon. If miners interpret
the situation as being forced to run non-reference software in order
to prevent a chain split because a lack of support from Bitcoin Core,
that could be a one-way street.

On Tue, Jun 20, 2017 at 9:49 AM, Hampus Sj?berg via bitcoin-dev
<bitcoin-dev at lists.linuxfoundation.org> wrote:
> I don't think it's a huge deal if the miners need to run a non-Core node
> once the BIP91 deployment of Segwit2x happens. The shift will most likely be
> temporary.
>
> I agree that the "-bip148"-option should be merged, though.
>
> 2017-06-20 17:44 GMT+02:00 Erik Aronesty via bitcoin-dev
> <bitcoin-dev at lists.linuxfoundation.org>:
>>
>> Are we going to merge BIP91 or a -BIP148 option to core for inclusion in
>> the next release or so?
>>
>> Because a large percentage of miners are indifferent, right now miners
>> have to choose between BIP148 and Segwit2x if they want to activate Segwit.
>>
>> Should we be forcing miners to choose to run non-core code in order to
>> activate a popular feature?
>>
>> - Erik
>>
>> _______________________________________________
>> bitcoin-dev mailing list
>> bitcoin-dev at lists.linuxfoundation.org
>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>
>
>
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>
_______________________________________________
bitcoin-dev mailing list
bitcoin-dev at lists.linuxfoundation.org
https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170620/daf389f6/attachment-0001.html>

From hampus.sjoberg at gmail.com  Tue Jun 20 22:15:59 2017
From: hampus.sjoberg at gmail.com (=?UTF-8?Q?Hampus_Sj=C3=B6berg?=)
Date: Wed, 21 Jun 2017 00:15:59 +0200
Subject: [bitcoin-dev] Miners forced to run non-core code in order to
 get segwit activated
In-Reply-To: <CAAS2fgSZ_X3G7j3-S6tAGPe2TOTT2umBB8a0RHpD-wAHN9aPgw@mail.gmail.com>
References: <CAJowKgLtu-HUDuakk4DDU53nyChbQk_zY=f5OO2j1Za95PdL7w@mail.gmail.com>
	<CAAS2fgSZ_X3G7j3-S6tAGPe2TOTT2umBB8a0RHpD-wAHN9aPgw@mail.gmail.com>
Message-ID: <CAFMkqK_73RrpaS2oJQ-0o6oC29m6a1h411_P7HmVcAyX712Sgw@mail.gmail.com>

> Ironically, it looks like most of the segwit2x signaling miners are
> faking it (because they're not signaling segwit which it requires).
> It'll be unfortunate if some aren't faking it and start orphaning
> their own blocks because they are failing to signal segwit.

Well, they're doing some kind of "pre-signaling" in the coinbase at the
moment, because the segwit2x project is still in alpha-phase according to
the timeline. They're just showing commitment.
I'm sure they will begin signaling on version bit 4/BIP91 as well as
actually running a segwit2x node when the time comes.

> As far as prevent a chain split goes, all those things
> (148/91/segwit2x(per today)) effectively guarantee a chainsplit-- so I
> don't think that holds.

Segwit2x/BIP91/BIP148 will orphan miners that do not run a Segwit2x (or
BIP148) node, because they wouldn't have the new consensus rule of
requiring all blocks to signal for segwit.
I don't believe there would be any long lasting chainsplit though (because
of the ~80% hashrate support on segwit2x), perhaps 2-3 blocks if we get
unlucky.

Hampus

2017-06-20 23:49 GMT+02:00 Gregory Maxwell via bitcoin-dev <
bitcoin-dev at lists.linuxfoundation.org>:

> On Tue, Jun 20, 2017 at 3:44 PM, Erik Aronesty via bitcoin-dev
> <bitcoin-dev at lists.linuxfoundation.org> wrote:
> > Because a large percentage of miners are indifferent, right now miners
> have
> > to choose between BIP148 and Segwit2x if they want to activate Segwit.
>
> Miners can simply continuing signaling segwit, which will leave them
> at least soft-fork compatible with BIP148 and BIP91 (and god knows
> what "segwit2x" is since they keep changing the actual definition and
> do not have a specification; but last I saw the near-term behavior the
> same as BIP91 but with a radically reduced activation window, so the
> story would be the same there in the near term).
>
> Ironically, it looks like most of the segwit2x signaling miners are
> faking it (because they're not signaling segwit which it requires).
> It'll be unfortunate if some aren't faking it and start orphaning
> their own blocks because they are failing to signal segwit.
>
> I don't think the rejection of segwit2x from Bitcoin's developers
> could be any more resolute than what we've already seen:
> https://en.bitcoin.it/wiki/Segwit_support
>
> On Tue, Jun 20, 2017 at 5:22 PM, Mark Friedenbach via bitcoin-dev
> <bitcoin-dev at lists.linuxfoundation.org> wrote:
> > I think it is very na?ve to assume that any shift would be temporary.
> > We have a hard enough time getting miners to proactively upgrade to
> > recent versions of the reference bitcoin daemon. If miners interpret
> > the situation as being forced to run non-reference software in order
> > to prevent a chain split because a lack of support from Bitcoin Core,
> > that could be a one-way street.
>
> I think this is somewhat naive and sounds a lot like the repeat of the
> previously debunked "XT" and "Classic" hysteria.
>
> There is a reason that segwit2x is pretty much unanimously rejected by
> the technical community.  And just like with XT/Classic/Unlimited
> you'll continue to see a strong correlation with people who are
> unwilling and unable to keep updating the software at an acceptable
> level of quality-- esp. because the very founding on their fork is
> predicated on discarding those properties.
>
> If miners want to go off and create an altcoin-- welp, thats something
> they can always do,  and nothing about that will force anyone to go
> along with it.
>
> As far as prevent a chain split goes, all those things
> (148/91/segwit2x(per today)) effectively guarantee a chainsplit-- so I
> don't think that holds.
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170621/0d0761cf/attachment.html>

From bitdev at theochino.com  Tue Jun 20 22:13:06 2017
From: bitdev at theochino.com (Theo Chino)
Date: Tue, 20 Jun 2017 18:13:06 -0400
Subject: [bitcoin-dev] Fwd:  Proposal to add the bitcoin symbol to Unicode
In-Reply-To: <CAFh0iXOtc6H-NdP+D_tkizvqG0xWaYy-PGBuu2VTXPdX2O83qQ@mail.gmail.com>
References: <CALBHtZzHeDy-6Ar+DWUb8hFG4kJcg9+x4Y=TUEiQr3-rbgannw@mail.gmail.com>
	<CAJN5wHV=o0_tdsKg1DwhwKcD4_uNffETYDb+Rzuy66hdoFybtw@mail.gmail.com>
	<CALBHtZzjJrhg-uEBBRdVapEpyQWdoRUt+dj1sHxD+VrA2ESs4Q@mail.gmail.com>
	<CAFh0iXOtc6H-NdP+D_tkizvqG0xWaYy-PGBuu2VTXPdX2O83qQ@mail.gmail.com>
Message-ID: <CAFh0iXMm5roHLyib7Qk29jJQOtKj_jaXrHSnD3zx9Gcu7qHidQ@mail.gmail.com>

Ken and team,

Took some time but here it is ! *Bravo !*

And as usual reporter make up the shit they want ... Feel free to remind
them that we had a working group and we worked on it.
https://www.theverge.com/2017/6/20/15840008/new-emoji-
unicode-consortium-version-10-bitcoin-symbol

The "Could be" is a bit too much. It's time we keep reporter in check so
feel free to remind her in your own way.
My way is "pissed off tweet", https://twitter.com/TheoBitcoin/status/
877277497796198400 but used your own way.

A page is officially turned.

Regards,
Theo

On Tue, Sep 8, 2015 at 5:05 PM, Ken Shirriff via bitcoin-dev <
bitcoin-dev at lists.linuxfoundation.org> wrote:

>
>
> On Tue, Sep 8, 2015 at 1:28 PM, Danny Thorpe <danny.thorpe at gmail.com>
> wrote:
>
>> What of this prior effort, proposing B-with-horizontal-bar (?)?
>> http://bitcoinsymbol.org/
>>
>> They argue that B-with-2-vertical-bars is easily confused with the Thai
>> Bhat currency symbol, which is a B with a single vertical bar.
>>
>
> Actually that page argues that using the Thai Bhat currency symbol *for*
> Bitcoin causes confusion. From the page you linked to:
>
> The Thai Baht (? <https://en.wikipedia.org/wiki/Thai_baht>) is sometimes
> used to represent Bitcoin, but this certainly raises a problem of
> differenciation between the Thai Baht and Bitcoin.
>
> Their main motivation for using the horizontal-bar ? (which they admit is
> a hack) is they consider adding a character to Unicode to be a "really long
> and complicated process". My view is that adding the bitcoin sign to
> Unicode avoids confusion with the Thai Baht, avoids hacks such as ?, and
> lets everyone use the standard symbol. Hopefully it won't be a really long
> and complicated process...
>
> Ken
>
>
>> I'm not terribly fond of the B-with-horizontal-bar as a symbol, but it
>> does have the advantage that it is already in the Unicode glyph set,
>> already available on most Unicode enabled devices.
>>
>> -Danny
>>
>> On Sat, Sep 5, 2015 at 7:11 AM, Ken Shirriff via bitcoin-dev <
>> bitcoin-dev at lists.linuxfoundation.org> wrote:
>>
>>> Use of the bitcoin symbol in text is inconvenient, because the bitcoin
>>> symbol isn't in the Unicode standard. To fix this, I've written a proposal
>>> to have the common B-with-vertical-bars bitcoin symbol added to Unicode.
>>> I've successfully proposed a new character for Unicode before, so I'm
>>> familiar with the process and think this has a good chance of succeeding.
>>> The proposal is at http://righto.com/bitcoin-unicode.pdf
>>>
>>> I received a suggestion to run this proposal by the bitcoin-dev group,
>>> so I hope this email is appropriate here. Endorsement by Bitcoin developers
>>> will help the Unicode Committee realize the importance of adding this
>>> symbol, so please let me know if you support this proposal.
>>>
>>> Thanks,
>>> Ken
>>>
>>>
>>>
>>> _______________________________________________
>>> bitcoin-dev mailing list
>>> bitcoin-dev at lists.linuxfoundation.org
>>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>>
>>>
>>
>
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170620/00ca3db9/attachment.html>

From jacob.eliosoff at gmail.com  Tue Jun 20 22:29:27 2017
From: jacob.eliosoff at gmail.com (Jacob Eliosoff)
Date: Tue, 20 Jun 2017 18:29:27 -0400
Subject: [bitcoin-dev] Miners forced to run non-core code in order to
 get segwit activated
In-Reply-To: <CAFMkqK_73RrpaS2oJQ-0o6oC29m6a1h411_P7HmVcAyX712Sgw@mail.gmail.com>
References: <CAJowKgLtu-HUDuakk4DDU53nyChbQk_zY=f5OO2j1Za95PdL7w@mail.gmail.com>
	<CAAS2fgSZ_X3G7j3-S6tAGPe2TOTT2umBB8a0RHpD-wAHN9aPgw@mail.gmail.com>
	<CAFMkqK_73RrpaS2oJQ-0o6oC29m6a1h411_P7HmVcAyX712Sgw@mail.gmail.com>
Message-ID: <CAAUaCyg2Nmsa2UaO2msBqSFeHLetUUN+cTETvSSmB7c=nH9ZhQ@mail.gmail.com>

If segwit is activated before Aug 1, as now seems likely, there will be no
split that day.  But if activation is via Segwit2x (also likely), and at
least some nodes do & some don't follow through with the HF 3mo later
(again, likely), agreed w/ Greg that *then* we'll see a split - probably in
Sep/Oct.  How those two chains will match up and how the split will play
out is anyone's guess...



On Jun 20, 2017 6:16 PM, "Hampus Sj?berg via bitcoin-dev" <
bitcoin-dev at lists.linuxfoundation.org> wrote:

> Ironically, it looks like most of the segwit2x signaling miners are
> faking it (because they're not signaling segwit which it requires).
> It'll be unfortunate if some aren't faking it and start orphaning
> their own blocks because they are failing to signal segwit.

Well, they're doing some kind of "pre-signaling" in the coinbase at the
moment, because the segwit2x project is still in alpha-phase according to
the timeline. They're just showing commitment.
I'm sure they will begin signaling on version bit 4/BIP91 as well as
actually running a segwit2x node when the time comes.


> As far as prevent a chain split goes, all those things
> (148/91/segwit2x(per today)) effectively guarantee a chainsplit-- so I
> don't think that holds.

Segwit2x/BIP91/BIP148 will orphan miners that do not run a Segwit2x (or
BIP148) node, because they wouldn't have the new consensus rule of
requiring all blocks to signal for segwit.
I don't believe there would be any long lasting chainsplit though (because
of the ~80% hashrate support on segwit2x), perhaps 2-3 blocks if we get
unlucky.

Hampus

2017-06-20 23:49 GMT+02:00 Gregory Maxwell via bitcoin-dev <
bitcoin-dev at lists.linuxfoundation.org>:

> On Tue, Jun 20, 2017 at 3:44 PM, Erik Aronesty via bitcoin-dev
> <bitcoin-dev at lists.linuxfoundation.org> wrote:
> > Because a large percentage of miners are indifferent, right now miners
> have
> > to choose between BIP148 and Segwit2x if they want to activate Segwit.
>
> Miners can simply continuing signaling segwit, which will leave them
> at least soft-fork compatible with BIP148 and BIP91 (and god knows
> what "segwit2x" is since they keep changing the actual definition and
> do not have a specification; but last I saw the near-term behavior the
> same as BIP91 but with a radically reduced activation window, so the
> story would be the same there in the near term).
>
> Ironically, it looks like most of the segwit2x signaling miners are
> faking it (because they're not signaling segwit which it requires).
> It'll be unfortunate if some aren't faking it and start orphaning
> their own blocks because they are failing to signal segwit.
>
> I don't think the rejection of segwit2x from Bitcoin's developers
> could be any more resolute than what we've already seen:
> https://en.bitcoin.it/wiki/Segwit_support
>
> On Tue, Jun 20, 2017 at 5:22 PM, Mark Friedenbach via bitcoin-dev
> <bitcoin-dev at lists.linuxfoundation.org> wrote:
> > I think it is very na?ve to assume that any shift would be temporary.
> > We have a hard enough time getting miners to proactively upgrade to
> > recent versions of the reference bitcoin daemon. If miners interpret
> > the situation as being forced to run non-reference software in order
> > to prevent a chain split because a lack of support from Bitcoin Core,
> > that could be a one-way street.
>
> I think this is somewhat naive and sounds a lot like the repeat of the
> previously debunked "XT" and "Classic" hysteria.
>
> There is a reason that segwit2x is pretty much unanimously rejected by
> the technical community.  And just like with XT/Classic/Unlimited
> you'll continue to see a strong correlation with people who are
> unwilling and unable to keep updating the software at an acceptable
> level of quality-- esp. because the very founding on their fork is
> predicated on discarding those properties.
>
> If miners want to go off and create an altcoin-- welp, thats something
> they can always do,  and nothing about that will force anyone to go
> along with it.
>
> As far as prevent a chain split goes, all those things
> (148/91/segwit2x(per today)) effectively guarantee a chainsplit-- so I
> don't think that holds.
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>


_______________________________________________
bitcoin-dev mailing list
bitcoin-dev at lists.linuxfoundation.org
https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170620/dfa5b469/attachment-0001.html>

From greg at xiph.org  Tue Jun 20 22:34:29 2017
From: greg at xiph.org (Gregory Maxwell)
Date: Tue, 20 Jun 2017 22:34:29 +0000
Subject: [bitcoin-dev] Miners forced to run non-core code in order to
 get segwit activated
In-Reply-To: <CAFMkqK_73RrpaS2oJQ-0o6oC29m6a1h411_P7HmVcAyX712Sgw@mail.gmail.com>
References: <CAJowKgLtu-HUDuakk4DDU53nyChbQk_zY=f5OO2j1Za95PdL7w@mail.gmail.com>
	<CAAS2fgSZ_X3G7j3-S6tAGPe2TOTT2umBB8a0RHpD-wAHN9aPgw@mail.gmail.com>
	<CAFMkqK_73RrpaS2oJQ-0o6oC29m6a1h411_P7HmVcAyX712Sgw@mail.gmail.com>
Message-ID: <CAAS2fgQKrFCTL-=qREOjNrwjDqhgdPZQUSgpXHUKyG4+NAo26g@mail.gmail.com>

On Tue, Jun 20, 2017 at 10:15 PM, Hampus Sj?berg
<hampus.sjoberg at gmail.com> wrote:
> Segwit2x/BIP91/BIP148 will orphan miners that do not run a Segwit2x (or
> BIP148) node, because they wouldn't have the new consensus rule of requiring
> all blocks to signal for segwit.

All versions of Bitcoin Core since 0.13.1 signal segwit, 0.14.1+ even
when downstream mining software doesn't support it.

I think it would be useful for there to exist a useful and trivial
patch against current (0.14.2) software to engage in the BIP91-like
orphaning, like people have provided for BIP148-- but right now I
don't see any specification of the behavior so it's unclear to me
_exactly_ what it would need to implement to be consistent.

From hampus.sjoberg at gmail.com  Tue Jun 20 22:53:29 2017
From: hampus.sjoberg at gmail.com (=?UTF-8?Q?Hampus_Sj=C3=B6berg?=)
Date: Wed, 21 Jun 2017 00:53:29 +0200
Subject: [bitcoin-dev] Miners forced to run non-core code in order to
 get segwit activated
In-Reply-To: <CAAS2fgQKrFCTL-=qREOjNrwjDqhgdPZQUSgpXHUKyG4+NAo26g@mail.gmail.com>
References: <CAJowKgLtu-HUDuakk4DDU53nyChbQk_zY=f5OO2j1Za95PdL7w@mail.gmail.com>
	<CAAS2fgSZ_X3G7j3-S6tAGPe2TOTT2umBB8a0RHpD-wAHN9aPgw@mail.gmail.com>
	<CAFMkqK_73RrpaS2oJQ-0o6oC29m6a1h411_P7HmVcAyX712Sgw@mail.gmail.com>
	<CAAS2fgQKrFCTL-=qREOjNrwjDqhgdPZQUSgpXHUKyG4+NAo26g@mail.gmail.com>
Message-ID: <CAFMkqK-4P1=3_SujjTJDgusyBeHX3rB82ekkv9uNGu7P+9yuyQ@mail.gmail.com>

> I think it would be useful for there to exist a useful and trivial
> patch against current (0.14.2) software to engage in the BIP91-like
> orphaning, like people have provided for BIP148-- but right now I
> don't see any specification of the behavior so it's unclear to me
> _exactly_ what it would need to implement to be consistent.

I agree.
This is the latest code regarding BIP91 that got merged,
https://github.com/btc1/bitcoin/pull/21/files so that should be the spec we
need to follow (also the old BIP91 PR:
https://github.com/btc1/bitcoin/pull/17/files).
Perhaps James Hilliard could give input here though.


2017-06-21 0:34 GMT+02:00 Gregory Maxwell <greg at xiph.org>:

> On Tue, Jun 20, 2017 at 10:15 PM, Hampus Sj?berg
> <hampus.sjoberg at gmail.com> wrote:
> > Segwit2x/BIP91/BIP148 will orphan miners that do not run a Segwit2x (or
> > BIP148) node, because they wouldn't have the new consensus rule of
> requiring
> > all blocks to signal for segwit.
>
> All versions of Bitcoin Core since 0.13.1 signal segwit, 0.14.1+ even
> when downstream mining software doesn't support it.
>
> I think it would be useful for there to exist a useful and trivial
> patch against current (0.14.2) software to engage in the BIP91-like
> orphaning, like people have provided for BIP148-- but right now I
> don't see any specification of the behavior so it's unclear to me
> _exactly_ what it would need to implement to be consistent.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170621/d51a368b/attachment.html>

From mark at friedenbach.org  Tue Jun 20 22:48:23 2017
From: mark at friedenbach.org (Mark Friedenbach)
Date: Tue, 20 Jun 2017 15:48:23 -0700
Subject: [bitcoin-dev] Miners forced to run non-core code in order to
	get segwit activated
In-Reply-To: <CAAUaCyg2Nmsa2UaO2msBqSFeHLetUUN+cTETvSSmB7c=nH9ZhQ@mail.gmail.com>
References: <CAJowKgLtu-HUDuakk4DDU53nyChbQk_zY=f5OO2j1Za95PdL7w@mail.gmail.com>
	<CAAS2fgSZ_X3G7j3-S6tAGPe2TOTT2umBB8a0RHpD-wAHN9aPgw@mail.gmail.com>
	<CAFMkqK_73RrpaS2oJQ-0o6oC29m6a1h411_P7HmVcAyX712Sgw@mail.gmail.com>
	<CAAUaCyg2Nmsa2UaO2msBqSFeHLetUUN+cTETvSSmB7c=nH9ZhQ@mail.gmail.com>
Message-ID: <BC758648-BD4F-4DEF-8B79-7E8E0A887033@friedenbach.org>

Why do you say activation by August 1st is likely? That would require an entire difficulty adjustment period with >=95% bit1 signaling. That seems a tall order to organize in the scant few weeks remaining. 

> On Jun 20, 2017, at 3:29 PM, Jacob Eliosoff via bitcoin-dev <bitcoin-dev at lists.linuxfoundation.org> wrote:
> 
> If segwit is activated before Aug 1, as now seems likely, there will be no split that day.  But if activation is via Segwit2x (also likely), and at least some nodes do & some don't follow through with the HF 3mo later (again, likely), agreed w/ Greg that *then* we'll see a split - probably in Sep/Oct.  How those two chains will match up and how the split will play out is anyone's guess...
> 
> 
> 
> On Jun 20, 2017 6:16 PM, "Hampus Sj?berg via bitcoin-dev" <bitcoin-dev at lists.linuxfoundation.org> wrote:
> > Ironically, it looks like most of the segwit2x signaling miners are
> > faking it (because they're not signaling segwit which it requires).
> > It'll be unfortunate if some aren't faking it and start orphaning
> > their own blocks because they are failing to signal segwit.
> 
> Well, they're doing some kind of "pre-signaling" in the coinbase at the moment, because the segwit2x project is still in alpha-phase according to the timeline. They're just showing commitment.
> I'm sure they will begin signaling on version bit 4/BIP91 as well as actually running a segwit2x node when the time comes.
> 
> 
> > As far as prevent a chain split goes, all those things
> > (148/91/segwit2x(per today)) effectively guarantee a chainsplit-- so I
> > don't think that holds.
> 
> Segwit2x/BIP91/BIP148 will orphan miners that do not run a Segwit2x (or BIP148) node, because they wouldn't have the new consensus rule of requiring all blocks to signal for segwit.
> I don't believe there would be any long lasting chainsplit though (because of the ~80% hashrate support on segwit2x), perhaps 2-3 blocks if we get unlucky.
> 
> Hampus
> 
> 2017-06-20 23:49 GMT+02:00 Gregory Maxwell via bitcoin-dev <bitcoin-dev at lists.linuxfoundation.org>:
>> On Tue, Jun 20, 2017 at 3:44 PM, Erik Aronesty via bitcoin-dev
>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>> > Because a large percentage of miners are indifferent, right now miners have
>> > to choose between BIP148 and Segwit2x if they want to activate Segwit.
>> 
>> Miners can simply continuing signaling segwit, which will leave them
>> at least soft-fork compatible with BIP148 and BIP91 (and god knows
>> what "segwit2x" is since they keep changing the actual definition and
>> do not have a specification; but last I saw the near-term behavior the
>> same as BIP91 but with a radically reduced activation window, so the
>> story would be the same there in the near term).
>> 
>> Ironically, it looks like most of the segwit2x signaling miners are
>> faking it (because they're not signaling segwit which it requires).
>> It'll be unfortunate if some aren't faking it and start orphaning
>> their own blocks because they are failing to signal segwit.
>> 
>> I don't think the rejection of segwit2x from Bitcoin's developers
>> could be any more resolute than what we've already seen:
>> https://en.bitcoin.it/wiki/Segwit_support
>> 
>> On Tue, Jun 20, 2017 at 5:22 PM, Mark Friedenbach via bitcoin-dev
>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>> > I think it is very na?ve to assume that any shift would be temporary.
>> > We have a hard enough time getting miners to proactively upgrade to
>> > recent versions of the reference bitcoin daemon. If miners interpret
>> > the situation as being forced to run non-reference software in order
>> > to prevent a chain split because a lack of support from Bitcoin Core,
>> > that could be a one-way street.
>> 
>> I think this is somewhat naive and sounds a lot like the repeat of the
>> previously debunked "XT" and "Classic" hysteria.
>> 
>> There is a reason that segwit2x is pretty much unanimously rejected by
>> the technical community.  And just like with XT/Classic/Unlimited
>> you'll continue to see a strong correlation with people who are
>> unwilling and unable to keep updating the software at an acceptable
>> level of quality-- esp. because the very founding on their fork is
>> predicated on discarding those properties.
>> 
>> If miners want to go off and create an altcoin-- welp, thats something
>> they can always do,  and nothing about that will force anyone to go
>> along with it.
>> 
>> As far as prevent a chain split goes, all those things
>> (148/91/segwit2x(per today)) effectively guarantee a chainsplit-- so I
>> don't think that holds.
>> _______________________________________________
>> bitcoin-dev mailing list
>> bitcoin-dev at lists.linuxfoundation.org
>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
> 
> 
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
> 
> 
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170620/607ef338/attachment-0001.html>

From jacob.eliosoff at gmail.com  Tue Jun 20 22:57:34 2017
From: jacob.eliosoff at gmail.com (Jacob Eliosoff)
Date: Tue, 20 Jun 2017 18:57:34 -0400
Subject: [bitcoin-dev] Miners forced to run non-core code in order to
 get segwit activated
In-Reply-To: <BC758648-BD4F-4DEF-8B79-7E8E0A887033@friedenbach.org>
References: <CAJowKgLtu-HUDuakk4DDU53nyChbQk_zY=f5OO2j1Za95PdL7w@mail.gmail.com>
	<CAAS2fgSZ_X3G7j3-S6tAGPe2TOTT2umBB8a0RHpD-wAHN9aPgw@mail.gmail.com>
	<CAFMkqK_73RrpaS2oJQ-0o6oC29m6a1h411_P7HmVcAyX712Sgw@mail.gmail.com>
	<CAAUaCyg2Nmsa2UaO2msBqSFeHLetUUN+cTETvSSmB7c=nH9ZhQ@mail.gmail.com>
	<BC758648-BD4F-4DEF-8B79-7E8E0A887033@friedenbach.org>
Message-ID: <CAAUaCyh+4m+t9d4yOoEOf6VUDyJ=sUpDT3hD3cDmd9dcBQZ+nw@mail.gmail.com>

I could be wrong, but the latest BIP91 implementation (also included in
Segwit2x) cuts the activation period to 336 blocks (2.33 days).  (This has
been updated at
https://github.com/bitcoin/bips/blob/master/bip-0091.mediawiki.)  So if 80%
of hashpower is actually running that code and signaling on bit 4 by July
25 or so, then those 80+% will start orphaning non-bit-1 blocks before Aug
1, and we avoid a split.

There may still be a few non-bit-1 blocks that get orphaned after Aug 1,
because they're mined by old BIP141 nodes.  But it seems like very few
miners won't be signaling either Segwit2x *or* BIP141 by then...

Make sense?


On Tue, Jun 20, 2017 at 6:48 PM, Mark Friedenbach <mark at friedenbach.org>
wrote:

> Why do you say activation by August 1st is likely? That would require an
> entire difficulty adjustment period with >=95% bit1 signaling. That seems a
> tall order to organize in the scant few weeks remaining.
>
> On Jun 20, 2017, at 3:29 PM, Jacob Eliosoff via bitcoin-dev <
> bitcoin-dev at lists.linuxfoundation.org> wrote:
>
> If segwit is activated before Aug 1, as now seems likely, there will be no
> split that day.  But if activation is via Segwit2x (also likely), and at
> least some nodes do & some don't follow through with the HF 3mo later
> (again, likely), agreed w/ Greg that *then* we'll see a split - probably in
> Sep/Oct.  How those two chains will match up and how the split will play
> out is anyone's guess...
>
>
>
> On Jun 20, 2017 6:16 PM, "Hampus Sj?berg via bitcoin-dev" <
> bitcoin-dev at lists.linuxfoundation.org> wrote:
>
> > Ironically, it looks like most of the segwit2x signaling miners are
> > faking it (because they're not signaling segwit which it requires).
> > It'll be unfortunate if some aren't faking it and start orphaning
> > their own blocks because they are failing to signal segwit.
>
> Well, they're doing some kind of "pre-signaling" in the coinbase at the
> moment, because the segwit2x project is still in alpha-phase according to
> the timeline. They're just showing commitment.
> I'm sure they will begin signaling on version bit 4/BIP91 as well as
> actually running a segwit2x node when the time comes.
>
>
> > As far as prevent a chain split goes, all those things
> > (148/91/segwit2x(per today)) effectively guarantee a chainsplit-- so I
> > don't think that holds.
>
> Segwit2x/BIP91/BIP148 will orphan miners that do not run a Segwit2x (or
> BIP148) node, because they wouldn't have the new consensus rule of
> requiring all blocks to signal for segwit.
> I don't believe there would be any long lasting chainsplit though (because
> of the ~80% hashrate support on segwit2x), perhaps 2-3 blocks if we get
> unlucky.
>
> Hampus
>
> 2017-06-20 23:49 GMT+02:00 Gregory Maxwell via bitcoin-dev <
> bitcoin-dev at lists.linuxfoundation.org>:
>
>> On Tue, Jun 20, 2017 at 3:44 PM, Erik Aronesty via bitcoin-dev
>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>> > Because a large percentage of miners are indifferent, right now miners
>> have
>> > to choose between BIP148 and Segwit2x if they want to activate Segwit.
>>
>> Miners can simply continuing signaling segwit, which will leave them
>> at least soft-fork compatible with BIP148 and BIP91 (and god knows
>> what "segwit2x" is since they keep changing the actual definition and
>> do not have a specification; but last I saw the near-term behavior the
>> same as BIP91 but with a radically reduced activation window, so the
>> story would be the same there in the near term).
>>
>> Ironically, it looks like most of the segwit2x signaling miners are
>> faking it (because they're not signaling segwit which it requires).
>> It'll be unfortunate if some aren't faking it and start orphaning
>> their own blocks because they are failing to signal segwit.
>>
>> I don't think the rejection of segwit2x from Bitcoin's developers
>> could be any more resolute than what we've already seen:
>> https://en.bitcoin.it/wiki/Segwit_support
>>
>> On Tue, Jun 20, 2017 at 5:22 PM, Mark Friedenbach via bitcoin-dev
>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>> > I think it is very na?ve to assume that any shift would be temporary.
>> > We have a hard enough time getting miners to proactively upgrade to
>> > recent versions of the reference bitcoin daemon. If miners interpret
>> > the situation as being forced to run non-reference software in order
>> > to prevent a chain split because a lack of support from Bitcoin Core,
>> > that could be a one-way street.
>>
>> I think this is somewhat naive and sounds a lot like the repeat of the
>> previously debunked "XT" and "Classic" hysteria.
>>
>> There is a reason that segwit2x is pretty much unanimously rejected by
>> the technical community.  And just like with XT/Classic/Unlimited
>> you'll continue to see a strong correlation with people who are
>> unwilling and unable to keep updating the software at an acceptable
>> level of quality-- esp. because the very founding on their fork is
>> predicated on discarding those properties.
>>
>> If miners want to go off and create an altcoin-- welp, thats something
>> they can always do,  and nothing about that will force anyone to go
>> along with it.
>>
>> As far as prevent a chain split goes, all those things
>> (148/91/segwit2x(per today)) effectively guarantee a chainsplit-- so I
>> don't think that holds.
>> _______________________________________________
>> bitcoin-dev mailing list
>> bitcoin-dev at lists.linuxfoundation.org
>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>
>
>
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>
>
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170620/a7a99037/attachment-0001.html>

From jacob.eliosoff at gmail.com  Tue Jun 20 23:01:14 2017
From: jacob.eliosoff at gmail.com (Jacob Eliosoff)
Date: Tue, 20 Jun 2017 19:01:14 -0400
Subject: [bitcoin-dev] Miners forced to run non-core code in order to
 get segwit activated
In-Reply-To: <CAAUaCyh+4m+t9d4yOoEOf6VUDyJ=sUpDT3hD3cDmd9dcBQZ+nw@mail.gmail.com>
References: <CAJowKgLtu-HUDuakk4DDU53nyChbQk_zY=f5OO2j1Za95PdL7w@mail.gmail.com>
	<CAAS2fgSZ_X3G7j3-S6tAGPe2TOTT2umBB8a0RHpD-wAHN9aPgw@mail.gmail.com>
	<CAFMkqK_73RrpaS2oJQ-0o6oC29m6a1h411_P7HmVcAyX712Sgw@mail.gmail.com>
	<CAAUaCyg2Nmsa2UaO2msBqSFeHLetUUN+cTETvSSmB7c=nH9ZhQ@mail.gmail.com>
	<BC758648-BD4F-4DEF-8B79-7E8E0A887033@friedenbach.org>
	<CAAUaCyh+4m+t9d4yOoEOf6VUDyJ=sUpDT3hD3cDmd9dcBQZ+nw@mail.gmail.com>
Message-ID: <CAAUaCyiDhHtn0rHt6D+gLqe_-UArUwBzomOdYXp4MnkqVFgfgw@mail.gmail.com>

(That is: "...because they're mined by old non-Segwit2x nodes that *aren't
signaling bit 1 support*", ie, that support neither Segwit2x nor old segwit)


On Tue, Jun 20, 2017 at 6:57 PM, Jacob Eliosoff <jacob.eliosoff at gmail.com>
wrote:

> I could be wrong, but the latest BIP91 implementation (also included in
> Segwit2x) cuts the activation period to 336 blocks (2.33 days).  (This has
> been updated at https://github.com/bitcoin/bips/blob/master/bip-0091.
> mediawiki.)  So if 80% of hashpower is actually running that code and
> signaling on bit 4 by July 25 or so, then those 80+% will start orphaning
> non-bit-1 blocks before Aug 1, and we avoid a split.
>
> There may still be a few non-bit-1 blocks that get orphaned after Aug 1,
> because they're mined by old BIP141 nodes.  But it seems like very few
> miners won't be signaling either Segwit2x *or* BIP141 by then...
>
> Make sense?
>
>
> On Tue, Jun 20, 2017 at 6:48 PM, Mark Friedenbach <mark at friedenbach.org>
> wrote:
>
>> Why do you say activation by August 1st is likely? That would require an
>> entire difficulty adjustment period with >=95% bit1 signaling. That seems a
>> tall order to organize in the scant few weeks remaining.
>>
>> On Jun 20, 2017, at 3:29 PM, Jacob Eliosoff via bitcoin-dev <
>> bitcoin-dev at lists.linuxfoundation.org> wrote:
>>
>> If segwit is activated before Aug 1, as now seems likely, there will be
>> no split that day.  But if activation is via Segwit2x (also likely), and at
>> least some nodes do & some don't follow through with the HF 3mo later
>> (again, likely), agreed w/ Greg that *then* we'll see a split - probably in
>> Sep/Oct.  How those two chains will match up and how the split will play
>> out is anyone's guess...
>>
>>
>>
>> On Jun 20, 2017 6:16 PM, "Hampus Sj?berg via bitcoin-dev" <
>> bitcoin-dev at lists.linuxfoundation.org> wrote:
>>
>> > Ironically, it looks like most of the segwit2x signaling miners are
>> > faking it (because they're not signaling segwit which it requires).
>> > It'll be unfortunate if some aren't faking it and start orphaning
>> > their own blocks because they are failing to signal segwit.
>>
>> Well, they're doing some kind of "pre-signaling" in the coinbase at the
>> moment, because the segwit2x project is still in alpha-phase according to
>> the timeline. They're just showing commitment.
>> I'm sure they will begin signaling on version bit 4/BIP91 as well as
>> actually running a segwit2x node when the time comes.
>>
>>
>> > As far as prevent a chain split goes, all those things
>> > (148/91/segwit2x(per today)) effectively guarantee a chainsplit-- so I
>> > don't think that holds.
>>
>> Segwit2x/BIP91/BIP148 will orphan miners that do not run a Segwit2x (or
>> BIP148) node, because they wouldn't have the new consensus rule of
>> requiring all blocks to signal for segwit.
>> I don't believe there would be any long lasting chainsplit though
>> (because of the ~80% hashrate support on segwit2x), perhaps 2-3 blocks if
>> we get unlucky.
>>
>> Hampus
>>
>> 2017-06-20 23:49 GMT+02:00 Gregory Maxwell via bitcoin-dev <
>> bitcoin-dev at lists.linuxfoundation.org>:
>>
>>> On Tue, Jun 20, 2017 at 3:44 PM, Erik Aronesty via bitcoin-dev
>>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>> > Because a large percentage of miners are indifferent, right now miners
>>> have
>>> > to choose between BIP148 and Segwit2x if they want to activate Segwit.
>>>
>>> Miners can simply continuing signaling segwit, which will leave them
>>> at least soft-fork compatible with BIP148 and BIP91 (and god knows
>>> what "segwit2x" is since they keep changing the actual definition and
>>> do not have a specification; but last I saw the near-term behavior the
>>> same as BIP91 but with a radically reduced activation window, so the
>>> story would be the same there in the near term).
>>>
>>> Ironically, it looks like most of the segwit2x signaling miners are
>>> faking it (because they're not signaling segwit which it requires).
>>> It'll be unfortunate if some aren't faking it and start orphaning
>>> their own blocks because they are failing to signal segwit.
>>>
>>> I don't think the rejection of segwit2x from Bitcoin's developers
>>> could be any more resolute than what we've already seen:
>>> https://en.bitcoin.it/wiki/Segwit_support
>>>
>>> On Tue, Jun 20, 2017 at 5:22 PM, Mark Friedenbach via bitcoin-dev
>>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>> > I think it is very na?ve to assume that any shift would be temporary.
>>> > We have a hard enough time getting miners to proactively upgrade to
>>> > recent versions of the reference bitcoin daemon. If miners interpret
>>> > the situation as being forced to run non-reference software in order
>>> > to prevent a chain split because a lack of support from Bitcoin Core,
>>> > that could be a one-way street.
>>>
>>> I think this is somewhat naive and sounds a lot like the repeat of the
>>> previously debunked "XT" and "Classic" hysteria.
>>>
>>> There is a reason that segwit2x is pretty much unanimously rejected by
>>> the technical community.  And just like with XT/Classic/Unlimited
>>> you'll continue to see a strong correlation with people who are
>>> unwilling and unable to keep updating the software at an acceptable
>>> level of quality-- esp. because the very founding on their fork is
>>> predicated on discarding those properties.
>>>
>>> If miners want to go off and create an altcoin-- welp, thats something
>>> they can always do,  and nothing about that will force anyone to go
>>> along with it.
>>>
>>> As far as prevent a chain split goes, all those things
>>> (148/91/segwit2x(per today)) effectively guarantee a chainsplit-- so I
>>> don't think that holds.
>>> _______________________________________________
>>> bitcoin-dev mailing list
>>> bitcoin-dev at lists.linuxfoundation.org
>>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>>
>>
>>
>> _______________________________________________
>> bitcoin-dev mailing list
>> bitcoin-dev at lists.linuxfoundation.org
>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>
>>
>> _______________________________________________
>> bitcoin-dev mailing list
>> bitcoin-dev at lists.linuxfoundation.org
>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170620/ee28dc3b/attachment.html>

From erik at q32.com  Wed Jun 21 01:36:49 2017
From: erik at q32.com (Erik Aronesty)
Date: Tue, 20 Jun 2017 21:36:49 -0400
Subject: [bitcoin-dev] Miners forced to run non-core code in order to
 get segwit activated
In-Reply-To: <CAAUaCyh+4m+t9d4yOoEOf6VUDyJ=sUpDT3hD3cDmd9dcBQZ+nw@mail.gmail.com>
References: <CAJowKgLtu-HUDuakk4DDU53nyChbQk_zY=f5OO2j1Za95PdL7w@mail.gmail.com>
	<CAAS2fgSZ_X3G7j3-S6tAGPe2TOTT2umBB8a0RHpD-wAHN9aPgw@mail.gmail.com>
	<CAFMkqK_73RrpaS2oJQ-0o6oC29m6a1h411_P7HmVcAyX712Sgw@mail.gmail.com>
	<CAAUaCyg2Nmsa2UaO2msBqSFeHLetUUN+cTETvSSmB7c=nH9ZhQ@mail.gmail.com>
	<BC758648-BD4F-4DEF-8B79-7E8E0A887033@friedenbach.org>
	<CAAUaCyh+4m+t9d4yOoEOf6VUDyJ=sUpDT3hD3cDmd9dcBQZ+nw@mail.gmail.com>
Message-ID: <CAJowKgJcp7d30LsrDZ5iR6-k9Ncz0N90pxs2GmJkuG1qYDG6GQ@mail.gmail.com>

# Jacob Eliosoff:

>  will start orphaning non-bit-1 blocks before Aug 1, and we avoid a
split.

Correct.  There are 2 short activation periods in BIP91 either of which
would avoid a split.

# Gregory Maxwell:

> unclear to me _exactly_ what it would need to implement to be consistent.

This is the relevant pull req to core:

https://github.com/bitcoin/bitcoin/pull/10444

Seems OK.  It's technically running now on testnet5.   I think it (or a
-bip148 option) should be merged as soon as feasible.

> previously debunked "XT" and "Classic" hysteria.

apples vs oranges, imo.   segwit is not a contentious feature.   the
"bundling" in segwit2x is, but that's not the issue here.   the issue is we
are indirectly requiring miners that strongly support segwit to install
consensus protocol changes outside of bitcoin's standard reference.   80%
of them have signaled they will do so.   these are uncharted waters.


On Tue, Jun 20, 2017 at 6:57 PM, Jacob Eliosoff via bitcoin-dev <
bitcoin-dev at lists.linuxfoundation.org> wrote:

> I could be wrong, but the latest BIP91 implementation (also included in
> Segwit2x) cuts the activation period to 336 blocks (2.33 days).  (This has
> been updated at https://github.com/bitcoin/bips/blob/master/bip-0091.
> mediawiki.)  So if 80% of hashpower is actually running that code and
> signaling on bit 4 by July 25 or so, then those 80+% will start orphaning
> non-bit-1 blocks before Aug 1, and we avoid a split.
>
> There may still be a few non-bit-1 blocks that get orphaned after Aug 1,
> because they're mined by old BIP141 nodes.  But it seems like very few
> miners won't be signaling either Segwit2x *or* BIP141 by then...
>
> Make sense?
>
>
> On Tue, Jun 20, 2017 at 6:48 PM, Mark Friedenbach <mark at friedenbach.org>
> wrote:
>
>> Why do you say activation by August 1st is likely? That would require an
>> entire difficulty adjustment period with >=95% bit1 signaling. That seems a
>> tall order to organize in the scant few weeks remaining.
>>
>> On Jun 20, 2017, at 3:29 PM, Jacob Eliosoff via bitcoin-dev <
>> bitcoin-dev at lists.linuxfoundation.org> wrote:
>>
>> If segwit is activated before Aug 1, as now seems likely, there will be
>> no split that day.  But if activation is via Segwit2x (also likely), and at
>> least some nodes do & some don't follow through with the HF 3mo later
>> (again, likely), agreed w/ Greg that *then* we'll see a split - probably in
>> Sep/Oct.  How those two chains will match up and how the split will play
>> out is anyone's guess...
>>
>>
>>
>> On Jun 20, 2017 6:16 PM, "Hampus Sj?berg via bitcoin-dev" <
>> bitcoin-dev at lists.linuxfoundation.org> wrote:
>>
>> > Ironically, it looks like most of the segwit2x signaling miners are
>> > faking it (because they're not signaling segwit which it requires).
>> > It'll be unfortunate if some aren't faking it and start orphaning
>> > their own blocks because they are failing to signal segwit.
>>
>> Well, they're doing some kind of "pre-signaling" in the coinbase at the
>> moment, because the segwit2x project is still in alpha-phase according to
>> the timeline. They're just showing commitment.
>> I'm sure they will begin signaling on version bit 4/BIP91 as well as
>> actually running a segwit2x node when the time comes.
>>
>>
>> > As far as prevent a chain split goes, all those things
>> > (148/91/segwit2x(per today)) effectively guarantee a chainsplit-- so I
>> > don't think that holds.
>>
>> Segwit2x/BIP91/BIP148 will orphan miners that do not run a Segwit2x (or
>> BIP148) node, because they wouldn't have the new consensus rule of
>> requiring all blocks to signal for segwit.
>> I don't believe there would be any long lasting chainsplit though
>> (because of the ~80% hashrate support on segwit2x), perhaps 2-3 blocks if
>> we get unlucky.
>>
>> Hampus
>>
>> 2017-06-20 23:49 GMT+02:00 Gregory Maxwell via bitcoin-dev <
>> bitcoin-dev at lists.linuxfoundation.org>:
>>
>>> On Tue, Jun 20, 2017 at 3:44 PM, Erik Aronesty via bitcoin-dev
>>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>> > Because a large percentage of miners are indifferent, right now miners
>>> have
>>> > to choose between BIP148 and Segwit2x if they want to activate Segwit.
>>>
>>> Miners can simply continuing signaling segwit, which will leave them
>>> at least soft-fork compatible with BIP148 and BIP91 (and god knows
>>> what "segwit2x" is since they keep changing the actual definition and
>>> do not have a specification; but last I saw the near-term behavior the
>>> same as BIP91 but with a radically reduced activation window, so the
>>> story would be the same there in the near term).
>>>
>>> Ironically, it looks like most of the segwit2x signaling miners are
>>> faking it (because they're not signaling segwit which it requires).
>>> It'll be unfortunate if some aren't faking it and start orphaning
>>> their own blocks because they are failing to signal segwit.
>>>
>>> I don't think the rejection of segwit2x from Bitcoin's developers
>>> could be any more resolute than what we've already seen:
>>> https://en.bitcoin.it/wiki/Segwit_support
>>>
>>> On Tue, Jun 20, 2017 at 5:22 PM, Mark Friedenbach via bitcoin-dev
>>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>> > I think it is very na?ve to assume that any shift would be temporary.
>>> > We have a hard enough time getting miners to proactively upgrade to
>>> > recent versions of the reference bitcoin daemon. If miners interpret
>>> > the situation as being forced to run non-reference software in order
>>> > to prevent a chain split because a lack of support from Bitcoin Core,
>>> > that could be a one-way street.
>>>
>>> I think this is somewhat naive and sounds a lot like the repeat of the
>>> previously debunked "XT" and "Classic" hysteria.
>>>
>>> There is a reason that segwit2x is pretty much unanimously rejected by
>>> the technical community.  And just like with XT/Classic/Unlimited
>>> you'll continue to see a strong correlation with people who are
>>> unwilling and unable to keep updating the software at an acceptable
>>> level of quality-- esp. because the very founding on their fork is
>>> predicated on discarding those properties.
>>>
>>> If miners want to go off and create an altcoin-- welp, thats something
>>> they can always do,  and nothing about that will force anyone to go
>>> along with it.
>>>
>>> As far as prevent a chain split goes, all those things
>>> (148/91/segwit2x(per today)) effectively guarantee a chainsplit-- so I
>>> don't think that holds.
>>> _______________________________________________
>>> bitcoin-dev mailing list
>>> bitcoin-dev at lists.linuxfoundation.org
>>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>>
>>
>>
>> _______________________________________________
>> bitcoin-dev mailing list
>> bitcoin-dev at lists.linuxfoundation.org
>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>
>>
>> _______________________________________________
>> bitcoin-dev mailing list
>> bitcoin-dev at lists.linuxfoundation.org
>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>
>>
>
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170620/b23c5cf2/attachment-0001.html>

From mark at friedenbach.org  Wed Jun 21 02:11:15 2017
From: mark at friedenbach.org (Mark Friedenbach)
Date: Tue, 20 Jun 2017 19:11:15 -0700
Subject: [bitcoin-dev] Miners forced to run non-core code in order to
 get segwit activated
In-Reply-To: <CAJowKgJcp7d30LsrDZ5iR6-k9Ncz0N90pxs2GmJkuG1qYDG6GQ@mail.gmail.com>
References: <CAJowKgLtu-HUDuakk4DDU53nyChbQk_zY=f5OO2j1Za95PdL7w@mail.gmail.com>
	<CAAS2fgSZ_X3G7j3-S6tAGPe2TOTT2umBB8a0RHpD-wAHN9aPgw@mail.gmail.com>
	<CAFMkqK_73RrpaS2oJQ-0o6oC29m6a1h411_P7HmVcAyX712Sgw@mail.gmail.com>
	<CAAUaCyg2Nmsa2UaO2msBqSFeHLetUUN+cTETvSSmB7c=nH9ZhQ@mail.gmail.com>
	<BC758648-BD4F-4DEF-8B79-7E8E0A887033@friedenbach.org>
	<CAAUaCyh+4m+t9d4yOoEOf6VUDyJ=sUpDT3hD3cDmd9dcBQZ+nw@mail.gmail.com>
	<CAJowKgJcp7d30LsrDZ5iR6-k9Ncz0N90pxs2GmJkuG1qYDG6GQ@mail.gmail.com>
Message-ID: <CAOG=w-tPgJ5baaNiZC5rTs_y=eV7AU+F=aGaH+uObqaB-VgL2w@mail.gmail.com>

80% have set "NYA" in their coinbase string. We have no idea what that
means. People are equating it to BIP 91 -- but BIP 91 did not exist at
the time of the New York agreement, and differs from the actual text
of the NYA in substantive ways. The "Segwit2MB" that existed at the
time of the NYA, and which was explicitly referenced by the text is
the proposal by Sergio Demian Lerner that was made to this mailing
list on 31 March. The text of the NYA grants no authority for
upgrading this proposal while remaining compliant with the agreement.
This is without even considering the fact that in the days after the
NYA there was disagreement among those who signed it as to what it
meant.

I feel it is a very dangerous and unwarranted assumption people are
making that what we are seeing now is either 80% support for BIP-91 or
for the code in the btc1 repo.

On Tue, Jun 20, 2017 at 6:36 PM, Erik Aronesty <erik at q32.com> wrote:
> # Jacob Eliosoff:
>
>>  will start orphaning non-bit-1 blocks before Aug 1, and we avoid a split.
>
> Correct.  There are 2 short activation periods in BIP91 either of which
> would avoid a split.
>
> # Gregory Maxwell:
>
>> unclear to me _exactly_ what it would need to implement to be consistent.
>
> This is the relevant pull req to core:
>
> https://github.com/bitcoin/bitcoin/pull/10444
>
> Seems OK.  It's technically running now on testnet5.   I think it (or a
> -bip148 option) should be merged as soon as feasible.
>
>> previously debunked "XT" and "Classic" hysteria.
>
> apples vs oranges, imo.   segwit is not a contentious feature.   the
> "bundling" in segwit2x is, but that's not the issue here.   the issue is we
> are indirectly requiring miners that strongly support segwit to install
> consensus protocol changes outside of bitcoin's standard reference.   80% of
> them have signaled they will do so.   these are uncharted waters.
>
>
> On Tue, Jun 20, 2017 at 6:57 PM, Jacob Eliosoff via bitcoin-dev
> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>
>> I could be wrong, but the latest BIP91 implementation (also included in
>> Segwit2x) cuts the activation period to 336 blocks (2.33 days).  (This has
>> been updated at
>> https://github.com/bitcoin/bips/blob/master/bip-0091.mediawiki.)  So if 80%
>> of hashpower is actually running that code and signaling on bit 4 by July 25
>> or so, then those 80+% will start orphaning non-bit-1 blocks before Aug 1,
>> and we avoid a split.
>>
>> There may still be a few non-bit-1 blocks that get orphaned after Aug 1,
>> because they're mined by old BIP141 nodes.  But it seems like very few
>> miners won't be signaling either Segwit2x *or* BIP141 by then...
>>
>> Make sense?
>>
>>
>> On Tue, Jun 20, 2017 at 6:48 PM, Mark Friedenbach <mark at friedenbach.org>
>> wrote:
>>>
>>> Why do you say activation by August 1st is likely? That would require an
>>> entire difficulty adjustment period with >=95% bit1 signaling. That seems a
>>> tall order to organize in the scant few weeks remaining.
>>>
>>> On Jun 20, 2017, at 3:29 PM, Jacob Eliosoff via bitcoin-dev
>>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>>
>>> If segwit is activated before Aug 1, as now seems likely, there will be
>>> no split that day.  But if activation is via Segwit2x (also likely), and at
>>> least some nodes do & some don't follow through with the HF 3mo later
>>> (again, likely), agreed w/ Greg that *then* we'll see a split - probably in
>>> Sep/Oct.  How those two chains will match up and how the split will play out
>>> is anyone's guess...
>>>
>>>
>>>
>>> On Jun 20, 2017 6:16 PM, "Hampus Sj?berg via bitcoin-dev"
>>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>>
>>> > Ironically, it looks like most of the segwit2x signaling miners are
>>> > faking it (because they're not signaling segwit which it requires).
>>> > It'll be unfortunate if some aren't faking it and start orphaning
>>> > their own blocks because they are failing to signal segwit.
>>>
>>> Well, they're doing some kind of "pre-signaling" in the coinbase at the
>>> moment, because the segwit2x project is still in alpha-phase according to
>>> the timeline. They're just showing commitment.
>>> I'm sure they will begin signaling on version bit 4/BIP91 as well as
>>> actually running a segwit2x node when the time comes.
>>>
>>>
>>> > As far as prevent a chain split goes, all those things
>>> > (148/91/segwit2x(per today)) effectively guarantee a chainsplit-- so I
>>> > don't think that holds.
>>>
>>> Segwit2x/BIP91/BIP148 will orphan miners that do not run a Segwit2x (or
>>> BIP148) node, because they wouldn't have the new consensus rule of requiring
>>> all blocks to signal for segwit.
>>> I don't believe there would be any long lasting chainsplit though
>>> (because of the ~80% hashrate support on segwit2x), perhaps 2-3 blocks if we
>>> get unlucky.
>>>
>>> Hampus
>>>
>>> 2017-06-20 23:49 GMT+02:00 Gregory Maxwell via bitcoin-dev
>>> <bitcoin-dev at lists.linuxfoundation.org>:
>>>>
>>>> On Tue, Jun 20, 2017 at 3:44 PM, Erik Aronesty via bitcoin-dev
>>>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>>> > Because a large percentage of miners are indifferent, right now miners
>>>> > have
>>>> > to choose between BIP148 and Segwit2x if they want to activate Segwit.
>>>>
>>>> Miners can simply continuing signaling segwit, which will leave them
>>>> at least soft-fork compatible with BIP148 and BIP91 (and god knows
>>>> what "segwit2x" is since they keep changing the actual definition and
>>>> do not have a specification; but last I saw the near-term behavior the
>>>> same as BIP91 but with a radically reduced activation window, so the
>>>> story would be the same there in the near term).
>>>>
>>>> Ironically, it looks like most of the segwit2x signaling miners are
>>>> faking it (because they're not signaling segwit which it requires).
>>>> It'll be unfortunate if some aren't faking it and start orphaning
>>>> their own blocks because they are failing to signal segwit.
>>>>
>>>> I don't think the rejection of segwit2x from Bitcoin's developers
>>>> could be any more resolute than what we've already seen:
>>>> https://en.bitcoin.it/wiki/Segwit_support
>>>>
>>>> On Tue, Jun 20, 2017 at 5:22 PM, Mark Friedenbach via bitcoin-dev
>>>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>>> > I think it is very na?ve to assume that any shift would be temporary.
>>>> > We have a hard enough time getting miners to proactively upgrade to
>>>> > recent versions of the reference bitcoin daemon. If miners interpret
>>>> > the situation as being forced to run non-reference software in order
>>>> > to prevent a chain split because a lack of support from Bitcoin Core,
>>>> > that could be a one-way street.
>>>>
>>>> I think this is somewhat naive and sounds a lot like the repeat of the
>>>> previously debunked "XT" and "Classic" hysteria.
>>>>
>>>> There is a reason that segwit2x is pretty much unanimously rejected by
>>>> the technical community.  And just like with XT/Classic/Unlimited
>>>> you'll continue to see a strong correlation with people who are
>>>> unwilling and unable to keep updating the software at an acceptable
>>>> level of quality-- esp. because the very founding on their fork is
>>>> predicated on discarding those properties.
>>>>
>>>> If miners want to go off and create an altcoin-- welp, thats something
>>>> they can always do,  and nothing about that will force anyone to go
>>>> along with it.
>>>>
>>>> As far as prevent a chain split goes, all those things
>>>> (148/91/segwit2x(per today)) effectively guarantee a chainsplit-- so I
>>>> don't think that holds.
>>>> _______________________________________________
>>>> bitcoin-dev mailing list
>>>> bitcoin-dev at lists.linuxfoundation.org
>>>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>>
>>>
>>>
>>> _______________________________________________
>>> bitcoin-dev mailing list
>>> bitcoin-dev at lists.linuxfoundation.org
>>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>>
>>>
>>> _______________________________________________
>>> bitcoin-dev mailing list
>>> bitcoin-dev at lists.linuxfoundation.org
>>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>
>>
>>
>> _______________________________________________
>> bitcoin-dev mailing list
>> bitcoin-dev at lists.linuxfoundation.org
>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>
>

From erik.lite at gmail.com  Wed Jun 21 09:55:22 2017
From: erik.lite at gmail.com (Ilya Eriklintsev)
Date: Wed, 21 Jun 2017 12:55:22 +0300
Subject: [bitcoin-dev] BIP Idea : DDoS resistance via decentrilized
	proof-of-work
Message-ID: <CA+Yhp0Uv3zrg28G7QcgXPSv4Md9j2U-=SROJqWAOqvW_tCu=bQ@mail.gmail.com>

Hello everyone,

recently I have got an idea that in my opinion will improve bitcoin
network, making it better store-of-value for growing cyberspace and
cryptoeconomy. Sorry for longread below and thank you for your time.

*Decentralized proof-of-work and DDoS resistance for Bitcoin*

*Abstract*

By introducing some new block validation rules it is possible to make
Bitcoin network more secure, decentralized and DDoS resistant. The idea is
to modify simple proof-of-work puzzle in such a way that user transactions
could be hardened with the same proof-of-work algorithm thus incentivising
all the miners to include that particular transaction. Such mechanism will
effectively give a handicap to every miner who includes "mined" transaction
into next block, increasing probability of him getting block reward.

*Problems and motivation*

This document will address the issue of a continuous DDoS attack targeting
the Bitcoin network, e.g. full nodes mempools constantly being overflowed
with transactions carrying small value reduce system primary ability to
transfer value (and hence making it perfect store of value). Valid
transactions are cheap to create (in the sense of computational effort
required) and no adequate mechanism exist to make transaction total value
increase probably of its confirmation by the network.

Currently, miners decide which transactions to include in blocks because
it's them who are securing Bitcoin network providing proof-of-work
certificates stored inside every block header. Miners have to store the
whole blockchain at all times, so one of the costs is storage which grows
linearly with the transaction size (blockchain size as well). Another cost
is network bandwidth which depends directly on the size of data to be
communicated over.

The only incentive a person who wants to transfer his bitcoins is allowed
to use is setting of transaction fee, that is going directly to the miner.
This solution probably was intended to utilize free market (as implied by
Satoshi introducing sequence numbers) to determine appropriate fees, but
that is obviously not the case, in the current bitcoin network operating in
full block capacity mode. This fee market deviates significantly from a
free market premise (also attempts being made to make it closer, e.g. in
BIP125 where Replace-By-Fee signaling is supposed to help in replacing
"stuck" transactions with noncompetitive fee).

Currently, bitcoin network is susceptible to the DDoS attack of a kind.
Adversary creating and translating into the network a lot of transactions
carrying small value (e.g. only miners fee), will be able to impair the
ability to transfer value for everyone in the world, should he has enough
money to pay the fees. Miners would continue to work providing security for
the network and new blocks will consist of transaction transferring
negligible value. It's a major drawback because the cost of such attack
doesn't grow asymmetrically with the cost of BTC asset.

*Proposed solution*

So how do we incentivize all miners to include our transaction carrying a
lot of value in the next block? The only thing a miner supposed to do to
get a reward is to produce Hashcash proof-of-work, thus providing
cryptographic security guarantees for the whole Bitcoin blockchain. What if
including our transaction in a block would reduce effort requirements for
the miner produce valid block?

We could do so by extending the concept of proof-of-work, in such a way
that we do not sacrifice security at all. Here are both descriptions
proof-of-work as-is and to-be:

Standart proof-of-work: hash(previous block hash + current block target +
current block metadata + current block transactions) < target

Decentralized proof-of-work: hash(previous block hash + current block
target + current block metadata + current block transactions) - sum( FFFF -
hash( previous block hash + raw_tx ) ) < target

It is possible to imagine completely mining agnostic proof-of-work, for
example, the following PoW would do:

Distributed (mining-agnostic) proof-of-work: sum( FFFF - hash( previous
block hash + current block target + current block metadata + signed_tx ) )
< target

Described protocol change could be implemented as user activated soft-fork
(described in BIP148), introducing new blocks with the modified
proof-of-work concept.

*Economic reasoning*

An adversary whose goal is to prevent the network from transferring value
will have to compete with good users hash rate using same equipment good
miners will use. And it's far more complicated than competing with others
using the money to pay transaction fees.

In order to investigate probable consequences of protocol upgrade and
stability of implied economical equilibrium, we need an adequate game
theoretical model. Such model and numerical simulation results should be
obtained and studied before any protocol change could be considered by the
community.

To me it seems like a win-win solution for everyone owning BTC:

Miners benefit: as the result DDoS attack will be stopped, Bitcoin becomes
perfect store-of-value finally. Political decentralization of hash rate
will be incentivized as mining equipment becomes relevant to every user.
Users benefit: miners will have direct incentives to include transactions
deemed important by their sender and supported by some amount of
proof-of-work.

Sincerely yours, Ilya Eriklintsev.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170621/9e0880f5/attachment.html>

From jacob.eliosoff at gmail.com  Wed Jun 21 04:05:53 2017
From: jacob.eliosoff at gmail.com (Jacob Eliosoff)
Date: Wed, 21 Jun 2017 00:05:53 -0400
Subject: [bitcoin-dev] Miners forced to run non-core code in order to
 get segwit activated
In-Reply-To: <CAOG=w-tPgJ5baaNiZC5rTs_y=eV7AU+F=aGaH+uObqaB-VgL2w@mail.gmail.com>
References: <CAJowKgLtu-HUDuakk4DDU53nyChbQk_zY=f5OO2j1Za95PdL7w@mail.gmail.com>
	<CAAS2fgSZ_X3G7j3-S6tAGPe2TOTT2umBB8a0RHpD-wAHN9aPgw@mail.gmail.com>
	<CAFMkqK_73RrpaS2oJQ-0o6oC29m6a1h411_P7HmVcAyX712Sgw@mail.gmail.com>
	<CAAUaCyg2Nmsa2UaO2msBqSFeHLetUUN+cTETvSSmB7c=nH9ZhQ@mail.gmail.com>
	<BC758648-BD4F-4DEF-8B79-7E8E0A887033@friedenbach.org>
	<CAAUaCyh+4m+t9d4yOoEOf6VUDyJ=sUpDT3hD3cDmd9dcBQZ+nw@mail.gmail.com>
	<CAJowKgJcp7d30LsrDZ5iR6-k9Ncz0N90pxs2GmJkuG1qYDG6GQ@mail.gmail.com>
	<CAOG=w-tPgJ5baaNiZC5rTs_y=eV7AU+F=aGaH+uObqaB-VgL2w@mail.gmail.com>
Message-ID: <CAAUaCyijF1eHSffUYf9Mrv+KP5H+NLBcy5MEhMUyT6Rxcbx93g@mail.gmail.com>

Well, this Saturday's "Chinese roundtable" statement from a bunch of
miners (https://pastebin.com/b3St9VCF) says they intend "NYA" in the
coinbase as support for "the New York consensus SegWit2x program btc1 (
https://github.com/btc1)", whose code includes the (accelerated 336-block)
BIP 91 change.  So, other facts or interpretations could come to light, but
until they do we should probably assume that's what the "NYA" (which just
broke 80% over the last 24h) means.


On Tue, Jun 20, 2017 at 10:11 PM, Mark Friedenbach <mark at friedenbach.org>
wrote:

> 80% have set "NYA" in their coinbase string. We have no idea what that
> means. People are equating it to BIP 91 -- but BIP 91 did not exist at
> the time of the New York agreement, and differs from the actual text
> of the NYA in substantive ways. The "Segwit2MB" that existed at the
> time of the NYA, and which was explicitly referenced by the text is
> the proposal by Sergio Demian Lerner that was made to this mailing
> list on 31 March. The text of the NYA grants no authority for
> upgrading this proposal while remaining compliant with the agreement.
> This is without even considering the fact that in the days after the
> NYA there was disagreement among those who signed it as to what it
> meant.
>
> I feel it is a very dangerous and unwarranted assumption people are
> making that what we are seeing now is either 80% support for BIP-91 or
> for the code in the btc1 repo.
>
> On Tue, Jun 20, 2017 at 6:36 PM, Erik Aronesty <erik at q32.com> wrote:
> > # Jacob Eliosoff:
> >
> >>  will start orphaning non-bit-1 blocks before Aug 1, and we avoid a
> split.
> >
> > Correct.  There are 2 short activation periods in BIP91 either of which
> > would avoid a split.
> >
> > # Gregory Maxwell:
> >
> >> unclear to me _exactly_ what it would need to implement to be
> consistent.
> >
> > This is the relevant pull req to core:
> >
> > https://github.com/bitcoin/bitcoin/pull/10444
> >
> > Seems OK.  It's technically running now on testnet5.   I think it (or a
> > -bip148 option) should be merged as soon as feasible.
> >
> >> previously debunked "XT" and "Classic" hysteria.
> >
> > apples vs oranges, imo.   segwit is not a contentious feature.   the
> > "bundling" in segwit2x is, but that's not the issue here.   the issue is
> we
> > are indirectly requiring miners that strongly support segwit to install
> > consensus protocol changes outside of bitcoin's standard reference.
>  80% of
> > them have signaled they will do so.   these are uncharted waters.
> >
> >
> > On Tue, Jun 20, 2017 at 6:57 PM, Jacob Eliosoff via bitcoin-dev
> > <bitcoin-dev at lists.linuxfoundation.org> wrote:
> >>
> >> I could be wrong, but the latest BIP91 implementation (also included in
> >> Segwit2x) cuts the activation period to 336 blocks (2.33 days).  (This
> has
> >> been updated at
> >> https://github.com/bitcoin/bips/blob/master/bip-0091.mediawiki.)  So
> if 80%
> >> of hashpower is actually running that code and signaling on bit 4 by
> July 25
> >> or so, then those 80+% will start orphaning non-bit-1 blocks before Aug
> 1,
> >> and we avoid a split.
> >>
> >> There may still be a few non-bit-1 blocks that get orphaned after Aug 1,
> >> because they're mined by old BIP141 nodes.  But it seems like very few
> >> miners won't be signaling either Segwit2x *or* BIP141 by then...
> >>
> >> Make sense?
> >>
> >>
> >> On Tue, Jun 20, 2017 at 6:48 PM, Mark Friedenbach <mark at friedenbach.org
> >
> >> wrote:
> >>>
> >>> Why do you say activation by August 1st is likely? That would require
> an
> >>> entire difficulty adjustment period with >=95% bit1 signaling. That
> seems a
> >>> tall order to organize in the scant few weeks remaining.
> >>>
> >>> On Jun 20, 2017, at 3:29 PM, Jacob Eliosoff via bitcoin-dev
> >>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
> >>>
> >>> If segwit is activated before Aug 1, as now seems likely, there will be
> >>> no split that day.  But if activation is via Segwit2x (also likely),
> and at
> >>> least some nodes do & some don't follow through with the HF 3mo later
> >>> (again, likely), agreed w/ Greg that *then* we'll see a split -
> probably in
> >>> Sep/Oct.  How those two chains will match up and how the split will
> play out
> >>> is anyone's guess...
> >>>
> >>>
> >>>
> >>> On Jun 20, 2017 6:16 PM, "Hampus Sj?berg via bitcoin-dev"
> >>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
> >>>
> >>> > Ironically, it looks like most of the segwit2x signaling miners are
> >>> > faking it (because they're not signaling segwit which it requires).
> >>> > It'll be unfortunate if some aren't faking it and start orphaning
> >>> > their own blocks because they are failing to signal segwit.
> >>>
> >>> Well, they're doing some kind of "pre-signaling" in the coinbase at the
> >>> moment, because the segwit2x project is still in alpha-phase according
> to
> >>> the timeline. They're just showing commitment.
> >>> I'm sure they will begin signaling on version bit 4/BIP91 as well as
> >>> actually running a segwit2x node when the time comes.
> >>>
> >>>
> >>> > As far as prevent a chain split goes, all those things
> >>> > (148/91/segwit2x(per today)) effectively guarantee a chainsplit-- so
> I
> >>> > don't think that holds.
> >>>
> >>> Segwit2x/BIP91/BIP148 will orphan miners that do not run a Segwit2x (or
> >>> BIP148) node, because they wouldn't have the new consensus rule of
> requiring
> >>> all blocks to signal for segwit.
> >>> I don't believe there would be any long lasting chainsplit though
> >>> (because of the ~80% hashrate support on segwit2x), perhaps 2-3 blocks
> if we
> >>> get unlucky.
> >>>
> >>> Hampus
> >>>
> >>> 2017-06-20 23:49 GMT+02:00 Gregory Maxwell via bitcoin-dev
> >>> <bitcoin-dev at lists.linuxfoundation.org>:
> >>>>
> >>>> On Tue, Jun 20, 2017 at 3:44 PM, Erik Aronesty via bitcoin-dev
> >>>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
> >>>> > Because a large percentage of miners are indifferent, right now
> miners
> >>>> > have
> >>>> > to choose between BIP148 and Segwit2x if they want to activate
> Segwit.
> >>>>
> >>>> Miners can simply continuing signaling segwit, which will leave them
> >>>> at least soft-fork compatible with BIP148 and BIP91 (and god knows
> >>>> what "segwit2x" is since they keep changing the actual definition and
> >>>> do not have a specification; but last I saw the near-term behavior the
> >>>> same as BIP91 but with a radically reduced activation window, so the
> >>>> story would be the same there in the near term).
> >>>>
> >>>> Ironically, it looks like most of the segwit2x signaling miners are
> >>>> faking it (because they're not signaling segwit which it requires).
> >>>> It'll be unfortunate if some aren't faking it and start orphaning
> >>>> their own blocks because they are failing to signal segwit.
> >>>>
> >>>> I don't think the rejection of segwit2x from Bitcoin's developers
> >>>> could be any more resolute than what we've already seen:
> >>>> https://en.bitcoin.it/wiki/Segwit_support
> >>>>
> >>>> On Tue, Jun 20, 2017 at 5:22 PM, Mark Friedenbach via bitcoin-dev
> >>>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
> >>>> > I think it is very na?ve to assume that any shift would be
> temporary.
> >>>> > We have a hard enough time getting miners to proactively upgrade to
> >>>> > recent versions of the reference bitcoin daemon. If miners interpret
> >>>> > the situation as being forced to run non-reference software in order
> >>>> > to prevent a chain split because a lack of support from Bitcoin
> Core,
> >>>> > that could be a one-way street.
> >>>>
> >>>> I think this is somewhat naive and sounds a lot like the repeat of the
> >>>> previously debunked "XT" and "Classic" hysteria.
> >>>>
> >>>> There is a reason that segwit2x is pretty much unanimously rejected by
> >>>> the technical community.  And just like with XT/Classic/Unlimited
> >>>> you'll continue to see a strong correlation with people who are
> >>>> unwilling and unable to keep updating the software at an acceptable
> >>>> level of quality-- esp. because the very founding on their fork is
> >>>> predicated on discarding those properties.
> >>>>
> >>>> If miners want to go off and create an altcoin-- welp, thats something
> >>>> they can always do,  and nothing about that will force anyone to go
> >>>> along with it.
> >>>>
> >>>> As far as prevent a chain split goes, all those things
> >>>> (148/91/segwit2x(per today)) effectively guarantee a chainsplit-- so I
> >>>> don't think that holds.
> >>>> _______________________________________________
> >>>> bitcoin-dev mailing list
> >>>> bitcoin-dev at lists.linuxfoundation.org
> >>>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
> >>>
> >>>
> >>>
> >>> _______________________________________________
> >>> bitcoin-dev mailing list
> >>> bitcoin-dev at lists.linuxfoundation.org
> >>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
> >>>
> >>>
> >>> _______________________________________________
> >>> bitcoin-dev mailing list
> >>> bitcoin-dev at lists.linuxfoundation.org
> >>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
> >>
> >>
> >>
> >> _______________________________________________
> >> bitcoin-dev mailing list
> >> bitcoin-dev at lists.linuxfoundation.org
> >> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
> >>
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170621/9b66620b/attachment-0001.html>

From lvella at gmail.com  Wed Jun 21 04:46:15 2017
From: lvella at gmail.com (Lucas Clemente Vella)
Date: Wed, 21 Jun 2017 01:46:15 -0300
Subject: [bitcoin-dev] Freeze Bitcoin protocol and call it Bitcoin 1
Message-ID: <CAGCathyHbNpepDZU-EHzmvGW_yM=+B3K6hHDDJ-LbDQ4T3vCyg@mail.gmail.com>

Is it too late to propose to freeze Bitcoin protocol as it is today (no
SegWit, no bigger block)?

Hear me out: assume Bitcoin is frozen as it is now: no more forks, no more
change in consensus rules. Call it Bitcoin 1 (BC1). So, how to evolve and
scale Bitcoin?

Use a very conservative sidechain, call it Bitcoin 2 (BC2), tightly
coupled, block per block, with Bitcoin 1 chain. No fancy experimental
changes there: fix the bare minimum to support more general two-way
sidechains, linear scalability transaction verification time and
transaction malleability. Can be one way only if that makes it simple
enough: coins sent to BC2 can never come back to BC1.

Miners choose to mine a BC2 block alongside a BC1 block, and it can be done
for free once a BC1 block is found. There may be BC1 blocks in the chain
whose corresponding BC2 blocks are missing (and that is not a big deal),
but there will be an economic incentive to mine a BC2 block, since
transaction fees on that chain will be collected.

The economic adoption is completely voluntary and independent of anyone
else, doesn't require the strong consensus of SegWit. If it is feasible to
create a simple enough two way sidechain over BC1, good. If not, economic
value of BC1 will always be at least that of BC2, but never lower. BC2 may
have a lower price than BC1 at first, but since it will have every feature
of BC1, plus the possibility of massive scalability and instantaneous
transactions with a lightning network built over BC2 (a practical
economical advantage), it will most likely value over what BC1 could ever
be alone, raising BC1 price with it.

If these predictions are correct, fewer and fewer people will transact BC1,
eventually with blocks mined empty except for the coinbase, which the miner
may choose to send directly to BC2. If I turn out to be wrong, and people
prefer to stick to the old BC1 for some reason, BC2 becomes just another
speculative altcoin. Thus, everyone migrating should be fully conscious
about the risk of immediate devaluation.

The 2 major risks I see that could hamper the adoption are:
 - Just plain fear: I find the whole economical incentive scenario of BC2
sound and plausible, just as I found Bitcoin sound and plausible when I
heard about it for the first time. I also fear to put my money in BC2, just
as I did when I heard about Bitcoin. BC2 case is even worse, because I can
safely hold my coins in BC1 until I am sure BC2 is solid, so at first we
may experience only enthusiast adoption;
- Technological inertia: everyone wishing to accept BC2 will have to
implement this payment system as for any other altcoin. Every exchange
supporting both will have to create separated markets for BC1 and BC2.
Remember: both chains must be obviously distinguishable. It is even
desirable that the address format in BC2 to be incompatible with BC1 (maybe
staring with "2" ?).

Finally, due to the present state of affairs, with impending activation of
segwit with a promise to hardfork in 3 months, I believe this proposal is
too late, not to mention the stress, emotions and hard feelings of the
situation will make it go largely ill received or ignored. But since I
genuinely believe this to be the best and most conservative way to go with
Bitcoin, I wrote this anyway.

Please forgive me if something like this was discussed a thousand times
before and you wasted your time reading this.

-- 
Lucas Clemente Vella
lvella at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170621/d52291ac/attachment.html>

From gsomlo at gmail.com  Wed Jun 21 13:24:09 2017
From: gsomlo at gmail.com (Gabriel L. Somlo)
Date: Wed, 21 Jun 2017 09:24:09 -0400
Subject: [bitcoin-dev] RFC: Sandboxed Bitcoin network ?
Message-ID: <20170621132408.GA29456@HEDWIG.INI.CMU.EDU>

I've been looking for a way to set up a self-contained, sandboxed
network of Bitcoin peer nodes, for testing and experimentation. Think
a bunch of networked VMs, or containers inside a network simulator
like GNS3 (http://gns3.com) or CORE (http://github.com/coreemu/core).

Neither 'main' nor 'test' are feasible, due to hard-coded assumptions
they both make about their respective publicly shared blockchain state.

Right now, that leaves 'regtest' -- however, connecting peers together
over the sandboxed network in regtest mode is a manual process.

After some tinkering, the following changes make 'regtest' behave
similarly to "the real thing", but inside an isolated sandbox network:

diff --git a/src/chainparams.cpp b/src/chainparams.cpp
index 3b42c5f..4345667 100644
--- a/src/chainparams.cpp
+++ b/src/chainparams.cpp
@@ -275,7 +275,7 @@ public:
         consensus.nPowTargetTimespan = 14 * 24 * 60 * 60; // two weeks
         consensus.nPowTargetSpacing = 10 * 60;
         consensus.fPowAllowMinDifficultyBlocks = true;
-        consensus.fPowNoRetargeting = true;
+        consensus.fPowNoRetargeting = false;
         consensus.nRuleChangeActivationThreshold = 108; // 75% for testchains
         consensus.nMinerConfirmationWindow = 144; // Faster than normal for regtest (144 instead of 2016)
         consensus.vDeployments[Consensus::DEPLOYMENT_TESTDUMMY].bit = 28;
@@ -307,11 +307,13 @@ public:
         assert(genesis.hashMerkleRoot == uint256S("0x4a5e1e4baab89f3a32518a88c31bc87f618f76673e2cc77ab2127b7afdeda33b"));
 
         vFixedSeeds.clear(); //!< Regtest mode doesn't have any fixed seeds.
+        vFixedSeeds = std::vector<SeedSpec6>(pnSeed6_regtest, pnSeed6_regtest + ARRAYLEN(pnSeed6_regtest));
         vSeeds.clear();      //!< Regtest mode doesn't have any DNS seeds.
+        vSeeds.push_back(CDNSSeedData("btc-sandbox.local", "seed.btc-sandbox.local"));
 
-        fDefaultConsistencyChecks = true;
+        fDefaultConsistencyChecks = false;
         fRequireStandard = false;
-        fMineBlocksOnDemand = true;
+        fMineBlocksOnDemand = false;
 
         checkpointData = (CCheckpointData) {
             {

(not showing the pnSeed6_regtest[] table added to src/chainparamsseeds.h)

Additionally, for this network to behave realistically, I need peers to
actually mine blocks on their own once connected together, so I reverted 
commit 8d1de43 and re-added the 'setgenerate' triggered internal miner.

At this point, I have a few questions for the Bitcoin dev community:

  1. would a realistic sandbox test mode be interesting enough to make
     it worth supporting upstream? (happy to submit patches and do
     revisions if there's interest, and a chance for success)

  2. if yes, support modifying 'regtest' mode accordingly via some sort of
     command line flags, or rather implement a dedicated 'sandbox' mode
     with its own CChainParams defaults?

  3. finally, would re-inserting the internal 'setgenerate' miner be a
     deal breaker?

Any other thoughts and comments also much appreciated!

Thanks much,
--Gabriel

From conrad.burchert at googlemail.com  Thu Jun 22 12:02:45 2017
From: conrad.burchert at googlemail.com (Conrad Burchert)
Date: Thu, 22 Jun 2017 14:02:45 +0200
Subject: [bitcoin-dev] BIP Idea : DDoS resistance via decentrilized
	proof-of-work
In-Reply-To: <CA+Yhp0Uv3zrg28G7QcgXPSv4Md9j2U-=SROJqWAOqvW_tCu=bQ@mail.gmail.com>
References: <CA+Yhp0Uv3zrg28G7QcgXPSv4Md9j2U-=SROJqWAOqvW_tCu=bQ@mail.gmail.com>
Message-ID: <CADc9zGD6mGMzUgsJ5QOnXwe9X7jgjZz1WTB7RqK_kxCoRfhXBA@mail.gmail.com>

As soon as there is competition for block space, people will likely
outsource creating the proof of work on the transaction to "transaction
miners". This would likely result in giving a fee to those transaction
miners. If those are the same miners as those mining the block, we are back
at the current system.

Put in other words: We are already doing this, you are paying the miner for
a piece of the proof of work of the block. If you want to mine instead of
paying, just mine a block and use a part of the block reward to pay the fee
for another transaction.

This also does not work to prevent spam. Instead of paying the transaction
fee you can just pay someone to mine proof-of-work on your spam
transactions, resulting in roughly the same cost. There is no reason a
normal user would be better in doing this than a spammer, likely it is the
other way around as the spammer is a more reliable customer for a miner.

2017-06-21 11:55 GMT+02:00 Ilya Eriklintsev via bitcoin-dev <
bitcoin-dev at lists.linuxfoundation.org>:

> Hello everyone,
>
> recently I have got an idea that in my opinion will improve bitcoin
> network, making it better store-of-value for growing cyberspace and
> cryptoeconomy. Sorry for longread below and thank you for your time.
>
> *Decentralized proof-of-work and DDoS resistance for Bitcoin*
>
> *Abstract*
>
> By introducing some new block validation rules it is possible to make
> Bitcoin network more secure, decentralized and DDoS resistant. The idea is
> to modify simple proof-of-work puzzle in such a way that user transactions
> could be hardened with the same proof-of-work algorithm thus incentivising
> all the miners to include that particular transaction. Such mechanism will
> effectively give a handicap to every miner who includes "mined" transaction
> into next block, increasing probability of him getting block reward.
>
> *Problems and motivation*
>
> This document will address the issue of a continuous DDoS attack targeting
> the Bitcoin network, e.g. full nodes mempools constantly being overflowed
> with transactions carrying small value reduce system primary ability to
> transfer value (and hence making it perfect store of value). Valid
> transactions are cheap to create (in the sense of computational effort
> required) and no adequate mechanism exist to make transaction total value
> increase probably of its confirmation by the network.
>
> Currently, miners decide which transactions to include in blocks because
> it's them who are securing Bitcoin network providing proof-of-work
> certificates stored inside every block header. Miners have to store the
> whole blockchain at all times, so one of the costs is storage which grows
> linearly with the transaction size (blockchain size as well). Another cost
> is network bandwidth which depends directly on the size of data to be
> communicated over.
>
> The only incentive a person who wants to transfer his bitcoins is allowed
> to use is setting of transaction fee, that is going directly to the miner.
> This solution probably was intended to utilize free market (as implied by
> Satoshi introducing sequence numbers) to determine appropriate fees, but
> that is obviously not the case, in the current bitcoin network operating in
> full block capacity mode. This fee market deviates significantly from a
> free market premise (also attempts being made to make it closer, e.g. in
> BIP125 where Replace-By-Fee signaling is supposed to help in replacing
> "stuck" transactions with noncompetitive fee).
>
> Currently, bitcoin network is susceptible to the DDoS attack of a kind.
> Adversary creating and translating into the network a lot of transactions
> carrying small value (e.g. only miners fee), will be able to impair the
> ability to transfer value for everyone in the world, should he has enough
> money to pay the fees. Miners would continue to work providing security for
> the network and new blocks will consist of transaction transferring
> negligible value. It's a major drawback because the cost of such attack
> doesn't grow asymmetrically with the cost of BTC asset.
>
> *Proposed solution*
>
> So how do we incentivize all miners to include our transaction carrying a
> lot of value in the next block? The only thing a miner supposed to do to
> get a reward is to produce Hashcash proof-of-work, thus providing
> cryptographic security guarantees for the whole Bitcoin blockchain. What if
> including our transaction in a block would reduce effort requirements for
> the miner produce valid block?
>
> We could do so by extending the concept of proof-of-work, in such a way
> that we do not sacrifice security at all. Here are both descriptions
> proof-of-work as-is and to-be:
>
> Standart proof-of-work: hash(previous block hash + current block target +
> current block metadata + current block transactions) < target
>
> Decentralized proof-of-work: hash(previous block hash + current block
> target + current block metadata + current block transactions) - sum( FFFF -
> hash( previous block hash + raw_tx ) ) < target
>
> It is possible to imagine completely mining agnostic proof-of-work, for
> example, the following PoW would do:
>
> Distributed (mining-agnostic) proof-of-work: sum( FFFF - hash( previous
> block hash + current block target + current block metadata + signed_tx ) )
> < target
>
> Described protocol change could be implemented as user activated soft-fork
> (described in BIP148), introducing new blocks with the modified
> proof-of-work concept.
>
> *Economic reasoning*
>
> An adversary whose goal is to prevent the network from transferring value
> will have to compete with good users hash rate using same equipment good
> miners will use. And it's far more complicated than competing with others
> using the money to pay transaction fees.
>
> In order to investigate probable consequences of protocol upgrade and
> stability of implied economical equilibrium, we need an adequate game
> theoretical model. Such model and numerical simulation results should be
> obtained and studied before any protocol change could be considered by the
> community.
>
> To me it seems like a win-win solution for everyone owning BTC:
>
> Miners benefit: as the result DDoS attack will be stopped, Bitcoin becomes
> perfect store-of-value finally. Political decentralization of hash rate
> will be incentivized as mining equipment becomes relevant to every user.
> Users benefit: miners will have direct incentives to include transactions
> deemed important by their sender and supported by some amount of
> proof-of-work.
>
> Sincerely yours, Ilya Eriklintsev.
>
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170622/234987bf/attachment-0001.html>

From truthcoin at gmail.com  Thu Jun 22 13:27:25 2017
From: truthcoin at gmail.com (Paul Sztorc)
Date: Thu, 22 Jun 2017 09:27:25 -0400
Subject: [bitcoin-dev] Drivechain RfD -- Follow Up
In-Reply-To: <CAJowKgKT2rn3N3L+79JEY_uNfKDewcmgkiEB2mJYx1mg+YjGCQ@mail.gmail.com>
References: <24f2b447-a237-45eb-ef9f-1a62533fad5c@gmail.com>
	<83671224-f6ff-16a9-81c0-20ab578aec9d@gmail.com>
	<AAC86547-7904-4475-9966-138130019567@taoeffect.com>
	<6764b8af-bb4c-615d-5af5-462127bbbe36@gmail.com>
	<CAJowKgLJW=kJhcN4B7TbWXLb7U51tzYU3PFOy1m8JqKXqFsU4A@mail.gmail.com>
	<33d98418-10f0-3854-a954-14985d53e04b@gmail.com>
	<CAJowKgKT2rn3N3L+79JEY_uNfKDewcmgkiEB2mJYx1mg+YjGCQ@mail.gmail.com>
Message-ID: <cd96b01e-46ca-9328-2a0a-82ba96d5183c@gmail.com>

Hi Erik,

I don't think that your design is competitive. Why would users tolerate
a depreciation of X% per year, when there are alternatives which do not
require such depreciation? It seems to me that none would.

Paul

On 6/20/2017 9:38 AM, Erik Aronesty wrote:
> - a proof-of-burn sidechain is the ultimate two-way peg.   you have to
> burn bitcoin *or* side-chain tokens to mine the side chain.   the size
> of the burn is the degree of security.    i actually wrote code to do
> randomized blind burns where you have a poisson distribution
> (non-deterministic selected burn).    there is no way to game it...
> it's very similar to algorand - but it uses burns instead of staking
>
> - you can then have a secure sidechain that issues a mining reward in
> sidechain tokens, which can be aggrregated and redeemed for bitcoins.
>   the result of this is that any bitcoins held in the sidechain
> depreciate in value at a rate of X% per year.   this deflation rate
> pays for increased security
>
> - logically this functions like an alt coin, with high inflation and
> cheap transactions.   but the altcoin is pegged to bitcoin's price
> because of the pool of unredeemed bitcoins held within the side chain.
>
>
>
> On Tue, Jun 20, 2017 at 7:54 AM, Paul Sztorc <truthcoin at gmail.com
> <mailto:truthcoin at gmail.com>> wrote:
>
>     Hi Erik,
>
>     As you know:
>
>     1. If a sidechain is merged mined it basically grows out of the
>     existing Bitcoin mining network. If it has a different PoW
>     algorithm it is a new mining network.
>     2. The security (ie, hashrate) of any mining network would be
>     determined by the total economic value of the block. In Bitcoin
>     this is (subsidy+tx_fees)*price, but since a sidechain cannot
>     issue new tokens it would only be (tx_fees)*price.
>
>     Unfortunately the two have a nasty correlation which can lead to a
>     disastrous self-fulfilling prophecy: users will avoid a network
>     that is too insecure; and if users avoid using a network, they
>     will stop paying txn fees and so the quantity (tx_fees)*price
>     falls toward zero, erasing the network's security. So it is quite
>     problematic and I recommend just biting the bullet and going with
>     merged mining instead.
>
>     And, the point may be moot. Bitcoin miners may decide that, given
>     their expertise in seeking out cheap sources of power/cooling,
>     they might as well mine both/all chains. So your suggestion may
>     not achieve your desired result (and would, meanwhile, consume
>     more of the economy's resources -- some of these would not
>     contribute even to a higher hashrate).
>
>     Paul
>
>
>
>
>     On 6/19/2017 1:11 PM, Erik Aronesty wrote:
>>     It would be nice to be able to enforce that a drivechain *not*
>>     have the same POW as bitcoin.
>>
>>     I suspect this is the only way to be sure that a drivechain
>>     doesn't destabilize the main chain and push more power to miners
>>     that already have too much power.
>>
>>
>
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170622/3ba60e24/attachment.html>

From erik.lite at gmail.com  Thu Jun 22 13:41:55 2017
From: erik.lite at gmail.com (Ilya Eriklintsev)
Date: Thu, 22 Jun 2017 16:41:55 +0300
Subject: [bitcoin-dev] BIP Idea : DDoS resistance via decentrilized
	proof-of-work
In-Reply-To: <CADc9zGD6mGMzUgsJ5QOnXwe9X7jgjZz1WTB7RqK_kxCoRfhXBA@mail.gmail.com>
References: <CA+Yhp0Uv3zrg28G7QcgXPSv4Md9j2U-=SROJqWAOqvW_tCu=bQ@mail.gmail.com>
	<CADc9zGD6mGMzUgsJ5QOnXwe9X7jgjZz1WTB7RqK_kxCoRfhXBA@mail.gmail.com>
Message-ID: <CA+Yhp0UeiUV5sXpMN-D5uyog2SZcpHbWELecwqMaPV3AsXpo=w@mail.gmail.com>

Thank you, Conrad, for the feedback and I think I can see your points
clearly, but I would disagree that decentralised proof-of-work doesn't
change game rules drastically.
You are correct about proof-of-work market splitting into
"transaction-miners" and "blockchain-miners", but this is not just another
way to pay the fees, it's actually completely different mechanism. Here are
some arguments that might be able to convince you or at least to question
your premises:

1. Since bitcoin mining is a game in which winner takes it all, modified
proof-of-work will introduce a new tradeoff for the miners: either you
collect more fees (increasing risk of losing reward) or you collect more
proof-of-work (increasing reward win probability). This will create the
missing economic link between transaction fees (BTC) and proof-of-work
security costs (Hashcash PoW), creating the secondary market of
transaction-mining-capable hash power / BTC. It feels like some new game
dynamics arise in this setting, but I haven't run any numerical simulations
yet, though I'm going to do so.

2. Why is it possible to stop spam and DDoS of the network? The reason is
that to generate transaction proof-of-work user have to spend some physical
time (not money). After the user found out previous block hash he has two
choices: either to start doing some work (probably with the help of
transaction miners AND money) or instantly adjust fee at every moment (only
money). This adds a new signalling mechanism alongside standard fee market,
which will make it possible for miners to filter and do not propagate
transactions with PoW less than some handicap value (of course they can
always agree on some whitelist of non-spammers), thus preventing abuse of
spammer transactions with competitive fees to delay valuable and important
transfers of BTC.

Hope I addressed all the issues you mentioned.


On 22 June 2017 at 15:02, Conrad Burchert <conrad.burchert at googlemail.com>
wrote:

> As soon as there is competition for block space, people will likely
> outsource creating the proof of work on the transaction to "transaction
> miners". This would likely result in giving a fee to those transaction
> miners. If those are the same miners as those mining the block, we are back
> at the current system.
>
> Put in other words: We are already doing this, you are paying the miner
> for a piece of the proof of work of the block. If you want to mine instead
> of paying, just mine a block and use a part of the block reward to pay the
> fee for another transaction.
>
> This also does not work to prevent spam. Instead of paying the transaction
> fee you can just pay someone to mine proof-of-work on your spam
> transactions, resulting in roughly the same cost. There is no reason a
> normal user would be better in doing this than a spammer, likely it is the
> other way around as the spammer is a more reliable customer for a miner.
>
> 2017-06-21 11:55 GMT+02:00 Ilya Eriklintsev via bitcoin-dev <
> bitcoin-dev at lists.linuxfoundation.org>:
>
>> Hello everyone,
>>
>> recently I have got an idea that in my opinion will improve bitcoin
>> network, making it better store-of-value for growing cyberspace and
>> cryptoeconomy. Sorry for longread below and thank you for your time.
>>
>> *Decentralized proof-of-work and DDoS resistance for Bitcoin*
>>
>> *Abstract*
>>
>> By introducing some new block validation rules it is possible to make
>> Bitcoin network more secure, decentralized and DDoS resistant. The idea is
>> to modify simple proof-of-work puzzle in such a way that user transactions
>> could be hardened with the same proof-of-work algorithm thus incentivising
>> all the miners to include that particular transaction. Such mechanism will
>> effectively give a handicap to every miner who includes "mined" transaction
>> into next block, increasing probability of him getting block reward.
>>
>> *Problems and motivation*
>>
>> This document will address the issue of a continuous DDoS attack
>> targeting the Bitcoin network, e.g. full nodes mempools constantly being
>> overflowed with transactions carrying small value reduce system primary
>> ability to transfer value (and hence making it perfect store of value).
>> Valid transactions are cheap to create (in the sense of computational
>> effort required) and no adequate mechanism exist to make transaction total
>> value increase probably of its confirmation by the network.
>>
>> Currently, miners decide which transactions to include in blocks because
>> it's them who are securing Bitcoin network providing proof-of-work
>> certificates stored inside every block header. Miners have to store the
>> whole blockchain at all times, so one of the costs is storage which grows
>> linearly with the transaction size (blockchain size as well). Another cost
>> is network bandwidth which depends directly on the size of data to be
>> communicated over.
>>
>> The only incentive a person who wants to transfer his bitcoins is allowed
>> to use is setting of transaction fee, that is going directly to the miner.
>> This solution probably was intended to utilize free market (as implied by
>> Satoshi introducing sequence numbers) to determine appropriate fees, but
>> that is obviously not the case, in the current bitcoin network operating in
>> full block capacity mode. This fee market deviates significantly from a
>> free market premise (also attempts being made to make it closer, e.g. in
>> BIP125 where Replace-By-Fee signaling is supposed to help in replacing
>> "stuck" transactions with noncompetitive fee).
>>
>> Currently, bitcoin network is susceptible to the DDoS attack of a kind.
>> Adversary creating and translating into the network a lot of transactions
>> carrying small value (e.g. only miners fee), will be able to impair the
>> ability to transfer value for everyone in the world, should he has enough
>> money to pay the fees. Miners would continue to work providing security for
>> the network and new blocks will consist of transaction transferring
>> negligible value. It's a major drawback because the cost of such attack
>> doesn't grow asymmetrically with the cost of BTC asset.
>>
>> *Proposed solution*
>>
>> So how do we incentivize all miners to include our transaction carrying a
>> lot of value in the next block? The only thing a miner supposed to do to
>> get a reward is to produce Hashcash proof-of-work, thus providing
>> cryptographic security guarantees for the whole Bitcoin blockchain. What if
>> including our transaction in a block would reduce effort requirements for
>> the miner produce valid block?
>>
>> We could do so by extending the concept of proof-of-work, in such a way
>> that we do not sacrifice security at all. Here are both descriptions
>> proof-of-work as-is and to-be:
>>
>> Standart proof-of-work: hash(previous block hash + current block target +
>> current block metadata + current block transactions) < target
>>
>> Decentralized proof-of-work: hash(previous block hash + current block
>> target + current block metadata + current block transactions) - sum( FFFF -
>> hash( previous block hash + raw_tx ) ) < target
>>
>> It is possible to imagine completely mining agnostic proof-of-work, for
>> example, the following PoW would do:
>>
>> Distributed (mining-agnostic) proof-of-work: sum( FFFF - hash( previous
>> block hash + current block target + current block metadata + signed_tx ) )
>> < target
>>
>> Described protocol change could be implemented as user activated
>> soft-fork (described in BIP148), introducing new blocks with the modified
>> proof-of-work concept.
>>
>> *Economic reasoning*
>>
>> An adversary whose goal is to prevent the network from transferring value
>> will have to compete with good users hash rate using same equipment good
>> miners will use. And it's far more complicated than competing with others
>> using the money to pay transaction fees.
>>
>> In order to investigate probable consequences of protocol upgrade and
>> stability of implied economical equilibrium, we need an adequate game
>> theoretical model. Such model and numerical simulation results should be
>> obtained and studied before any protocol change could be considered by the
>> community.
>>
>> To me it seems like a win-win solution for everyone owning BTC:
>>
>> Miners benefit: as the result DDoS attack will be stopped, Bitcoin
>> becomes perfect store-of-value finally. Political decentralization of hash
>> rate will be incentivized as mining equipment becomes relevant to every
>> user.
>> Users benefit: miners will have direct incentives to include transactions
>> deemed important by their sender and supported by some amount of
>> proof-of-work.
>>
>> Sincerely yours, Ilya Eriklintsev.
>>
>> _______________________________________________
>> bitcoin-dev mailing list
>> bitcoin-dev at lists.linuxfoundation.org
>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170622/43b6ace6/attachment-0001.html>

From john at seebitcoin.com  Thu Jun 22 13:47:14 2017
From: john at seebitcoin.com (John Hardy)
Date: Thu, 22 Jun 2017 13:47:14 +0000
Subject: [bitcoin-dev] BIP Idea : DDoS resistance via
	decentrilized	proof-of-work
In-Reply-To: <CA+Yhp0Uv3zrg28G7QcgXPSv4Md9j2U-=SROJqWAOqvW_tCu=bQ@mail.gmail.com>
References: <CA+Yhp0Uv3zrg28G7QcgXPSv4Md9j2U-=SROJqWAOqvW_tCu=bQ@mail.gmail.com>
Message-ID: <BLUPR0301MB2002AAC764B140C4DE74768DEEDB0@BLUPR0301MB2002.namprd03.prod.outlook.com>

Hi Ilya,


This proposal wouldn't work because bad actors can perform PoW just as cheaply as any other participant.


The transaction fee already acts as a mechanism to prevent spam. It is not a problem to have a lot of low value transactions in the mempool as thresholds can easily be set for them to be disregarded/expire - a 300MB  maxmempool size by default eliminates any real 'DDOS' risk. Spam only really becomes an issue when it enters the blockchain. If a spammer is willing to pay the tx fee to spam, they'd be willing to pay the PoW.


The only actors who can spam the blockchain at zero cost are the miners themselves (beyond the opportunity cost of including genuine fee paying transactions). They can even do it without their transactions ever hitting the mempool or including a fee, though this behaviour would be easy to spot.


If miners are colluding to spam the mempool or blocks in order to increase the average transaction cost overall there is little that can be done as the network relies on 51% of hashpower being honest. A miner creating spam transactions that enter the mempool has the risk that another miner would include it in a block and they would incur an economic cost if this happened.


I had an idea for a dynamic blocksize that required miners to pay a percentage of the transaction fees to the next mined block. Here is a link: https://lists.linuxfoundation.org/pipermail/bitcoin-discuss/2017-January/000123.html


If it was established that miners spamming blocks with transactions was an issue, this could be used as a disincentive as it means the cost for doing so becomes non-zero.


Regards,

John Hardy
john at seebitcoin.com

________________________________
From: bitcoin-dev-bounces at lists.linuxfoundation.org <bitcoin-dev-bounces at lists.linuxfoundation.org> on behalf of Ilya Eriklintsev via bitcoin-dev <bitcoin-dev at lists.linuxfoundation.org>
Sent: Wednesday, June 21, 2017 9:55 AM
To: bitcoin-dev at lists.linuxfoundation.org
Subject: [bitcoin-dev] BIP Idea : DDoS resistance via decentrilized proof-of-work

Hello everyone,

recently I have got an idea that in my opinion will improve bitcoin network, making it better store-of-value for growing cyberspace and cryptoeconomy. Sorry for longread below and thank you for your time.

Decentralized proof-of-work and DDoS resistance for Bitcoin

Abstract

By introducing some new block validation rules it is possible to make Bitcoin network more secure, decentralized and DDoS resistant. The idea is to modify simple proof-of-work puzzle in such a way that user transactions could be hardened with the same proof-of-work algorithm thus incentivising all the miners to include that particular transaction. Such mechanism will effectively give a handicap to every miner who includes "mined" transaction into next block, increasing probability of him getting block reward.

Problems and motivation

This document will address the issue of a continuous DDoS attack targeting the Bitcoin network, e.g. full nodes mempools constantly being overflowed with transactions carrying small value reduce system primary ability to transfer value (and hence making it perfect store of value). Valid transactions are cheap to create (in the sense of computational effort required) and no adequate mechanism exist to make transaction total value increase probably of its confirmation by the network.

Currently, miners decide which transactions to include in blocks because it's them who are securing Bitcoin network providing proof-of-work certificates stored inside every block header. Miners have to store the whole blockchain at all times, so one of the costs is storage which grows linearly with the transaction size (blockchain size as well). Another cost is network bandwidth which depends directly on the size of data to be communicated over.

The only incentive a person who wants to transfer his bitcoins is allowed to use is setting of transaction fee, that is going directly to the miner. This solution probably was intended to utilize free market (as implied by Satoshi introducing sequence numbers) to determine appropriate fees, but that is obviously not the case, in the current bitcoin network operating in full block capacity mode. This fee market deviates significantly from a free market premise (also attempts being made to make it closer, e.g. in BIP125 where Replace-By-Fee signaling is supposed to help in replacing "stuck" transactions with noncompetitive fee).

Currently, bitcoin network is susceptible to the DDoS attack of a kind. Adversary creating and translating into the network a lot of transactions carrying small value (e.g. only miners fee), will be able to impair the ability to transfer value for everyone in the world, should he has enough money to pay the fees. Miners would continue to work providing security for the network and new blocks will consist of transaction transferring negligible value. It's a major drawback because the cost of such attack doesn't grow asymmetrically with the cost of BTC asset.

Proposed solution

So how do we incentivize all miners to include our transaction carrying a lot of value in the next block? The only thing a miner supposed to do to get a reward is to produce Hashcash proof-of-work, thus providing cryptographic security guarantees for the whole Bitcoin blockchain. What if including our transaction in a block would reduce effort requirements for the miner produce valid block?

We could do so by extending the concept of proof-of-work, in such a way that we do not sacrifice security at all. Here are both descriptions proof-of-work as-is and to-be:

Standart proof-of-work: hash(previous block hash + current block target + current block metadata + current block transactions) < target

Decentralized proof-of-work: hash(previous block hash + current block target + current block metadata + current block transactions) - sum( FFFF - hash( previous block hash + raw_tx ) ) < target

It is possible to imagine completely mining agnostic proof-of-work, for example, the following PoW would do:

Distributed (mining-agnostic) proof-of-work: sum( FFFF - hash( previous block hash + current block target + current block metadata + signed_tx ) ) < target

Described protocol change could be implemented as user activated soft-fork (described in BIP148), introducing new blocks with the modified proof-of-work concept.

Economic reasoning

An adversary whose goal is to prevent the network from transferring value will have to compete with good users hash rate using same equipment good miners will use. And it's far more complicated than competing with others using the money to pay transaction fees.

In order to investigate probable consequences of protocol upgrade and stability of implied economical equilibrium, we need an adequate game theoretical model. Such model and numerical simulation results should be obtained and studied before any protocol change could be considered by the community.

To me it seems like a win-win solution for everyone owning BTC:

Miners benefit: as the result DDoS attack will be stopped, Bitcoin becomes perfect store-of-value finally. Political decentralization of hash rate will be incentivized as mining equipment becomes relevant to every user.
Users benefit: miners will have direct incentives to include transactions deemed important by their sender and supported by some amount of proof-of-work.

Sincerely yours, Ilya Eriklintsev.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170622/6825dd9b/attachment-0001.html>

From erik.lite at gmail.com  Thu Jun 22 14:18:40 2017
From: erik.lite at gmail.com (Ilya Eriklintsev)
Date: Thu, 22 Jun 2017 17:18:40 +0300
Subject: [bitcoin-dev] BIP Idea : DDoS resistance via decentrilized
	proof-of-work
In-Reply-To: <BLUPR0301MB2002AAC764B140C4DE74768DEEDB0@BLUPR0301MB2002.namprd03.prod.outlook.com>
References: <CA+Yhp0Uv3zrg28G7QcgXPSv4Md9j2U-=SROJqWAOqvW_tCu=bQ@mail.gmail.com>
	<BLUPR0301MB2002AAC764B140C4DE74768DEEDB0@BLUPR0301MB2002.namprd03.prod.outlook.com>
Message-ID: <CA+Yhp0VmAA4ixRURTubttOyW0D_e+YAd=70QC+8FGShA5=JVCw@mail.gmail.com>

Thanks a lot for the reply, let me think it over and come up with a proper
response. You and Conrad may be right about the proposal being irrelevant
to DDoS, so I'll try to come up with the more solid argument supporting my
point of view, otherwise, I will refute the proposal myself). At the moment
I feel like I need to specify game theoretical model and consider all costs
and incentives in more details. Sincerely yours, Ilya Eriklintsev.

On 22 June 2017 at 16:47, John Hardy <john at seebitcoin.com> wrote:

> Hi Ilya,
>
>
> This proposal wouldn't work because bad actors can perform PoW just as
> cheaply as any other participant.
>
>
> The transaction fee already acts as a mechanism to prevent spam. It is not
> a problem to have a lot of low value transactions in the mempool as
> thresholds can easily be set for them to be disregarded/expire - a 300MB
>  maxmempool size by default eliminates any real 'DDOS' risk. Spam only
> really becomes an issue when it enters the blockchain. If a spammer is
> willing to pay the tx fee to spam, they'd be willing to pay the PoW.
>
>
> The only actors who can spam the blockchain at zero cost are the miners
> themselves (beyond the opportunity cost of including genuine fee paying
> transactions). They can even do it without their transactions ever hitting
> the mempool or including a fee, though this behaviour would be easy to spot.
>
>
> If miners are colluding to spam the mempool or blocks in order to increase
> the average transaction cost overall there is little that can be done as
> the network relies on 51% of hashpower being honest. A miner creating spam
> transactions that enter the mempool has the risk that another miner would
> include it in a block and they would incur an economic cost if this
> happened.
>
>
> I had an idea for a dynamic blocksize that required miners to pay a
> percentage of the transaction fees to the next mined block. Here is a
> link: https://lists.linuxfoundation.org/pipermail/
> bitcoin-discuss/2017-January/000123.html
>
>
> If it was established that miners spamming blocks with transactions was an
> issue, this could be used as a disincentive as it means the cost for doing
> so becomes non-zero.
>
>
> Regards,
>
> John Hardy
> john at seebitcoin.com
>
> ------------------------------
> *From:* bitcoin-dev-bounces at lists.linuxfoundation.org <
> bitcoin-dev-bounces at lists.linuxfoundation.org> on behalf of Ilya
> Eriklintsev via bitcoin-dev <bitcoin-dev at lists.linuxfoundation.org>
> *Sent:* Wednesday, June 21, 2017 9:55 AM
> *To:* bitcoin-dev at lists.linuxfoundation.org
> *Subject:* [bitcoin-dev] BIP Idea : DDoS resistance via decentrilized
> proof-of-work
>
> Hello everyone,
>
> recently I have got an idea that in my opinion will improve bitcoin
> network, making it better store-of-value for growing cyberspace and
> cryptoeconomy. Sorry for longread below and thank you for your time.
>
> *Decentralized proof-of-work and DDoS resistance for Bitcoin*
>
> *Abstract*
>
> By introducing some new block validation rules it is possible to make
> Bitcoin network more secure, decentralized and DDoS resistant. The idea is
> to modify simple proof-of-work puzzle in such a way that user transactions
> could be hardened with the same proof-of-work algorithm thus incentivising
> all the miners to include that particular transaction. Such mechanism will
> effectively give a handicap to every miner who includes "mined" transaction
> into next block, increasing probability of him getting block reward.
>
> *Problems and motivation*
>
> This document will address the issue of a continuous DDoS attack targeting
> the Bitcoin network, e.g. full nodes mempools constantly being overflowed
> with transactions carrying small value reduce system primary ability to
> transfer value (and hence making it perfect store of value). Valid
> transactions are cheap to create (in the sense of computational effort
> required) and no adequate mechanism exist to make transaction total value
> increase probably of its confirmation by the network.
>
> Currently, miners decide which transactions to include in blocks because
> it's them who are securing Bitcoin network providing proof-of-work
> certificates stored inside every block header. Miners have to store the
> whole blockchain at all times, so one of the costs is storage which grows
> linearly with the transaction size (blockchain size as well). Another cost
> is network bandwidth which depends directly on the size of data to be
> communicated over.
>
> The only incentive a person who wants to transfer his bitcoins is allowed
> to use is setting of transaction fee, that is going directly to the miner.
> This solution probably was intended to utilize free market (as implied by
> Satoshi introducing sequence numbers) to determine appropriate fees, but
> that is obviously not the case, in the current bitcoin network operating in
> full block capacity mode. This fee market deviates significantly from a
> free market premise (also attempts being made to make it closer, e.g. in
> BIP125 where Replace-By-Fee signaling is supposed to help in replacing
> "stuck" transactions with noncompetitive fee).
>
> Currently, bitcoin network is susceptible to the DDoS attack of a kind.
> Adversary creating and translating into the network a lot of transactions
> carrying small value (e.g. only miners fee), will be able to impair the
> ability to transfer value for everyone in the world, should he has enough
> money to pay the fees. Miners would continue to work providing security for
> the network and new blocks will consist of transaction transferring
> negligible value. It's a major drawback because the cost of such attack
> doesn't grow asymmetrically with the cost of BTC asset.
>
> *Proposed solution*
>
> So how do we incentivize all miners to include our transaction carrying a
> lot of value in the next block? The only thing a miner supposed to do to
> get a reward is to produce Hashcash proof-of-work, thus providing
> cryptographic security guarantees for the whole Bitcoin blockchain. What if
> including our transaction in a block would reduce effort requirements for
> the miner produce valid block?
>
> We could do so by extending the concept of proof-of-work, in such a way
> that we do not sacrifice security at all. Here are both descriptions
> proof-of-work as-is and to-be:
>
> Standart proof-of-work: hash(previous block hash + current block target +
> current block metadata + current block transactions) < target
>
> Decentralized proof-of-work: hash(previous block hash + current block
> target + current block metadata + current block transactions) - sum( FFFF -
> hash( previous block hash + raw_tx ) ) < target
>
> It is possible to imagine completely mining agnostic proof-of-work, for
> example, the following PoW would do:
>
> Distributed (mining-agnostic) proof-of-work: sum( FFFF - hash( previous
> block hash + current block target + current block metadata + signed_tx ) )
> < target
>
> Described protocol change could be implemented as user activated soft-fork
> (described in BIP148), introducing new blocks with the modified
> proof-of-work concept.
>
> * Economic reasoning*
>
> An adversary whose goal is to prevent the network from transferring value
> will have to compete with good users hash rate using same equipment good
> miners will use. And it's far more complicated than competing with others
> using the money to pay transaction fees.
>
> In order to investigate probable consequences of protocol upgrade and
> stability of implied economical equilibrium, we need an adequate game
> theoretical model. Such model and numerical simulation results should be
> obtained and studied before any protocol change could be considered by the
> community.
>
> To me it seems like a win-win solution for everyone owning BTC:
>
> Miners benefit: as the result DDoS attack will be stopped, Bitcoin becomes
> perfect store-of-value finally. Political decentralization of hash rate
> will be incentivized as mining equipment becomes relevant to every user.
> Users benefit: miners will have direct incentives to include transactions
> deemed important by their sender and supported by some amount of
> proof-of-work.
>
> Sincerely yours, Ilya Eriklintsev.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170622/381f77b8/attachment-0001.html>

From erik at q32.com  Thu Jun 22 13:45:33 2017
From: erik at q32.com (Erik Aronesty)
Date: Thu, 22 Jun 2017 09:45:33 -0400
Subject: [bitcoin-dev] Drivechain RfD -- Follow Up
In-Reply-To: <cd96b01e-46ca-9328-2a0a-82ba96d5183c@gmail.com>
References: <24f2b447-a237-45eb-ef9f-1a62533fad5c@gmail.com>
	<83671224-f6ff-16a9-81c0-20ab578aec9d@gmail.com>
	<AAC86547-7904-4475-9966-138130019567@taoeffect.com>
	<6764b8af-bb4c-615d-5af5-462127bbbe36@gmail.com>
	<CAJowKgLJW=kJhcN4B7TbWXLb7U51tzYU3PFOy1m8JqKXqFsU4A@mail.gmail.com>
	<33d98418-10f0-3854-a954-14985d53e04b@gmail.com>
	<CAJowKgKT2rn3N3L+79JEY_uNfKDewcmgkiEB2mJYx1mg+YjGCQ@mail.gmail.com>
	<cd96b01e-46ca-9328-2a0a-82ba96d5183c@gmail.com>
Message-ID: <CAJowKg+u64ZQFEeKMyRXjaLj92o=uJzhpU_jHpPz1CmDNnwOKA@mail.gmail.com>

Users would tolerate depreciation because the intention is to have a cheap
way of transacting using a two-way pegged chain that isn't controlled by
miners.   Who cares about some minor depreciation when the purpose of the
chain is to do cheap secure transactions forever?

Add in UTXO commitments and you've got a system that is cheap and
secure-enough for transfer. storage and accumulation of a ledger... before
moving in to the main chain.

Seems better to me than messing with the main chain's incentive structure
via merged mining.


On Thu, Jun 22, 2017 at 9:27 AM, Paul Sztorc <truthcoin at gmail.com> wrote:

> Hi Erik,
>
> I don't think that your design is competitive. Why would users tolerate a
> depreciation of X% per year, when there are alternatives which do not
> require such depreciation? It seems to me that none would.
>
> Paul
>
> On 6/20/2017 9:38 AM, Erik Aronesty wrote:
>
> - a proof-of-burn sidechain is the ultimate two-way peg.   you have to
> burn bitcoin *or* side-chain tokens to mine the side chain.   the size of
> the burn is the degree of security.    i actually wrote code to do
> randomized blind burns where you have a poisson distribution
> (non-deterministic selected burn).    there is no way to game it... it's
> very similar to algorand - but it uses burns instead of staking
>
> - you can then have a secure sidechain that issues a mining reward in
> sidechain tokens, which can be aggrregated and redeemed for bitcoins.   the
> result of this is that any bitcoins held in the sidechain depreciate in
> value at a rate of X% per year.   this deflation rate pays for increased
> security
>
> - logically this functions like an alt coin, with high inflation and cheap
> transactions.   but the altcoin is pegged to bitcoin's price because of the
> pool of unredeemed bitcoins held within the side chain.
>
>
>
> On Tue, Jun 20, 2017 at 7:54 AM, Paul Sztorc <truthcoin at gmail.com> wrote:
>
>> Hi Erik,
>>
>> As you know:
>>
>> 1. If a sidechain is merged mined it basically grows out of the existing
>> Bitcoin mining network. If it has a different PoW algorithm it is a new
>> mining network.
>> 2. The security (ie, hashrate) of any mining network would be determined
>> by the total economic value of the block. In Bitcoin this is
>> (subsidy+tx_fees)*price, but since a sidechain cannot issue new tokens it
>> would only be (tx_fees)*price.
>>
>> Unfortunately the two have a nasty correlation which can lead to a
>> disastrous self-fulfilling prophecy: users will avoid a network that is too
>> insecure; and if users avoid using a network, they will stop paying txn
>> fees and so the quantity (tx_fees)*price falls toward zero, erasing the
>> network's security. So it is quite problematic and I recommend just biting
>> the bullet and going with merged mining instead.
>>
>> And, the point may be moot. Bitcoin miners may decide that, given their
>> expertise in seeking out cheap sources of power/cooling, they might as well
>> mine both/all chains. So your suggestion may not achieve your desired
>> result (and would, meanwhile, consume more of the economy's resources --
>> some of these would not contribute even to a higher hashrate).
>>
>> Paul
>>
>>
>>
>>
>> On 6/19/2017 1:11 PM, Erik Aronesty wrote:
>>
>> It would be nice to be able to enforce that a drivechain *not* have the
>> same POW as bitcoin.
>>
>> I suspect this is the only way to be sure that a drivechain doesn't
>> destabilize the main chain and push more power to miners that already have
>> too much power.
>>
>>
>>
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170622/bc42c113/attachment.html>

From truthcoin at gmail.com  Thu Jun 22 20:30:39 2017
From: truthcoin at gmail.com (Paul Sztorc)
Date: Thu, 22 Jun 2017 16:30:39 -0400
Subject: [bitcoin-dev] Drivechain RfD -- Follow Up
In-Reply-To: <CAJowKg+u64ZQFEeKMyRXjaLj92o=uJzhpU_jHpPz1CmDNnwOKA@mail.gmail.com>
References: <24f2b447-a237-45eb-ef9f-1a62533fad5c@gmail.com>
	<83671224-f6ff-16a9-81c0-20ab578aec9d@gmail.com>
	<AAC86547-7904-4475-9966-138130019567@taoeffect.com>
	<6764b8af-bb4c-615d-5af5-462127bbbe36@gmail.com>
	<CAJowKgLJW=kJhcN4B7TbWXLb7U51tzYU3PFOy1m8JqKXqFsU4A@mail.gmail.com>
	<33d98418-10f0-3854-a954-14985d53e04b@gmail.com>
	<CAJowKgKT2rn3N3L+79JEY_uNfKDewcmgkiEB2mJYx1mg+YjGCQ@mail.gmail.com>
	<cd96b01e-46ca-9328-2a0a-82ba96d5183c@gmail.com>
	<CAJowKg+u64ZQFEeKMyRXjaLj92o=uJzhpU_jHpPz1CmDNnwOKA@mail.gmail.com>
Message-ID: <ca4c117e-3dba-cf44-775d-dcb49591593e@gmail.com>

Responses inline.

On 6/22/2017 9:45 AM, Erik Aronesty wrote:
> Users would tolerate depreciation because the intention is to have a
> cheap way of transacting using a two-way pegged chain that isn't
> controlled by miners.  Who cares about some minor depreciation when
> the purpose of the chain is to do cheap secure transactions forever?

Thus far you've claimed that these transactions would be "cheap", "[not]
controlled by miners", and "secure".

They would certainly not be cheap, because they are relatively more
expensive due to the extra depreciation cost.

I also doubt that they would be free of control by miners. 51% hashrate
can always filter out any message they want from anywhere.

For the same reason, I don't understand why they would be any more or
less secure.

So I think your way is just a more expensive way of accomplishing
basically the same result.

>
> Add in UTXO commitments and you've got a system that is cheap and
> secure-enough for transfer. storage and accumulation of a ledger...
> before moving in to the main chain.

As I posted to bitcoin-discuss last week, I support UTXO commitments for
sidechains.

> Seems better to me than messing with the main chain's incentive
> structure via merged mining.

I don't think that blind merged mining messes with the main chain's
incentive structure. Miners are free to ignore the sidechain (and yet
still get paid the same as other miners), as are all mainchain users.

Paul
>
> On Thu, Jun 22, 2017 at 9:27 AM, Paul Sztorc <truthcoin at gmail.com
> <mailto:truthcoin at gmail.com>> wrote:
>
>     Hi Erik,
>
>     I don't think that your design is competitive. Why would users
>     tolerate a depreciation of X% per year, when there are
>     alternatives which do not require such depreciation? It seems to
>     me that none would.
>
>     Paul
>
>     On 6/20/2017 9:38 AM, Erik Aronesty wrote:
>>     - a proof-of-burn sidechain is the ultimate two-way peg.   you
>>     have to burn bitcoin *or* side-chain tokens to mine the side
>>     chain.   the size of the burn is the degree of security.    i
>>     actually wrote code to do randomized blind burns where you have a
>>     poisson distribution (non-deterministic selected burn).    there
>>     is no way to game it... it's very similar to algorand - but it
>>     uses burns instead of staking
>>
>>     - you can then have a secure sidechain that issues a mining
>>     reward in sidechain tokens, which can be aggrregated and redeemed
>>     for bitcoins.   the result of this is that any bitcoins held in
>>     the sidechain depreciate in value at a rate of X% per year.  
>>     this deflation rate pays for increased security
>>
>>     - logically this functions like an alt coin, with high inflation
>>     and cheap transactions.   but the altcoin is pegged to bitcoin's
>>     price because of the pool of unredeemed bitcoins held within the
>>     side chain.
>>
>>
>>
>>     On Tue, Jun 20, 2017 at 7:54 AM, Paul Sztorc <truthcoin at gmail.com
>>     <mailto:truthcoin at gmail.com>> wrote:
>>
>>         Hi Erik,
>>
>>         As you know:
>>
>>         1. If a sidechain is merged mined it basically grows out of
>>         the existing Bitcoin mining network. If it has a different
>>         PoW algorithm it is a new mining network.
>>         2. The security (ie, hashrate) of any mining network would be
>>         determined by the total economic value of the block. In
>>         Bitcoin this is (subsidy+tx_fees)*price, but since a
>>         sidechain cannot issue new tokens it would only be
>>         (tx_fees)*price.
>>
>>         Unfortunately the two have a nasty correlation which can lead
>>         to a disastrous self-fulfilling prophecy: users will avoid a
>>         network that is too insecure; and if users avoid using a
>>         network, they will stop paying txn fees and so the quantity
>>         (tx_fees)*price falls toward zero, erasing the network's
>>         security. So it is quite problematic and I recommend just
>>         biting the bullet and going with merged mining instead.
>>
>>         And, the point may be moot. Bitcoin miners may decide that,
>>         given their expertise in seeking out cheap sources of
>>         power/cooling, they might as well mine both/all chains. So
>>         your suggestion may not achieve your desired result (and
>>         would, meanwhile, consume more of the economy's resources --
>>         some of these would not contribute even to a higher hashrate).
>>
>>         Paul
>>
>>
>>
>>
>>         On 6/19/2017 1:11 PM, Erik Aronesty wrote:
>>>         It would be nice to be able to enforce that a drivechain
>>>         *not* have the same POW as bitcoin.
>>>
>>>         I suspect this is the only way to be sure that a drivechain
>>>         doesn't destabilize the main chain and push more power to
>>>         miners that already have too much power.
>>>
>>>
>>
>>
>
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170622/cb6a08cf/attachment-0001.html>

From erik at q32.com  Fri Jun 23 14:19:18 2017
From: erik at q32.com (Erik Aronesty)
Date: Fri, 23 Jun 2017 10:19:18 -0400
Subject: [bitcoin-dev] Drivechain RfD -- Follow Up
In-Reply-To: <ca4c117e-3dba-cf44-775d-dcb49591593e@gmail.com>
References: <24f2b447-a237-45eb-ef9f-1a62533fad5c@gmail.com>
	<83671224-f6ff-16a9-81c0-20ab578aec9d@gmail.com>
	<AAC86547-7904-4475-9966-138130019567@taoeffect.com>
	<6764b8af-bb4c-615d-5af5-462127bbbe36@gmail.com>
	<CAJowKgLJW=kJhcN4B7TbWXLb7U51tzYU3PFOy1m8JqKXqFsU4A@mail.gmail.com>
	<33d98418-10f0-3854-a954-14985d53e04b@gmail.com>
	<CAJowKgKT2rn3N3L+79JEY_uNfKDewcmgkiEB2mJYx1mg+YjGCQ@mail.gmail.com>
	<cd96b01e-46ca-9328-2a0a-82ba96d5183c@gmail.com>
	<CAJowKg+u64ZQFEeKMyRXjaLj92o=uJzhpU_jHpPz1CmDNnwOKA@mail.gmail.com>
	<ca4c117e-3dba-cf44-775d-dcb49591593e@gmail.com>
Message-ID: <CAJowKg+GLDmOexa89etFep7H1hNEGbqkm_mk79xby7Ka0znS-g@mail.gmail.com>

> They would certainly not be cheap, because they are relatively more
expensive due to the extra depreciation cost.

This depends on how long you expect to keep money on a side chain and how
many transactions you plan on doing.   Inflation is a great way of paying
PoS / PoB  miners - that cannot introduce issues with consolidation.   If
you design the inflation schedule correctly, it should be balance
transaction costs *precisely*.   Indeed, you can calculate the exact amount
of inflation needed to guarantee that a side chain is always exactly 10
times cheaper than bitcoin.

>As I posted to bitcoin-discuss last week, I support UTXO commitments for
sidechains.

Indeed, I think side chain nodes should always be fast-synced from 6 month
old commitments and thus be ephemeral, cheap, and *never *appropriate for
long term storage.  This would provide the best possible incentive
structure to keep the main chain secure, paid for with high clearing fees,
etc.

> I don't think that blind merged mining messes with the main chain's
incentive structure

The critical issue is that we cannot introduce protocol changes that
*further *incentivize geographical and institutional consolidation.  Miners
who are able to deal with the bandwidth caused by drivechain coffee
transactions will profit from these transactions, whereas smaller and more
geographically distributed miners will not.   Those miners will, in turn,
build faster ASICs and buy more electricity and drive out smaller players.
  I think this is *abundantly *clear, and is the primary motivation behind
preserving block size limits.

If this premise is false (which it may be), or is skewed so as to damage
bitcoin as a whole (could be as well), then that needs to be demonstrated
*first*.

The lightning model does the opposite of this.   Miners watch fees increase
and coming from an *orthoganal* protocol that cannot cause further
centralization.

One problem is that the main chain also *must* grow in response to
bandwidth, or the disadvantages of using the main chain will weaken
financial support and hashrate securing it.   I believe this is also true,
and that a "balancing act" will be Bitcoin's norm until we adopt something
like BIP103 - which provides a steady and appropriate growth.





On Thu, Jun 22, 2017 at 4:30 PM, Paul Sztorc <truthcoin at gmail.com> wrote:

> Responses inline.
>
> On 6/22/2017 9:45 AM, Erik Aronesty wrote:
>
> Users would tolerate depreciation because the intention is to have a cheap
> way of transacting using a two-way pegged chain that isn't controlled by
> miners.  Who cares about some minor depreciation when the purpose of the
> chain is to do cheap secure transactions forever?
>
>
> Thus far you've claimed that these transactions would be "cheap", "[not]
> controlled by miners", and "secure".
>
> They would certainly not be cheap, because they are relatively more
> expensive due to the extra depreciation cost.
>
> I also doubt that they would be free of control by miners. 51% hashrate
> can always filter out any message they want from anywhere.
>
> For the same reason, I don't understand why they would be any more or less
> secure.
>
> So I think your way is just a more expensive way of accomplishing
> basically the same result.
>
>
> Add in UTXO commitments and you've got a system that is cheap and
> secure-enough for transfer. storage and accumulation of a ledger... before
> moving in to the main chain.
>
>
> As I posted to bitcoin-discuss last week, I support UTXO commitments for
> sidechains.
>
> Seems better to me than messing with the main chain's incentive structure
> via merged mining.
>
>
> I don't think that blind merged mining messes with the main chain's
> incentive structure. Miners are free to ignore the sidechain (and yet still
> get paid the same as other miners), as are all mainchain users.
>
> Paul
>
>
> On Thu, Jun 22, 2017 at 9:27 AM, Paul Sztorc <truthcoin at gmail.com> wrote:
>
>> Hi Erik,
>>
>> I don't think that your design is competitive. Why would users tolerate a
>> depreciation of X% per year, when there are alternatives which do not
>> require such depreciation? It seems to me that none would.
>>
>> Paul
>>
>> On 6/20/2017 9:38 AM, Erik Aronesty wrote:
>>
>> - a proof-of-burn sidechain is the ultimate two-way peg.   you have to
>> burn bitcoin *or* side-chain tokens to mine the side chain.   the size of
>> the burn is the degree of security.    i actually wrote code to do
>> randomized blind burns where you have a poisson distribution
>> (non-deterministic selected burn).    there is no way to game it... it's
>> very similar to algorand - but it uses burns instead of staking
>>
>> - you can then have a secure sidechain that issues a mining reward in
>> sidechain tokens, which can be aggrregated and redeemed for bitcoins.   the
>> result of this is that any bitcoins held in the sidechain depreciate in
>> value at a rate of X% per year.   this deflation rate pays for increased
>> security
>>
>> - logically this functions like an alt coin, with high inflation and
>> cheap transactions.   but the altcoin is pegged to bitcoin's price because
>> of the pool of unredeemed bitcoins held within the side chain.
>>
>>
>>
>> On Tue, Jun 20, 2017 at 7:54 AM, Paul Sztorc <truthcoin at gmail.com> wrote:
>>
>>> Hi Erik,
>>>
>>> As you know:
>>>
>>> 1. If a sidechain is merged mined it basically grows out of the existing
>>> Bitcoin mining network. If it has a different PoW algorithm it is a new
>>> mining network.
>>> 2. The security (ie, hashrate) of any mining network would be determined
>>> by the total economic value of the block. In Bitcoin this is
>>> (subsidy+tx_fees)*price, but since a sidechain cannot issue new tokens it
>>> would only be (tx_fees)*price.
>>>
>>> Unfortunately the two have a nasty correlation which can lead to a
>>> disastrous self-fulfilling prophecy: users will avoid a network that is too
>>> insecure; and if users avoid using a network, they will stop paying txn
>>> fees and so the quantity (tx_fees)*price falls toward zero, erasing the
>>> network's security. So it is quite problematic and I recommend just biting
>>> the bullet and going with merged mining instead.
>>>
>>> And, the point may be moot. Bitcoin miners may decide that, given their
>>> expertise in seeking out cheap sources of power/cooling, they might as well
>>> mine both/all chains. So your suggestion may not achieve your desired
>>> result (and would, meanwhile, consume more of the economy's resources --
>>> some of these would not contribute even to a higher hashrate).
>>>
>>> Paul
>>>
>>>
>>>
>>>
>>> On 6/19/2017 1:11 PM, Erik Aronesty wrote:
>>>
>>> It would be nice to be able to enforce that a drivechain *not* have the
>>> same POW as bitcoin.
>>>
>>> I suspect this is the only way to be sure that a drivechain doesn't
>>> destabilize the main chain and push more power to miners that already have
>>> too much power.
>>>
>>>
>>>
>>>
>>
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170623/7f19dcfe/attachment.html>

From ethan.scruples at gmail.com  Fri Jun 23 14:51:20 2017
From: ethan.scruples at gmail.com (Moral Agent)
Date: Fri, 23 Jun 2017 10:51:20 -0400
Subject: [bitcoin-dev] Drivechain RfD -- Follow Up
In-Reply-To: <CAJowKg+GLDmOexa89etFep7H1hNEGbqkm_mk79xby7Ka0znS-g@mail.gmail.com>
References: <24f2b447-a237-45eb-ef9f-1a62533fad5c@gmail.com>
	<83671224-f6ff-16a9-81c0-20ab578aec9d@gmail.com>
	<AAC86547-7904-4475-9966-138130019567@taoeffect.com>
	<6764b8af-bb4c-615d-5af5-462127bbbe36@gmail.com>
	<CAJowKgLJW=kJhcN4B7TbWXLb7U51tzYU3PFOy1m8JqKXqFsU4A@mail.gmail.com>
	<33d98418-10f0-3854-a954-14985d53e04b@gmail.com>
	<CAJowKgKT2rn3N3L+79JEY_uNfKDewcmgkiEB2mJYx1mg+YjGCQ@mail.gmail.com>
	<cd96b01e-46ca-9328-2a0a-82ba96d5183c@gmail.com>
	<CAJowKg+u64ZQFEeKMyRXjaLj92o=uJzhpU_jHpPz1CmDNnwOKA@mail.gmail.com>
	<ca4c117e-3dba-cf44-775d-dcb49591593e@gmail.com>
	<CAJowKg+GLDmOexa89etFep7H1hNEGbqkm_mk79xby7Ka0znS-g@mail.gmail.com>
Message-ID: <CACiOHGyTySC5=+v6WzAoP09RzUR0ofccsAX-OeAwRv2fnXn32Q@mail.gmail.com>

>Miners who are able to deal with the bandwidth caused by drivechain coffee
transactions will profit from these transactions, whereas smaller and more
geographically distributed miners will not.   Those miners will, in turn,
build faster ASICs and buy more electricity and drive out smaller players.

I think you are conflating 3 different (though overlapping) groups:

1. Block header generators. These need 'good internet' meaning very low
latency, reasonable bandwidth, good place in network (e.g. FIBRE or mining
backbone). They need reliable computers with enough RAM and CPU to validate
prior blocks promptly and immediately assemble new blocks.

2. Hashers. These need cheap electricity, access to economical uses of
waste heat, cheap mining hardware. e.g. IOT electric water heater.

3. ASIC manufacturers. These need lots of capital, etc.

It might be helpful to keep these three groups distinct in your mind and
conversation, and to use the protocol as a crowbar to pry them into
separate people, or at a minimum make it economically possible to
participate in one role without needing to participate in the other two. If
different, geographically and politically dispersed groups are helping
perform these functions, it aids decentralization.

On Fri, Jun 23, 2017 at 10:19 AM, Erik Aronesty via bitcoin-dev <
bitcoin-dev at lists.linuxfoundation.org> wrote:

> > They would certainly not be cheap, because they are relatively more
> expensive due to the extra depreciation cost.
>
> This depends on how long you expect to keep money on a side chain and how
> many transactions you plan on doing.   Inflation is a great way of paying
> PoS / PoB  miners - that cannot introduce issues with consolidation.   If
> you design the inflation schedule correctly, it should be balance
> transaction costs *precisely*.   Indeed, you can calculate the exact amount
> of inflation needed to guarantee that a side chain is always exactly 10
> times cheaper than bitcoin.
>
> >As I posted to bitcoin-discuss last week, I support UTXO commitments for
> sidechains.
>
> Indeed, I think side chain nodes should always be fast-synced from 6 month
> old commitments and thus be ephemeral, cheap, and *never *appropriate for
> long term storage.  This would provide the best possible incentive
> structure to keep the main chain secure, paid for with high clearing fees,
> etc.
>
> > I don't think that blind merged mining messes with the main chain's
> incentive structure
>
> The critical issue is that we cannot introduce protocol changes that
> *further *incentivize geographical and institutional consolidation.
> Miners who are able to deal with the bandwidth caused by drivechain coffee
> transactions will profit from these transactions, whereas smaller and more
> geographically distributed miners will not.   Those miners will, in turn,
> build faster ASICs and buy more electricity and drive out smaller players.
>   I think this is *abundantly *clear, and is the primary motivation
> behind preserving block size limits.
>
> If this premise is false (which it may be), or is skewed so as to damage
> bitcoin as a whole (could be as well), then that needs to be demonstrated
> *first*.
>
> The lightning model does the opposite of this.   Miners watch fees
> increase and coming from an *orthoganal* protocol that cannot cause further
> centralization.
>
> One problem is that the main chain also *must* grow in response to
> bandwidth, or the disadvantages of using the main chain will weaken
> financial support and hashrate securing it.   I believe this is also true,
> and that a "balancing act" will be Bitcoin's norm until we adopt something
> like BIP103 - which provides a steady and appropriate growth.
>
>
>
>
>
> On Thu, Jun 22, 2017 at 4:30 PM, Paul Sztorc <truthcoin at gmail.com> wrote:
>
>> Responses inline.
>>
>> On 6/22/2017 9:45 AM, Erik Aronesty wrote:
>>
>> Users would tolerate depreciation because the intention is to have a
>> cheap way of transacting using a two-way pegged chain that isn't controlled
>> by miners.  Who cares about some minor depreciation when the purpose of the
>> chain is to do cheap secure transactions forever?
>>
>>
>> Thus far you've claimed that these transactions would be "cheap", "[not]
>> controlled by miners", and "secure".
>>
>> They would certainly not be cheap, because they are relatively more
>> expensive due to the extra depreciation cost.
>>
>> I also doubt that they would be free of control by miners. 51% hashrate
>> can always filter out any message they want from anywhere.
>>
>> For the same reason, I don't understand why they would be any more or
>> less secure.
>>
>> So I think your way is just a more expensive way of accomplishing
>> basically the same result.
>>
>>
>> Add in UTXO commitments and you've got a system that is cheap and
>> secure-enough for transfer. storage and accumulation of a ledger... before
>> moving in to the main chain.
>>
>>
>> As I posted to bitcoin-discuss last week, I support UTXO commitments for
>> sidechains.
>>
>> Seems better to me than messing with the main chain's incentive structure
>> via merged mining.
>>
>>
>> I don't think that blind merged mining messes with the main chain's
>> incentive structure. Miners are free to ignore the sidechain (and yet still
>> get paid the same as other miners), as are all mainchain users.
>>
>> Paul
>>
>>
>> On Thu, Jun 22, 2017 at 9:27 AM, Paul Sztorc <truthcoin at gmail.com> wrote:
>>
>>> Hi Erik,
>>>
>>> I don't think that your design is competitive. Why would users tolerate
>>> a depreciation of X% per year, when there are alternatives which do not
>>> require such depreciation? It seems to me that none would.
>>>
>>> Paul
>>>
>>> On 6/20/2017 9:38 AM, Erik Aronesty wrote:
>>>
>>> - a proof-of-burn sidechain is the ultimate two-way peg.   you have to
>>> burn bitcoin *or* side-chain tokens to mine the side chain.   the size of
>>> the burn is the degree of security.    i actually wrote code to do
>>> randomized blind burns where you have a poisson distribution
>>> (non-deterministic selected burn).    there is no way to game it... it's
>>> very similar to algorand - but it uses burns instead of staking
>>>
>>> - you can then have a secure sidechain that issues a mining reward in
>>> sidechain tokens, which can be aggrregated and redeemed for bitcoins.   the
>>> result of this is that any bitcoins held in the sidechain depreciate in
>>> value at a rate of X% per year.   this deflation rate pays for increased
>>> security
>>>
>>> - logically this functions like an alt coin, with high inflation and
>>> cheap transactions.   but the altcoin is pegged to bitcoin's price because
>>> of the pool of unredeemed bitcoins held within the side chain.
>>>
>>>
>>>
>>> On Tue, Jun 20, 2017 at 7:54 AM, Paul Sztorc <truthcoin at gmail.com>
>>> wrote:
>>>
>>>> Hi Erik,
>>>>
>>>> As you know:
>>>>
>>>> 1. If a sidechain is merged mined it basically grows out of the
>>>> existing Bitcoin mining network. If it has a different PoW algorithm it is
>>>> a new mining network.
>>>> 2. The security (ie, hashrate) of any mining network would be
>>>> determined by the total economic value of the block. In Bitcoin this is
>>>> (subsidy+tx_fees)*price, but since a sidechain cannot issue new tokens it
>>>> would only be (tx_fees)*price.
>>>>
>>>> Unfortunately the two have a nasty correlation which can lead to a
>>>> disastrous self-fulfilling prophecy: users will avoid a network that is too
>>>> insecure; and if users avoid using a network, they will stop paying txn
>>>> fees and so the quantity (tx_fees)*price falls toward zero, erasing the
>>>> network's security. So it is quite problematic and I recommend just biting
>>>> the bullet and going with merged mining instead.
>>>>
>>>> And, the point may be moot. Bitcoin miners may decide that, given their
>>>> expertise in seeking out cheap sources of power/cooling, they might as well
>>>> mine both/all chains. So your suggestion may not achieve your desired
>>>> result (and would, meanwhile, consume more of the economy's resources --
>>>> some of these would not contribute even to a higher hashrate).
>>>>
>>>> Paul
>>>>
>>>>
>>>>
>>>>
>>>> On 6/19/2017 1:11 PM, Erik Aronesty wrote:
>>>>
>>>> It would be nice to be able to enforce that a drivechain *not* have the
>>>> same POW as bitcoin.
>>>>
>>>> I suspect this is the only way to be sure that a drivechain doesn't
>>>> destabilize the main chain and push more power to miners that already have
>>>> too much power.
>>>>
>>>>
>>>>
>>>>
>>>
>>>
>>
>>
>
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170623/1d48aca3/attachment-0001.html>

From truthcoin at gmail.com  Fri Jun 23 18:11:26 2017
From: truthcoin at gmail.com (Paul Sztorc)
Date: Fri, 23 Jun 2017 14:11:26 -0400
Subject: [bitcoin-dev] Drivechain RfD -- Follow Up
In-Reply-To: <CAJowKg+GLDmOexa89etFep7H1hNEGbqkm_mk79xby7Ka0znS-g@mail.gmail.com>
References: <24f2b447-a237-45eb-ef9f-1a62533fad5c@gmail.com>
	<83671224-f6ff-16a9-81c0-20ab578aec9d@gmail.com>
	<AAC86547-7904-4475-9966-138130019567@taoeffect.com>
	<6764b8af-bb4c-615d-5af5-462127bbbe36@gmail.com>
	<CAJowKgLJW=kJhcN4B7TbWXLb7U51tzYU3PFOy1m8JqKXqFsU4A@mail.gmail.com>
	<33d98418-10f0-3854-a954-14985d53e04b@gmail.com>
	<CAJowKgKT2rn3N3L+79JEY_uNfKDewcmgkiEB2mJYx1mg+YjGCQ@mail.gmail.com>
	<cd96b01e-46ca-9328-2a0a-82ba96d5183c@gmail.com>
	<CAJowKg+u64ZQFEeKMyRXjaLj92o=uJzhpU_jHpPz1CmDNnwOKA@mail.gmail.com>
	<ca4c117e-3dba-cf44-775d-dcb49591593e@gmail.com>
	<CAJowKg+GLDmOexa89etFep7H1hNEGbqkm_mk79xby7Ka0znS-g@mail.gmail.com>
Message-ID: <4e79ca13-17f7-d5ed-1c7f-c9e01e88ad95@gmail.com>

On 6/23/2017 10:19 AM, Erik Aronesty wrote:
> > They would certainly not be cheap, because they are relatively more expensive due to the
> extra depreciation cost.
>
> If you design the inflation schedule correctly, it should be balance
> transaction costs *precisely*.

You have not explained how your scheme would cause a relative decrease
in transaction costs. The way I see it, tx costs would be exactly the
same, so it would in fact be impossible to design an inflation schedule
to "balance" these costs (other than inflation of zero as I suggest).

>
> > I don't think that blind merged mining messes with the main chain's
> incentive structure 
>
> Miners who are able to deal with the bandwidth caused by drivechain
> coffee transactions
There is no additional bandwidth requirement. That is the point of BMM.
They do not even need to run a sidechain node (to be paid just as much
as if they had).

--Paul



>
> On Thu, Jun 22, 2017 at 4:30 PM, Paul Sztorc <truthcoin at gmail.com
> <mailto:truthcoin at gmail.com>> wrote:
>
>     Responses inline.
>
>     On 6/22/2017 9:45 AM, Erik Aronesty wrote:
>>     Users would tolerate depreciation because the intention is to
>>     have a cheap way of transacting using a two-way pegged chain that
>>     isn't controlled by miners.  Who cares about some minor
>>     depreciation when the purpose of the chain is to do cheap secure
>>     transactions forever?
>
>     Thus far you've claimed that these transactions would be "cheap",
>     "[not] controlled by miners", and "secure".
>
>     They would certainly not be cheap, because they are relatively
>     more expensive due to the extra depreciation cost.
>
>     I also doubt that they would be free of control by miners. 51%
>     hashrate can always filter out any message they want from anywhere.
>
>     For the same reason, I don't understand why they would be any more
>     or less secure.
>
>     So I think your way is just a more expensive way of accomplishing
>     basically the same result.
>
>>
>>     Add in UTXO commitments and you've got a system that is cheap and
>>     secure-enough for transfer. storage and accumulation of a
>>     ledger... before moving in to the main chain.
>
>     As I posted to bitcoin-discuss last week, I support UTXO
>     commitments for sidechains.
>
>>     Seems better to me than messing with the main chain's incentive
>>     structure via merged mining.
>
>     I don't think that blind merged mining messes with the main
>     chain's incentive structure. Miners are free to ignore the
>     sidechain (and yet still get paid the same as other miners), as
>     are all mainchain users.
>
>     Paul
>>
>>     On Thu, Jun 22, 2017 at 9:27 AM, Paul Sztorc <truthcoin at gmail.com
>>     <mailto:truthcoin at gmail.com>> wrote:
>>
>>         Hi Erik,
>>
>>         I don't think that your design is competitive. Why would
>>         users tolerate a depreciation of X% per year, when there are
>>         alternatives which do not require such depreciation? It seems
>>         to me that none would.
>>
>>         Paul
>>
>>         On 6/20/2017 9:38 AM, Erik Aronesty wrote:
>>>         - a proof-of-burn sidechain is the ultimate two-way peg.  
>>>         you have to burn bitcoin *or* side-chain tokens to mine the
>>>         side chain.   the size of the burn is the degree of
>>>         security.    i actually wrote code to do randomized blind
>>>         burns where you have a poisson distribution
>>>         (non-deterministic selected burn).    there is no way to
>>>         game it... it's very similar to algorand - but it uses burns
>>>         instead of staking
>>>
>>>         - you can then have a secure sidechain that issues a mining
>>>         reward in sidechain tokens, which can be aggrregated and
>>>         redeemed for bitcoins.   the result of this is that any
>>>         bitcoins held in the sidechain depreciate in value at a rate
>>>         of X% per year.   this deflation rate pays for increased
>>>         security
>>>
>>>         - logically this functions like an alt coin, with high
>>>         inflation and cheap transactions.   but the altcoin is
>>>         pegged to bitcoin's price because of the pool of unredeemed
>>>         bitcoins held within the side chain.
>>>
>>>
>>>
>>>         On Tue, Jun 20, 2017 at 7:54 AM, Paul Sztorc
>>>         <truthcoin at gmail.com <mailto:truthcoin at gmail.com>> wrote:
>>>
>>>             Hi Erik,
>>>
>>>             As you know:
>>>
>>>             1. If a sidechain is merged mined it basically grows out
>>>             of the existing Bitcoin mining network. If it has a
>>>             different PoW algorithm it is a new mining network.
>>>             2. The security (ie, hashrate) of any mining network
>>>             would be determined by the total economic value of the
>>>             block. In Bitcoin this is (subsidy+tx_fees)*price, but
>>>             since a sidechain cannot issue new tokens it would only
>>>             be (tx_fees)*price.
>>>
>>>             Unfortunately the two have a nasty correlation which can
>>>             lead to a disastrous self-fulfilling prophecy: users
>>>             will avoid a network that is too insecure; and if users
>>>             avoid using a network, they will stop paying txn fees
>>>             and so the quantity (tx_fees)*price falls toward zero,
>>>             erasing the network's security. So it is quite
>>>             problematic and I recommend just biting the bullet and
>>>             going with merged mining instead.
>>>
>>>             And, the point may be moot. Bitcoin miners may decide
>>>             that, given their expertise in seeking out cheap sources
>>>             of power/cooling, they might as well mine both/all
>>>             chains. So your suggestion may not achieve your desired
>>>             result (and would, meanwhile, consume more of the
>>>             economy's resources -- some of these would not
>>>             contribute even to a higher hashrate).
>>>
>>>             Paul
>>>
>>>
>>>
>>>
>>>             On 6/19/2017 1:11 PM, Erik Aronesty wrote:
>>>>             It would be nice to be able to enforce that a
>>>>             drivechain *not* have the same POW as bitcoin.
>>>>
>>>>             I suspect this is the only way to be sure that a
>>>>             drivechain doesn't destabilize the main chain and push
>>>>             more power to miners that already have too much power.
>>>>
>>>>
>>>
>>>
>>
>>
>
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170623/f6a7f0fc/attachment.html>

From pete at petertodd.org  Tue Jun 27 04:13:08 2017
From: pete at petertodd.org (Peter Todd)
Date: Tue, 27 Jun 2017 00:13:08 -0400
Subject: [bitcoin-dev] A Method for Computing Merkle Roots of Annotated
 Binary Trees
In-Reply-To: <CAMZUoK=8xaVp2Qoc7kvx8FdPbpY0rEpSba8kQVRQGjX4p0haxg@mail.gmail.com>
References: <CAMZUoK=f3hXHkqJBDfiLGSrgXi_ppgyH6+XWD9W54EYFWLm1+Q@mail.gmail.com>
	<20170528082624.GA14552@fedora-23-dvm>
	<CAMZUoK=8xaVp2Qoc7kvx8FdPbpY0rEpSba8kQVRQGjX4p0haxg@mail.gmail.com>
Message-ID: <20170627041308.GA23776@savin.petertodd.org>

On Mon, May 29, 2017 at 10:55:37AM -0400, Russell O'Connor wrote:
> > This doesn't hold true in the case of pruned trees, as for the pruning to
> > be
> > useful, you don't know what produced the left merkleRoot, and thus you
> > can't
> > guarantee it is in fact a midstate of a genuine SHA256 hash.
> >
> 
> Thanks for the review Peter.  This does seem like a serious issue that I
> hadn't considered yet.  As far as I understand, we have no reason to think
> that the SHA-256 compression function will be secure with chosen initial
> values.

Relevant: fixed points can be found for the SHA256 compression function, if the
attacker can control the IV:

https://crypto.stackexchange.com/questions/48580/fixed-point-of-the-sha-256-compression-function

-- 
https://petertodd.org 'peter'[:-1]@petertodd.org
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 455 bytes
Desc: Digital signature
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170627/79b22ad1/attachment-0001.sig>

From sergio.d.lerner at gmail.com  Tue Jun 27 15:42:53 2017
From: sergio.d.lerner at gmail.com (Sergio Demian Lerner)
Date: Tue, 27 Jun 2017 12:42:53 -0300
Subject: [bitcoin-dev] Miners forced to run non-core code in order to
 get segwit activated
In-Reply-To: <CAAUaCyijF1eHSffUYf9Mrv+KP5H+NLBcy5MEhMUyT6Rxcbx93g@mail.gmail.com>
References: <CAJowKgLtu-HUDuakk4DDU53nyChbQk_zY=f5OO2j1Za95PdL7w@mail.gmail.com>
	<CAAS2fgSZ_X3G7j3-S6tAGPe2TOTT2umBB8a0RHpD-wAHN9aPgw@mail.gmail.com>
	<CAFMkqK_73RrpaS2oJQ-0o6oC29m6a1h411_P7HmVcAyX712Sgw@mail.gmail.com>
	<CAAUaCyg2Nmsa2UaO2msBqSFeHLetUUN+cTETvSSmB7c=nH9ZhQ@mail.gmail.com>
	<BC758648-BD4F-4DEF-8B79-7E8E0A887033@friedenbach.org>
	<CAAUaCyh+4m+t9d4yOoEOf6VUDyJ=sUpDT3hD3cDmd9dcBQZ+nw@mail.gmail.com>
	<CAJowKgJcp7d30LsrDZ5iR6-k9Ncz0N90pxs2GmJkuG1qYDG6GQ@mail.gmail.com>
	<CAOG=w-tPgJ5baaNiZC5rTs_y=eV7AU+F=aGaH+uObqaB-VgL2w@mail.gmail.com>
	<CAAUaCyijF1eHSffUYf9Mrv+KP5H+NLBcy5MEhMUyT6Rxcbx93g@mail.gmail.com>
Message-ID: <CAKzdR-rvP9RLJ=qGDMVyOT3WVqp7q2tUPpzbaQZ=wStsFSCbWA@mail.gmail.com>

Currently the only implementation that fulfills the requirements of the NYA
agreement is the segwit2x/btc1 implementation, which is being finalized
this week.

Segwit2mb does not fulfill the NYA agreement.

I'm asking now the segwit2x development team when a BIP will be ready so
that Core has the opportunity to evaluate the technical proposal.




On Wed, Jun 21, 2017 at 1:05 AM, Jacob Eliosoff via bitcoin-dev <
bitcoin-dev at lists.linuxfoundation.org> wrote:

> Well, this Saturday's "Chinese roundtable" statement from a bunch of
> miners (https://pastebin.com/b3St9VCF) says they intend "NYA" in the
> coinbase as support for "the New York consensus SegWit2x program btc1 (
> https://github.com/btc1)", whose code includes the (accelerated
> 336-block) BIP 91 change.  So, other facts or interpretations could come to
> light, but until they do we should probably assume that's what the "NYA"
> (which just broke 80% over the last 24h) means.
>
>
> On Tue, Jun 20, 2017 at 10:11 PM, Mark Friedenbach <mark at friedenbach.org>
> wrote:
>
>> 80% have set "NYA" in their coinbase string. We have no idea what that
>> means. People are equating it to BIP 91 -- but BIP 91 did not exist at
>> the time of the New York agreement, and differs from the actual text
>> of the NYA in substantive ways. The "Segwit2MB" that existed at the
>> time of the NYA, and which was explicitly referenced by the text is
>> the proposal by Sergio Demian Lerner that was made to this mailing
>> list on 31 March. The text of the NYA grants no authority for
>> upgrading this proposal while remaining compliant with the agreement.
>> This is without even considering the fact that in the days after the
>> NYA there was disagreement among those who signed it as to what it
>> meant.
>>
>> I feel it is a very dangerous and unwarranted assumption people are
>> making that what we are seeing now is either 80% support for BIP-91 or
>> for the code in the btc1 repo.
>>
>> On Tue, Jun 20, 2017 at 6:36 PM, Erik Aronesty <erik at q32.com> wrote:
>> > # Jacob Eliosoff:
>> >
>> >>  will start orphaning non-bit-1 blocks before Aug 1, and we avoid a
>> split.
>> >
>> > Correct.  There are 2 short activation periods in BIP91 either of which
>> > would avoid a split.
>> >
>> > # Gregory Maxwell:
>> >
>> >> unclear to me _exactly_ what it would need to implement to be
>> consistent.
>> >
>> > This is the relevant pull req to core:
>> >
>> > https://github.com/bitcoin/bitcoin/pull/10444
>> >
>> > Seems OK.  It's technically running now on testnet5.   I think it (or a
>> > -bip148 option) should be merged as soon as feasible.
>> >
>> >> previously debunked "XT" and "Classic" hysteria.
>> >
>> > apples vs oranges, imo.   segwit is not a contentious feature.   the
>> > "bundling" in segwit2x is, but that's not the issue here.   the issue
>> is we
>> > are indirectly requiring miners that strongly support segwit to install
>> > consensus protocol changes outside of bitcoin's standard reference.
>>  80% of
>> > them have signaled they will do so.   these are uncharted waters.
>> >
>> >
>> > On Tue, Jun 20, 2017 at 6:57 PM, Jacob Eliosoff via bitcoin-dev
>> > <bitcoin-dev at lists.linuxfoundation.org> wrote:
>> >>
>> >> I could be wrong, but the latest BIP91 implementation (also included in
>> >> Segwit2x) cuts the activation period to 336 blocks (2.33 days).  (This
>> has
>> >> been updated at
>> >> https://github.com/bitcoin/bips/blob/master/bip-0091.mediawiki.)  So
>> if 80%
>> >> of hashpower is actually running that code and signaling on bit 4 by
>> July 25
>> >> or so, then those 80+% will start orphaning non-bit-1 blocks before
>> Aug 1,
>> >> and we avoid a split.
>> >>
>> >> There may still be a few non-bit-1 blocks that get orphaned after Aug
>> 1,
>> >> because they're mined by old BIP141 nodes.  But it seems like very few
>> >> miners won't be signaling either Segwit2x *or* BIP141 by then...
>> >>
>> >> Make sense?
>> >>
>> >>
>> >> On Tue, Jun 20, 2017 at 6:48 PM, Mark Friedenbach <
>> mark at friedenbach.org>
>> >> wrote:
>> >>>
>> >>> Why do you say activation by August 1st is likely? That would require
>> an
>> >>> entire difficulty adjustment period with >=95% bit1 signaling. That
>> seems a
>> >>> tall order to organize in the scant few weeks remaining.
>> >>>
>> >>> On Jun 20, 2017, at 3:29 PM, Jacob Eliosoff via bitcoin-dev
>> >>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>> >>>
>> >>> If segwit is activated before Aug 1, as now seems likely, there will
>> be
>> >>> no split that day.  But if activation is via Segwit2x (also likely),
>> and at
>> >>> least some nodes do & some don't follow through with the HF 3mo later
>> >>> (again, likely), agreed w/ Greg that *then* we'll see a split -
>> probably in
>> >>> Sep/Oct.  How those two chains will match up and how the split will
>> play out
>> >>> is anyone's guess...
>> >>>
>> >>>
>> >>>
>> >>> On Jun 20, 2017 6:16 PM, "Hampus Sj?berg via bitcoin-dev"
>> >>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>> >>>
>> >>> > Ironically, it looks like most of the segwit2x signaling miners are
>> >>> > faking it (because they're not signaling segwit which it requires).
>> >>> > It'll be unfortunate if some aren't faking it and start orphaning
>> >>> > their own blocks because they are failing to signal segwit.
>> >>>
>> >>> Well, they're doing some kind of "pre-signaling" in the coinbase at
>> the
>> >>> moment, because the segwit2x project is still in alpha-phase
>> according to
>> >>> the timeline. They're just showing commitment.
>> >>> I'm sure they will begin signaling on version bit 4/BIP91 as well as
>> >>> actually running a segwit2x node when the time comes.
>> >>>
>> >>>
>> >>> > As far as prevent a chain split goes, all those things
>> >>> > (148/91/segwit2x(per today)) effectively guarantee a chainsplit--
>> so I
>> >>> > don't think that holds.
>> >>>
>> >>> Segwit2x/BIP91/BIP148 will orphan miners that do not run a Segwit2x
>> (or
>> >>> BIP148) node, because they wouldn't have the new consensus rule of
>> requiring
>> >>> all blocks to signal for segwit.
>> >>> I don't believe there would be any long lasting chainsplit though
>> >>> (because of the ~80% hashrate support on segwit2x), perhaps 2-3
>> blocks if we
>> >>> get unlucky.
>> >>>
>> >>> Hampus
>> >>>
>> >>> 2017-06-20 23:49 GMT+02:00 Gregory Maxwell via bitcoin-dev
>> >>> <bitcoin-dev at lists.linuxfoundation.org>:
>> >>>>
>> >>>> On Tue, Jun 20, 2017 at 3:44 PM, Erik Aronesty via bitcoin-dev
>> >>>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>> >>>> > Because a large percentage of miners are indifferent, right now
>> miners
>> >>>> > have
>> >>>> > to choose between BIP148 and Segwit2x if they want to activate
>> Segwit.
>> >>>>
>> >>>> Miners can simply continuing signaling segwit, which will leave them
>> >>>> at least soft-fork compatible with BIP148 and BIP91 (and god knows
>> >>>> what "segwit2x" is since they keep changing the actual definition and
>> >>>> do not have a specification; but last I saw the near-term behavior
>> the
>> >>>> same as BIP91 but with a radically reduced activation window, so the
>> >>>> story would be the same there in the near term).
>> >>>>
>> >>>> Ironically, it looks like most of the segwit2x signaling miners are
>> >>>> faking it (because they're not signaling segwit which it requires).
>> >>>> It'll be unfortunate if some aren't faking it and start orphaning
>> >>>> their own blocks because they are failing to signal segwit.
>> >>>>
>> >>>> I don't think the rejection of segwit2x from Bitcoin's developers
>> >>>> could be any more resolute than what we've already seen:
>> >>>> https://en.bitcoin.it/wiki/Segwit_support
>> >>>>
>> >>>> On Tue, Jun 20, 2017 at 5:22 PM, Mark Friedenbach via bitcoin-dev
>> >>>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>> >>>> > I think it is very na?ve to assume that any shift would be
>> temporary.
>> >>>> > We have a hard enough time getting miners to proactively upgrade to
>> >>>> > recent versions of the reference bitcoin daemon. If miners
>> interpret
>> >>>> > the situation as being forced to run non-reference software in
>> order
>> >>>> > to prevent a chain split because a lack of support from Bitcoin
>> Core,
>> >>>> > that could be a one-way street.
>> >>>>
>> >>>> I think this is somewhat naive and sounds a lot like the repeat of
>> the
>> >>>> previously debunked "XT" and "Classic" hysteria.
>> >>>>
>> >>>> There is a reason that segwit2x is pretty much unanimously rejected
>> by
>> >>>> the technical community.  And just like with XT/Classic/Unlimited
>> >>>> you'll continue to see a strong correlation with people who are
>> >>>> unwilling and unable to keep updating the software at an acceptable
>> >>>> level of quality-- esp. because the very founding on their fork is
>> >>>> predicated on discarding those properties.
>> >>>>
>> >>>> If miners want to go off and create an altcoin-- welp, thats
>> something
>> >>>> they can always do,  and nothing about that will force anyone to go
>> >>>> along with it.
>> >>>>
>> >>>> As far as prevent a chain split goes, all those things
>> >>>> (148/91/segwit2x(per today)) effectively guarantee a chainsplit-- so
>> I
>> >>>> don't think that holds.
>> >>>> _______________________________________________
>> >>>> bitcoin-dev mailing list
>> >>>> bitcoin-dev at lists.linuxfoundation.org
>> >>>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>> >>>
>> >>>
>> >>>
>> >>> _______________________________________________
>> >>> bitcoin-dev mailing list
>> >>> bitcoin-dev at lists.linuxfoundation.org
>> >>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>> >>>
>> >>>
>> >>> _______________________________________________
>> >>> bitcoin-dev mailing list
>> >>> bitcoin-dev at lists.linuxfoundation.org
>> >>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>> >>
>> >>
>> >>
>> >> _______________________________________________
>> >> bitcoin-dev mailing list
>> >> bitcoin-dev at lists.linuxfoundation.org
>> >> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>> >>
>> >
>>
>
>
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170627/3642debc/attachment.html>

From jtimon at jtimon.cc  Tue Jun 27 16:31:26 2017
From: jtimon at jtimon.cc (=?UTF-8?B?Sm9yZ2UgVGltw7Nu?=)
Date: Tue, 27 Jun 2017 18:31:26 +0200
Subject: [bitcoin-dev] Miners forced to run non-core code in order to
 get segwit activated
In-Reply-To: <CAKzdR-rvP9RLJ=qGDMVyOT3WVqp7q2tUPpzbaQZ=wStsFSCbWA@mail.gmail.com>
References: <CAJowKgLtu-HUDuakk4DDU53nyChbQk_zY=f5OO2j1Za95PdL7w@mail.gmail.com>
	<CAAS2fgSZ_X3G7j3-S6tAGPe2TOTT2umBB8a0RHpD-wAHN9aPgw@mail.gmail.com>
	<CAFMkqK_73RrpaS2oJQ-0o6oC29m6a1h411_P7HmVcAyX712Sgw@mail.gmail.com>
	<CAAUaCyg2Nmsa2UaO2msBqSFeHLetUUN+cTETvSSmB7c=nH9ZhQ@mail.gmail.com>
	<BC758648-BD4F-4DEF-8B79-7E8E0A887033@friedenbach.org>
	<CAAUaCyh+4m+t9d4yOoEOf6VUDyJ=sUpDT3hD3cDmd9dcBQZ+nw@mail.gmail.com>
	<CAJowKgJcp7d30LsrDZ5iR6-k9Ncz0N90pxs2GmJkuG1qYDG6GQ@mail.gmail.com>
	<CAOG=w-tPgJ5baaNiZC5rTs_y=eV7AU+F=aGaH+uObqaB-VgL2w@mail.gmail.com>
	<CAAUaCyijF1eHSffUYf9Mrv+KP5H+NLBcy5MEhMUyT6Rxcbx93g@mail.gmail.com>
	<CAKzdR-rvP9RLJ=qGDMVyOT3WVqp7q2tUPpzbaQZ=wStsFSCbWA@mail.gmail.com>
Message-ID: <CABm2gDrBOSWnqW_vZ-cibMFe8FqJmVChws-Vt7eMFzpfsx-7mQ@mail.gmail.com>

First the implementation, then the technical design (BIP)... will the
analysis come after that?
Will there be any kind of simulations of tje proposed size or will thag
come only after activation on mainnet?
I assume the very last step will be activation on testnet 3 ?

On 27 Jun 2017 8:44 am, "Sergio Demian Lerner via bitcoin-dev" <
bitcoin-dev at lists.linuxfoundation.org> wrote:

Currently the only implementation that fulfills the requirements of the NYA
agreement is the segwit2x/btc1 implementation, which is being finalized
this week.

Segwit2mb does not fulfill the NYA agreement.

I'm asking now the segwit2x development team when a BIP will be ready so
that Core has the opportunity to evaluate the technical proposal.




On Wed, Jun 21, 2017 at 1:05 AM, Jacob Eliosoff via bitcoin-dev <
bitcoin-dev at lists.linuxfoundation.org> wrote:

> Well, this Saturday's "Chinese roundtable" statement from a bunch of
> miners (https://pastebin.com/b3St9VCF) says they intend "NYA" in the
> coinbase as support for "the New York consensus SegWit2x program btc1 (
> https://github.com/btc1)", whose code includes the (accelerated
> 336-block) BIP 91 change.  So, other facts or interpretations could come to
> light, but until they do we should probably assume that's what the "NYA"
> (which just broke 80% over the last 24h) means.
>
>
> On Tue, Jun 20, 2017 at 10:11 PM, Mark Friedenbach <mark at friedenbach.org>
> wrote:
>
>> 80% have set "NYA" in their coinbase string. We have no idea what that
>> means. People are equating it to BIP 91 -- but BIP 91 did not exist at
>> the time of the New York agreement, and differs from the actual text
>> of the NYA in substantive ways. The "Segwit2MB" that existed at the
>> time of the NYA, and which was explicitly referenced by the text is
>> the proposal by Sergio Demian Lerner that was made to this mailing
>> list on 31 March. The text of the NYA grants no authority for
>> upgrading this proposal while remaining compliant with the agreement.
>> This is without even considering the fact that in the days after the
>> NYA there was disagreement among those who signed it as to what it
>> meant.
>>
>> I feel it is a very dangerous and unwarranted assumption people are
>> making that what we are seeing now is either 80% support for BIP-91 or
>> for the code in the btc1 repo.
>>
>> On Tue, Jun 20, 2017 at 6:36 PM, Erik Aronesty <erik at q32.com> wrote:
>> > # Jacob Eliosoff:
>> >
>> >>  will start orphaning non-bit-1 blocks before Aug 1, and we avoid a
>> split.
>> >
>> > Correct.  There are 2 short activation periods in BIP91 either of which
>> > would avoid a split.
>> >
>> > # Gregory Maxwell:
>> >
>> >> unclear to me _exactly_ what it would need to implement to be
>> consistent.
>> >
>> > This is the relevant pull req to core:
>> >
>> > https://github.com/bitcoin/bitcoin/pull/10444
>> >
>> > Seems OK.  It's technically running now on testnet5.   I think it (or a
>> > -bip148 option) should be merged as soon as feasible.
>> >
>> >> previously debunked "XT" and "Classic" hysteria.
>> >
>> > apples vs oranges, imo.   segwit is not a contentious feature.   the
>> > "bundling" in segwit2x is, but that's not the issue here.   the issue
>> is we
>> > are indirectly requiring miners that strongly support segwit to install
>> > consensus protocol changes outside of bitcoin's standard reference.
>>  80% of
>> > them have signaled they will do so.   these are uncharted waters.
>> >
>> >
>> > On Tue, Jun 20, 2017 at 6:57 PM, Jacob Eliosoff via bitcoin-dev
>> > <bitcoin-dev at lists.linuxfoundation.org> wrote:
>> >>
>> >> I could be wrong, but the latest BIP91 implementation (also included in
>> >> Segwit2x) cuts the activation period to 336 blocks (2.33 days).  (This
>> has
>> >> been updated at
>> >> https://github.com/bitcoin/bips/blob/master/bip-0091.mediawiki.)  So
>> if 80%
>> >> of hashpower is actually running that code and signaling on bit 4 by
>> July 25
>> >> or so, then those 80+% will start orphaning non-bit-1 blocks before
>> Aug 1,
>> >> and we avoid a split.
>> >>
>> >> There may still be a few non-bit-1 blocks that get orphaned after Aug
>> 1,
>> >> because they're mined by old BIP141 nodes.  But it seems like very few
>> >> miners won't be signaling either Segwit2x *or* BIP141 by then...
>> >>
>> >> Make sense?
>> >>
>> >>
>> >> On Tue, Jun 20, 2017 at 6:48 PM, Mark Friedenbach <
>> mark at friedenbach.org>
>> >> wrote:
>> >>>
>> >>> Why do you say activation by August 1st is likely? That would require
>> an
>> >>> entire difficulty adjustment period with >=95% bit1 signaling. That
>> seems a
>> >>> tall order to organize in the scant few weeks remaining.
>> >>>
>> >>> On Jun 20, 2017, at 3:29 PM, Jacob Eliosoff via bitcoin-dev
>> >>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>> >>>
>> >>> If segwit is activated before Aug 1, as now seems likely, there will
>> be
>> >>> no split that day.  But if activation is via Segwit2x (also likely),
>> and at
>> >>> least some nodes do & some don't follow through with the HF 3mo later
>> >>> (again, likely), agreed w/ Greg that *then* we'll see a split -
>> probably in
>> >>> Sep/Oct.  How those two chains will match up and how the split will
>> play out
>> >>> is anyone's guess...
>> >>>
>> >>>
>> >>>
>> >>> On Jun 20, 2017 6:16 PM, "Hampus Sj?berg via bitcoin-dev"
>> >>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>> >>>
>> >>> > Ironically, it looks like most of the segwit2x signaling miners are
>> >>> > faking it (because they're not signaling segwit which it requires).
>> >>> > It'll be unfortunate if some aren't faking it and start orphaning
>> >>> > their own blocks because they are failing to signal segwit.
>> >>>
>> >>> Well, they're doing some kind of "pre-signaling" in the coinbase at
>> the
>> >>> moment, because the segwit2x project is still in alpha-phase
>> according to
>> >>> the timeline. They're just showing commitment.
>> >>> I'm sure they will begin signaling on version bit 4/BIP91 as well as
>> >>> actually running a segwit2x node when the time comes.
>> >>>
>> >>>
>> >>> > As far as prevent a chain split goes, all those things
>> >>> > (148/91/segwit2x(per today)) effectively guarantee a chainsplit--
>> so I
>> >>> > don't think that holds.
>> >>>
>> >>> Segwit2x/BIP91/BIP148 will orphan miners that do not run a Segwit2x
>> (or
>> >>> BIP148) node, because they wouldn't have the new consensus rule of
>> requiring
>> >>> all blocks to signal for segwit.
>> >>> I don't believe there would be any long lasting chainsplit though
>> >>> (because of the ~80% hashrate support on segwit2x), perhaps 2-3
>> blocks if we
>> >>> get unlucky.
>> >>>
>> >>> Hampus
>> >>>
>> >>> 2017-06-20 23:49 GMT+02:00 Gregory Maxwell via bitcoin-dev
>> >>> <bitcoin-dev at lists.linuxfoundation.org>:
>> >>>>
>> >>>> On Tue, Jun 20, 2017 at 3:44 PM, Erik Aronesty via bitcoin-dev
>> >>>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>> >>>> > Because a large percentage of miners are indifferent, right now
>> miners
>> >>>> > have
>> >>>> > to choose between BIP148 and Segwit2x if they want to activate
>> Segwit.
>> >>>>
>> >>>> Miners can simply continuing signaling segwit, which will leave them
>> >>>> at least soft-fork compatible with BIP148 and BIP91 (and god knows
>> >>>> what "segwit2x" is since they keep changing the actual definition and
>> >>>> do not have a specification; but last I saw the near-term behavior
>> the
>> >>>> same as BIP91 but with a radically reduced activation window, so the
>> >>>> story would be the same there in the near term).
>> >>>>
>> >>>> Ironically, it looks like most of the segwit2x signaling miners are
>> >>>> faking it (because they're not signaling segwit which it requires).
>> >>>> It'll be unfortunate if some aren't faking it and start orphaning
>> >>>> their own blocks because they are failing to signal segwit.
>> >>>>
>> >>>> I don't think the rejection of segwit2x from Bitcoin's developers
>> >>>> could be any more resolute than what we've already seen:
>> >>>> https://en.bitcoin.it/wiki/Segwit_support
>> >>>>
>> >>>> On Tue, Jun 20, 2017 at 5:22 PM, Mark Friedenbach via bitcoin-dev
>> >>>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>> >>>> > I think it is very na?ve to assume that any shift would be
>> temporary.
>> >>>> > We have a hard enough time getting miners to proactively upgrade to
>> >>>> > recent versions of the reference bitcoin daemon. If miners
>> interpret
>> >>>> > the situation as being forced to run non-reference software in
>> order
>> >>>> > to prevent a chain split because a lack of support from Bitcoin
>> Core,
>> >>>> > that could be a one-way street.
>> >>>>
>> >>>> I think this is somewhat naive and sounds a lot like the repeat of
>> the
>> >>>> previously debunked "XT" and "Classic" hysteria.
>> >>>>
>> >>>> There is a reason that segwit2x is pretty much unanimously rejected
>> by
>> >>>> the technical community.  And just like with XT/Classic/Unlimited
>> >>>> you'll continue to see a strong correlation with people who are
>> >>>> unwilling and unable to keep updating the software at an acceptable
>> >>>> level of quality-- esp. because the very founding on their fork is
>> >>>> predicated on discarding those properties.
>> >>>>
>> >>>> If miners want to go off and create an altcoin-- welp, thats
>> something
>> >>>> they can always do,  and nothing about that will force anyone to go
>> >>>> along with it.
>> >>>>
>> >>>> As far as prevent a chain split goes, all those things
>> >>>> (148/91/segwit2x(per today)) effectively guarantee a chainsplit-- so
>> I
>> >>>> don't think that holds.
>> >>>> _______________________________________________
>> >>>> bitcoin-dev mailing list
>> >>>> bitcoin-dev at lists.linuxfoundation.org
>> >>>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>> >>>
>> >>>
>> >>>
>> >>> _______________________________________________
>> >>> bitcoin-dev mailing list
>> >>> bitcoin-dev at lists.linuxfoundation.org
>> >>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>> >>>
>> >>>
>> >>> _______________________________________________
>> >>> bitcoin-dev mailing list
>> >>> bitcoin-dev at lists.linuxfoundation.org
>> >>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>> >>
>> >>
>> >>
>> >> _______________________________________________
>> >> bitcoin-dev mailing list
>> >> bitcoin-dev at lists.linuxfoundation.org
>> >> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>> >>
>> >
>>
>
>
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>
>

_______________________________________________
bitcoin-dev mailing list
bitcoin-dev at lists.linuxfoundation.org
https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170627/6fe6606e/attachment-0001.html>

From erik at q32.com  Tue Jun 27 19:26:35 2017
From: erik at q32.com (Erik Aronesty)
Date: Tue, 27 Jun 2017 15:26:35 -0400
Subject: [bitcoin-dev] Miners forced to run non-core code in order to
 get segwit activated
In-Reply-To: <CABm2gDrBOSWnqW_vZ-cibMFe8FqJmVChws-Vt7eMFzpfsx-7mQ@mail.gmail.com>
References: <CAJowKgLtu-HUDuakk4DDU53nyChbQk_zY=f5OO2j1Za95PdL7w@mail.gmail.com>
	<CAAS2fgSZ_X3G7j3-S6tAGPe2TOTT2umBB8a0RHpD-wAHN9aPgw@mail.gmail.com>
	<CAFMkqK_73RrpaS2oJQ-0o6oC29m6a1h411_P7HmVcAyX712Sgw@mail.gmail.com>
	<CAAUaCyg2Nmsa2UaO2msBqSFeHLetUUN+cTETvSSmB7c=nH9ZhQ@mail.gmail.com>
	<BC758648-BD4F-4DEF-8B79-7E8E0A887033@friedenbach.org>
	<CAAUaCyh+4m+t9d4yOoEOf6VUDyJ=sUpDT3hD3cDmd9dcBQZ+nw@mail.gmail.com>
	<CAJowKgJcp7d30LsrDZ5iR6-k9Ncz0N90pxs2GmJkuG1qYDG6GQ@mail.gmail.com>
	<CAOG=w-tPgJ5baaNiZC5rTs_y=eV7AU+F=aGaH+uObqaB-VgL2w@mail.gmail.com>
	<CAAUaCyijF1eHSffUYf9Mrv+KP5H+NLBcy5MEhMUyT6Rxcbx93g@mail.gmail.com>
	<CAKzdR-rvP9RLJ=qGDMVyOT3WVqp7q2tUPpzbaQZ=wStsFSCbWA@mail.gmail.com>
	<CABm2gDrBOSWnqW_vZ-cibMFe8FqJmVChws-Vt7eMFzpfsx-7mQ@mail.gmail.com>
Message-ID: <CAJowKg+6b5JFgNuFXL0hurPUt15AA3+AGwyFawZQBhgeZAOJDg@mail.gmail.com>

There's a pull req to core already for part of it:

https://github.com/bitcoin/bitcoin/pull/10444




On Tue, Jun 27, 2017 at 12:31 PM, Jorge Tim?n via bitcoin-dev <
bitcoin-dev at lists.linuxfoundation.org> wrote:

> First the implementation, then the technical design (BIP)... will the
> analysis come after that?
> Will there be any kind of simulations of tje proposed size or will thag
> come only after activation on mainnet?
> I assume the very last step will be activation on testnet 3 ?
>
>
> On 27 Jun 2017 8:44 am, "Sergio Demian Lerner via bitcoin-dev" <
> bitcoin-dev at lists.linuxfoundation.org> wrote:
>
> Currently the only implementation that fulfills the requirements of the
> NYA agreement is the segwit2x/btc1 implementation, which is being finalized
> this week.
>
> Segwit2mb does not fulfill the NYA agreement.
>
> I'm asking now the segwit2x development team when a BIP will be ready so
> that Core has the opportunity to evaluate the technical proposal.
>
>
>
>
> On Wed, Jun 21, 2017 at 1:05 AM, Jacob Eliosoff via bitcoin-dev <
> bitcoin-dev at lists.linuxfoundation.org> wrote:
>
>> Well, this Saturday's "Chinese roundtable" statement from a bunch of
>> miners (https://pastebin.com/b3St9VCF) says they intend "NYA" in the
>> coinbase as support for "the New York consensus SegWit2x program btc1 (
>> https://github.com/btc1)", whose code includes the (accelerated
>> 336-block) BIP 91 change.  So, other facts or interpretations could come to
>> light, but until they do we should probably assume that's what the "NYA"
>> (which just broke 80% over the last 24h) means.
>>
>>
>> On Tue, Jun 20, 2017 at 10:11 PM, Mark Friedenbach <mark at friedenbach.org>
>> wrote:
>>
>>> 80% have set "NYA" in their coinbase string. We have no idea what that
>>> means. People are equating it to BIP 91 -- but BIP 91 did not exist at
>>> the time of the New York agreement, and differs from the actual text
>>> of the NYA in substantive ways. The "Segwit2MB" that existed at the
>>> time of the NYA, and which was explicitly referenced by the text is
>>> the proposal by Sergio Demian Lerner that was made to this mailing
>>> list on 31 March. The text of the NYA grants no authority for
>>> upgrading this proposal while remaining compliant with the agreement.
>>> This is without even considering the fact that in the days after the
>>> NYA there was disagreement among those who signed it as to what it
>>> meant.
>>>
>>> I feel it is a very dangerous and unwarranted assumption people are
>>> making that what we are seeing now is either 80% support for BIP-91 or
>>> for the code in the btc1 repo.
>>>
>>> On Tue, Jun 20, 2017 at 6:36 PM, Erik Aronesty <erik at q32.com> wrote:
>>> > # Jacob Eliosoff:
>>> >
>>> >>  will start orphaning non-bit-1 blocks before Aug 1, and we avoid a
>>> split.
>>> >
>>> > Correct.  There are 2 short activation periods in BIP91 either of which
>>> > would avoid a split.
>>> >
>>> > # Gregory Maxwell:
>>> >
>>> >> unclear to me _exactly_ what it would need to implement to be
>>> consistent.
>>> >
>>> > This is the relevant pull req to core:
>>> >
>>> > https://github.com/bitcoin/bitcoin/pull/10444
>>> >
>>> > Seems OK.  It's technically running now on testnet5.   I think it (or a
>>> > -bip148 option) should be merged as soon as feasible.
>>> >
>>> >> previously debunked "XT" and "Classic" hysteria.
>>> >
>>> > apples vs oranges, imo.   segwit is not a contentious feature.   the
>>> > "bundling" in segwit2x is, but that's not the issue here.   the issue
>>> is we
>>> > are indirectly requiring miners that strongly support segwit to install
>>> > consensus protocol changes outside of bitcoin's standard reference.
>>>  80% of
>>> > them have signaled they will do so.   these are uncharted waters.
>>> >
>>> >
>>> > On Tue, Jun 20, 2017 at 6:57 PM, Jacob Eliosoff via bitcoin-dev
>>> > <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>> >>
>>> >> I could be wrong, but the latest BIP91 implementation (also included
>>> in
>>> >> Segwit2x) cuts the activation period to 336 blocks (2.33 days).
>>> (This has
>>> >> been updated at
>>> >> https://github.com/bitcoin/bips/blob/master/bip-0091.mediawiki.)  So
>>> if 80%
>>> >> of hashpower is actually running that code and signaling on bit 4 by
>>> July 25
>>> >> or so, then those 80+% will start orphaning non-bit-1 blocks before
>>> Aug 1,
>>> >> and we avoid a split.
>>> >>
>>> >> There may still be a few non-bit-1 blocks that get orphaned after Aug
>>> 1,
>>> >> because they're mined by old BIP141 nodes.  But it seems like very few
>>> >> miners won't be signaling either Segwit2x *or* BIP141 by then...
>>> >>
>>> >> Make sense?
>>> >>
>>> >>
>>> >> On Tue, Jun 20, 2017 at 6:48 PM, Mark Friedenbach <
>>> mark at friedenbach.org>
>>> >> wrote:
>>> >>>
>>> >>> Why do you say activation by August 1st is likely? That would
>>> require an
>>> >>> entire difficulty adjustment period with >=95% bit1 signaling. That
>>> seems a
>>> >>> tall order to organize in the scant few weeks remaining.
>>> >>>
>>> >>> On Jun 20, 2017, at 3:29 PM, Jacob Eliosoff via bitcoin-dev
>>> >>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>> >>>
>>> >>> If segwit is activated before Aug 1, as now seems likely, there will
>>> be
>>> >>> no split that day.  But if activation is via Segwit2x (also likely),
>>> and at
>>> >>> least some nodes do & some don't follow through with the HF 3mo later
>>> >>> (again, likely), agreed w/ Greg that *then* we'll see a split -
>>> probably in
>>> >>> Sep/Oct.  How those two chains will match up and how the split will
>>> play out
>>> >>> is anyone's guess...
>>> >>>
>>> >>>
>>> >>>
>>> >>> On Jun 20, 2017 6:16 PM, "Hampus Sj?berg via bitcoin-dev"
>>> >>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>> >>>
>>> >>> > Ironically, it looks like most of the segwit2x signaling miners are
>>> >>> > faking it (because they're not signaling segwit which it requires).
>>> >>> > It'll be unfortunate if some aren't faking it and start orphaning
>>> >>> > their own blocks because they are failing to signal segwit.
>>> >>>
>>> >>> Well, they're doing some kind of "pre-signaling" in the coinbase at
>>> the
>>> >>> moment, because the segwit2x project is still in alpha-phase
>>> according to
>>> >>> the timeline. They're just showing commitment.
>>> >>> I'm sure they will begin signaling on version bit 4/BIP91 as well as
>>> >>> actually running a segwit2x node when the time comes.
>>> >>>
>>> >>>
>>> >>> > As far as prevent a chain split goes, all those things
>>> >>> > (148/91/segwit2x(per today)) effectively guarantee a chainsplit--
>>> so I
>>> >>> > don't think that holds.
>>> >>>
>>> >>> Segwit2x/BIP91/BIP148 will orphan miners that do not run a Segwit2x
>>> (or
>>> >>> BIP148) node, because they wouldn't have the new consensus rule of
>>> requiring
>>> >>> all blocks to signal for segwit.
>>> >>> I don't believe there would be any long lasting chainsplit though
>>> >>> (because of the ~80% hashrate support on segwit2x), perhaps 2-3
>>> blocks if we
>>> >>> get unlucky.
>>> >>>
>>> >>> Hampus
>>> >>>
>>> >>> 2017-06-20 23:49 GMT+02:00 Gregory Maxwell via bitcoin-dev
>>> >>> <bitcoin-dev at lists.linuxfoundation.org>:
>>> >>>>
>>> >>>> On Tue, Jun 20, 2017 at 3:44 PM, Erik Aronesty via bitcoin-dev
>>> >>>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>> >>>> > Because a large percentage of miners are indifferent, right now
>>> miners
>>> >>>> > have
>>> >>>> > to choose between BIP148 and Segwit2x if they want to activate
>>> Segwit.
>>> >>>>
>>> >>>> Miners can simply continuing signaling segwit, which will leave them
>>> >>>> at least soft-fork compatible with BIP148 and BIP91 (and god knows
>>> >>>> what "segwit2x" is since they keep changing the actual definition
>>> and
>>> >>>> do not have a specification; but last I saw the near-term behavior
>>> the
>>> >>>> same as BIP91 but with a radically reduced activation window, so the
>>> >>>> story would be the same there in the near term).
>>> >>>>
>>> >>>> Ironically, it looks like most of the segwit2x signaling miners are
>>> >>>> faking it (because they're not signaling segwit which it requires).
>>> >>>> It'll be unfortunate if some aren't faking it and start orphaning
>>> >>>> their own blocks because they are failing to signal segwit.
>>> >>>>
>>> >>>> I don't think the rejection of segwit2x from Bitcoin's developers
>>> >>>> could be any more resolute than what we've already seen:
>>> >>>> https://en.bitcoin.it/wiki/Segwit_support
>>> >>>>
>>> >>>> On Tue, Jun 20, 2017 at 5:22 PM, Mark Friedenbach via bitcoin-dev
>>> >>>> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>>> >>>> > I think it is very na?ve to assume that any shift would be
>>> temporary.
>>> >>>> > We have a hard enough time getting miners to proactively upgrade
>>> to
>>> >>>> > recent versions of the reference bitcoin daemon. If miners
>>> interpret
>>> >>>> > the situation as being forced to run non-reference software in
>>> order
>>> >>>> > to prevent a chain split because a lack of support from Bitcoin
>>> Core,
>>> >>>> > that could be a one-way street.
>>> >>>>
>>> >>>> I think this is somewhat naive and sounds a lot like the repeat of
>>> the
>>> >>>> previously debunked "XT" and "Classic" hysteria.
>>> >>>>
>>> >>>> There is a reason that segwit2x is pretty much unanimously rejected
>>> by
>>> >>>> the technical community.  And just like with XT/Classic/Unlimited
>>> >>>> you'll continue to see a strong correlation with people who are
>>> >>>> unwilling and unable to keep updating the software at an acceptable
>>> >>>> level of quality-- esp. because the very founding on their fork is
>>> >>>> predicated on discarding those properties.
>>> >>>>
>>> >>>> If miners want to go off and create an altcoin-- welp, thats
>>> something
>>> >>>> they can always do,  and nothing about that will force anyone to go
>>> >>>> along with it.
>>> >>>>
>>> >>>> As far as prevent a chain split goes, all those things
>>> >>>> (148/91/segwit2x(per today)) effectively guarantee a chainsplit--
>>> so I
>>> >>>> don't think that holds.
>>> >>>> _______________________________________________
>>> >>>> bitcoin-dev mailing list
>>> >>>> bitcoin-dev at lists.linuxfoundation.org
>>> >>>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>> >>>
>>> >>>
>>> >>>
>>> >>> _______________________________________________
>>> >>> bitcoin-dev mailing list
>>> >>> bitcoin-dev at lists.linuxfoundation.org
>>> >>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>> >>>
>>> >>>
>>> >>> _______________________________________________
>>> >>> bitcoin-dev mailing list
>>> >>> bitcoin-dev at lists.linuxfoundation.org
>>> >>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>> >>
>>> >>
>>> >>
>>> >> _______________________________________________
>>> >> bitcoin-dev mailing list
>>> >> bitcoin-dev at lists.linuxfoundation.org
>>> >> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>> >>
>>> >
>>>
>>
>>
>> _______________________________________________
>> bitcoin-dev mailing list
>> bitcoin-dev at lists.linuxfoundation.org
>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>
>>
>
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>
>
>
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170627/472604e0/attachment-0001.html>

From chris at suredbits.com  Wed Jun 28 00:37:13 2017
From: chris at suredbits.com (Chris Stewart)
Date: Tue, 27 Jun 2017 19:37:13 -0500
Subject: [bitcoin-dev] BIP: OP_BRIBVERIFY - the op code needed for Blind
	Merge Mined drivechains
Message-ID: <CAGL6+mHQ_vMc2JYVqwfP89WOZdUF2WDtWfh7ccL1PQve=nC+zQ@mail.gmail.com>

<pre>
  BIP: <BIP number>
  Layer: Consensus (Soft fork)
  Title: OP_BRIBEVERIFY
  Author: Chris Stewart <chris at suredbits.com>
  Status: Draft
  Type: Standards Track
  Created: 2017-06-27
</pre>


==Abstract==

This BIP describes a new opcode, OP_BRIBEVERIFY, for the Bitcoin
scripting system that allows for a user to bribe a miner to include a hash
in the coinbase transaction's output.


==Summary==

BRIBEVERIFY redefines the existing NOP4 opcode. When executed, if the given
critical hash is included at the given vout index in the coinbase
transaction
the script evaluates to true. Otherwise, the script will fail.

This allows sidechains to be merged mined against
bitcoin without burdening bitcoin miners with extra resource requirements.

==Motivation==

The current political climate of bitcoin is extremely contentious. Many
community members
have different visions of what bitcoin is. This op code is meant to
enable [http://www.truthcoin.info/blog/blind-merged-mining/ Blind Merge
Mining].
This enables sidechains in Bitcoin. With OP_BRIBEVERIFY, sidechains miners
can
bribe bitcoin miners to to include their block hash in the bitcoin
blockchain. If their block
is included in the coinbase transaction's vout, it is assumed that block is
a mined block on the sidechain.

This will allow various factions of the community to realize their vision
on their own separate
blockchain that is interoperable with the bitcoin blockchain. This allows
those factions to use
bitcoin as a 'reserve currency' for their own network.


===Commitment Structure===

A new block rule is added which requires that the miner's coinbase reward
be at index 0 in the coinbase transaction's output vector.

It also fixes the witness commitment output to be at index 1 of the
coinbase transaction's output vector.

This is needed so we can reliably tell what vout corresponds to what
drivechain. For instance, the mimblewimble sidechain
could correspond to index 2 of the vector outputs on the coinbase
transaction.

The commitment is recorded in a <code>scriptPubKey</code> of the coinbase
transaction. It must be at least 34 bytes in size
   1-byte - OP_RETURN (0x6a)
   1-byte - Push the following 32 bytes (0x20)
  32-byte - block hash

the 35th byte and onward have no consensus meaning.

===OP_BRIBEVERIFY op code===

This op code reads two arguments from the stack. The stack top is expected
to be a sidechain id for which this user attempting to blind merge mine for.
The next element on the stack is expected to be a block hash. This op code
looks into the coinbase transaction's output vector at the given index
(which is derived from the sidechain id) and checks
to see if the hash in the block matches the hash inside of the BRIBEVERIFY
program. If the hashes match, the OP_BRIBEVERIFY acts as an OP_NOP. If the
comparison between the two hashes fail, the script fails.

===BRIBEVERIFY program===

A standard BRIBEVERIFY program has the format:
  1-byte - Push the following 32 bytes (0x20)
 32-byte - block hash
  1 byte - Push operation? (needed if number can't be encoded as OP_0 -
OP_16)
  1 byte - sidechain id
  1 byte - OP_BRIBEVERIFY op code

==Detailed Specification==

Refer to the reference implementation, reproduced below, for the precise
semantics and detailed rationale for those semantics.


 case OP_NOP4:
 {
    //format: block_hash sidechain_id OP_BRIBEVERIFY
    if (!(flags & SCRIPT_VERIFY_BRIBEVERIFY)) {
        // not enabled; treat as a NOP4
        if (flags & SCRIPT_VERIFY_DISCOURAGE_UPGRADABLE_NOPS) {
            return set_error(serror, SCRIPT_ERR_DISCOURAGE_UPGRADABLE_NOPS);
        }
        break;
    }

    if (stack.size() < 2)
        return set_error(serror, SCRIPT_ERR_INVALID_STACK_OPERATION);

    const CScriptNum scriptNumSidechainId(stacktop(-1),fRequireMinimal);
    uint8_t nSidechainId;
    if (!checker.CheckSidechainId(scriptNumSidechainId,nSidechainId)) {
        return set_error(serror, SCRIPT_ERR_UNKNOWN_SIDECHAIN);
    }

    // Check block hash
    bool fHashCritical =
checker.CheckCriticalHash(stacktop(-2),nSidechainId);
    if (!fHashCritical) {
        return set_error(serror, SCRIPT_ERR_UNSATISFIED_BRIBE);
    }
    break;
 }



https://github.com/Christewart/bitcoin/blob/94b6f33f2278c42d4d8758a3c8ffe2078e4ec933/src/script/interpreter.cpp#L427

https://github.com/drivechain-project/bitcoin/pull/13

==Deployment==

TODO

==Credits==

Credit to Paul Sztorc for the original idea of Blind Merge Mined sidechains.

Credit to CryptAxe for writing the foundational layer of software for
drivechains so I could implement OP_BRIBEVERIFY.


==References==

Blind Merge Mined Sidechains -
http://www.truthcoin.info/blog/blind-merged-mining/

Mailing list discussion -
https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-May/014408.html

==Copyright==

This document is placed in the public domain.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170627/bd5730bf/attachment.html>

From greg at xiph.org  Wed Jun 28 04:07:43 2017
From: greg at xiph.org (Gregory Maxwell)
Date: Wed, 28 Jun 2017 04:07:43 +0000
Subject: [bitcoin-dev] BIP: OP_BRIBVERIFY - the op code needed for Blind
 Merge Mined drivechains
In-Reply-To: <CAGL6+mHQ_vMc2JYVqwfP89WOZdUF2WDtWfh7ccL1PQve=nC+zQ@mail.gmail.com>
References: <CAGL6+mHQ_vMc2JYVqwfP89WOZdUF2WDtWfh7ccL1PQve=nC+zQ@mail.gmail.com>
Message-ID: <CAAS2fgS7Fn=k0mFt04-+0kPqZYFZXjaOQ7J3JzNXSnCgQiSSOw@mail.gmail.com>

On Wed, Jun 28, 2017 at 12:37 AM, Chris Stewart via bitcoin-dev
<bitcoin-dev at lists.linuxfoundation.org> wrote:
> A new block rule is added which requires that the miner's coinbase reward be
> at index 0 in the coinbase transaction's output vector.

This is an absurd restriction-- I hope it was not your intent to
directly ban P2Pool and probably any other form of decentralized or
less centralized mining pooling... but thats what doing that does.

> It also fixes the witness commitment output to be at index 1 of the coinbase transaction's output vector.

This removes important flexibility that was intentionally preserved.
What happens when an additional commitment is needed for bitcoin?
must some sidechain be irreparably destroyed? looks like it in  your
proposal.

> For instance, the mimblewimble sidechain could correspond to index 2 of the vector outputs on the coinbase transaction.

And what happens if index 1 isn't present? if index 35 is used must
there be 34 dummy outputs?

> This op code looks into the coinbase transaction's output vector at the given index (which is derived from the sidechain id) and checks to see if the hash in the block matches the hash inside of the BRIBEVERIFY progra

This is not monotone/reorg safe. It means that the output coins (if
any) are not equivalently fungible with other bitcoins (for, e.g. 100
blocks) because if there is a reorg this transaction cannot be
restored to the chain.  It's also impure and not compatible with
caching, which would be unfortunate and slow block propagation.

From luke at dashjr.org  Wed Jun 28 05:20:27 2017
From: luke at dashjr.org (Luke Dashjr)
Date: Wed, 28 Jun 2017 05:20:27 +0000
Subject: [bitcoin-dev] BIP: OP_BRIBVERIFY - the op code needed for Blind
	Merge Mined drivechains
In-Reply-To: <CAGL6+mHQ_vMc2JYVqwfP89WOZdUF2WDtWfh7ccL1PQve=nC+zQ@mail.gmail.com>
References: <CAGL6+mHQ_vMc2JYVqwfP89WOZdUF2WDtWfh7ccL1PQve=nC+zQ@mail.gmail.com>
Message-ID: <201706280520.29105.luke@dashjr.org>

On Wednesday 28 June 2017 12:37:13 AM Chris Stewart via bitcoin-dev wrote:
> BRIBEVERIFY redefines the existing NOP4 opcode. When executed, if the given
> critical hash is included at the given vout index in the coinbase
> transaction
> the script evaluates to true. Otherwise, the script will fail.
> 
> This allows sidechains to be merged mined against
> bitcoin without burdening bitcoin miners with extra resource requirements.

I don't see how. It seems like the logical outcome from this is "whoever pays 
the most gets the next sidechain block"... That's not particularly useful for 
merge mining.

> This enables sidechains in Bitcoin.

There are different kinds of sidechains...

Federated peg: this already works on Bitcoin.
SPV/SNARK peg: this isn't enabled by your BIP.
Drivechains: this isn't enabled by your BIP.

How do you say this enables any kind of sidechain?

> A new block rule is added which requires that the miner's coinbase reward
> be at index 0 in the coinbase transaction's output vector.
> 
> It also fixes the witness commitment output to be at index 1 of the
> coinbase transaction's output vector.

This is unacceptable, for reasons Greg already pointed out.

> This document is placed in the public domain.

Note that this is not acceptable for BIPs anymore.

https://github.com/bitcoin/bips/blob/master/bip-0002.mediawiki#BIP_licensing

From adam.back at gmail.com  Wed Jun 28 05:28:31 2017
From: adam.back at gmail.com (Adam Back)
Date: Tue, 27 Jun 2017 22:28:31 -0700
Subject: [bitcoin-dev] BIP: OP_BRIBVERIFY - the op code needed for Blind
 Merge Mined drivechains
In-Reply-To: <201706280520.29105.luke@dashjr.org>
References: <CAGL6+mHQ_vMc2JYVqwfP89WOZdUF2WDtWfh7ccL1PQve=nC+zQ@mail.gmail.com>
	<201706280520.29105.luke@dashjr.org>
Message-ID: <CALqxMTE7jXdnXvsXoyTqTv6m1xQDQXCXsu7mh3oHmw8aXhrB0w@mail.gmail.com>

On 27 June 2017 at 22:20, Luke Dashjr via bitcoin-dev
<bitcoin-dev at lists.linuxfoundation.org> wrote:
> On Wednesday 28 June 2017 12:37:13 AM Chris Stewart via bitcoin-dev wrote:
>> BRIBEVERIFY redefines the existing NOP4 opcode. When executed, if the given
>> critical hash is included at the given vout index in the coinbase
>> transaction the script evaluates to true. Otherwise, the script will fail.
>>
>> This allows sidechains to be merged mined against
>> bitcoin without burdening bitcoin miners with extra resource requirements.
>
> I don't see how. It seems like the logical outcome from this is "whoever pays
> the most gets the next sidechain block"... That's not particularly useful for
> merge mining.

Maybe that's phrased badly but the point of the "blind merge mining"
is just that the sidechain fees are paid in main chain bitcoin (rather
than in sidechain bitcoin).

That means that a miner who solo mines the main chain could still mine
the sidechain by requesting a block-proposal from a trusted sidechain
fullnode.  The sidechain fullnode would actually pay the mainchain
fee, and pay itself the sidechain fees as part of the side-chain
block-proposal.

This was viewed as less centralising than forcing miners to directly
process sidechain blocks, which could in principle be bandwidth and
CPU expensive to process, construct and validate.

Adam

From aj at erisian.com.au  Wed Jun 28 07:01:33 2017
From: aj at erisian.com.au (Anthony Towns)
Date: Wed, 28 Jun 2017 17:01:33 +1000
Subject: [bitcoin-dev] Replay protection via CHECKSIG
Message-ID: <20170628070133.GA2421@erisian.com.au>

Hi,

I thought of a possibly interesting way to prevent transaction replay in
the event of a chain split, that seems better to the other approaches
I've seen. Basically, update OP_CHECKSIG (and MULTISIG and the VERIFY
variants, presumably via segwit versioning or using a NOP opcode) so that
signatures can optionally specify an additional integer block-height. If
this is provided, the message hash is combined with the block hash at
the given height, before the signature is created/verified, and therefore
the signature becomes invalid if used on a chain that does not have that
particular block in its history [0].

It adds four bytes to a signature that uses the feature [1], along with
a block hash lookup, and some extra sha ops when verifying the signature,
but it otherwise seems pretty lightweight, and scales to an arbitrary
number of forks including a pretty fair range of hard forks, as far
as I can see, without requiring any coordination between any of the
chains. So I think it's superior to what Johnson Lau proposed in January
[2] or BIP 115 from last year [3].

Thoughts? Has this been proposed before and found wanting already?

Cheers,
aj

[0] For consistency, you could use the genesis block hash if the signature
    doesn't specify a block height, which would lock a given signature to
    "bitcoin" or "testnet" or "litecoin", which might be beneficial.

[1] Conceivably a little less if you allow "-5" to mean "5 blocks ago"
    and miners replace a four byte absolute reference ("473000") with a
    one or two byte relative reference ("-206") when grabbing transactions
    from the mempool to put in the block template.

[2] https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-January/013473.html

[3] https://github.com/bitcoin/bips/blob/master/bip-0115.mediawiki


From ZmnSCPxj at protonmail.com  Wed Jun 28 08:26:37 2017
From: ZmnSCPxj at protonmail.com (ZmnSCPxj)
Date: Wed, 28 Jun 2017 04:26:37 -0400
Subject: [bitcoin-dev] BIP: OP_BRIBVERIFY - the op code needed for Blind
	Merge Mined drivechains
In-Reply-To: <CAGL6+mHQ_vMc2JYVqwfP89WOZdUF2WDtWfh7ccL1PQve=nC+zQ@mail.gmail.com>
References: <CAGL6+mHQ_vMc2JYVqwfP89WOZdUF2WDtWfh7ccL1PQve=nC+zQ@mail.gmail.com>
Message-ID: <OozQK1_gWeExd5578AYH_dHnSKSvx63FJc2rIBBcaJF4f07qzsR8rr-ka5epwMFCjqDuidAWZiZqqlvn4xvSuUpDY0KkV014VQs6_E3Rp_A=@protonmail.com>

Good morning.
I still do not see what this does that cannot be done by:
OP_RETURN <sidechain-id> <sidechain-block-id>
A transaction with such an output would allow sidechain-miners to bribe mainchain-miners by paying a transaction fee if the transaction containing this OP_RETURN is included in a block and committed to by a mainchain-miner in the Merkle tree root.
It would not require a softfork.
--
I have an alternate proposal that sidechains and altcoins that want to do "blinded" merge mining can use without a softfork:
1. Encode a block header as a simple cons-pair, with the head as the block and the tail as the parent cons-pair.
1.1. This can be encoded as a 32-byte hash of the block including its header, and the 32-byte hash of the parent cons-pair.
1.2. This is now the actual "chain" in the sidecoin/altcoin blockchain.
2. When a sidechain-node wants to know the consensus, it downloads mainchain-blocks and looks for OP_RETURN's.
2.1. Starting with its genesis cons-pair hash (equivalent to the empty list) as the current cons-pair, it scans each OP_RETURN transaction.
2.1.1. If an OP_RETURN is 64-byte and has the parent cons-pair equal to the current cons-pair, look for the side block indicated and confirm its correctness. If correct, update the current cons-pair for the hash of the OP_RETURN data.
2.2. When reaching the latest mainchain block, the current cons-pair is now the sidecoin/altcoin latest block.
2.3. Note that if multiple OP_RETURN in a block match the current cons-pair, the first one is considered the correct chain. This property means that the sidechain/altchain can only have a chainsplit if the mainchain has a chainsplit.
3. When a sidechain-miner wants to create a side-block, it generates a new cons-pair and creates an OP_RETURN transaction for it, paying a mainchain-miner to include it in the next mainchain-block.
3.1. The sidechain-miner risks that its competitors will outbid it and get its OP_RETURN earlier in a mainchain-block (or earlier in the order of transactions). It can mitigate this risk by updating itself to become a mainchain-miner, it can then keep its OP_RETURN transaction private and put it earlier in the block, ensuring it will "win" the sidechain-consensus if it wins the mainchain-consensus.
Regards,
ZmnSCPxj
-------- Original Message --------
Subject: [bitcoin-dev] BIP: OP_BRIBVERIFY - the op code needed for Blind Merge Mined drivechains
Local Time: June 28, 2017 8:37 AM
UTC Time: June 28, 2017 12:37 AM
From: bitcoin-dev at lists.linuxfoundation.org
To: Bitcoin Protocol Discussion <bitcoin-dev at lists.linuxfoundation.org>
<pre>
BIP: <BIP number>
Layer: Consensus (Soft fork)
Title: OP_BRIBEVERIFY
Author: Chris Stewart <chris at suredbits.com>
Status: Draft
Type: Standards Track
Created: 2017-06-27
</pre>
==Abstract==
This BIP describes a new opcode, OP_BRIBEVERIFY, for the Bitcoin
scripting system that allows for a user to bribe a miner to include a hash
in the coinbase transaction's output.
==Summary==
BRIBEVERIFY redefines the existing NOP4 opcode. When executed, if the given
critical hash is included at the given vout index in the coinbase transaction
the script evaluates to true. Otherwise, the script will fail.
This allows sidechains to be merged mined against
bitcoin without burdening bitcoin miners with extra resource requirements.
==Motivation==
The current political climate of bitcoin is extremely contentious. Many community members
have different visions of what bitcoin is. This op code is meant to
enable [http://www.truthcoin.info/blog/blind-merged-mining/ Blind Merge Mining].
This enables sidechains in Bitcoin. With OP_BRIBEVERIFY, sidechains miners can
bribe bitcoin miners to to include their block hash in the bitcoin blockchain. If their block
is included in the coinbase transaction's vout, it is assumed that block is a mined block on the sidechain.
This will allow various factions of the community to realize their vision on their own separate
blockchain that is interoperable with the bitcoin blockchain. This allows those factions to use
bitcoin as a 'reserve currency' for their own network.
===Commitment Structure===
A new block rule is added which requires that the miner's coinbase reward be at index 0 in the coinbase transaction's output vector.
It also fixes the witness commitment output to be at index 1 of the coinbase transaction's output vector.
This is needed so we can reliably tell what vout corresponds to what drivechain. For instance, the mimblewimble sidechain
could correspond to index 2 of the vector outputs on the coinbase transaction.
The commitment is recorded in a <code>scriptPubKey</code> of the coinbase transaction. It must be at least 34 bytes in size
1-byte - OP_RETURN (0x6a)
1-byte - Push the following 32 bytes (0x20)
32-byte - block hash
the 35th byte and onward have no consensus meaning.
===OP_BRIBEVERIFY op code===
This op code reads two arguments from the stack. The stack top is expected to be a sidechain id for which this user attempting to blind merge mine for.
The next element on the stack is expected to be a block hash. This op code looks into the coinbase transaction's output vector at the given index (which is derived from the sidechain id) and checks
to see if the hash in the block matches the hash inside of the BRIBEVERIFY program. If the hashes match, the OP_BRIBEVERIFY acts as an OP_NOP. If the
comparison between the two hashes fail, the script fails.
===BRIBEVERIFY program===
A standard BRIBEVERIFY program has the format:
1-byte - Push the following 32 bytes (0x20)
32-byte - block hash
1 byte - Push operation? (needed if number can't be encoded as OP_0 - OP_16)
1 byte - sidechain id
1 byte - OP_BRIBEVERIFY op code
==Detailed Specification==
Refer to the reference implementation, reproduced below, for the precise
semantics and detailed rationale for those semantics.
case OP_NOP4:
{
//format: block_hash sidechain_id OP_BRIBEVERIFY
if (!(flags & SCRIPT_VERIFY_BRIBEVERIFY)) {
// not enabled; treat as a NOP4
if (flags & SCRIPT_VERIFY_DISCOURAGE_UPGRADABLE_NOPS) {
return set_error(serror, SCRIPT_ERR_DISCOURAGE_UPGRADABLE_NOPS);
}
break;
}
if (stack.size() < 2)
return set_error(serror, SCRIPT_ERR_INVALID_STACK_OPERATION);
const CScriptNum scriptNumSidechainId(stacktop(-1),fRequireMinimal);
uint8_t nSidechainId;
if (!checker.CheckSidechainId(scriptNumSidechainId,nSidechainId)) {
return set_error(serror, SCRIPT_ERR_UNKNOWN_SIDECHAIN);
}
// Check block hash
bool fHashCritical = checker.CheckCriticalHash(stacktop(-2),nSidechainId);
if (!fHashCritical) {
return set_error(serror, SCRIPT_ERR_UNSATISFIED_BRIBE);
}
break;
}
https://github.com/Christewart/bitcoin/blob/94b6f33f2278c42d4d8758a3c8ffe2078e4ec933/src/script/interpreter.cpp#L427
https://github.com/drivechain-project/bitcoin/pull/13
==Deployment==
TODO
==Credits==
Credit to Paul Sztorc for the original idea of Blind Merge Mined sidechains.
Credit to CryptAxe for writing the foundational layer of software for drivechains so I could implement OP_BRIBEVERIFY.
==References==
Blind Merge Mined Sidechains - http://www.truthcoin.info/blog/blind-merged-mining/
Mailing list discussion - https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-May/014408.html
==Copyright==
This document is placed in the public domain.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170628/ed97475f/attachment.html>

From truthcoin at gmail.com  Wed Jun 28 16:35:32 2017
From: truthcoin at gmail.com (Paul Sztorc)
Date: Wed, 28 Jun 2017 12:35:32 -0400
Subject: [bitcoin-dev] BIP: OP_BRIBVERIFY - the op code needed for Blind
 Merge Mined drivechains
In-Reply-To: <CAAS2fgS7Fn=k0mFt04-+0kPqZYFZXjaOQ7J3JzNXSnCgQiSSOw@mail.gmail.com>
References: <CAGL6+mHQ_vMc2JYVqwfP89WOZdUF2WDtWfh7ccL1PQve=nC+zQ@mail.gmail.com>
	<CAAS2fgS7Fn=k0mFt04-+0kPqZYFZXjaOQ7J3JzNXSnCgQiSSOw@mail.gmail.com>
Message-ID: <53ce81c2-4eac-986c-a204-2f9b7d476260@gmail.com>

Chris/Greg,

For pending withdrawals (side-to-main transfers), all of the data is
stored in a teeny tiny extension block which contains all the drivechain
data (which we called "MinerDB"). And miners were supposed to commit to
this and put it in the coinbase in some locate-able place (for example,
index 1).

I had assumed that this would go the same for BMM, since it is all
drivechain-themed. Thus, all drivechains, and all drivechain-stuff (BMM
included), would claim one output index.

Moreover, while DC claims an output "slot", the claim doesn't need to be
permanent...if the BTC-value of the relevant output is not equal to
zero, the BMM code could just ignore it. The sidechains would each
assume that no sidechain block was merged-mined in this period. And DC
would assume that no forward progress was made on any side-to-main
transfers (ie, that everyone "abstained").

Perhaps that addresses Greg's third, first, and second concerns.

I am having some trouble understanding concern #4. I think you mean to
say that the output coins of a transaction which is encumbered by OP
BribeVerify are different from other coins. Indeed they are, and coins
locked by OP BribeVerify cannot be moved until their associated
sidechain header ("h*") is ~100 blocks deep in the sidechain (hence the
earlier conversation about the "ratchet", which attempts to measure this).

The timeline that CryptAxe and I discussed, as I last remember it, is that:
0. (setup) The sidechain node is run by a briber, and this briber
constructs a sidechain block paying himself all the fees. These fees
total q=4 BTC.
1. Negotiations happen out of bound, between Briber and all miners.
(still setting up) Each new transaction the Briber makes, he chooses a
completely new h* (which is trivial for him to do by incrementing a
nonce/anything), and he may as well also fund each of these txns with
the same unspent output (owned by him). This prevents a miner from
annoying the Briber by including many ultimately-invalid transactions.
2. Miner1 includes h* in the coinbase of today's block thus BMMing a
sidechain block today, he also includes the transaction he just
negotiated with the Briber (call it, "tx1"). This tx1 is one where
Briber pays z=(q-0.001) to an op_bribe script that will eventually pay z
BTC to Bitcoin address M owned by "miner1".
3. After ~123 blocks, the ratchet (on mainchain) indicates that the
sidechain headers have advanced sequentially by x=100 places. This
allows miner1 to spend from tx1 to address M.
3. OR, after ~250 blocks, the second timing threshold is reached*, and
the Briber can spend from his script back to an address he controls
(also predefined in steps 1 and 2).


*This is the dual-threshold time-locking technique that the LN uses to
prove a negative.

The second timelock setup is required because it is possible that miner
will earnestly BMM a sidechain block, but then reorg such that this
block is orphaned out of the longest (side)chain. In this case, the
Briber doesn't get paid his tx-fees, so he is entitled to a refund.


So, maybe this BIP will need to be edited a little. : ) Nonetheless, I'm
glad Chris is taking the initiative and doing this work. And I'm sorry
if the documentation has shifted too much. At the bottom of the spec
blog post there are some notes, but they probably aren't very helpful.



On 6/28/2017 12:07 AM, Gregory Maxwell via bitcoin-dev wrote:
> On Wed, Jun 28, 2017 at 12:37 AM, Chris Stewart via bitcoin-dev
> <bitcoin-dev at lists.linuxfoundation.org> wrote:
>> A new block rule is added which requires that the miner's coinbase reward be
>> at index 0 in the coinbase transaction's output vector.
> 
> This is an absurd restriction-- I hope it was not your intent to
> directly ban P2Pool and probably any other form of decentralized or
> less centralized mining pooling... but thats what doing that does.
> 
>> It also fixes the witness commitment output to be at index 1 of the coinbase transaction's output vector.
> 
> This removes important flexibility that was intentionally preserved.
> What happens when an additional commitment is needed for bitcoin?
> must some sidechain be irreparably destroyed? looks like it in  your
> proposal.
> 
>> For instance, the mimblewimble sidechain could correspond to index 2 of the vector outputs on the coinbase transaction.
> 
> And what happens if index 1 isn't present? if index 35 is used must
> there be 34 dummy outputs?
> 
>> This op code looks into the coinbase transaction's output vector at the given index (which is derived from the sidechain id) and checks to see if the hash in the block matches the hash inside of the BRIBEVERIFY progra
> 
> This is not monotone/reorg safe. It means that the output coins (if
> any) are not equivalently fungible with other bitcoins (for, e.g. 100
> blocks) because if there is a reorg this transaction cannot be
> restored to the chain.  It's also impure and not compatible with
> caching, which would be unfortunate and slow block propagation.
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
> 

From truthcoin at gmail.com  Wed Jun 28 16:43:22 2017
From: truthcoin at gmail.com (Paul Sztorc)
Date: Wed, 28 Jun 2017 12:43:22 -0400
Subject: [bitcoin-dev] BIP: OP_BRIBVERIFY - the op code needed for Blind
 Merge Mined drivechains
In-Reply-To: <201706280520.29105.luke@dashjr.org>
References: <CAGL6+mHQ_vMc2JYVqwfP89WOZdUF2WDtWfh7ccL1PQve=nC+zQ@mail.gmail.com>
	<201706280520.29105.luke@dashjr.org>
Message-ID: <32d0153f-0660-3261-237e-516b570bc2db@gmail.com>


Hi Luke,

On 6/28/2017 1:20 AM, Luke Dashjr via bitcoin-dev wrote:
> On Wednesday 28 June 2017 12:37:13 AM Chris Stewart via bitcoin-dev wrote:
>> BRIBEVERIFY redefines the existing NOP4 opcode. When executed, if the given
>> critical hash is included at the given vout index in the coinbase
>> transaction
>> the script evaluates to true. Otherwise, the script will fail.
>>
>> This allows sidechains to be merged mined against
>> bitcoin without burdening bitcoin miners with extra resource requirements.
> 
> I don't see how. It seems like the logical outcome from this is "whoever pays 
> the most gets the next sidechain block"... That's not particularly useful for 
> merge mining.

This is one of the assumptions which BMM exploits, see #4 of:
http://www.truthcoin.info/blog/blind-merged-mining/#focus

The idea is that this is a safe assumption, because it is already the
case today. If we assume that miners revenue-maximize, and further that
the "bidder" frames his payments in tx-fees, then a willing buyer can
control the next block by simply filling it with high tx-fee spam.
Anyone who is willing to pay the most can already 'get' the next
mainchain block (only, indirectly).

> 
>> This enables sidechains in Bitcoin.
> 
> There are different kinds of sidechains...
> 
> Federated peg: this already works on Bitcoin.
> SPV/SNARK peg: this isn't enabled by your BIP.
> Drivechains: this isn't enabled by your BIP.
> 
> How do you say this enables any kind of sidechain?

Yes, it is unclear, but Chris' email is specific to blind merged mining
(BMM), which is kind of a "sidechains +". So this does not directly
enable any sidechains. Instead, it enables the "+" part.

--Paul

From truthcoin at gmail.com  Wed Jun 28 22:20:35 2017
From: truthcoin at gmail.com (Paul Sztorc)
Date: Wed, 28 Jun 2017 18:20:35 -0400
Subject: [bitcoin-dev] BIP: OP_BRIBVERIFY - the op code needed for Blind
 Merge Mined drivechains
In-Reply-To: <OozQK1_gWeExd5578AYH_dHnSKSvx63FJc2rIBBcaJF4f07qzsR8rr-ka5epwMFCjqDuidAWZiZqqlvn4xvSuUpDY0KkV014VQs6_E3Rp_A=@protonmail.com>
References: <CAGL6+mHQ_vMc2JYVqwfP89WOZdUF2WDtWfh7ccL1PQve=nC+zQ@mail.gmail.com>
	<OozQK1_gWeExd5578AYH_dHnSKSvx63FJc2rIBBcaJF4f07qzsR8rr-ka5epwMFCjqDuidAWZiZqqlvn4xvSuUpDY0KkV014VQs6_E3Rp_A=@protonmail.com>
Message-ID: <2f2e6b7c-2d47-518a-5a8f-0b5333607aac@gmail.com>

Hi ZmnSCPxj,

It seems that, in your version, the "bribers" would react to the scheme
in inefficient ways, particularly when the mainchain's tx-fee-rate (ie
fee per Kb) is low.

In short, there would be many bribe-attempts (each of which would take
up space in mainchain blocks), almost all of which would be unsuccessful.

In turn, miners would likely react to this, and try to improve the state
of affairs by offering users the privilege of occupying transaction slot
#2 (ie, the one right after the coinbase). Users would need to trust
miners for this, which introduces a cost friction which is pure
deadweight loss. And, it might be easier for larger/older miners to be
trustworthy than smaller/newer ones.

Your way is actually very similar to mine. Mine _forces_ the bribe to be
in the earliest txn (the coinbase) and to only occur once. Yours doesn't
do anything to refund the briber, if the sidechain (but not the
mainchain) reorganizes (as it can easily do, if an older sidechain
parent is extended while the mainchain proceeds normally). This creates
additional risk.

I think mine is also much more space-efficient. Even if ours each had
exactly one h* per sidechain per block, it seems that I only require one
hash to be communicated (plus an indicator byte, and a ~2 byte counter
for the ratchet), whereas you require two. Since its overhead per
sidechain per block, it actually might really add up.

Thanks,
Paul



On 6/28/2017 4:26 AM, ZmnSCPxj via bitcoin-dev wrote:
> Good morning.
> 
> I still do not see what this does that cannot be done by:
> 
> OP_RETURN <sidechain-id> <sidechain-block-id>
> 
> A transaction with such an output would allow sidechain-miners to bribe
> mainchain-miners by paying a transaction fee if the transaction
> containing this OP_RETURN is included in a block and committed to by a
> mainchain-miner in the Merkle tree root.
> 
> It would not require a softfork.
> 
> --
> 
> I have an alternate proposal that sidechains and altcoins that want to
> do "blinded" merge mining can use without a softfork:
> 
> 1.  Encode a block header as a simple cons-pair, with the head as the
> block and the tail as the parent cons-pair.
> 1.1.  This can be encoded as a 32-byte hash of the block including its
> header, and the 32-byte hash of the parent cons-pair.
> 1.2.  This is now the actual "chain" in the sidecoin/altcoin blockchain.
> 2.  When a sidechain-node wants to know the consensus, it downloads
> mainchain-blocks and looks for OP_RETURN's.
> 2.1.  Starting with its genesis cons-pair hash (equivalent to the empty
> list) as the current cons-pair, it scans each OP_RETURN transaction.
> 2.1.1.  If an OP_RETURN is 64-byte and has the parent cons-pair equal to
> the current cons-pair, look for the side block indicated and confirm its
> correctness.  If correct, update the current cons-pair for the hash of
> the OP_RETURN data.
> 2.2.  When reaching the latest mainchain block, the current cons-pair is
> now the sidecoin/altcoin latest block.
> 2.3.  Note that if multiple OP_RETURN in a block match the current
> cons-pair, the first one is considered the correct chain.  This property
> means that the sidechain/altchain can only have a chainsplit if the
> mainchain has a chainsplit.
> 3.  When a sidechain-miner wants to create a side-block, it generates a
> new cons-pair and creates an OP_RETURN transaction for it, paying a
> mainchain-miner to include it in the next mainchain-block.
> 3.1.  The sidechain-miner risks that its competitors will outbid it and
> get its OP_RETURN earlier in a mainchain-block (or earlier in the order
> of transactions).  It can mitigate this risk by updating itself to
> become a mainchain-miner, it can then keep its OP_RETURN transaction
> private and put it earlier in the block, ensuring it will "win" the
> sidechain-consensus if it wins the mainchain-consensus.
> 
> Regards,
> ZmnSCPxj
> 
> -------- Original Message --------
> Subject: [bitcoin-dev] BIP: OP_BRIBVERIFY - the op code needed for Blind
> Merge Mined drivechains
> Local Time: June 28, 2017 8:37 AM
> UTC Time: June 28, 2017 12:37 AM
> From: bitcoin-dev at lists.linuxfoundation.org
> To: Bitcoin Protocol Discussion <bitcoin-dev at lists.linuxfoundation.org>
> 
> <pre> 
>   BIP: <BIP number>
>   Layer: Consensus (Soft fork)
>   Title: OP_BRIBEVERIFY
>   Author: Chris Stewart <chris at suredbits.com>
>   Status: Draft
>   Type: Standards Track
>   Created: 2017-06-27
> </pre>
> 
> 
> ==Abstract==
> 
> This BIP describes a new opcode, OP_BRIBEVERIFY, for the Bitcoin
> scripting system that allows for a user to bribe a miner to include a hash
> in the coinbase transaction's output.
> 
> 
> ==Summary==
> 
> BRIBEVERIFY redefines the existing NOP4 opcode. When executed, if the given
> critical hash is included at the given vout index in the coinbase
> transaction
> the script evaluates to true. Otherwise, the script will fail.
> 
> This allows sidechains to be merged mined against
> bitcoin without burdening bitcoin miners with extra resource requirements.
> 
> ==Motivation==
> 
> The current political climate of bitcoin is extremely contentious. Many
> community members
> have different visions of what bitcoin is. This op code is meant to
> enable [http://www.truthcoin.info/blog/blind-merged-mining/ Blind Merge
> Mining].
> This enables sidechains in Bitcoin. With OP_BRIBEVERIFY, sidechains
> miners can
> bribe bitcoin miners to to include their block hash in the bitcoin
> blockchain. If their block
> is included in the coinbase transaction's vout, it is assumed that block
> is a mined block on the sidechain.
> 
> This will allow various factions of the community to realize their
> vision on their own separate
> blockchain that is interoperable with the bitcoin blockchain. This
> allows those factions to use
> bitcoin as a 'reserve currency' for their own network.
> 
> 
> ===Commitment Structure===
> 
> A new block rule is added which requires that the miner's coinbase
> reward be at index 0 in the coinbase transaction's output vector.
> 
> It also fixes the witness commitment output to be at index 1 of the
> coinbase transaction's output vector.
> 
> This is needed so we can reliably tell what vout corresponds to what
> drivechain. For instance, the mimblewimble sidechain
> could correspond to index 2 of the vector outputs on the coinbase
> transaction.
> 
> The commitment is recorded in a <code>scriptPubKey</code> of the
> coinbase transaction. It must be at least 34 bytes in size
>    1-byte - OP_RETURN (0x6a)
>    1-byte - Push the following 32 bytes (0x20)
>   32-byte - block hash
> 
> the 35th byte and onward have no consensus meaning.
> 
> ===OP_BRIBEVERIFY op code===
> 
> This op code reads two arguments from the stack. The stack top is
> expected to be a sidechain id for which this user attempting to blind
> merge mine for.
> The next element on the stack is expected to be a block hash. This op
> code looks into the coinbase transaction's output vector at the given
> index (which is derived from the sidechain id) and checks
> to see if the hash in the block matches the hash inside of the
> BRIBEVERIFY program. If the hashes match, the OP_BRIBEVERIFY acts as an
> OP_NOP. If the
> comparison between the two hashes fail, the script fails.
> 
> ===BRIBEVERIFY program===
> 
> A standard BRIBEVERIFY program has the format:
>   1-byte - Push the following 32 bytes (0x20)
>  32-byte - block hash
>   1 byte - Push operation? (needed if number can't be encoded as OP_0 -
> OP_16)
>   1 byte - sidechain id
>   1 byte - OP_BRIBEVERIFY op code
> 
> ==Detailed Specification==
> 
> Refer to the reference implementation, reproduced below, for the precise
> semantics and detailed rationale for those semantics.
> 
>  
>  case OP_NOP4:
>  {
>     //format: block_hash sidechain_id OP_BRIBEVERIFY
>     if (!(flags & SCRIPT_VERIFY_BRIBEVERIFY)) {
>         // not enabled; treat as a NOP4
>         if (flags & SCRIPT_VERIFY_DISCOURAGE_UPGRADABLE_NOPS) {
>             return set_error(serror, SCRIPT_ERR_DISCOURAGE_UPGRADABLE_NOPS);
>         }
>         break;
>     }
>    
>     if (stack.size() < 2)
>         return set_error(serror, SCRIPT_ERR_INVALID_STACK_OPERATION);
>  
>     const CScriptNum scriptNumSidechainId(stacktop(-1),fRequireMinimal);
>     uint8_t nSidechainId; 
>     if (!checker.CheckSidechainId(scriptNumSidechainId,nSidechainId)) {
>         return set_error(serror, SCRIPT_ERR_UNKNOWN_SIDECHAIN);
>     }
>  
>     // Check block hash
>     bool fHashCritical =
> checker.CheckCriticalHash(stacktop(-2),nSidechainId);
>     if (!fHashCritical) {
>         return set_error(serror, SCRIPT_ERR_UNSATISFIED_BRIBE);
>     }
>     break;
>  }
> 
> 
> 
> https://github.com/Christewart/bitcoin/blob/94b6f33f2278c42d4d8758a3c8ffe2078e4ec933/src/script/interpreter.cpp#L427
> 
> https://github.com/drivechain-project/bitcoin/pull/13
> 
> ==Deployment==
> 
> TODO
> 
> ==Credits==
> 
> Credit to Paul Sztorc for the original idea of Blind Merge Mined sidechains.
> 
> Credit to CryptAxe for writing the foundational layer of software for
> drivechains so I could implement OP_BRIBEVERIFY.
> 
> 
> ==References==
> 
> Blind Merge Mined Sidechains -
> http://www.truthcoin.info/blog/blind-merged-mining/
> Mailing list discussion -
> https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-May/014408.html
> 
> ==Copyright==
> 
> This document is placed in the public domain.
> 
> 
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
> 

From roconnor at blockstream.io  Wed Jun 28 22:49:54 2017
From: roconnor at blockstream.io (Russell O'Connor)
Date: Wed, 28 Jun 2017 18:49:54 -0400
Subject: [bitcoin-dev] BIP: OP_BRIBVERIFY - the op code needed for Blind
 Merge Mined drivechains
In-Reply-To: <2f2e6b7c-2d47-518a-5a8f-0b5333607aac@gmail.com>
References: <CAGL6+mHQ_vMc2JYVqwfP89WOZdUF2WDtWfh7ccL1PQve=nC+zQ@mail.gmail.com>
	<OozQK1_gWeExd5578AYH_dHnSKSvx63FJc2rIBBcaJF4f07qzsR8rr-ka5epwMFCjqDuidAWZiZqqlvn4xvSuUpDY0KkV014VQs6_E3Rp_A=@protonmail.com>
	<2f2e6b7c-2d47-518a-5a8f-0b5333607aac@gmail.com>
Message-ID: <CAMZUoKmKxJvVECh8ofdn=6N1tZ2M_4EAAFcWvpOeUYVp5DDyDw@mail.gmail.com>

I haven't really been following the drivechain discussion; I have found the
documentation about how drivechains are supposed to work scattered and
difficult to follow. So, without advocating for or against this proposal,
I'd also suggest that adding an opcode is not the best way to implement
this bribe.

The problem I see is that to send a bribe one must first post a transaction
to a script that uses the OP_BRIBE code that fixes the critical hash (and
the sidechain id), and then a second transaction is needed to pay the bribe
to the miner.

I suggest instead to use a 0 output value with some currently non-standard
OP_RETURN output script that specifies the critical hash (and the sidechain
id), similar to ZmnSCPxj's idea.  The difference is that I we would
soft-fork a rule that says that such an output is only legal when a miner
places the same critical hash suitably in their coinbase output.

OP_RETURN outputs are prunable from the UTXO set.  The special bribe output
can be fixed to 0 value because the bribe will be paid using the
transaction's fees.  To perform a bribe, a user creates and signs a
transaction containing one (or more) of these special bribe outputs.  The
fee of this transaction constitutes the bribe, and any change the user has
can be sent back to themselves.  This way only a single transaction is
required to make a bribe.  I didn't really understand the bribe refund
mechanism, but I think the fact that the bribe can be done in a single
transaction this way alleviates any need for bribe refunds.

Hopefully I have understood the goal of this proposal.


On Wed, Jun 28, 2017 at 6:20 PM, Paul Sztorc via bitcoin-dev <
bitcoin-dev at lists.linuxfoundation.org> wrote:

> Hi ZmnSCPxj,
>
> It seems that, in your version, the "bribers" would react to the scheme
> in inefficient ways, particularly when the mainchain's tx-fee-rate (ie
> fee per Kb) is low.
>
> In short, there would be many bribe-attempts (each of which would take
> up space in mainchain blocks), almost all of which would be unsuccessful.
>
> In turn, miners would likely react to this, and try to improve the state
> of affairs by offering users the privilege of occupying transaction slot
> #2 (ie, the one right after the coinbase). Users would need to trust
> miners for this, which introduces a cost friction which is pure
> deadweight loss. And, it might be easier for larger/older miners to be
> trustworthy than smaller/newer ones.
>
> Your way is actually very similar to mine. Mine _forces_ the bribe to be
> in the earliest txn (the coinbase) and to only occur once. Yours doesn't
> do anything to refund the briber, if the sidechain (but not the
> mainchain) reorganizes (as it can easily do, if an older sidechain
> parent is extended while the mainchain proceeds normally). This creates
> additional risk.
>
> I think mine is also much more space-efficient. Even if ours each had
> exactly one h* per sidechain per block, it seems that I only require one
> hash to be communicated (plus an indicator byte, and a ~2 byte counter
> for the ratchet), whereas you require two. Since its overhead per
> sidechain per block, it actually might really add up.
>
> Thanks,
> Paul
>
>
>
> On 6/28/2017 4:26 AM, ZmnSCPxj via bitcoin-dev wrote:
> > Good morning.
> >
> > I still do not see what this does that cannot be done by:
> >
> > OP_RETURN <sidechain-id> <sidechain-block-id>
> >
> > A transaction with such an output would allow sidechain-miners to bribe
> > mainchain-miners by paying a transaction fee if the transaction
> > containing this OP_RETURN is included in a block and committed to by a
> > mainchain-miner in the Merkle tree root.
> >
> > It would not require a softfork.
> >
> > --
> >
> > I have an alternate proposal that sidechains and altcoins that want to
> > do "blinded" merge mining can use without a softfork:
> >
> > 1.  Encode a block header as a simple cons-pair, with the head as the
> > block and the tail as the parent cons-pair.
> > 1.1.  This can be encoded as a 32-byte hash of the block including its
> > header, and the 32-byte hash of the parent cons-pair.
> > 1.2.  This is now the actual "chain" in the sidecoin/altcoin blockchain.
> > 2.  When a sidechain-node wants to know the consensus, it downloads
> > mainchain-blocks and looks for OP_RETURN's.
> > 2.1.  Starting with its genesis cons-pair hash (equivalent to the empty
> > list) as the current cons-pair, it scans each OP_RETURN transaction.
> > 2.1.1.  If an OP_RETURN is 64-byte and has the parent cons-pair equal to
> > the current cons-pair, look for the side block indicated and confirm its
> > correctness.  If correct, update the current cons-pair for the hash of
> > the OP_RETURN data.
> > 2.2.  When reaching the latest mainchain block, the current cons-pair is
> > now the sidecoin/altcoin latest block.
> > 2.3.  Note that if multiple OP_RETURN in a block match the current
> > cons-pair, the first one is considered the correct chain.  This property
> > means that the sidechain/altchain can only have a chainsplit if the
> > mainchain has a chainsplit.
> > 3.  When a sidechain-miner wants to create a side-block, it generates a
> > new cons-pair and creates an OP_RETURN transaction for it, paying a
> > mainchain-miner to include it in the next mainchain-block.
> > 3.1.  The sidechain-miner risks that its competitors will outbid it and
> > get its OP_RETURN earlier in a mainchain-block (or earlier in the order
> > of transactions).  It can mitigate this risk by updating itself to
> > become a mainchain-miner, it can then keep its OP_RETURN transaction
> > private and put it earlier in the block, ensuring it will "win" the
> > sidechain-consensus if it wins the mainchain-consensus.
> >
> > Regards,
> > ZmnSCPxj
> >
> > -------- Original Message --------
> > Subject: [bitcoin-dev] BIP: OP_BRIBVERIFY - the op code needed for Blind
> > Merge Mined drivechains
> > Local Time: June 28, 2017 8:37 AM
> > UTC Time: June 28, 2017 12:37 AM
> > From: bitcoin-dev at lists.linuxfoundation.org
> > To: Bitcoin Protocol Discussion <bitcoin-dev at lists.linuxfoundation.org>
> >
> > <pre>
> >   BIP: <BIP number>
> >   Layer: Consensus (Soft fork)
> >   Title: OP_BRIBEVERIFY
> >   Author: Chris Stewart <chris at suredbits.com>
> >   Status: Draft
> >   Type: Standards Track
> >   Created: 2017-06-27
> > </pre>
> >
> >
> > ==Abstract==
> >
> > This BIP describes a new opcode, OP_BRIBEVERIFY, for the Bitcoin
> > scripting system that allows for a user to bribe a miner to include a
> hash
> > in the coinbase transaction's output.
> >
> >
> > ==Summary==
> >
> > BRIBEVERIFY redefines the existing NOP4 opcode. When executed, if the
> given
> > critical hash is included at the given vout index in the coinbase
> > transaction
> > the script evaluates to true. Otherwise, the script will fail.
> >
> > This allows sidechains to be merged mined against
> > bitcoin without burdening bitcoin miners with extra resource
> requirements.
> >
> > ==Motivation==
> >
> > The current political climate of bitcoin is extremely contentious. Many
> > community members
> > have different visions of what bitcoin is. This op code is meant to
> > enable [http://www.truthcoin.info/blog/blind-merged-mining/ Blind Merge
> > Mining].
> > This enables sidechains in Bitcoin. With OP_BRIBEVERIFY, sidechains
> > miners can
> > bribe bitcoin miners to to include their block hash in the bitcoin
> > blockchain. If their block
> > is included in the coinbase transaction's vout, it is assumed that block
> > is a mined block on the sidechain.
> >
> > This will allow various factions of the community to realize their
> > vision on their own separate
> > blockchain that is interoperable with the bitcoin blockchain. This
> > allows those factions to use
> > bitcoin as a 'reserve currency' for their own network.
> >
> >
> > ===Commitment Structure===
> >
> > A new block rule is added which requires that the miner's coinbase
> > reward be at index 0 in the coinbase transaction's output vector.
> >
> > It also fixes the witness commitment output to be at index 1 of the
> > coinbase transaction's output vector.
> >
> > This is needed so we can reliably tell what vout corresponds to what
> > drivechain. For instance, the mimblewimble sidechain
> > could correspond to index 2 of the vector outputs on the coinbase
> > transaction.
> >
> > The commitment is recorded in a <code>scriptPubKey</code> of the
> > coinbase transaction. It must be at least 34 bytes in size
> >    1-byte - OP_RETURN (0x6a)
> >    1-byte - Push the following 32 bytes (0x20)
> >   32-byte - block hash
> >
> > the 35th byte and onward have no consensus meaning.
> >
> > ===OP_BRIBEVERIFY op code===
> >
> > This op code reads two arguments from the stack. The stack top is
> > expected to be a sidechain id for which this user attempting to blind
> > merge mine for.
> > The next element on the stack is expected to be a block hash. This op
> > code looks into the coinbase transaction's output vector at the given
> > index (which is derived from the sidechain id) and checks
> > to see if the hash in the block matches the hash inside of the
> > BRIBEVERIFY program. If the hashes match, the OP_BRIBEVERIFY acts as an
> > OP_NOP. If the
> > comparison between the two hashes fail, the script fails.
> >
> > ===BRIBEVERIFY program===
> >
> > A standard BRIBEVERIFY program has the format:
> >   1-byte - Push the following 32 bytes (0x20)
> >  32-byte - block hash
> >   1 byte - Push operation? (needed if number can't be encoded as OP_0 -
> > OP_16)
> >   1 byte - sidechain id
> >   1 byte - OP_BRIBEVERIFY op code
> >
> > ==Detailed Specification==
> >
> > Refer to the reference implementation, reproduced below, for the precise
> > semantics and detailed rationale for those semantics.
> >
> >
> >  case OP_NOP4:
> >  {
> >     //format: block_hash sidechain_id OP_BRIBEVERIFY
> >     if (!(flags & SCRIPT_VERIFY_BRIBEVERIFY)) {
> >         // not enabled; treat as a NOP4
> >         if (flags & SCRIPT_VERIFY_DISCOURAGE_UPGRADABLE_NOPS) {
> >             return set_error(serror, SCRIPT_ERR_DISCOURAGE_
> UPGRADABLE_NOPS);
> >         }
> >         break;
> >     }
> >
> >     if (stack.size() < 2)
> >         return set_error(serror, SCRIPT_ERR_INVALID_STACK_OPERATION);
> >
> >     const CScriptNum scriptNumSidechainId(stacktop(-1),fRequireMinimal);
> >     uint8_t nSidechainId;
> >     if (!checker.CheckSidechainId(scriptNumSidechainId,nSidechainId)) {
> >         return set_error(serror, SCRIPT_ERR_UNKNOWN_SIDECHAIN);
> >     }
> >
> >     // Check block hash
> >     bool fHashCritical =
> > checker.CheckCriticalHash(stacktop(-2),nSidechainId);
> >     if (!fHashCritical) {
> >         return set_error(serror, SCRIPT_ERR_UNSATISFIED_BRIBE);
> >     }
> >     break;
> >  }
> >
> >
> >
> > https://github.com/Christewart/bitcoin/blob/
> 94b6f33f2278c42d4d8758a3c8ffe2078e4ec933/src/script/interpreter.cpp#L427
> >
> > https://github.com/drivechain-project/bitcoin/pull/13
> >
> > ==Deployment==
> >
> > TODO
> >
> > ==Credits==
> >
> > Credit to Paul Sztorc for the original idea of Blind Merge Mined
> sidechains.
> >
> > Credit to CryptAxe for writing the foundational layer of software for
> > drivechains so I could implement OP_BRIBEVERIFY.
> >
> >
> > ==References==
> >
> > Blind Merge Mined Sidechains -
> > http://www.truthcoin.info/blog/blind-merged-mining/
> > Mailing list discussion -
> > https://lists.linuxfoundation.org/pipermail/bitcoin-dev/
> 2017-May/014408.html
> >
> > ==Copyright==
> >
> > This document is placed in the public domain.
> >
> >
> > _______________________________________________
> > bitcoin-dev mailing list
> > bitcoin-dev at lists.linuxfoundation.org
> > https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
> >
> _______________________________________________
> bitcoin-dev mailing list
> bitcoin-dev at lists.linuxfoundation.org
> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170628/3ea18112/attachment-0001.html>

From roconnor at blockstream.io  Thu Jun 29 01:09:27 2017
From: roconnor at blockstream.io (Russell O'Connor)
Date: Wed, 28 Jun 2017 21:09:27 -0400
Subject: [bitcoin-dev] BIP: OP_BRIBVERIFY - the op code needed for Blind
 Merge Mined drivechains
In-Reply-To: <CAGL6+mECcS=rNz3guM+95RoOB4cVYvXTgTj9JWhf52uZRZimCg@mail.gmail.com>
References: <CAGL6+mHQ_vMc2JYVqwfP89WOZdUF2WDtWfh7ccL1PQve=nC+zQ@mail.gmail.com>
	<OozQK1_gWeExd5578AYH_dHnSKSvx63FJc2rIBBcaJF4f07qzsR8rr-ka5epwMFCjqDuidAWZiZqqlvn4xvSuUpDY0KkV014VQs6_E3Rp_A=@protonmail.com>
	<2f2e6b7c-2d47-518a-5a8f-0b5333607aac@gmail.com>
	<CAMZUoKmKxJvVECh8ofdn=6N1tZ2M_4EAAFcWvpOeUYVp5DDyDw@mail.gmail.com>
	<CAGL6+mECcS=rNz3guM+95RoOB4cVYvXTgTj9JWhf52uZRZimCg@mail.gmail.com>
Message-ID: <CAMZUoK=s0LtsJS-Wspg83Pz-HH=8TdhbitJtXb-nzNRCO0hJ5w@mail.gmail.com>

HI Chris,

My proposal isn't intended to assume that the bitcoin miner is also
following the sidechain.  In line with my understanding of your proposal,
I'm only proposing to bribe miners to put particular data into the coinbase
output regardless of any semantics that doing so may entail. By my proposed
soft-fork rules, only one of these Bribe TXOs can be included per coinbase
slot (except unless there are identical Bribe TXOs), so there is a
competition of which one of a set of conflicting Bribe TXOs will be
included in the next block.  (That said, the losing set Bribe TXOs can be
included in the later blocks; I don't know what this means semantically for
sidechains; however, the same thing occurs with your proposal as well.)

On Wed, Jun 28, 2017 at 7:47 PM, Chris Stewart <chris at suredbits.com> wrote:

> Hi Russell,
>
> >I haven't really been following the drivechain discussion; I have found
> the documentation about how drivechains are supposed to work scattered and
> difficult to follow. So, without advocating for or against this proposal,
> I'd also suggest that adding an opcode is not the best way to implement
> this bribe.
>
> Despite the flaws in this draft BIP, the goal is to start consolidating
> this information into a more compact format. This BIP is *only*
> meant to address the Blind Merging Mining Process of drivechains. It does
> *not* address the withdrawal process from drivechain -> bitcoin.
>
> >The problem I see is that to send a bribe one must first post a
> transaction to a script that uses the OP_BRIBE code that fixes the critical
> hash (and the sidechain id), and then a second transaction is needed to pay
> the bribe to the miner.
>
> That is intentional, this allows for a competitive process (like bitcoin
> mining) for a block to be 'found' on the sidechain. The OP_BV output that
> rewards
> the bitcoin miner the most amount of money should be the one that is
> included in the bitcoin blockchain. If I understand your scheme correctly,
> you are
> assuming the the bitcoin miner is *also* following the sidechain --
> Sztorc's scheme does not make this assumption. The *number one goal* of BMM
> is to *minimize* the resource burden on bitcoin miners for mining on a
> drivechain.
>
> To gmaxwell/luke-jr,
>
> I agree my commitment scheme is flawed. Thanks for pointing it out. Is
> there any way we could manipulate a coinbase transaction
> into spending these OP_BV outputs? According to instagibbs, and AFIACT he
> is right, we cannot have coinbase transactions
> spend any outputs in previous blocks without a hard fork. This is
> unfortunate because it might make more sense for the coinbase transaction
> to spend these OP_BV outputs. We could design the coinbase transaction's
> scriptSig to push the critical hash onto the stack and
> place an OP_EQUAL on the OP_BV output to verify they were equal.
> If I understand gmaxwell's concern about 'monotone' (or stateless) blocks
> correctly, I *think*
> this solution might fix that as well.
>
> Another way we could fix this is by *fixing* the drivechain indices.
> Therefore the mining rewards and witness commitments must
> *not* occupy one of those indices -- but can occupy any other indice in
> the coinbase output.
> This would give us future flexibility for committing to new soft forks.
> For instance, we would say
> the mining reward must *not* be index 0 of the coinbase transaction, but
> can occupy index 1 - 256. The same would apply for witness commitments.
>
> -Chris
>
> On Wed, Jun 28, 2017 at 5:49 PM, Russell O'Connor <roconnor at blockstream.io
> > wrote:
>
>> I haven't really been following the drivechain discussion; I have found
>> the documentation about how drivechains are supposed to work scattered and
>> difficult to follow. So, without advocating for or against this proposal,
>> I'd also suggest that adding an opcode is not the best way to implement
>> this bribe.
>>
>> The problem I see is that to send a bribe one must first post a
>> transaction to a script that uses the OP_BRIBE code that fixes the critical
>> hash (and the sidechain id), and then a second transaction is needed to pay
>> the bribe to the miner.
>>
>> I suggest instead to use a 0 output value with some currently
>> non-standard OP_RETURN output script that specifies the critical hash (and
>> the sidechain id), similar to ZmnSCPxj's idea.  The difference is that I we
>> would soft-fork a rule that says that such an output is only legal when a
>> miner places the same critical hash suitably in their coinbase output.
>>
>> OP_RETURN outputs are prunable from the UTXO set.  The special bribe
>> output can be fixed to 0 value because the bribe will be paid using the
>> transaction's fees.  To perform a bribe, a user creates and signs a
>> transaction containing one (or more) of these special bribe outputs.  The
>> fee of this transaction constitutes the bribe, and any change the user has
>> can be sent back to themselves.  This way only a single transaction is
>> required to make a bribe.  I didn't really understand the bribe refund
>> mechanism, but I think the fact that the bribe can be done in a single
>> transaction this way alleviates any need for bribe refunds.
>>
>> Hopefully I have understood the goal of this proposal.
>>
>>
>> On Wed, Jun 28, 2017 at 6:20 PM, Paul Sztorc via bitcoin-dev <
>> bitcoin-dev at lists.linuxfoundation.org> wrote:
>>
>>> Hi ZmnSCPxj,
>>>
>>> It seems that, in your version, the "bribers" would react to the scheme
>>> in inefficient ways, particularly when the mainchain's tx-fee-rate (ie
>>> fee per Kb) is low.
>>>
>>> In short, there would be many bribe-attempts (each of which would take
>>> up space in mainchain blocks), almost all of which would be unsuccessful.
>>>
>>> In turn, miners would likely react to this, and try to improve the state
>>> of affairs by offering users the privilege of occupying transaction slot
>>> #2 (ie, the one right after the coinbase). Users would need to trust
>>> miners for this, which introduces a cost friction which is pure
>>> deadweight loss. And, it might be easier for larger/older miners to be
>>> trustworthy than smaller/newer ones.
>>>
>>> Your way is actually very similar to mine. Mine _forces_ the bribe to be
>>> in the earliest txn (the coinbase) and to only occur once. Yours doesn't
>>> do anything to refund the briber, if the sidechain (but not the
>>> mainchain) reorganizes (as it can easily do, if an older sidechain
>>> parent is extended while the mainchain proceeds normally). This creates
>>> additional risk.
>>>
>>> I think mine is also much more space-efficient. Even if ours each had
>>> exactly one h* per sidechain per block, it seems that I only require one
>>> hash to be communicated (plus an indicator byte, and a ~2 byte counter
>>> for the ratchet), whereas you require two. Since its overhead per
>>> sidechain per block, it actually might really add up.
>>>
>>> Thanks,
>>> Paul
>>>
>>>
>>>
>>> On 6/28/2017 4:26 AM, ZmnSCPxj via bitcoin-dev wrote:
>>> > Good morning.
>>> >
>>> > I still do not see what this does that cannot be done by:
>>> >
>>> > OP_RETURN <sidechain-id> <sidechain-block-id>
>>> >
>>> > A transaction with such an output would allow sidechain-miners to bribe
>>> > mainchain-miners by paying a transaction fee if the transaction
>>> > containing this OP_RETURN is included in a block and committed to by a
>>> > mainchain-miner in the Merkle tree root.
>>> >
>>> > It would not require a softfork.
>>> >
>>> > --
>>> >
>>> > I have an alternate proposal that sidechains and altcoins that want to
>>> > do "blinded" merge mining can use without a softfork:
>>> >
>>> > 1.  Encode a block header as a simple cons-pair, with the head as the
>>> > block and the tail as the parent cons-pair.
>>> > 1.1.  This can be encoded as a 32-byte hash of the block including its
>>> > header, and the 32-byte hash of the parent cons-pair.
>>> > 1.2.  This is now the actual "chain" in the sidecoin/altcoin
>>> blockchain.
>>> > 2.  When a sidechain-node wants to know the consensus, it downloads
>>> > mainchain-blocks and looks for OP_RETURN's.
>>> > 2.1.  Starting with its genesis cons-pair hash (equivalent to the empty
>>> > list) as the current cons-pair, it scans each OP_RETURN transaction.
>>> > 2.1.1.  If an OP_RETURN is 64-byte and has the parent cons-pair equal
>>> to
>>> > the current cons-pair, look for the side block indicated and confirm
>>> its
>>> > correctness.  If correct, update the current cons-pair for the hash of
>>> > the OP_RETURN data.
>>> > 2.2.  When reaching the latest mainchain block, the current cons-pair
>>> is
>>> > now the sidecoin/altcoin latest block.
>>> > 2.3.  Note that if multiple OP_RETURN in a block match the current
>>> > cons-pair, the first one is considered the correct chain.  This
>>> property
>>> > means that the sidechain/altchain can only have a chainsplit if the
>>> > mainchain has a chainsplit.
>>> > 3.  When a sidechain-miner wants to create a side-block, it generates a
>>> > new cons-pair and creates an OP_RETURN transaction for it, paying a
>>> > mainchain-miner to include it in the next mainchain-block.
>>> > 3.1.  The sidechain-miner risks that its competitors will outbid it and
>>> > get its OP_RETURN earlier in a mainchain-block (or earlier in the order
>>> > of transactions).  It can mitigate this risk by updating itself to
>>> > become a mainchain-miner, it can then keep its OP_RETURN transaction
>>> > private and put it earlier in the block, ensuring it will "win" the
>>> > sidechain-consensus if it wins the mainchain-consensus.
>>> >
>>> > Regards,
>>> > ZmnSCPxj
>>> >
>>> > -------- Original Message --------
>>> > Subject: [bitcoin-dev] BIP: OP_BRIBVERIFY - the op code needed for
>>> Blind
>>> > Merge Mined drivechains
>>> > Local Time: June 28, 2017 8:37 AM
>>> > UTC Time: June 28, 2017 12:37 AM
>>> > From: bitcoin-dev at lists.linuxfoundation.org
>>> > To: Bitcoin Protocol Discussion <bitcoin-dev at lists.linuxfoundation.org
>>> >
>>> >
>>> > <pre>
>>> >   BIP: <BIP number>
>>> >   Layer: Consensus (Soft fork)
>>> >   Title: OP_BRIBEVERIFY
>>> >   Author: Chris Stewart <chris at suredbits.com>
>>> >   Status: Draft
>>> >   Type: Standards Track
>>> >   Created: 2017-06-27
>>> > </pre>
>>> >
>>> >
>>> > ==Abstract==
>>> >
>>> > This BIP describes a new opcode, OP_BRIBEVERIFY, for the Bitcoin
>>> > scripting system that allows for a user to bribe a miner to include a
>>> hash
>>> > in the coinbase transaction's output.
>>> >
>>> >
>>> > ==Summary==
>>> >
>>> > BRIBEVERIFY redefines the existing NOP4 opcode. When executed, if the
>>> given
>>> > critical hash is included at the given vout index in the coinbase
>>> > transaction
>>> > the script evaluates to true. Otherwise, the script will fail.
>>> >
>>> > This allows sidechains to be merged mined against
>>> > bitcoin without burdening bitcoin miners with extra resource
>>> requirements.
>>> >
>>> > ==Motivation==
>>> >
>>> > The current political climate of bitcoin is extremely contentious. Many
>>> > community members
>>> > have different visions of what bitcoin is. This op code is meant to
>>> > enable [http://www.truthcoin.info/blog/blind-merged-mining/ Blind
>>> Merge
>>> > Mining].
>>> > This enables sidechains in Bitcoin. With OP_BRIBEVERIFY, sidechains
>>> > miners can
>>> > bribe bitcoin miners to to include their block hash in the bitcoin
>>> > blockchain. If their block
>>> > is included in the coinbase transaction's vout, it is assumed that
>>> block
>>> > is a mined block on the sidechain.
>>> >
>>> > This will allow various factions of the community to realize their
>>> > vision on their own separate
>>> > blockchain that is interoperable with the bitcoin blockchain. This
>>> > allows those factions to use
>>> > bitcoin as a 'reserve currency' for their own network.
>>> >
>>> >
>>> > ===Commitment Structure===
>>> >
>>> > A new block rule is added which requires that the miner's coinbase
>>> > reward be at index 0 in the coinbase transaction's output vector.
>>> >
>>> > It also fixes the witness commitment output to be at index 1 of the
>>> > coinbase transaction's output vector.
>>> >
>>> > This is needed so we can reliably tell what vout corresponds to what
>>> > drivechain. For instance, the mimblewimble sidechain
>>> > could correspond to index 2 of the vector outputs on the coinbase
>>> > transaction.
>>> >
>>> > The commitment is recorded in a <code>scriptPubKey</code> of the
>>> > coinbase transaction. It must be at least 34 bytes in size
>>> >    1-byte - OP_RETURN (0x6a)
>>> >    1-byte - Push the following 32 bytes (0x20)
>>> >   32-byte - block hash
>>> >
>>> > the 35th byte and onward have no consensus meaning.
>>> >
>>> > ===OP_BRIBEVERIFY op code===
>>> >
>>> > This op code reads two arguments from the stack. The stack top is
>>> > expected to be a sidechain id for which this user attempting to blind
>>> > merge mine for.
>>> > The next element on the stack is expected to be a block hash. This op
>>> > code looks into the coinbase transaction's output vector at the given
>>> > index (which is derived from the sidechain id) and checks
>>> > to see if the hash in the block matches the hash inside of the
>>> > BRIBEVERIFY program. If the hashes match, the OP_BRIBEVERIFY acts as an
>>> > OP_NOP. If the
>>> > comparison between the two hashes fail, the script fails.
>>> >
>>> > ===BRIBEVERIFY program===
>>> >
>>> > A standard BRIBEVERIFY program has the format:
>>> >   1-byte - Push the following 32 bytes (0x20)
>>> >  32-byte - block hash
>>> >   1 byte - Push operation? (needed if number can't be encoded as OP_0 -
>>> > OP_16)
>>> >   1 byte - sidechain id
>>> >   1 byte - OP_BRIBEVERIFY op code
>>> >
>>> > ==Detailed Specification==
>>> >
>>> > Refer to the reference implementation, reproduced below, for the
>>> precise
>>> > semantics and detailed rationale for those semantics.
>>> >
>>> >
>>> >  case OP_NOP4:
>>> >  {
>>> >     //format: block_hash sidechain_id OP_BRIBEVERIFY
>>> >     if (!(flags & SCRIPT_VERIFY_BRIBEVERIFY)) {
>>> >         // not enabled; treat as a NOP4
>>> >         if (flags & SCRIPT_VERIFY_DISCOURAGE_UPGRADABLE_NOPS) {
>>> >             return set_error(serror, SCRIPT_ERR_DISCOURAGE_UPGRADAB
>>> LE_NOPS);
>>> >         }
>>> >         break;
>>> >     }
>>> >
>>> >     if (stack.size() < 2)
>>> >         return set_error(serror, SCRIPT_ERR_INVALID_STACK_OPERATION);
>>> >
>>> >     const CScriptNum scriptNumSidechainId(stacktop(
>>> -1),fRequireMinimal);
>>> >     uint8_t nSidechainId;
>>> >     if (!checker.CheckSidechainId(scriptNumSidechainId,nSidechainId))
>>> {
>>> >         return set_error(serror, SCRIPT_ERR_UNKNOWN_SIDECHAIN);
>>> >     }
>>> >
>>> >     // Check block hash
>>> >     bool fHashCritical =
>>> > checker.CheckCriticalHash(stacktop(-2),nSidechainId);
>>> >     if (!fHashCritical) {
>>> >         return set_error(serror, SCRIPT_ERR_UNSATISFIED_BRIBE);
>>> >     }
>>> >     break;
>>> >  }
>>> >
>>> >
>>> >
>>> > https://github.com/Christewart/bitcoin/blob/94b6f33f2278c42d
>>> 4d8758a3c8ffe2078e4ec933/src/script/interpreter.cpp#L427
>>> >
>>> > https://github.com/drivechain-project/bitcoin/pull/13
>>> >
>>> > ==Deployment==
>>> >
>>> > TODO
>>> >
>>> > ==Credits==
>>> >
>>> > Credit to Paul Sztorc for the original idea of Blind Merge Mined
>>> sidechains.
>>> >
>>> > Credit to CryptAxe for writing the foundational layer of software for
>>> > drivechains so I could implement OP_BRIBEVERIFY.
>>> >
>>> >
>>> > ==References==
>>> >
>>> > Blind Merge Mined Sidechains -
>>> > http://www.truthcoin.info/blog/blind-merged-mining/
>>> > Mailing list discussion -
>>> > https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017
>>> -May/014408.html
>>> >
>>> > ==Copyright==
>>> >
>>> > This document is placed in the public domain.
>>> >
>>> >
>>> > _______________________________________________
>>> > bitcoin-dev mailing list
>>> > bitcoin-dev at lists.linuxfoundation.org
>>> > https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>> >
>>> _______________________________________________
>>> bitcoin-dev mailing list
>>> bitcoin-dev at lists.linuxfoundation.org
>>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>>
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170628/0f8f4641/attachment-0001.html>

From chris at suredbits.com  Wed Jun 28 23:47:57 2017
From: chris at suredbits.com (Chris Stewart)
Date: Wed, 28 Jun 2017 18:47:57 -0500
Subject: [bitcoin-dev] BIP: OP_BRIBVERIFY - the op code needed for Blind
 Merge Mined drivechains
In-Reply-To: <CAMZUoKmKxJvVECh8ofdn=6N1tZ2M_4EAAFcWvpOeUYVp5DDyDw@mail.gmail.com>
References: <CAGL6+mHQ_vMc2JYVqwfP89WOZdUF2WDtWfh7ccL1PQve=nC+zQ@mail.gmail.com>
	<OozQK1_gWeExd5578AYH_dHnSKSvx63FJc2rIBBcaJF4f07qzsR8rr-ka5epwMFCjqDuidAWZiZqqlvn4xvSuUpDY0KkV014VQs6_E3Rp_A=@protonmail.com>
	<2f2e6b7c-2d47-518a-5a8f-0b5333607aac@gmail.com>
	<CAMZUoKmKxJvVECh8ofdn=6N1tZ2M_4EAAFcWvpOeUYVp5DDyDw@mail.gmail.com>
Message-ID: <CAGL6+mECcS=rNz3guM+95RoOB4cVYvXTgTj9JWhf52uZRZimCg@mail.gmail.com>

Hi Russell,

>I haven't really been following the drivechain discussion; I have found
the documentation about how drivechains are supposed to work scattered and
difficult to follow. So, without advocating for or against this proposal,
I'd also suggest that adding an opcode is not the best way to implement
this bribe.

Despite the flaws in this draft BIP, the goal is to start consolidating
this information into a more compact format. This BIP is *only*
meant to address the Blind Merging Mining Process of drivechains. It does
*not* address the withdrawal process from drivechain -> bitcoin.

>The problem I see is that to send a bribe one must first post a
transaction to a script that uses the OP_BRIBE code that fixes the critical
hash (and the sidechain id), and then a second transaction is needed to pay
the bribe to the miner.

That is intentional, this allows for a competitive process (like bitcoin
mining) for a block to be 'found' on the sidechain. The OP_BV output that
rewards
the bitcoin miner the most amount of money should be the one that is
included in the bitcoin blockchain. If I understand your scheme correctly,
you are
assuming the the bitcoin miner is *also* following the sidechain --
Sztorc's scheme does not make this assumption. The *number one goal* of BMM
is to *minimize* the resource burden on bitcoin miners for mining on a
drivechain.

To gmaxwell/luke-jr,

I agree my commitment scheme is flawed. Thanks for pointing it out. Is
there any way we could manipulate a coinbase transaction
into spending these OP_BV outputs? According to instagibbs, and AFIACT he
is right, we cannot have coinbase transactions
spend any outputs in previous blocks without a hard fork. This is
unfortunate because it might make more sense for the coinbase transaction
to spend these OP_BV outputs. We could design the coinbase transaction's
scriptSig to push the critical hash onto the stack and
place an OP_EQUAL on the OP_BV output to verify they were equal.
If I understand gmaxwell's concern about 'monotone' (or stateless) blocks
correctly, I *think*
this solution might fix that as well.

Another way we could fix this is by *fixing* the drivechain indices.
Therefore the mining rewards and witness commitments must
*not* occupy one of those indices -- but can occupy any other indice in the
coinbase output.
This would give us future flexibility for committing to new soft forks. For
instance, we would say
the mining reward must *not* be index 0 of the coinbase transaction, but
can occupy index 1 - 256. The same would apply for witness commitments.

-Chris

On Wed, Jun 28, 2017 at 5:49 PM, Russell O'Connor <roconnor at blockstream.io>
wrote:

> I haven't really been following the drivechain discussion; I have found
> the documentation about how drivechains are supposed to work scattered and
> difficult to follow. So, without advocating for or against this proposal,
> I'd also suggest that adding an opcode is not the best way to implement
> this bribe.
>
> The problem I see is that to send a bribe one must first post a
> transaction to a script that uses the OP_BRIBE code that fixes the critical
> hash (and the sidechain id), and then a second transaction is needed to pay
> the bribe to the miner.
>
> I suggest instead to use a 0 output value with some currently non-standard
> OP_RETURN output script that specifies the critical hash (and the sidechain
> id), similar to ZmnSCPxj's idea.  The difference is that I we would
> soft-fork a rule that says that such an output is only legal when a miner
> places the same critical hash suitably in their coinbase output.
>
> OP_RETURN outputs are prunable from the UTXO set.  The special bribe
> output can be fixed to 0 value because the bribe will be paid using the
> transaction's fees.  To perform a bribe, a user creates and signs a
> transaction containing one (or more) of these special bribe outputs.  The
> fee of this transaction constitutes the bribe, and any change the user has
> can be sent back to themselves.  This way only a single transaction is
> required to make a bribe.  I didn't really understand the bribe refund
> mechanism, but I think the fact that the bribe can be done in a single
> transaction this way alleviates any need for bribe refunds.
>
> Hopefully I have understood the goal of this proposal.
>
>
> On Wed, Jun 28, 2017 at 6:20 PM, Paul Sztorc via bitcoin-dev <
> bitcoin-dev at lists.linuxfoundation.org> wrote:
>
>> Hi ZmnSCPxj,
>>
>> It seems that, in your version, the "bribers" would react to the scheme
>> in inefficient ways, particularly when the mainchain's tx-fee-rate (ie
>> fee per Kb) is low.
>>
>> In short, there would be many bribe-attempts (each of which would take
>> up space in mainchain blocks), almost all of which would be unsuccessful.
>>
>> In turn, miners would likely react to this, and try to improve the state
>> of affairs by offering users the privilege of occupying transaction slot
>> #2 (ie, the one right after the coinbase). Users would need to trust
>> miners for this, which introduces a cost friction which is pure
>> deadweight loss. And, it might be easier for larger/older miners to be
>> trustworthy than smaller/newer ones.
>>
>> Your way is actually very similar to mine. Mine _forces_ the bribe to be
>> in the earliest txn (the coinbase) and to only occur once. Yours doesn't
>> do anything to refund the briber, if the sidechain (but not the
>> mainchain) reorganizes (as it can easily do, if an older sidechain
>> parent is extended while the mainchain proceeds normally). This creates
>> additional risk.
>>
>> I think mine is also much more space-efficient. Even if ours each had
>> exactly one h* per sidechain per block, it seems that I only require one
>> hash to be communicated (plus an indicator byte, and a ~2 byte counter
>> for the ratchet), whereas you require two. Since its overhead per
>> sidechain per block, it actually might really add up.
>>
>> Thanks,
>> Paul
>>
>>
>>
>> On 6/28/2017 4:26 AM, ZmnSCPxj via bitcoin-dev wrote:
>> > Good morning.
>> >
>> > I still do not see what this does that cannot be done by:
>> >
>> > OP_RETURN <sidechain-id> <sidechain-block-id>
>> >
>> > A transaction with such an output would allow sidechain-miners to bribe
>> > mainchain-miners by paying a transaction fee if the transaction
>> > containing this OP_RETURN is included in a block and committed to by a
>> > mainchain-miner in the Merkle tree root.
>> >
>> > It would not require a softfork.
>> >
>> > --
>> >
>> > I have an alternate proposal that sidechains and altcoins that want to
>> > do "blinded" merge mining can use without a softfork:
>> >
>> > 1.  Encode a block header as a simple cons-pair, with the head as the
>> > block and the tail as the parent cons-pair.
>> > 1.1.  This can be encoded as a 32-byte hash of the block including its
>> > header, and the 32-byte hash of the parent cons-pair.
>> > 1.2.  This is now the actual "chain" in the sidecoin/altcoin blockchain.
>> > 2.  When a sidechain-node wants to know the consensus, it downloads
>> > mainchain-blocks and looks for OP_RETURN's.
>> > 2.1.  Starting with its genesis cons-pair hash (equivalent to the empty
>> > list) as the current cons-pair, it scans each OP_RETURN transaction.
>> > 2.1.1.  If an OP_RETURN is 64-byte and has the parent cons-pair equal to
>> > the current cons-pair, look for the side block indicated and confirm its
>> > correctness.  If correct, update the current cons-pair for the hash of
>> > the OP_RETURN data.
>> > 2.2.  When reaching the latest mainchain block, the current cons-pair is
>> > now the sidecoin/altcoin latest block.
>> > 2.3.  Note that if multiple OP_RETURN in a block match the current
>> > cons-pair, the first one is considered the correct chain.  This property
>> > means that the sidechain/altchain can only have a chainsplit if the
>> > mainchain has a chainsplit.
>> > 3.  When a sidechain-miner wants to create a side-block, it generates a
>> > new cons-pair and creates an OP_RETURN transaction for it, paying a
>> > mainchain-miner to include it in the next mainchain-block.
>> > 3.1.  The sidechain-miner risks that its competitors will outbid it and
>> > get its OP_RETURN earlier in a mainchain-block (or earlier in the order
>> > of transactions).  It can mitigate this risk by updating itself to
>> > become a mainchain-miner, it can then keep its OP_RETURN transaction
>> > private and put it earlier in the block, ensuring it will "win" the
>> > sidechain-consensus if it wins the mainchain-consensus.
>> >
>> > Regards,
>> > ZmnSCPxj
>> >
>> > -------- Original Message --------
>> > Subject: [bitcoin-dev] BIP: OP_BRIBVERIFY - the op code needed for Blind
>> > Merge Mined drivechains
>> > Local Time: June 28, 2017 8:37 AM
>> > UTC Time: June 28, 2017 12:37 AM
>> > From: bitcoin-dev at lists.linuxfoundation.org
>> > To: Bitcoin Protocol Discussion <bitcoin-dev at lists.linuxfoundation.org>
>> >
>> > <pre>
>> >   BIP: <BIP number>
>> >   Layer: Consensus (Soft fork)
>> >   Title: OP_BRIBEVERIFY
>> >   Author: Chris Stewart <chris at suredbits.com>
>> >   Status: Draft
>> >   Type: Standards Track
>> >   Created: 2017-06-27
>> > </pre>
>> >
>> >
>> > ==Abstract==
>> >
>> > This BIP describes a new opcode, OP_BRIBEVERIFY, for the Bitcoin
>> > scripting system that allows for a user to bribe a miner to include a
>> hash
>> > in the coinbase transaction's output.
>> >
>> >
>> > ==Summary==
>> >
>> > BRIBEVERIFY redefines the existing NOP4 opcode. When executed, if the
>> given
>> > critical hash is included at the given vout index in the coinbase
>> > transaction
>> > the script evaluates to true. Otherwise, the script will fail.
>> >
>> > This allows sidechains to be merged mined against
>> > bitcoin without burdening bitcoin miners with extra resource
>> requirements.
>> >
>> > ==Motivation==
>> >
>> > The current political climate of bitcoin is extremely contentious. Many
>> > community members
>> > have different visions of what bitcoin is. This op code is meant to
>> > enable [http://www.truthcoin.info/blog/blind-merged-mining/ Blind Merge
>> > Mining].
>> > This enables sidechains in Bitcoin. With OP_BRIBEVERIFY, sidechains
>> > miners can
>> > bribe bitcoin miners to to include their block hash in the bitcoin
>> > blockchain. If their block
>> > is included in the coinbase transaction's vout, it is assumed that block
>> > is a mined block on the sidechain.
>> >
>> > This will allow various factions of the community to realize their
>> > vision on their own separate
>> > blockchain that is interoperable with the bitcoin blockchain. This
>> > allows those factions to use
>> > bitcoin as a 'reserve currency' for their own network.
>> >
>> >
>> > ===Commitment Structure===
>> >
>> > A new block rule is added which requires that the miner's coinbase
>> > reward be at index 0 in the coinbase transaction's output vector.
>> >
>> > It also fixes the witness commitment output to be at index 1 of the
>> > coinbase transaction's output vector.
>> >
>> > This is needed so we can reliably tell what vout corresponds to what
>> > drivechain. For instance, the mimblewimble sidechain
>> > could correspond to index 2 of the vector outputs on the coinbase
>> > transaction.
>> >
>> > The commitment is recorded in a <code>scriptPubKey</code> of the
>> > coinbase transaction. It must be at least 34 bytes in size
>> >    1-byte - OP_RETURN (0x6a)
>> >    1-byte - Push the following 32 bytes (0x20)
>> >   32-byte - block hash
>> >
>> > the 35th byte and onward have no consensus meaning.
>> >
>> > ===OP_BRIBEVERIFY op code===
>> >
>> > This op code reads two arguments from the stack. The stack top is
>> > expected to be a sidechain id for which this user attempting to blind
>> > merge mine for.
>> > The next element on the stack is expected to be a block hash. This op
>> > code looks into the coinbase transaction's output vector at the given
>> > index (which is derived from the sidechain id) and checks
>> > to see if the hash in the block matches the hash inside of the
>> > BRIBEVERIFY program. If the hashes match, the OP_BRIBEVERIFY acts as an
>> > OP_NOP. If the
>> > comparison between the two hashes fail, the script fails.
>> >
>> > ===BRIBEVERIFY program===
>> >
>> > A standard BRIBEVERIFY program has the format:
>> >   1-byte - Push the following 32 bytes (0x20)
>> >  32-byte - block hash
>> >   1 byte - Push operation? (needed if number can't be encoded as OP_0 -
>> > OP_16)
>> >   1 byte - sidechain id
>> >   1 byte - OP_BRIBEVERIFY op code
>> >
>> > ==Detailed Specification==
>> >
>> > Refer to the reference implementation, reproduced below, for the precise
>> > semantics and detailed rationale for those semantics.
>> >
>> >
>> >  case OP_NOP4:
>> >  {
>> >     //format: block_hash sidechain_id OP_BRIBEVERIFY
>> >     if (!(flags & SCRIPT_VERIFY_BRIBEVERIFY)) {
>> >         // not enabled; treat as a NOP4
>> >         if (flags & SCRIPT_VERIFY_DISCOURAGE_UPGRADABLE_NOPS) {
>> >             return set_error(serror, SCRIPT_ERR_DISCOURAGE_UPGRADAB
>> LE_NOPS);
>> >         }
>> >         break;
>> >     }
>> >
>> >     if (stack.size() < 2)
>> >         return set_error(serror, SCRIPT_ERR_INVALID_STACK_OPERATION);
>> >
>> >     const CScriptNum scriptNumSidechainId(stacktop(
>> -1),fRequireMinimal);
>> >     uint8_t nSidechainId;
>> >     if (!checker.CheckSidechainId(scriptNumSidechainId,nSidechainId)) {
>> >         return set_error(serror, SCRIPT_ERR_UNKNOWN_SIDECHAIN);
>> >     }
>> >
>> >     // Check block hash
>> >     bool fHashCritical =
>> > checker.CheckCriticalHash(stacktop(-2),nSidechainId);
>> >     if (!fHashCritical) {
>> >         return set_error(serror, SCRIPT_ERR_UNSATISFIED_BRIBE);
>> >     }
>> >     break;
>> >  }
>> >
>> >
>> >
>> > https://github.com/Christewart/bitcoin/blob/94b6f33f2278c42d
>> 4d8758a3c8ffe2078e4ec933/src/script/interpreter.cpp#L427
>> >
>> > https://github.com/drivechain-project/bitcoin/pull/13
>> >
>> > ==Deployment==
>> >
>> > TODO
>> >
>> > ==Credits==
>> >
>> > Credit to Paul Sztorc for the original idea of Blind Merge Mined
>> sidechains.
>> >
>> > Credit to CryptAxe for writing the foundational layer of software for
>> > drivechains so I could implement OP_BRIBEVERIFY.
>> >
>> >
>> > ==References==
>> >
>> > Blind Merge Mined Sidechains -
>> > http://www.truthcoin.info/blog/blind-merged-mining/
>> > Mailing list discussion -
>> > https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017
>> -May/014408.html
>> >
>> > ==Copyright==
>> >
>> > This document is placed in the public domain.
>> >
>> >
>> > _______________________________________________
>> > bitcoin-dev mailing list
>> > bitcoin-dev at lists.linuxfoundation.org
>> > https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>> >
>> _______________________________________________
>> bitcoin-dev mailing list
>> bitcoin-dev at lists.linuxfoundation.org
>> https://lists.linuxfoundation.org/mailman/listinfo/bitcoin-dev
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170628/be436e01/attachment-0001.html>

From ZmnSCPxj at protonmail.com  Fri Jun 30 04:00:27 2017
From: ZmnSCPxj at protonmail.com (ZmnSCPxj)
Date: Fri, 30 Jun 2017 00:00:27 -0400
Subject: [bitcoin-dev] BIP: OP_BRIBVERIFY - the op code needed for Blind
	Merge Mined drivechains
In-Reply-To: <2f2e6b7c-2d47-518a-5a8f-0b5333607aac@gmail.com>
References: <CAGL6+mHQ_vMc2JYVqwfP89WOZdUF2WDtWfh7ccL1PQve=nC+zQ@mail.gmail.com>
	<OozQK1_gWeExd5578AYH_dHnSKSvx63FJc2rIBBcaJF4f07qzsR8rr-ka5epwMFCjqDuidAWZiZqqlvn4xvSuUpDY0KkV014VQs6_E3Rp_A=@protonmail.com>
	<2f2e6b7c-2d47-518a-5a8f-0b5333607aac@gmail.com>
Message-ID: <lYqi6yZAdUknHWs2DvSaM3h1tf3EVLngILZV9gbVBm5JVI96RvBGZaPBEFYNzt0QBkjdJ614BTsWjUkmuuqSd7RPFx-ihUL6SIXocqyW_ss=@protonmail.com>

Good Morning Paul,
>It seems that, in your version, the "bribers" would react to the scheme
>in inefficient ways, particularly when the mainchain"s tx-fee-rate (ie
>fee per Kb) is low.
>
>In short, there would be many bribe-attempts (each of which would take
>up space in mainchain blocks), almost all of which would be unsuccessful.
>
>In turn, miners would likely react to this, and try to improve the state
>of affairs by offering users the privilege of occupying transaction slot
>#2 (ie, the one right after the coinbase). Users would need to trust
>miners for this, which introduces a cost friction which is pure
>deadweight loss. And, it might be easier for larger/older miners to be
>trustworthy than smaller/newer ones.
I understand.
>Your way is actually very similar to mine. Mine _forces_ the bribe to be
>in the earliest txn (the coinbase) and to only occur once. Yours doesn"t
>do anything to refund the briber, if the sidechain (but not the
>mainchain) reorganizes (as it can easily do, if an older sidechain
>parent is extended while the mainchain proceeds normally). This creates
>additional risk.
I don't understand this part. In my scheme, a sidechain cannot reorganize unless the mainchain reorganizes, since the consensus loop only cares about matching the current block; it ignores splits and does not consider them valid.
But I suppose you are considering something like the Ethereum mutability feature, which I do not think is something you would want in a sidechain.
>I think mine is also much more space-efficient. Even if ours each had
>exactly one h* per sidechain per block, it seems that I only require one
>hash to be communicated (plus an indicator byte, and a ~2 byte counter
>for the ratchet), whereas you require two. Since its overhead per
>sidechain per block, it actually might really add up.
Do you not provide a single sidechain's h* twice in the block? Once in the coinbase and once in the briber's separate transaction?
In my scheme at least there is no indicator byte -- the "previous block" hash is the indicator of which sidechain it is extending. From your other emails on this list, it seems the ratchet is for withdrawals from sidechain to mainchain? If so, should it not only appear in only some of the sidechains (the ones which are currently doing some withdrawal?)?
Regards,
ZmnSCPxj
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170630/48b1263c/attachment.html>

From chris at suredbits.com  Fri Jun 30 14:12:30 2017
From: chris at suredbits.com (Chris Stewart)
Date: Fri, 30 Jun 2017 09:12:30 -0500
Subject: [bitcoin-dev] BIP: OP_BRIBVERIFY - the op code needed for Blind
 Merge Mined drivechains
In-Reply-To: <lYqi6yZAdUknHWs2DvSaM3h1tf3EVLngILZV9gbVBm5JVI96RvBGZaPBEFYNzt0QBkjdJ614BTsWjUkmuuqSd7RPFx-ihUL6SIXocqyW_ss=@protonmail.com>
References: <CAGL6+mHQ_vMc2JYVqwfP89WOZdUF2WDtWfh7ccL1PQve=nC+zQ@mail.gmail.com>
	<OozQK1_gWeExd5578AYH_dHnSKSvx63FJc2rIBBcaJF4f07qzsR8rr-ka5epwMFCjqDuidAWZiZqqlvn4xvSuUpDY0KkV014VQs6_E3Rp_A=@protonmail.com>
	<2f2e6b7c-2d47-518a-5a8f-0b5333607aac@gmail.com>
	<lYqi6yZAdUknHWs2DvSaM3h1tf3EVLngILZV9gbVBm5JVI96RvBGZaPBEFYNzt0QBkjdJ614BTsWjUkmuuqSd7RPFx-ihUL6SIXocqyW_ss=@protonmail.com>
Message-ID: <CAGL6+mF8Jh2qFYX=yDx=w7G83YX0eYhKXyRckDSvLH2v0OTJTA@mail.gmail.com>

>I don't understand this part.  In my scheme, a sidechain cannot reorganize
unless the mainchain reorganizes, since the consensus loop only cares about
matching the current block; it ignores splits and does not consider them
valid.

Maybe I am misunderstanding you, but isn't this a flaw not a feature? What
if a attacker pays a large fee to have his *invalid* block hash included in
the bitcoin mainchain? Would this block *have* to be included in the
sidechain's blockchain forever since *it was* included in bitcoin
blockchain?

>Do you not provide a single sidechain's h* twice in the block?  Once in
the coinbase and once in the briber's separate transaction?

Yes, my BIP proposal does this.

>In my scheme at least there is no indicator byte -- the "previous block"
hash is the indicator of which sidechain it is extending.  From your other
emails on this list, it seems the ratchet is for withdrawals from sidechain
to mainchain?  If so, should it not only appear in only some of the
sidechains (the ones which are currently doing some withdrawal?)?

Maybe I am missing something here, but why we do *explicitly* commit to the
previous block hash? Isn't it implicitly committed to via SHA256(SHA256())?
If a drivechain node tries to sync the drivechain from bitcoin's commitment
headers, it will invalidate that block since
the block hash does not correctly reference the previous block hash. AFAICT
there is no need to explicitly specify the previous block hash in the OP_BV
output. In general, I don't think we should assume these commitment headers
dictate the strict ordering of blocks on the sidechain -- only potential
blocks that
*might* be valid. To guarantee full validity drivechain nodes will have to
download the full block and figure out if they follow all of the consensus
rules.

This is sort of like headers first sync in bitcoin core:

https://bitcoin.org/en/developer-guide#headers-first

-Chris

On Thu, Jun 29, 2017 at 11:00 PM, ZmnSCPxj <ZmnSCPxj at protonmail.com> wrote:

> Good Morning Paul,
>
> >It seems that, in your version, the "bribers" would react to the scheme
> >in inefficient ways, particularly when the mainchain"s tx-fee-rate (ie
> >fee per Kb) is low.
> >
> >In short, there would be many bribe-attempts (each of which would take
> >up space in mainchain blocks), almost all of which would be unsuccessful.
> >
> >In turn, miners would likely react to this, and try to improve the state
> >of affairs by offering users the privilege of occupying transaction slot
> >#2 (ie, the one right after the coinbase). Users would need to trust
> >miners for this, which introduces a cost friction which is pure
> >deadweight loss. And, it might be easier for larger/older miners to be
> >trustworthy than smaller/newer ones.
>
> I understand.
>
> >Your way is actually very similar to mine. Mine _forces_ the bribe to be
> >in the earliest txn (the coinbase) and to only occur once. Yours doesn"t
> >do anything to refund the briber, if the sidechain (but not the
> >mainchain) reorganizes (as it can easily do, if an older sidechain
> >parent is extended while the mainchain proceeds normally). This creates
> >additional risk.
>
> I don't understand this part.  In my scheme, a sidechain cannot reorganize
> unless the mainchain reorganizes, since the consensus loop only cares about
> matching the current block; it ignores splits and does not consider them
> valid.
>
> But I suppose you are considering something like the Ethereum mutability
> feature, which I do not think is something you would want in a sidechain.
>
> >I think mine is also much more space-efficient. Even if ours each had
> >exactly one h* per sidechain per block, it seems that I only require one
> >hash to be communicated (plus an indicator byte, and a ~2 byte counter
> >for the ratchet), whereas you require two. Since its overhead per
> >sidechain per block, it actually might really add up.
>
> Do you not provide a single sidechain's h* twice in the block?  Once in
> the coinbase and once in the briber's separate transaction?
>
> In my scheme at least there is no indicator byte -- the "previous block"
> hash is the indicator of which sidechain it is extending.  From your other
> emails on this list, it seems the ratchet is for withdrawals from sidechain
> to mainchain?  If so, should it not only appear in only some of the
> sidechains (the ones which are currently doing some withdrawal?)?
>
>
> Regards,
> ZmnSCPxj
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170630/fdacfffe/attachment-0001.html>

From cryptaxe at gmail.com  Fri Jun 30 16:51:34 2017
From: cryptaxe at gmail.com (CryptAxe)
Date: Fri, 30 Jun 2017 09:51:34 -0700
Subject: [bitcoin-dev] BIP: OP_BRIBVERIFY - the op code needed for Blind
 Merge Mined drivechains
In-Reply-To: <lYqi6yZAdUknHWs2DvSaM3h1tf3EVLngILZV9gbVBm5JVI96RvBGZaPBEFYNzt0QBkjdJ614BTsWjUkmuuqSd7RPFx-ihUL6SIXocqyW_ss=@protonmail.com>
References: <CAGL6+mHQ_vMc2JYVqwfP89WOZdUF2WDtWfh7ccL1PQve=nC+zQ@mail.gmail.com>
	<OozQK1_gWeExd5578AYH_dHnSKSvx63FJc2rIBBcaJF4f07qzsR8rr-ka5epwMFCjqDuidAWZiZqqlvn4xvSuUpDY0KkV014VQs6_E3Rp_A=@protonmail.com>
	<2f2e6b7c-2d47-518a-5a8f-0b5333607aac@gmail.com>
	<lYqi6yZAdUknHWs2DvSaM3h1tf3EVLngILZV9gbVBm5JVI96RvBGZaPBEFYNzt0QBkjdJ614BTsWjUkmuuqSd7RPFx-ihUL6SIXocqyW_ss=@protonmail.com>
Message-ID: <CAF5CFkjwdx64F6Ss8Oz=2H1yiu5jWCHZNSoE5W6LD_Husr_Z3g@mail.gmail.com>

To ZmnSCPxj:

I don't understand this part.  In my scheme, a sidechain cannot reorganize
unless the mainchain reorganizes, since the consensus loop only cares about
matching the current block; it ignores splits and does not consider them
valid.

But I suppose you are considering something like the Ethereum mutability
feature, which I do not think is something you would want in a sidechain.


The goal was to allow for sidechain reorgs without effecting the mainchain
at all. With the ratchet system (WIP) the sidechain miners can either move
the side chain forward or start a split at some previous sidechain block
height. This happens as the main chain moves forward normally.

>From your other emails on this list, it seems the ratchet is for
withdrawals from sidechain to mainchain?  ...


The ratchet system is actually what links the h* data from bribes to
sidechain blocks. h*'s (which are sidechain block hashes) are added to the
ratchet system if they move the sidechain forward or start a split like I
mentioned before. Then a sidechain can request of their local mainchain
node to verify the headers they have downloaded from sidechain peers and
form the side chain.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.linuxfoundation.org/pipermail/bitcoin-dev/attachments/20170630/9a6557d5/attachment-0001.html>

